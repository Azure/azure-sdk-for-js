trigger:
  branches:
    include:
      - main
      - feature/*
      - hotfix/*
  paths:
    include:
      - common/tools/dev-tool/

pr:
  branches:
    include:
      - main
      - feature/*
      - hotfix/*

  paths:
    include:
      - common/tools/dev-tool/

jobs:
  - job: 'DevTool'
    displayName: 'Dev-tool validation'

    variables:
      - template: /eng/pipelines/templates/variables/globals.yml
      - template: /eng/pipelines/templates/variables/image.yml

    pool:
      name: $(LINUXPOOL)
      demands: ImageOverride -equals $(LINUXVMIMAGE)

    steps:
      - template: /eng/pipelines/templates/steps/common.yml

      - script: |
          npm install -g pnpm
        displayName: "Install Pnpm"

      - script: |
          pnpm install
        displayName: "Install library dependencies"

      - script: |
          pnpm --filter @azure/dev-tool... build
        displayName: "Build dev-tool"

      - script: |
          pnpm --filter @azure/dev-tool... check-format
        displayName: "Check format for dev-tool"

      - script: |
          pnpm --filter @azure/dev-tool... lint
        displayName: "Lint dev-tool"

      - script: |
          pnpm --filter @azure/dev-tool... test
        displayName: "Run dev-tool unit tests"

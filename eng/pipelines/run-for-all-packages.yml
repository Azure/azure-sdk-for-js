trigger: none
pr: none

stages:
  - stage:
    displayName: Manual Validation All Packages

    pool:
      name: azsdk-pool-mms-ubuntu-2204-general

    jobs:
      - job: BuildAllPackages
        timeoutInMinutes: 120
        steps:
          - template: /eng/pipelines/templates/steps/use-node-version.yml
            parameters:
              NodeVersion: 20.x

          - template: ./templates/steps/generate-doc.yml
            parameters:
              ServiceDirectory: core

          - script: |
              npm install -g pnpm
              pnpm install
            displayName: "Install library dependencies"

          - script: |
              npx turbo run build --filter=@azure/eslint-plugin-azure-sdk... -v
            displayName: "Build ESLint Plugin"

          - script: |
              node eng/tools/ci-runner/index.js build monitor -packages "azure-monitor-opentelemetry-exporter" -v
            displayName: "Build packages to enable typed checking"

          - script: |
              npx turbo run lint --concurrency=100% -v
            displayName: "Lint All Packages"

          - script: |
              npx turbo run build --concurrency=100% -v
            displayName: "Build All Packages"

          - script: |
              npx turbo run build:test --filter=@azure/identity... --filter=@azure/app-configuration... --filter=@azure/event-hubs... --concurrentcy=1 -v
            displayName: "Build Tests for Selected Packages"

          - script: |
              npx turbo run unit-test --filter=@azure/identity... --filter=@azure/app-configuration... --filter=@azure/event-hubs... --concurrentcy=1 -v
            displayName: "Run Unit Tests for Selected Packages"

          - script: |
              npx turbo run integration-test --filter=@azure/app-configuration --filter=@azure/storage-blob --filter=@azure-rest/synapse-access-control --concurrentcy=1 -v
            displayName: "Run Integration Tests for Selected Packages"

parameters:
  Artifact: {}
  Registry: ''
  PathToArtifacts: ''
  DependsOn: []
  VarDependencies: {}

jobs:
  - job: PublishDevPackage_${{ replace(parameters.Artifact.name, '-', '_') }}
    dependsOn: ${{ parameters.DependsOn }}
    variables:
      - template: /eng/pipelines/templates/variables/image.yml
      - ${{ each var in parameters.VarDependencies }}:
        - name: ${{ var.key }}
          value: ${{ var.value }}
    displayName: 'Publish ${{parameters.Artifact.name}} to Dev Feed'
    pool:
      name: $(LINUXPOOL)
      image: $(LINUXVMIMAGE)
      os: linux
    steps:
    - checkout: self
    - download: current
    - task: PowerShell@2
      displayName: Publish to Dev Feed
      inputs:
        targetType: filePath
        filePath: eng/tools/publish-to-npm.ps1
        arguments: -pathToArtifacts ${{parameters.PathToArtifacts}} -accessLevel "public" -tag "$(Tag)" -additionalTag "$(AdditionalTag)" -registry ${{parameters.Registry}} -npmToken $(azure-sdk-npm-token)
        pwsh: true
      condition: succeeded()

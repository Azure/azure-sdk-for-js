variables:
  OSName: 'Windows'
  OSVmImage: 'vs2017-win2016'
  NodeVersion: '10.x'

jobs:
<<<<<<< HEAD
- job: 'Test'

  pool:
    vmImage: '$(OSVmImage)'

  timeoutInMinutes: 240

  steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '$(node.version)'
      displayName: 'Install Node.js $(node.version)'

    # Rather than running "npm install" in the repo root, reduce build time by only installing the "npm-run-all" package,
    # which is the minimum required to run the composite script commands.
    - task: Npm@1
      inputs:
        command: 'custom'
        customCommand: 'install npm-run-all'
      displayName: 'npm install npm-run-all'

  - task: Npm@1
    inputs:
      command: 'custom'
      customCommand: 'run install-client$(NpmCommandSuffix)'
    displayName: 'npm run install-client$(NpmCommandSuffix)'

  - script: npm run live-test-client$(NpmCommandSuffix) -- -- --reporter mocha-multi --reporter-options spec=-,mocha-junit-reporter=- $(AdditionalTestArguments)
    displayName: 'npm run live-test-client$(NpmCommandSuffix)'
    env:
      # Service Bus
      AAD_CLIENT_ID: $(aad-azure-sdk-test-client-id)
      AAD_TENANT_ID: $(aad-azure-sdk-test-tenant-id)
      AAD_CLIENT_SECRET: $(aad-azure-sdk-test-client-secret)
      AZURE_SUBSCRIPTION_ID: $(test-subscription-id)
      CLEAN_NAMESPACE: 'true'
      RESOURCE_GROUP: $(service-bus-test-resource-group)
      SERVICEBUS_CONNECTION_STRING: $(service-bus-test-connection-string)
      # Event Hubs
      EVENTHUB_CONNECTION_STRING: $(js-event-hubs-test-connection-string)
      EVENTHUB_NAME: $(js-event-hubs-test-name)
      IOTHUB_CONNECTION_STRING: $(js-event-hubs-test-iothub-connection-string)
      STORAGE_CONNECTION_STRING: $(js-event-hubs-test-storage-connection-string)

  - task: PublishTestResults@2
    inputs:
      testResultsFiles: '**/test-results.xml'
      testRunTitle: '$(OSName) Node $(NodeVersion)'
    condition: succeededOrFailed()
    displayName: 'Publish test results'

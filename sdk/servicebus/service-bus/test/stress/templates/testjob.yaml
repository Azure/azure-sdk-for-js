{{- range $.Values.scenarios }}
---
{{- $ctx := merge $ (dict "Scenario" . ) -}}
{{- include "stress-test-addons.env-job-template.from-pod" (list $ctx "stress.service-bus") -}}
{{- end }}

{{- define "stress.service-bus" -}}
metadata:
  labels:
    testInstance: "service-bus-{{ .Scenario }}-{{ .Release.Name }}-{{ .Release.Revision }}"
    testName: service-bus-{{ .Scenario }}
    chaos: "true"
spec:
  containers:
    - name: sb-stressperf
      command: ["node", "src/dist/{{ .Scenario }}.js"]
      image: {{ default "stresstestregistry.azurecr.io/javascript" .Values.repository }}/service-bus:{{ default "v1" .Values.tag }}
      {{- include "stress-test-addons.container-env" . | nindent 6 }}
{{- end -}}

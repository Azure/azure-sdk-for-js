<!DOCTYPE html>
<html>
<head>
	<title>ESLint Report</title>
	<style>
	body {
		font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
		font-size: 16px;
		font-weight: normal;
		margin: 0;
		padding: 0;
		color: #333;
	}

	code {
		font: 12px monaco, monospace;
	}

	#overview {
		background: #f3f3f3;
		padding: 20px 30px;
		border-bottom: 10px solid #ccc;
	}

	#overview.bg-success {border-color: #008000;}
	#overview.bg-warning {border-color: #ffa500;}
	#overview.bg-error {border-color: #f00;}

	.bg-success {background: #dff0d8;}
	.bg-warning {background: #fcf8e3;}
	.bg-error {background: #f2dede;}

	.container {
		padding: 0 30px;
	}

	.page-header {
		padding-bottom: 9px;
		margin: 20px 0 20px;
		border-bottom: 1px solid #eee;
	}

	.row {
		display: table;
		width: 100%;
	}

	.column {
		padding: 15px;
		display: table-cell;
	}

	.text-success {
		color: #468847;
	}

	.text-warning {
		color: #f0ad4e;
	}

	.text-error {
		color: #b94a48;
	}

	td, th {
		padding: 5px 10px;
	}

	h1 {
		margin: 0;
	}

	h1 small {
		text-transform: capitalize;
	}

	table#fileOverview {
		margin: 30px;
		width: calc(100vw - 120px);
		border-radius: 5px;
		border: 1px solid #ddd;
		border-spacing: 0;
	}

	th {
		font-weight: 400;
		font-size: normal;
		text-align: left;
		border-bottom: 1px solid #ddd;
	}

	tr.lint-result {
		cursor: pointer;
	}

	tr.lint-result.bg-success {
		cursor: default;
	}

	th span {
		font-weight: 700;
		float: right;
		margin-left: 20px;
	}

	th span:after {
		content: "";
		clear: both;
		display: block;
	}

	tr:last-child td {
		border-bottom: none;
	}

	tr.bg-success th {
		border-color: #d6e9c6;
	}

	tr.bg-warning th {
		border-color: #fbeed5;
	}

	tr.bg-error th {
		border-color: #eed3d7;
	}

	td {
		border-bottom: 1px solid #ddd;
	}

	td a {
		color: #2780e3;
		text-decoration: none;
	}

	td a:hover {
		color: #165ba8;
		text-decoration: underline;
	}

	.icon-box {
		width: 30px;
		-webkit-box-sizing: border-box;
		-moz-box-sizing: border-box;
		box-sizing: border-box;
	}

	.result-summary {
		text-align: right;
	}

	/* Summary Styles */

	.summary-table {
		width: 100%;
	}

	.summary-table, .summary-table th, .summary-table td {
		color: #333;
		border: 1px solid #ddd;
		border-collapse: collapse;
		margin: 0;
	}

	.summary-table th {
		color: #444;
		background-color: #fafafa;
		font-weight: 700;
		text-transform: capitalize;
		border-bottom-width: 2px;
	}

	/* Filters */

	.filters {border: none;}
	.filters legend {
		font-weight: bold;
	}
	.filters input[type="radio"] {
		position: absolute;
		opacity: 0;
	}
	.btn-radio {
		display: inline-block;
		font-weight: bold;
		background: #fff;
		border: 1px solid #ccc;
		padding: 6px 12px;
		cursor: pointer;
	}
	input[type="radio"]:focus + .btn-radio {
		outline: 2px dotted #000;
	}
	input[type="radio"]:checked + .btn-radio {
		background: #e6e6e6;
		-webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
		box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
	}

	/* Accordion */

	.caret {
		display: inline-block;
		width: 0;
		height: 0;
		margin-left: 2px;
		vertical-align: middle;
		border-left: 6px dashed;
		border-top: 6px solid transparent;
		border-bottom: 6px solid transparent;
	}

	.open .caret{
		border-top: 6px dashed;
		border-right: 6px solid transparent;
		border-left: 6px solid transparent;
	}

	.bg-success .caret {
		border: none;
		height: auto;
		width: auto;
	}

	.bg-success .caret:before {
		content: '\02713';
	}

	/* Tabs */

	.nav-tabs {
		margin-bottom: 15px;
		padding-left: 0;
		list-style: none;
		border-bottom: 1px solid #ddd;
	}

	.nav-tabs > li {
		position: relative;
		display: inline-block;
		margin-bottom: -1px;
	}

	.nav-tabs > li > button {
		position: relative;
		display: block;
		padding: 10px 15px;
		margin-right: 2px;
		line-height: 1.5;
		cursor: pointer;
		color: #2780e3;
		background-color: transparent;
		border: 1px solid transparent;
	}

	.nav-tabs > li > button:focus,
	.nav-tabs > li > button:hover {
		color: #165ba8;
		background-color: #e6e6e6;
		border-color: #e6e6e6 #e6e6e6 #ddd;
	}

	.nav-tabs > li.active > button {
		color: #555;
		background-color: #fff;
		border: 1px solid #ddd;
		border-bottom-color: transparent;
		cursor: default;
		text-decoration: none;
	}

	/* Code Styles */

	table.source-code {
		width: 100%;
		margin-top: 10px;
		border-collapse: collapse;
		border: 1px solid #cbcbcb;
		color: #363636;
		-webkit-border-radius: 3px;
		-moz-border-radius: 3px;
		border-radius: 3px;
	}

	table.source-code thead {
		display: none;
	}

	table.source-code td {
		color: #363636;
		border: none;
	}

	table.source-code td.line {
		width: 20px;
		background: #eaeaea;
		text-align: center;
		font-size: 11px;
		padding: 0 10px;
		color: #949494;
	}

	table.source-code tr.bg-success {
		background: #fff;
	}

	table.source-code tr.bg-warning td.line {
		background: #fbeed5;
	}

	table.source-code tr.bg-warning td {
		background: #fcf8e3;
	}

	table.source-code tr.bg-error td.line {
		background: #e6c3c7;
	}

	table.source-code tr.bg-error td {
		background: #f8d5d8;
	}

	table.source-code tr.issue {
		background-color: hsl(240, 20%, 96%);
		font-size: 12px;
		box-shadow: inset 10px 10px 10px -12px hsl(240, 20%, 17%);
		margin-top: 10px;
		padding-top: 5px;
		padding-left: 5px;
		padding-bottom: 2px;
	}

	.issue a {
		float: right;
	}

	table.source-code td.source {
		padding-left: 15px;
		line-height: 15px;
		white-space: pre;
	}

	/* Overwrite classes */

	.hidden {
		display: none;
	}
</style>
</head>
<body>
	<div id="overview" class="bg-error">
		<h1>ESLint Report - <small class="text-error">error</small></h1>
	</div>
	<div class="container">
		<div id="summary">
			<h2 class="page-header">Summary</h2>
			<div>110 problems (102 errors, 8 warnings)</div>
			<div class="row"><div class="column">
	<h3 class="text-error">Top errors</h3>
	<table class="summary-table"><thead>
		<tr>
			<th>rule</th>
			<th>count</th>
		</tr>
	</thead><tbody>
		<tr>
	<td><a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a></td>
	<td>57</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a></td>
	<td>20</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a></td>
	<td>13</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a></td>
	<td>8</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/promise/always-return" target="_blank">promise/always-return</a></td>
	<td>4</td>
</tr>
	</tbody></table>
</div>
<div class="column">
	<h3 class="text-warning">Top warnings</h3>
	<table class="summary-table"><thead>
		<tr>
			<th>rule</th>
			<th>count</th>
		</tr>
	</thead><tbody>
		<tr>
	<td><a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a></td>
	<td>5</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/@typescript-eslint/no-unused-vars" target="_blank">@typescript-eslint/no-unused-vars</a></td>
	<td>3</td>
</tr>
	</tbody></table>
</div>
</div><div class="row">
	<div class="column">
		<h3>Most Problems</h3>
		<table class="summary-table"><thead>
			<tr>
				<th>file path</th>
				<th>errors</th>
				<th>warnings</th>
			</tr>
		</thead><tbody>
			<tr>
	<td><a href="#cCodeAzureSdkForJsSdkServicebusServiceBusSrcServiceBusMessageTs">\src\serviceBusMessage.ts</a></td>
	<td>43</td>
	<td>0</td>
</tr>
<tr>
	<td><a href="#cCodeAzureSdkForJsSdkServicebusServiceBusSrcCoreManagementClientTs">\src\core\managementClient.ts</a></td>
	<td>16</td>
	<td>0</td>
</tr>
<tr>
	<td><a href="#cCodeAzureSdkForJsSdkServicebusServiceBusSrcCoreMessageSenderTs">\src\core\messageSender.ts</a></td>
	<td>11</td>
	<td>3</td>
</tr>
<tr>
	<td><a href="#cCodeAzureSdkForJsSdkServicebusServiceBusSrcCoreBatchingReceiverTs">\src\core\batchingReceiver.ts</a></td>
	<td>8</td>
	<td>4</td>
</tr>
<tr>
	<td><a href="#cCodeAzureSdkForJsSdkServicebusServiceBusSrcCoreMessageReceiverTs">\src\core\messageReceiver.ts</a></td>
	<td>7</td>
	<td>0</td>
</tr>
		</tbody></table>
	</div>
</div>

		</div>
		<div id="details">
			<h2 class="page-header">Details</h2>
			<fieldset class="filters">
				<legend>Filters:</legend>
				<label>
					<input type="radio" name="filters" value="lint-result" checked>
					<span class="btn-radio">All</span>
				</label>
				<label>
					<input type="radio" name="filters" value="warning">
					<span class="btn-radio text-warning">Warnings</span>
				</label>
				<label>
					<input type="radio" name="filters" value="error">
					<span class="btn-radio text-error">Errors</span>
				</label>
			</fieldset>
			<table id="fileOverview">
				<tbody>
					<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcClientTs" class="lint-result bg-success" data-group="f-0" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\client.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcClientEntityContextTs" class="lint-result bg-success" data-group="f-1" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\clientEntityContext.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcConnectionContextTs" class="lint-result bg-warning" data-group="f-2" data-problem-count="1" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\connectionContext.ts
    </th>
    <th class="result-summary">
      1 problem (0 errors, 1 warning)
    </th>
</tr>
<tr class="f-2 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-2"
								data-content="detailSummary-2"
								aria-controls="detailSummary-2"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-2"
								data-content="sourceCode-2"
								aria-controls="sourceCode-2"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-2">
				<div class="row"></div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 69, Column 44: "'context' is defined but never used."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/no-unused-vars" target="_blank">@typescript-eslint/no-unused-vars</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-2">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import * as log from "./log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>import * as os from "os";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>import { packageJsonInfo } from "./util/constants";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>  ConnectionConfig,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>  Constants,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>  ConnectionContextBase,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code>  CreateConnectionContextBaseParameters,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>  Dictionary,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code>  delay,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>  TokenProvider</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>} from "@azure/amqp-common";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code>import { ServiceBusClientOptions } from "./serviceBusClient";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code>import { ClientEntityContext } from "./clientEntityContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code>import { OnAmqpEvent, EventContext, ConnectionEvents } from "rhea-promise";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code> * @interface ConnectionContext</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code> * Provides contextual information like the underlying amqp connection, cbs session, management session,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code> * tokenProvider, senders, receivers, etc. about the ServiceBus client.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code>export interface ConnectionContext extends ConnectionContextBase {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code>   * @property A dictionary of ClientEntityContext</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code>   * objects for each of the client in the `clients` dictionary</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code>  clientContexts: Dictionary&#60;ClientEntityContext&#62;;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code>export namespace ConnectionContext {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code>   * @property {string} userAgent The user agent string for the ServiceBus client.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code>   * See guideline at https://github.com/Azure/azure-sdk/blob/master/docs/design/Telemetry.mdk</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code>  export const userAgent: string = `azsdk-js-azureservicebus/${</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>    packageJsonInfo.version</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code>  } (NODE-VERSION ${process.version}; ${os.type()} ${os.release()})`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code>  export function create(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code>    config: ConnectionConfig,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code>    tokenProvider: TokenProvider,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code>    options?: ServiceBusClientOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code>  ): ConnectionContext {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code>    if (!options) options = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code>    const parameters: CreateConnectionContextBaseParameters = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code>      config: config,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code>      tokenProvider: tokenProvider,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code>      dataTransformer: options.dataTransformer,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>      isEntityPathRequired: false,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code>      connectionProperties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code>        product: "MSJSClient",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code>        userAgent: userAgent,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code>        version: packageJsonInfo.version</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code>    // Let us create the base context and then add ServiceBus specific ConnectionContext properties.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code>    const connectionContext = ConnectionContextBase.create(parameters) as ConnectionContext;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>    connectionContext.clientContexts = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>    // Define listeners to be added to the connection object for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>    // "connection_open" and "connection_error" events.</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 69, Column 44: "'context' is defined but never used."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/no-unused-vars" target="_blank">@typescript-eslint/no-unused-vars</a>
	</td>
</tr><tr class="hit bg-warning">
	<td class="line">69</td>
	<td class="source"><code>    const onConnectionOpen: OnAmqpEvent = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code>      connectionContext.wasConnectionCloseCalled = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code>      log.connectionCtxt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code>        "[%s] setting 'wasConnectionCloseCalled' property of connection context to %s.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code>        connectionContext.connection.id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code>        connectionContext.wasConnectionCloseCalled</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code>    const disconnected: OnAmqpEvent = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code>      const connectionError =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code>        context.connection && context.connection.error ? context.connection.error : undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">81</td>
	<td class="source"><code>      if (connectionError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>          "[%s] Error (context.connection.error) occurred on the amqp connection: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">84</td>
	<td class="source"><code>          connectionContext.connection.id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">85</td>
	<td class="source"><code>          connectionError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">86</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code>      const contextError = context.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code>      if (contextError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">90</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code>          "[%s] Error (context.error) occurred on the amqp connection: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>          connectionContext.connection.id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>          contextError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code>      const state: Readonly&#60;{</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code>        wasConnectionCloseCalled: boolean;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code>        numClients: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>      }&#62; = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code>        wasConnectionCloseCalled: connectionContext.wasConnectionCloseCalled,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code>        numClients: Object.keys(connectionContext.clientContexts).length</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code>      // Clear internal map maintained by rhea to avoid reconnecting of old links once the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>      // connection is back up.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>      connectionContext.connection.removeAllSessions();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code>      // Close the cbs session to ensure all the event handlers are released.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code>      await connectionContext.cbsSession.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">110</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">111</td>
	<td class="source"><code>      // Close the management sessions to ensure all the event handlers are released.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code>      for (const id of Object.keys(connectionContext.clientContexts)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code>        const clientContext = connectionContext.clientContexts[id];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code>        if (clientContext.managementClient) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>          await clientContext.managementClient.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">119</td>
	<td class="source"><code>      // The connection should always be brought back up if the sdk did not call connection.close()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">120</td>
	<td class="source"><code>      // and there was atleast one sender/receiver link on the connection before it went down.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">121</td>
	<td class="source"><code>      log.error("[%s] state: %O", connectionContext.connectionId, state);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">122</td>
	<td class="source"><code>      if (!state.wasConnectionCloseCalled && state.numClients) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">123</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">124</td>
	<td class="source"><code>          "[%s] connection.close() was not called from the sdk and there were some " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">125</td>
	<td class="source"><code>            "clients. We should reconnect.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">126</td>
	<td class="source"><code>          connectionContext.connection.id</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">127</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">128</td>
	<td class="source"><code>        await delay(Constants.connectionReconnectDelay);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">129</td>
	<td class="source"><code>        // reconnect clients if any</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">130</td>
	<td class="source"><code>        for (const id of Object.keys(connectionContext.clientContexts)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">131</td>
	<td class="source"><code>          const clientContext = connectionContext.clientContexts[id];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">132</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">133</td>
	<td class="source"><code>            "[%s] calling detached on client '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">134</td>
	<td class="source"><code>            connectionContext.connection.id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">135</td>
	<td class="source"><code>            clientContext.clientId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">136</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">137</td>
	<td class="source"><code>          clientContext.onDetached(connectionError || contextError).catch((err) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">138</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">139</td>
	<td class="source"><code>              "[%s] An error occurred while reconnecting the sender '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">140</td>
	<td class="source"><code>              connectionContext.connection.id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">141</td>
	<td class="source"><code>              clientContext.clientId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">142</td>
	<td class="source"><code>              err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">143</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">144</td>
	<td class="source"><code>          });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">145</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">146</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">147</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">148</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">149</td>
	<td class="source"><code>    // Add listeners on the connection object.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">150</td>
	<td class="source"><code>    connectionContext.connection.on(ConnectionEvents.connectionOpen, onConnectionOpen);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">151</td>
	<td class="source"><code>    connectionContext.connection.on(ConnectionEvents.disconnected, disconnected);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">152</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">153</td>
	<td class="source"><code>    log.connectionCtxt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">154</td>
	<td class="source"><code>      "[%s] Created connection context successfully.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">155</td>
	<td class="source"><code>      connectionContext.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">156</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">157</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">158</td>
	<td class="source"><code>    return connectionContext;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">159</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">160</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">161</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcCoreBatchingReceiverTs" class="lint-result bg-error" data-group="f-3" data-problem-count="12" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\core\batchingReceiver.ts
    </th>
    <th class="result-summary">
      12 problems (8 errors, 4 warnings)
    </th>
</tr>
<tr class="f-3 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-3"
								data-content="detailSummary-3"
								aria-controls="detailSummary-3"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-3"
								data-content="sourceCode-3"
								aria-controls="sourceCode-3"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-3">
				<div class="row"><div class="column">
	<h3 class="text-error">Top errors</h3>
	<table class="summary-table"><thead>
		<tr>
			<th>rule</th>
			<th>count</th>
		</tr>
	</thead><tbody>
		<tr>
	<td><a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a></td>
	<td>6</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a></td>
	<td>1</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/promise/always-return" target="_blank">promise/always-return</a></td>
	<td>1</td>
</tr>
	</tbody></table>
</div>
<div class="column">
	<h3 class="text-warning">Top warnings</h3>
	<table class="summary-table"><thead>
		<tr>
			<th>rule</th>
			<th>count</th>
		</tr>
	</thead><tbody>
		<tr>
	<td><a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a></td>
	<td>3</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/@typescript-eslint/no-unused-vars" target="_blank">@typescript-eslint/no-unused-vars</a></td>
	<td>1</td>
</tr>
	</tbody></table>
</div>
</div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 81, Column 11: "'onReceiveMessage' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 84, Column 11: "'onReceiveDrain' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 85, Column 11: "'onReceiveError' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 86, Column 11: "'onSessionError' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 90, Column 27: "Missing return type on function."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 161, Column 38: "Missing return type on function."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 172, Column 25: "'context' is defined but never used."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/no-unused-vars" target="_blank">@typescript-eslint/no-unused-vars</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 208, Column 11: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 251, Column 7: "'onReceiveClose' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 272, Column 7: "'onSessionClose' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 362, Column 36: "Missing return type on function."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 413, Column 17: "Each then() should return a value or throw"
		<a href="http://eslint.org/docs/rules/promise/always-return" target="_blank">promise/always-return</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-3">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import * as log from "../log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>import { Constants, translate, MessagingError } from "@azure/amqp-common";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>import { ReceiverEvents, EventContext, OnAmqpEvent, SessionEvents, AmqpError } from "rhea-promise";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>import { ServiceBusMessage } from "../serviceBusMessage";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>  MessageReceiver,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>  ReceiveOptions,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code>  ReceiverType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>  PromiseLike,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code>  OnAmqpEventAsPromise</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>} from "./messageReceiver";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>import { ClientEntityContext } from "../clientEntityContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code>import { throwErrorIfConnectionClosed } from "../util/errors";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code> * Describes the batching receiver where the user can receive a specified number of messages for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code> * a predefined time.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code> * @class BatchingReceiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code> * @extends MessageReceiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code>export class BatchingReceiver extends MessageReceiver {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code>   * @property {boolean} isReceivingMessages Indicates whether the link is actively receiving</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code>   * messages. Default: false.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code>  isReceivingMessages: boolean = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code>   * @property {AmqpError | Error | undefined} detachedError Error that occured when receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>   * got detached. Not applicable when onReceiveError is called.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code>   *  Default: undefined.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code>  private detachedError: AmqpError | Error | undefined = undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code>   * Instantiate a new BatchingReceiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code>   * @constructor</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>   * @param {ClientEntityContext} context The client entity context.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code>   * @param {ReceiveOptions} [options]  Options for how you'd like to connect.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code>  constructor(context: ClientEntityContext, options?: ReceiveOptions) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code>    super(context, ReceiverType.batching, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code>    this.newMessageWaitTimeoutInSeconds = 1;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code>   * Clear the token renewal timer and set the `detachedError` property.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code>   * @param {AmqpError | Error} [receiverError] The receiver error if any.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code>   * @returns {Promise&#60;void&#62;} Promise&#60;void&#62;.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>  async onDetached(receiverError?: AmqpError | Error): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code>    // Clears the token renewal timer. Closes the link and its session if they are open.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code>    await this._closeLink(this._receiver);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code>    this.detachedError = receiverError;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code>   * Receives a batch of messages from a ServiceBus Queue/Topic.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code>   * @param maxMessageCount      The maximum number of messages to receive.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>   * @param idleTimeoutInSeconds The maximum wait time in seconds for which the Receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code>   * should wait to receive the first message. If no message is received by this time,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>   * the returned promise gets resolved to an empty array.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>   * @returns {Promise&#60;ServiceBusMessage[]&#62;} A promise that resolves with an array of Message objects.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">69</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code>  receive(maxMessageCount: number, idleTimeoutInSeconds?: number): Promise&#60;ServiceBusMessage[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code>    if (idleTimeoutInSeconds == null) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code>      idleTimeoutInSeconds = Constants.defaultOperationTimeoutInSeconds;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code>    const brokeredMessages: ServiceBusMessage[] = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code>    this.isReceivingMessages = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code>    return new Promise&#60;ServiceBusMessage[]&#62;((resolve, reject) =&#62; {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 81, Column 11: "'onReceiveMessage' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">81</td>
	<td class="source"><code>      let onReceiveMessage: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>      let onSessionClose: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>      let onReceiveClose: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 84, Column 11: "'onReceiveDrain' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">84</td>
	<td class="source"><code>      let onReceiveDrain: OnAmqpEvent;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 85, Column 11: "'onReceiveError' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">85</td>
	<td class="source"><code>      let onReceiveError: OnAmqpEvent;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 86, Column 11: "'onSessionError' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">86</td>
	<td class="source"><code>      let onSessionError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code>      let firstMessageWaitTimer: NodeJS.Timer | undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code>      // Final action to be performed after maxMessageCount is reached or the maxWaitTime is over.</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 90, Column 27: "Missing return type on function."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a>
	</td>
</tr><tr class="hit bg-warning">
	<td class="line">90</td>
	<td class="source"><code>      const finalAction = () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code>        if (this._newMessageReceivedTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>          clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>        if (firstMessageWaitTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>          clearTimeout(firstMessageWaitTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code>        // Removing listeners, so that the next receiveMessages() call can set them again.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>        if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code>          this._receiver.removeListener(ReceiverEvents.receiverError, onReceiveError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code>          this._receiver.removeListener(ReceiverEvents.message, onReceiveMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>          this._receiver.session.removeListener(SessionEvents.sessionError, onSessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>        if (this.detachedError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>          if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code>            this._receiver.removeListener(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code>          this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">110</td>
	<td class="source"><code>          const err = translate(this.detachedError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">111</td>
	<td class="source"><code>          return reject(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code>        if (this._receiver && this._receiver.credit &#62; 0) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>          log.batching(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code>            "[%s] Receiver '%s': Draining leftover credits(%d).",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">119</td>
	<td class="source"><code>            this._receiver.credit</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">120</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">121</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">122</td>
	<td class="source"><code>          // Setting drain must be accompanied by a flow call (aliased to addCredit in this case).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">123</td>
	<td class="source"><code>          this._receiver.drain = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">124</td>
	<td class="source"><code>          this._receiver.addCredit(1);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">125</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">126</td>
	<td class="source"><code>          if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">127</td>
	<td class="source"><code>            this._receiver.removeListener(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">128</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">129</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">130</td>
	<td class="source"><code>          this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">131</td>
	<td class="source"><code>          log.batching(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">132</td>
	<td class="source"><code>            "[%s] Receiver '%s': Resolving receiveMessages() with %d messages.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">133</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">134</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">135</td>
	<td class="source"><code>            brokeredMessages.length</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">136</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">137</td>
	<td class="source"><code>          resolve(brokeredMessages);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">138</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">139</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">140</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">141</td>
	<td class="source"><code>      /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">142</td>
	<td class="source"><code>       * Resets the timer when a new message is received. If no messages were received for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">143</td>
	<td class="source"><code>       * `newMessageWaitTimeoutInSeconds`, the messages received till now are returned. The</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">144</td>
	<td class="source"><code>       * receiver link stays open for the next receive call, but doesnt receive messages until then</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">145</td>
	<td class="source"><code>       */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">146</td>
	<td class="source"><code>      this.resetTimerOnNewMessageReceived = () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">147</td>
	<td class="source"><code>        if (this._newMessageReceivedTimer) clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">148</td>
	<td class="source"><code>        if (this.newMessageWaitTimeoutInSeconds) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">149</td>
	<td class="source"><code>          this._newMessageReceivedTimer = setTimeout(async () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">150</td>
	<td class="source"><code>            const msg =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">151</td>
	<td class="source"><code>              `BatchingReceiver '${this.name}' did not receive any messages in the last ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">152</td>
	<td class="source"><code>              `${this.newMessageWaitTimeoutInSeconds} seconds. ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">153</td>
	<td class="source"><code>              `Hence ending this batch receive operation.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">154</td>
	<td class="source"><code>            log.error("[%s] %s", this._context.namespace.connectionId, msg);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">155</td>
	<td class="source"><code>            finalAction();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">156</td>
	<td class="source"><code>          }, this.newMessageWaitTimeoutInSeconds * 1000);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">157</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">158</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">159</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">160</td>
	<td class="source"><code>      // Action to be performed after the max wait time is over.</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 161, Column 38: "Missing return type on function."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a>
	</td>
</tr><tr class="hit bg-warning">
	<td class="line">161</td>
	<td class="source"><code>      const actionAfterWaitTimeout = () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">162</td>
	<td class="source"><code>        log.batching(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">163</td>
	<td class="source"><code>          "[%s] Batching Receiver '%s'  max wait time in seconds %d over.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">164</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">165</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">166</td>
	<td class="source"><code>          idleTimeoutInSeconds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">167</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">168</td>
	<td class="source"><code>        return finalAction();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">169</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">170</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">171</td>
	<td class="source"><code>      // Action to be performed on the "receiver_drained" event.</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 172, Column 25: "'context' is defined but never used."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/no-unused-vars" target="_blank">@typescript-eslint/no-unused-vars</a>
	</td>
</tr><tr class="hit bg-warning">
	<td class="line">172</td>
	<td class="source"><code>      onReceiveDrain = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">173</td>
	<td class="source"><code>        if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">174</td>
	<td class="source"><code>          this._receiver.removeListener(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">175</td>
	<td class="source"><code>          this._receiver.drain = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">176</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">177</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">178</td>
	<td class="source"><code>        this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">179</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">180</td>
	<td class="source"><code>        log.batching(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">181</td>
	<td class="source"><code>          "[%s] Receiver '%s' drained. Resolving receiveMessages() with %d messages.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">182</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">183</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">184</td>
	<td class="source"><code>          brokeredMessages.length</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">185</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">186</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">187</td>
	<td class="source"><code>        resolve(brokeredMessages);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">188</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">189</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">190</td>
	<td class="source"><code>      // Action to be performed on the "message" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">191</td>
	<td class="source"><code>      onReceiveMessage = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">192</td>
	<td class="source"><code>        if (firstMessageWaitTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">193</td>
	<td class="source"><code>          clearTimeout(firstMessageWaitTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">194</td>
	<td class="source"><code>          firstMessageWaitTimer = undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">195</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">196</td>
	<td class="source"><code>        this.resetTimerOnNewMessageReceived();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">197</td>
	<td class="source"><code>        try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">198</td>
	<td class="source"><code>          const data: ServiceBusMessage = new ServiceBusMessage(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">199</td>
	<td class="source"><code>            this._context,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">200</td>
	<td class="source"><code>            context.message!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">201</td>
	<td class="source"><code>            context.delivery!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">202</td>
	<td class="source"><code>            true</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">203</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">204</td>
	<td class="source"><code>          if (brokeredMessages.length &#60; maxMessageCount) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">205</td>
	<td class="source"><code>            brokeredMessages.push(data);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">206</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">207</td>
	<td class="source"><code>        } catch (err) {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 208, Column 11: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">208</td>
	<td class="source"><code>          err = err instanceof Error ? err : new Error(JSON.stringify(err));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">209</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">210</td>
	<td class="source"><code>            "[%s] Receiver '%s' received an error while converting AmqpMessage to ServiceBusMessage:\n%O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">211</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">212</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">213</td>
	<td class="source"><code>            err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">214</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">215</td>
	<td class="source"><code>          reject(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">216</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">217</td>
	<td class="source"><code>        if (brokeredMessages.length === maxMessageCount) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">218</td>
	<td class="source"><code>          finalAction();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">219</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">220</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">221</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">222</td>
	<td class="source"><code>      // Action to be taken when an error is received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">223</td>
	<td class="source"><code>      onReceiveError = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">224</td>
	<td class="source"><code>        this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">225</td>
	<td class="source"><code>        const receiver = this._receiver || context.receiver!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">226</td>
	<td class="source"><code>        receiver.removeListener(ReceiverEvents.receiverError, onReceiveError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">227</td>
	<td class="source"><code>        receiver.removeListener(ReceiverEvents.message, onReceiveMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">228</td>
	<td class="source"><code>        receiver.removeListener(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">229</td>
	<td class="source"><code>        receiver.session.removeListener(SessionEvents.sessionError, onSessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">230</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">231</td>
	<td class="source"><code>        const receiverError = context.receiver && context.receiver.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">232</td>
	<td class="source"><code>        let error = new MessagingError("An error occuured while receiving messages.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">233</td>
	<td class="source"><code>        if (receiverError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">234</td>
	<td class="source"><code>          error = translate(receiverError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">235</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">236</td>
	<td class="source"><code>            "[%s] Receiver '%s' received an error:\n%O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">237</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">238</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">239</td>
	<td class="source"><code>            error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">240</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">241</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">242</td>
	<td class="source"><code>        if (firstMessageWaitTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">243</td>
	<td class="source"><code>          clearTimeout(firstMessageWaitTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">244</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">245</td>
	<td class="source"><code>        if (this._newMessageReceivedTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">246</td>
	<td class="source"><code>          clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">247</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">248</td>
	<td class="source"><code>        reject(error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">249</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">250</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 251, Column 7: "'onReceiveClose' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">251</td>
	<td class="source"><code>      onReceiveClose = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">252</td>
	<td class="source"><code>        try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">253</td>
	<td class="source"><code>          this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">254</td>
	<td class="source"><code>          const receiverError = context.receiver && context.receiver.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">255</td>
	<td class="source"><code>          if (receiverError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">256</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">257</td>
	<td class="source"><code>              "[%s] 'receiver_close' event occurred. The associated error is: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">258</td>
	<td class="source"><code>              this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">259</td>
	<td class="source"><code>              receiverError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">260</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">261</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">262</td>
	<td class="source"><code>        } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">263</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">264</td>
	<td class="source"><code>            "[%s] Receiver '%s' error in onClose handler:\n%O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">265</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">266</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">267</td>
	<td class="source"><code>            translate(err)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">268</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">269</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">270</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">271</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 272, Column 7: "'onSessionClose' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">272</td>
	<td class="source"><code>      onSessionClose = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">273</td>
	<td class="source"><code>        try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">274</td>
	<td class="source"><code>          this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">275</td>
	<td class="source"><code>          const sessionError = context.session && context.session.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">276</td>
	<td class="source"><code>          if (sessionError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">277</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">278</td>
	<td class="source"><code>              "[%s] 'session_close' event occurred for receiver '%s'. The associated error is: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">279</td>
	<td class="source"><code>              this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">280</td>
	<td class="source"><code>              this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">281</td>
	<td class="source"><code>              sessionError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">282</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">283</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">284</td>
	<td class="source"><code>        } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">285</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">286</td>
	<td class="source"><code>            "[%s] Receiver '%s' error in onSessionClose handler:\n%O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">287</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">288</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">289</td>
	<td class="source"><code>            translate(err)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">290</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">291</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">292</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">293</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">294</td>
	<td class="source"><code>      onSessionError = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">295</td>
	<td class="source"><code>        this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">296</td>
	<td class="source"><code>        const receiver = this._receiver || context.receiver!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">297</td>
	<td class="source"><code>        receiver.removeListener(ReceiverEvents.receiverError, onReceiveError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">298</td>
	<td class="source"><code>        receiver.removeListener(ReceiverEvents.message, onReceiveMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">299</td>
	<td class="source"><code>        receiver.removeListener(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">300</td>
	<td class="source"><code>        receiver.session.removeListener(SessionEvents.sessionError, onSessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">301</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">302</td>
	<td class="source"><code>        const sessionError = context.session && context.session.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">303</td>
	<td class="source"><code>        let error = new MessagingError("An error occuured while receiving messages.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">304</td>
	<td class="source"><code>        if (sessionError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">305</td>
	<td class="source"><code>          error = translate(sessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">306</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">307</td>
	<td class="source"><code>            "[%s] 'session_close' event occurred for Receiver '%s' received an error:\n%O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">308</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">309</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">310</td>
	<td class="source"><code>            error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">311</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">312</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">313</td>
	<td class="source"><code>        if (firstMessageWaitTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">314</td>
	<td class="source"><code>          clearTimeout(firstMessageWaitTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">315</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">316</td>
	<td class="source"><code>        if (this._newMessageReceivedTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">317</td>
	<td class="source"><code>          clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">318</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">319</td>
	<td class="source"><code>        reject(error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">320</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">321</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">322</td>
	<td class="source"><code>      const onSettled: OnAmqpEvent = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">323</td>
	<td class="source"><code>        const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">324</td>
	<td class="source"><code>        const delivery = context.delivery;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">325</td>
	<td class="source"><code>        if (delivery) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">326</td>
	<td class="source"><code>          const id = delivery.id;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">327</td>
	<td class="source"><code>          const state = delivery.remote_state;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">328</td>
	<td class="source"><code>          const settled = delivery.remote_settled;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">329</td>
	<td class="source"><code>          log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">330</td>
	<td class="source"><code>            "[%s] Delivery with id %d, remote_settled: %s, remote_state: %o has been " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">331</td>
	<td class="source"><code>              "received.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">332</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">333</td>
	<td class="source"><code>            id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">334</td>
	<td class="source"><code>            settled,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">335</td>
	<td class="source"><code>            state && state.error ? state.error : state</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">336</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">337</td>
	<td class="source"><code>          if (settled && this._deliveryDispositionMap.has(id)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">338</td>
	<td class="source"><code>            const promise = this._deliveryDispositionMap.get(id) as PromiseLike;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">339</td>
	<td class="source"><code>            clearTimeout(promise.timer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">340</td>
	<td class="source"><code>            log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">341</td>
	<td class="source"><code>              "[%s] Found the delivery with id %d in the map and cleared the timer.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">342</td>
	<td class="source"><code>              connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">343</td>
	<td class="source"><code>              id</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">344</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">345</td>
	<td class="source"><code>            const deleteResult = this._deliveryDispositionMap.delete(id);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">346</td>
	<td class="source"><code>            log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">347</td>
	<td class="source"><code>              "[%s] Successfully deleted the delivery with id %d from the map.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">348</td>
	<td class="source"><code>              connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">349</td>
	<td class="source"><code>              id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">350</td>
	<td class="source"><code>              deleteResult</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">351</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">352</td>
	<td class="source"><code>            if (state && state.error && (state.error.condition || state.error.description)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">353</td>
	<td class="source"><code>              const error = translate(state.error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">354</td>
	<td class="source"><code>              return promise.reject(error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">355</td>
	<td class="source"><code>            }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">356</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">357</td>
	<td class="source"><code>            return promise.resolve();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">358</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">359</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">360</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">361</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 362, Column 36: "Missing return type on function."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a>
	</td>
</tr><tr class="hit bg-warning">
	<td class="line">362</td>
	<td class="source"><code>      const addCreditAndSetTimer = (reuse?: boolean) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">363</td>
	<td class="source"><code>        log.batching(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">364</td>
	<td class="source"><code>          "[%s] Receiver '%s', adding credit for receiving %d messages.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">365</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">366</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">367</td>
	<td class="source"><code>          maxMessageCount</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">368</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">369</td>
	<td class="source"><code>        // By adding credit here, we let the service know that at max we can handle `maxMessageCount`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">370</td>
	<td class="source"><code>        // number of messages concurrently. We will return the user an array of messages that can</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">371</td>
	<td class="source"><code>        // be of size upto maxMessageCount. Then the user needs to accordingly dispose</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">372</td>
	<td class="source"><code>        // (complete,/abandon/defer/deadletter) the messages from the array.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">373</td>
	<td class="source"><code>        this._receiver!.addCredit(maxMessageCount);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">374</td>
	<td class="source"><code>        let msg: string = "[%s] Setting the wait timer for %d seconds for receiver '%s'.";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">375</td>
	<td class="source"><code>        if (reuse) msg += " Receiver link already present, hence reusing it.";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">376</td>
	<td class="source"><code>        log.batching(msg, this._context.namespace.connectionId, idleTimeoutInSeconds, this.name);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">377</td>
	<td class="source"><code>        firstMessageWaitTimer = setTimeout(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">378</td>
	<td class="source"><code>          actionAfterWaitTimeout,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">379</td>
	<td class="source"><code>          (idleTimeoutInSeconds as number) * 1000</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">380</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">381</td>
	<td class="source"><code>        // TODO: Disabling this for now. We would want to give the user a decent chance to receive</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">382</td>
	<td class="source"><code>        // the first message and only timeout faster if successive messages from there onwards are</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">383</td>
	<td class="source"><code>        // not received quickly. However, it may be possible that there are no pending messages</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">384</td>
	<td class="source"><code>        // currently on the queue. In that case waiting for idleTimeoutInSeconds would be</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">385</td>
	<td class="source"><code>        // unnecessary.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">386</td>
	<td class="source"><code>        // There is a management plane API to get runtimeInfo of the Queue which provides</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">387</td>
	<td class="source"><code>        // information about active messages on the Queue and it's sub Queues. However, this adds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">388</td>
	<td class="source"><code>        // a little complexity. If the first message was delayed due to network latency then there</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">389</td>
	<td class="source"><code>        // are bright chances that the management plane api would receive the same fate.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">390</td>
	<td class="source"><code>        // It would be better to weigh all the options before making a decision.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">391</td>
	<td class="source"><code>        // resetTimerOnNewMessageReceived();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">392</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">393</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">394</td>
	<td class="source"><code>      if (!this.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">395</td>
	<td class="source"><code>        log.batching(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">396</td>
	<td class="source"><code>          "[%s] Receiver '%s', setting max concurrent calls to 0.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">397</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">398</td>
	<td class="source"><code>          this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">399</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">400</td>
	<td class="source"><code>        // while creating the receiver link for batching receiver the max concurrent calls</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">401</td>
	<td class="source"><code>        // i.e. the credit_window on the link is set to zero. After the link is created</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">402</td>
	<td class="source"><code>        // successfully, we add credit which is the maxMessageCount specified by the user.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">403</td>
	<td class="source"><code>        this.maxConcurrentCalls = 0;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">404</td>
	<td class="source"><code>        const rcvrOptions = this._createReceiverOptions(false, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">405</td>
	<td class="source"><code>          onMessage: onReceiveMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">406</td>
	<td class="source"><code>          onError: onReceiveError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">407</td>
	<td class="source"><code>          onSessionError: onSessionError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">408</td>
	<td class="source"><code>          onSettled: onSettled,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">409</td>
	<td class="source"><code>          onClose: onReceiveClose,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">410</td>
	<td class="source"><code>          onSessionClose: onSessionClose</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">411</td>
	<td class="source"><code>        });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">412</td>
	<td class="source"><code>        this._init(rcvrOptions)</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 413, Column 17: "Each then() should return a value or throw"
		<a href="http://eslint.org/docs/rules/promise/always-return" target="_blank">promise/always-return</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">413</td>
	<td class="source"><code>          .then(() =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">414</td>
	<td class="source"><code>            this._receiver!.on(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">415</td>
	<td class="source"><code>            addCreditAndSetTimer();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">416</td>
	<td class="source"><code>          })</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">417</td>
	<td class="source"><code>          .catch(reject);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">418</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">419</td>
	<td class="source"><code>        addCreditAndSetTimer(true);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">420</td>
	<td class="source"><code>        this._receiver!.on(ReceiverEvents.message, onReceiveMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">421</td>
	<td class="source"><code>        this._receiver!.on(ReceiverEvents.receiverError, onReceiveError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">422</td>
	<td class="source"><code>        this._receiver!.on(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">423</td>
	<td class="source"><code>        this._receiver!.session.on(SessionEvents.sessionError, onSessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">424</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">425</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">426</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">427</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">428</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">429</td>
	<td class="source"><code>   * Creates a batching receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">430</td>
	<td class="source"><code>   * @static</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">431</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">432</td>
	<td class="source"><code>   * @param {ClientEntityContext} context    The connection context.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">433</td>
	<td class="source"><code>   * @param {ReceiveOptions} [options]     Receive options.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">434</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">435</td>
	<td class="source"><code>  static create(context: ClientEntityContext, options?: ReceiveOptions): BatchingReceiver {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">436</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">437</td>
	<td class="source"><code>    const bReceiver = new BatchingReceiver(context, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">438</td>
	<td class="source"><code>    context.batchingReceiver = bReceiver;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">439</td>
	<td class="source"><code>    return bReceiver;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">440</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">441</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">442</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcCoreLinkEntityTs" class="lint-result bg-success" data-group="f-4" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\core\linkEntity.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcCoreManagementClientTs" class="lint-result bg-error" data-group="f-5" data-problem-count="16" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\core\managementClient.ts
    </th>
    <th class="result-summary">
      16 problems (16 errors, 0 warnings)
    </th>
</tr>
<tr class="f-5 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-5"
								data-content="detailSummary-5"
								aria-controls="detailSummary-5"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-5"
								data-content="sourceCode-5"
								aria-controls="sourceCode-5"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-5">
				<div class="row"><div class="column">
	<h3 class="text-error">Top errors</h3>
	<table class="summary-table"><thead>
		<tr>
			<th>rule</th>
			<th>count</th>
		</tr>
	</thead><tbody>
		<tr>
	<td><a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a></td>
	<td>11</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a></td>
	<td>3</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a></td>
	<td>2</td>
</tr>
	</tbody></table>
</div>
</div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 393, Column 32: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 394, Column 34: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 395, Column 23: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 484, Column 11: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 656, Column 21: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 740, Column 41: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 743, Column 36: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 746, Column 38: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 749, Column 29: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 799, Column 32: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 800, Column 34: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 801, Column 23: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1268, Column 3: "Member _init should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1320, Column 7: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1330, Column 3: "Member _isMgmtRequestResponseLinkOpen should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1337, Column 3: "Member _safelyGetTypedValueFromArray should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-5">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import Long from "long";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>  EventContext,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>  SenderEvents,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>  ReceiverEvents,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>  SenderOptions,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>  ReceiverOptions,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code>  types,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>  message as RheaMessageUtil,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code>  generate_uuid,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>  string_to_uuid</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>} from "rhea-promise";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code>  defaultLock,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code>  translate,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code>  Constants,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code>  RequestResponseLink,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code>  ConditionErrorNameMapper,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code>  AmqpMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code>  SendRequestOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code>} from "@azure/amqp-common";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code>import { ClientEntityContext } from "../clientEntityContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code>  ReceivedMessageInfo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code>  ServiceBusMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code>  SendableMessageInfo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code>  DispositionStatus,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code>  toAmqpMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>  getMessagePropertyTypeMismatchError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code>} from "../serviceBusMessage";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>import { LinkEntity } from "./linkEntity";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code>import * as log from "../log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code>import { ReceiveMode, fromAmqpMessage } from "../serviceBusMessage";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code>import { toBuffer } from "../util/utils";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code>  throwErrorIfConnectionClosed,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code>  throwTypeErrorIfParameterMissing,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code>  throwTypeErrorIfParameterNotLong,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code>  throwTypeErrorIfParameterTypeMismatch,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>  throwTypeErrorIfParameterIsEmptyString</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code>} from "../util/errors";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code>import { Typed } from "rhea-promise";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code>import { max32BitNumber } from "../util/constants";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code> * Represents a Rule on a Subscription that is used to filter the incoming message from the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code> * Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code>export interface RuleDescription {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code>   * Filter expression used to match messages. Supports 2 types:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code>   * - `string`: SQL-like condition expression that is evaluated against the messages'</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>   * user-defined properties and system properties. All system properties will be prefixed with</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code>   * `sys.` in the condition expression.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code>   * - `CorrelationFilter`: Properties of the filter will be used to match with the message properties.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code>  filter?: string | CorrelationFilter;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code>   * Action to perform if the message satisfies the filtering expression.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code>  action?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code>   * Represents the name of the rule.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>  name: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">69</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code> * Represents the correlation filter expression.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code> * A CorrelationFilter holds a set of conditions that are matched against user and system properties</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code> * of incoming messages from a Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code>export interface CorrelationFilter {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code>   * Value to be matched with the `correlationId` property of the incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code>  correlationId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">81</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>   * Value to be matched with the `messageId` property of the incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">84</td>
	<td class="source"><code>  messageId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">85</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">86</td>
	<td class="source"><code>   * Value to be matched with the `to` property of the incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code>  to?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">90</td>
	<td class="source"><code>   * Value to be matched with the `replyTo` property of the incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>  replyTo?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>   * Value to be matched with the `label` property of the incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code>  label?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code>   * Value to be matched with the `sessionId` property of the incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code>  sessionId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>   * Value to be matched with the `replyToSessionId` property of the incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code>  replyToSessionId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>   * Value to be matched with the `contentType` property of the incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code>  contentType?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">110</td>
	<td class="source"><code>   * Value to be matched with the user properties of the incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">111</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code>  userProperties?: any;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>const correlationProperties = [</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code>  "correlationId",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code>  "messageId",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code>  "to",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">119</td>
	<td class="source"><code>  "replyTo",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">120</td>
	<td class="source"><code>  "label",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">121</td>
	<td class="source"><code>  "sessionId",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">122</td>
	<td class="source"><code>  "replyToSessionId",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">123</td>
	<td class="source"><code>  "contentType",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">124</td>
	<td class="source"><code>  "userProperties"</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">125</td>
	<td class="source"><code>];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">126</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">127</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">128</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">129</td>
	<td class="source"><code> * Options to set when updating the disposition status</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">130</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">131</td>
	<td class="source"><code>interface DispositionStatusOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">132</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">133</td>
	<td class="source"><code>   * @property [propertiesToModify] A dictionary of Service Bus brokered message properties</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">134</td>
	<td class="source"><code>   * to modify.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">135</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">136</td>
	<td class="source"><code>  propertiesToModify?: { [key: string]: any };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">137</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">138</td>
	<td class="source"><code>   * @property [deadLetterReason] The deadletter reason. May be set if disposition status</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">139</td>
	<td class="source"><code>   * is set to suspended.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">140</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">141</td>
	<td class="source"><code>  deadLetterReason?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">142</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">143</td>
	<td class="source"><code>   * @property [deadLetterDescription] The deadletter description. May be set if disposition status</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">144</td>
	<td class="source"><code>   * is set to suspended.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">145</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">146</td>
	<td class="source"><code>  deadLetterDescription?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">147</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">148</td>
	<td class="source"><code>   * This should only be provided if `session` is enabled for a Queue or Topic.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">149</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">150</td>
	<td class="source"><code>  sessionId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">151</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">152</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">153</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">154</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">155</td>
	<td class="source"><code> * Options passed to the constructor of ManagementClient</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">156</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">157</td>
	<td class="source"><code>export interface ManagementClientOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">158</td>
	<td class="source"><code>  address?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">159</td>
	<td class="source"><code>  audience?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">160</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">161</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">162</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">163</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">164</td>
	<td class="source"><code> * @class ManagementClient</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">165</td>
	<td class="source"><code> * Descibes the ServiceBus Management Client that talks</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">166</td>
	<td class="source"><code> * to the $management endpoint over AMQP connection.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">167</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">168</td>
	<td class="source"><code>export class ManagementClient extends LinkEntity {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">169</td>
	<td class="source"><code>  readonly managementLock: string = `${Constants.managementRequestKey}-${generate_uuid()}`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">170</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">171</td>
	<td class="source"><code>   * @property {string} entityPath - The name/path of the entity (queue/topic/subscription name)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">172</td>
	<td class="source"><code>   * for which the management request needs to be made.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">173</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">174</td>
	<td class="source"><code>  entityPath: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">175</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">176</td>
	<td class="source"><code>   * @property {string} replyTo The reply to Guid for the management client.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">177</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">178</td>
	<td class="source"><code>  replyTo: string = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">179</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">180</td>
	<td class="source"><code>   * @property $management sender, receiver on the same session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">181</td>
	<td class="source"><code>   * @private</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">182</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">183</td>
	<td class="source"><code>  private _mgmtReqResLink?: RequestResponseLink;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">184</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">185</td>
	<td class="source"><code>   * @property _lastPeekedSequenceNumber Provides the sequence number of the last peeked message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">186</td>
	<td class="source"><code>   * @private</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">187</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">188</td>
	<td class="source"><code>  private _lastPeekedSequenceNumber: Long = Long.ZERO;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">189</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">190</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">191</td>
	<td class="source"><code>   * @constructor</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">192</td>
	<td class="source"><code>   * Instantiates the management client.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">193</td>
	<td class="source"><code>   * @param {ClientEntityContext} context The client entity context.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">194</td>
	<td class="source"><code>   * @param {ManagementClientOptions} [options] Options to be provided for creating the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">195</td>
	<td class="source"><code>   * "$management" client.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">196</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">197</td>
	<td class="source"><code>  constructor(context: ClientEntityContext, options?: ManagementClientOptions) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">198</td>
	<td class="source"><code>    super(`${context.entityPath}/$management`, context, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">199</td>
	<td class="source"><code>      address: options && options.address ? options.address : Constants.management,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">200</td>
	<td class="source"><code>      audience:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">201</td>
	<td class="source"><code>        options && options.audience</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">202</td>
	<td class="source"><code>          ? options.audience</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">203</td>
	<td class="source"><code>          : `${context.namespace.config.endpoint}${context.entityPath}/$management`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">204</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">205</td>
	<td class="source"><code>    this._context = context;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">206</td>
	<td class="source"><code>    this.entityPath = context.namespace.config.entityPath as string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">207</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">208</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">209</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">210</td>
	<td class="source"><code>   * Closes the AMQP management session to the ServiceBus namespace for this client,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">211</td>
	<td class="source"><code>   * returning a promise that will be resolved when disconnection is completed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">212</td>
	<td class="source"><code>   * @return Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">213</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">214</td>
	<td class="source"><code>  async close(): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">215</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">216</td>
	<td class="source"><code>      if (this._isMgmtRequestResponseLinkOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">217</td>
	<td class="source"><code>        const mgmtLink = this._mgmtReqResLink;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">218</td>
	<td class="source"><code>        this._mgmtReqResLink = undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">219</td>
	<td class="source"><code>        clearTimeout(this._tokenRenewalTimer as NodeJS.Timer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">220</td>
	<td class="source"><code>        await mgmtLink!.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">221</td>
	<td class="source"><code>        log.mgmt("Successfully closed the management session.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">222</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">223</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">224</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">225</td>
	<td class="source"><code>        "[%s] An error occurred while closing the management session: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">226</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">227</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">228</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">229</td>
	<td class="source"><code>      throw err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">230</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">231</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">232</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">233</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">234</td>
	<td class="source"><code>   * Fetches the next batch of active messages. The first call to `peek()` fetches the first</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">235</td>
	<td class="source"><code>   * active message for this client. Each subsequent call fetches the subsequent message in the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">236</td>
	<td class="source"><code>   * entity.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">237</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">238</td>
	<td class="source"><code>   * Unlike a `received` message, `peeked` message will not have lock token associated with it,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">239</td>
	<td class="source"><code>   * and hence it cannot be `Completed/Abandoned/Deferred/Deadlettered/Renewed`. This method will</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">240</td>
	<td class="source"><code>   * also fetch even Deferred messages (but not Deadlettered message).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">241</td>
	<td class="source"><code>   * @param {number} [messageCount] The number of messages to retrieve. Default value `1`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">242</td>
	<td class="source"><code>   * @returns Promise&#60;ReceivedSBMessage[]&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">243</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">244</td>
	<td class="source"><code>  async peek(messageCount?: number, associatedLinkName?: string): Promise&#60;ReceivedMessageInfo[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">245</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">246</td>
	<td class="source"><code>    return this.peekBySequenceNumber(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">247</td>
	<td class="source"><code>      this._lastPeekedSequenceNumber.add(1),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">248</td>
	<td class="source"><code>      messageCount,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">249</td>
	<td class="source"><code>      undefined,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">250</td>
	<td class="source"><code>      associatedLinkName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">251</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">252</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">253</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">254</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">255</td>
	<td class="source"><code>   * Fetches the next batch of active messages in the current MessageSession. The first call to</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">256</td>
	<td class="source"><code>   * `peek()` fetches the first active message for this client. Each subsequent call fetches the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">257</td>
	<td class="source"><code>   * subsequent message in the entity.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">258</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">259</td>
	<td class="source"><code>   * Unlike a `received` message, `peeked` message will not have lock token associated with it,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">260</td>
	<td class="source"><code>   * and hence it cannot be `Completed/Abandoned/Deferred/Deadlettered/Renewed`.  This method will</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">261</td>
	<td class="source"><code>   * also fetch even Deferred messages (but not Deadlettered message).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">262</td>
	<td class="source"><code>   * @param {string} sessionId The sessionId from which messages need to be peeked.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">263</td>
	<td class="source"><code>   * @param {number} [messageCount] The number of messages to retrieve. Default value `1`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">264</td>
	<td class="source"><code>   * @returns Promise&#60;ReceivedMessageInfo[]&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">265</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">266</td>
	<td class="source"><code>  async peekMessagesBySession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">267</td>
	<td class="source"><code>    sessionId: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">268</td>
	<td class="source"><code>    associatedLinkName: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">269</td>
	<td class="source"><code>    messageCount?: number</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">270</td>
	<td class="source"><code>  ): Promise&#60;ReceivedMessageInfo[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">271</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">272</td>
	<td class="source"><code>    return this.peekBySequenceNumber(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">273</td>
	<td class="source"><code>      this._lastPeekedSequenceNumber.add(1),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">274</td>
	<td class="source"><code>      messageCount,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">275</td>
	<td class="source"><code>      sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">276</td>
	<td class="source"><code>      associatedLinkName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">277</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">278</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">279</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">280</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">281</td>
	<td class="source"><code>   * Peeks the desired number of messages from the specified sequence number.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">282</td>
	<td class="source"><code>   * @param {Long} fromSequenceNumber The sequence number from where to read the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">283</td>
	<td class="source"><code>   * @param {number} messageCount The number of messages to retrieve. Default value `1`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">284</td>
	<td class="source"><code>   * @param {string} sessionId The sessionId from which messages need to be peeked.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">285</td>
	<td class="source"><code>   * @returns Promise&#60;ReceivedMessageInfo[]&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">286</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">287</td>
	<td class="source"><code>  async peekBySequenceNumber(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">288</td>
	<td class="source"><code>    fromSequenceNumber: Long,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">289</td>
	<td class="source"><code>    maxMessageCount?: number,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">290</td>
	<td class="source"><code>    sessionId?: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">291</td>
	<td class="source"><code>    associatedLinkName?: string</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">292</td>
	<td class="source"><code>  ): Promise&#60;ReceivedMessageInfo[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">293</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">294</td>
	<td class="source"><code>    const connId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">295</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">296</td>
	<td class="source"><code>    // Checks for fromSequenceNumber</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">297</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(connId, "fromSequenceNumber", fromSequenceNumber);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">298</td>
	<td class="source"><code>    throwTypeErrorIfParameterNotLong(connId, "fromSequenceNumber", fromSequenceNumber);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">299</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">300</td>
	<td class="source"><code>    // Checks for maxMessageCount</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">301</td>
	<td class="source"><code>    if (maxMessageCount !== undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">302</td>
	<td class="source"><code>      throwTypeErrorIfParameterTypeMismatch(connId, "maxMessageCount", maxMessageCount, "number");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">303</td>
	<td class="source"><code>      if (maxMessageCount &#60;= 0) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">304</td>
	<td class="source"><code>        return [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">305</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">306</td>
	<td class="source"><code>    } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">307</td>
	<td class="source"><code>      maxMessageCount = 1;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">308</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">309</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">310</td>
	<td class="source"><code>    const messageList: ReceivedMessageInfo[] = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">311</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">312</td>
	<td class="source"><code>      const messageBody: any = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">313</td>
	<td class="source"><code>      messageBody[Constants.fromSequenceNumber] = types.wrap_long(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">314</td>
	<td class="source"><code>        Buffer.from(fromSequenceNumber.toBytesBE())</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">315</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">316</td>
	<td class="source"><code>      messageBody[Constants.messageCount] = types.wrap_int(maxMessageCount);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">317</td>
	<td class="source"><code>      if (sessionId) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">318</td>
	<td class="source"><code>        messageBody[Constants.sessionIdMapKey] = sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">319</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">320</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">321</td>
	<td class="source"><code>        body: messageBody,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">322</td>
	<td class="source"><code>        message_id: generate_uuid(),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">323</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">324</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">325</td>
	<td class="source"><code>          operation: Constants.operations.peekMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">326</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">327</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">328</td>
	<td class="source"><code>      if (associatedLinkName) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">329</td>
	<td class="source"><code>        request.application_properties![Constants.associatedLinkName] = associatedLinkName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">330</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">331</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">332</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">333</td>
	<td class="source"><code>        "[%s] Peek by sequence number request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">334</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">335</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">336</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">337</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">338</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">339</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">340</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">341</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">342</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">343</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">344</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">345</td>
	<td class="source"><code>      const result = await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">346</td>
	<td class="source"><code>      if (result.application_properties!.statusCode !== 204) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">347</td>
	<td class="source"><code>        const messages = result.body.messages as { message: Buffer }[];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">348</td>
	<td class="source"><code>        for (const msg of messages) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">349</td>
	<td class="source"><code>          const decodedMessage = RheaMessageUtil.decode(msg.message);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">350</td>
	<td class="source"><code>          const message = fromAmqpMessage(decodedMessage as any);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">351</td>
	<td class="source"><code>          message.body = this._context.namespace.dataTransformer.decode(message.body);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">352</td>
	<td class="source"><code>          messageList.push(message);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">353</td>
	<td class="source"><code>          this._lastPeekedSequenceNumber = message.sequenceNumber!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">354</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">355</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">356</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">357</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">358</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">359</td>
	<td class="source"><code>        "An error occurred while sending the request to peek messages to " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">360</td>
	<td class="source"><code>          "$management endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">361</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">362</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">363</td>
	<td class="source"><code>      // statusCode == 404 then do not throw</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">364</td>
	<td class="source"><code>      if (error.name !== ConditionErrorNameMapper["com.microsoft:message-not-found"]) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">365</td>
	<td class="source"><code>        throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">366</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">367</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">368</td>
	<td class="source"><code>    return messageList;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">369</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">370</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">371</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">372</td>
	<td class="source"><code>   * Renews the lock on the message. The lock will be renewed based on the setting specified on</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">373</td>
	<td class="source"><code>   * the queue.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">374</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">375</td>
	<td class="source"><code>   * When a message is received in `PeekLock` mode, the message is locked on the server for this</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">376</td>
	<td class="source"><code>   * receiver instance for a duration as specified during the Queue/Subscription creation</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">377</td>
	<td class="source"><code>   * (LockDuration). If processing of the message requires longer than this duration, the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">378</td>
	<td class="source"><code>   * lock needs to be renewed. For each renewal, it resets the time the message is locked by the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">379</td>
	<td class="source"><code>   * LockDuration set on the Entity.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">380</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">381</td>
	<td class="source"><code>   * @param {string} lockToken Lock token of the message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">382</td>
	<td class="source"><code>   * @param {string} associatedLinkName associated link name on which operation is to be executed, if applicable</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">383</td>
	<td class="source"><code>   * @param {SendRequestOptions} [options] Options that can be set while sending the request.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">384</td>
	<td class="source"><code>   * @returns {Promise&#60;Date&#62;} Promise&#60;Date&#62; New lock token expiry date and time in UTC format.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">385</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">386</td>
	<td class="source"><code>  async renewLock(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">387</td>
	<td class="source"><code>    lockToken: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">388</td>
	<td class="source"><code>    associatedLinkName?: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">389</td>
	<td class="source"><code>    options?: SendRequestOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">390</td>
	<td class="source"><code>  ): Promise&#60;Date&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">391</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">392</td>
	<td class="source"><code>    if (!options) options = {};</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 393, Column 32: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">393</td>
	<td class="source"><code>    if (options.delayInSeconds == undefined) options.delayInSeconds = 1;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 394, Column 34: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">394</td>
	<td class="source"><code>    if (options.timeoutInSeconds == undefined) options.timeoutInSeconds = 5;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 395, Column 23: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">395</td>
	<td class="source"><code>    if (options.times == undefined) options.times = 5;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">396</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">397</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">398</td>
	<td class="source"><code>      const messageBody: any = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">399</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">400</td>
	<td class="source"><code>      messageBody[Constants.lockTokens] = types.wrap_array(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">401</td>
	<td class="source"><code>        [string_to_uuid(lockToken)],</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">402</td>
	<td class="source"><code>        0x98,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">403</td>
	<td class="source"><code>        undefined</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">404</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">405</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">406</td>
	<td class="source"><code>        body: messageBody,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">407</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">408</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">409</td>
	<td class="source"><code>          operation: Constants.operations.renewLock</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">410</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">411</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">412</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">413</td>
	<td class="source"><code>      if (associatedLinkName) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">414</td>
	<td class="source"><code>        request.application_properties![Constants.associatedLinkName] = associatedLinkName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">415</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">416</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">417</td>
	<td class="source"><code>        "[%s] Renew message Lock request: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">418</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">419</td>
	<td class="source"><code>        request</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">420</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">421</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">422</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">423</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">424</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">425</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">426</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">427</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">428</td>
	<td class="source"><code>      const result = await this._mgmtReqResLink!.sendRequest(request, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">429</td>
	<td class="source"><code>      const lockedUntilUtc = new Date(result.body.expirations[0]);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">430</td>
	<td class="source"><code>      return lockedUntilUtc;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">431</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">432</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">433</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">434</td>
	<td class="source"><code>        "An error occurred while sending the renew lock request to $management " + "endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">435</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">436</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">437</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">438</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">439</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">440</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">441</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">442</td>
	<td class="source"><code>   * Schedules an array of messages to appear on Service Bus at a later time.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">443</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">444</td>
	<td class="source"><code>   * @param scheduledEnqueueTimeUtc - The UTC time at which the messages should be enqueued.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">445</td>
	<td class="source"><code>   * @param messages - An array of messages that needs to be scheduled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">446</td>
	<td class="source"><code>   * @returns Promise&#60;number&#62; The sequence numbers of messages that were scheduled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">447</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">448</td>
	<td class="source"><code>  async scheduleMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">449</td>
	<td class="source"><code>    scheduledEnqueueTimeUtc: Date,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">450</td>
	<td class="source"><code>    messages: SendableMessageInfo[],</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">451</td>
	<td class="source"><code>    associatedLinkName?: string</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">452</td>
	<td class="source"><code>  ): Promise&#60;Long[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">453</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">454</td>
	<td class="source"><code>    const messageBody: any[] = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">455</td>
	<td class="source"><code>    for (let i = 0; i &#60; messages.length; i++) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">456</td>
	<td class="source"><code>      const item = messages[i];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">457</td>
	<td class="source"><code>      if (!item.messageId) item.messageId = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">458</td>
	<td class="source"><code>      item.scheduledEnqueueTimeUtc = scheduledEnqueueTimeUtc;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">459</td>
	<td class="source"><code>      const amqpMessage = toAmqpMessage(item);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">460</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">461</td>
	<td class="source"><code>      try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">462</td>
	<td class="source"><code>        const entry: any = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">463</td>
	<td class="source"><code>          message: RheaMessageUtil.encode(amqpMessage),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">464</td>
	<td class="source"><code>          "message-id": item.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">465</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">466</td>
	<td class="source"><code>        if (item.sessionId) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">467</td>
	<td class="source"><code>          entry[Constants.sessionIdMapKey] = item.sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">468</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">469</td>
	<td class="source"><code>        if (item.partitionKey) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">470</td>
	<td class="source"><code>          entry["partition-key"] = item.partitionKey;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">471</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">472</td>
	<td class="source"><code>        if (item.viaPartitionKey) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">473</td>
	<td class="source"><code>          entry["via-partition-key"] = item.viaPartitionKey;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">474</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">475</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">476</td>
	<td class="source"><code>        const wrappedEntry = types.wrap_map(entry);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">477</td>
	<td class="source"><code>        messageBody.push(wrappedEntry);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">478</td>
	<td class="source"><code>      } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">479</td>
	<td class="source"><code>        if (err instanceof TypeError || err.name === "TypeError") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">480</td>
	<td class="source"><code>          // `RheaMessageUtil.encode` can fail if message properties are of invalid type</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">481</td>
	<td class="source"><code>          // rhea throws errors with name `TypeError` but not an instance of `TypeError`, so catch them too</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">482</td>
	<td class="source"><code>          // Errors in such cases do not have user friendy message or call stack</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">483</td>
	<td class="source"><code>          // So use `getMessagePropertyTypeMismatchError` to get a better error message</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 484, Column 11: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">484</td>
	<td class="source"><code>          err = getMessagePropertyTypeMismatchError(item) || err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">485</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">486</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">487</td>
	<td class="source"><code>        const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">488</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">489</td>
	<td class="source"><code>          "An error occurred while encoding the item at position %d in the messages array" + ": %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">490</td>
	<td class="source"><code>          i,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">491</td>
	<td class="source"><code>          error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">492</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">493</td>
	<td class="source"><code>        throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">494</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">495</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">496</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">497</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">498</td>
	<td class="source"><code>        body: { messages: messageBody },</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">499</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">500</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">501</td>
	<td class="source"><code>          operation: Constants.operations.scheduleMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">502</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">503</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">504</td>
	<td class="source"><code>      if (associatedLinkName) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">505</td>
	<td class="source"><code>        request.application_properties![Constants.associatedLinkName] = associatedLinkName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">506</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">507</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">508</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">509</td>
	<td class="source"><code>        "[%s] Schedule messages request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">510</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">511</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">512</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">513</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">514</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">515</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">516</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">517</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">518</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">519</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">520</td>
	<td class="source"><code>      const result = await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">521</td>
	<td class="source"><code>      const sequenceNumbers = result.body[Constants.sequenceNumbers];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">522</td>
	<td class="source"><code>      const sequenceNumbersAsLong = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">523</td>
	<td class="source"><code>      for (let i = 0; i &#60; sequenceNumbers.length; i++) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">524</td>
	<td class="source"><code>        if (typeof sequenceNumbers[i] === "number") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">525</td>
	<td class="source"><code>          sequenceNumbersAsLong.push(Long.fromNumber(sequenceNumbers[i]));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">526</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">527</td>
	<td class="source"><code>          sequenceNumbersAsLong.push(Long.fromBytesBE(sequenceNumbers[i]));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">528</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">529</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">530</td>
	<td class="source"><code>      return sequenceNumbersAsLong;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">531</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">532</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">533</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">534</td>
	<td class="source"><code>        "An error occurred while sending the request to schedule messages to " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">535</td>
	<td class="source"><code>          "$management endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">536</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">537</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">538</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">539</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">540</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">541</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">542</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">543</td>
	<td class="source"><code>   * Cancels an array of messages that were scheduled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">544</td>
	<td class="source"><code>   * @param sequenceNumbers - An Array of sequence numbers of the message to be cancelled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">545</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">546</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">547</td>
	<td class="source"><code>  async cancelScheduledMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">548</td>
	<td class="source"><code>    sequenceNumbers: Long[],</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">549</td>
	<td class="source"><code>    associatedLinkName?: string</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">550</td>
	<td class="source"><code>  ): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">551</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">552</td>
	<td class="source"><code>    const messageBody: any = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">553</td>
	<td class="source"><code>    messageBody[Constants.sequenceNumbers] = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">554</td>
	<td class="source"><code>    for (let i = 0; i &#60; sequenceNumbers.length; i++) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">555</td>
	<td class="source"><code>      const sequenceNumber = sequenceNumbers[i];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">556</td>
	<td class="source"><code>      try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">557</td>
	<td class="source"><code>        messageBody[Constants.sequenceNumbers].push(Buffer.from(sequenceNumber.toBytesBE()));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">558</td>
	<td class="source"><code>      } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">559</td>
	<td class="source"><code>        const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">560</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">561</td>
	<td class="source"><code>          "An error occurred while encoding the item at position %d in the " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">562</td>
	<td class="source"><code>            "sequenceNumbers array: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">563</td>
	<td class="source"><code>          i,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">564</td>
	<td class="source"><code>          error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">565</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">566</td>
	<td class="source"><code>        throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">567</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">568</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">569</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">570</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">571</td>
	<td class="source"><code>      messageBody[Constants.sequenceNumbers] = types.wrap_array(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">572</td>
	<td class="source"><code>        messageBody[Constants.sequenceNumbers],</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">573</td>
	<td class="source"><code>        0x81,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">574</td>
	<td class="source"><code>        undefined</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">575</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">576</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">577</td>
	<td class="source"><code>        body: messageBody,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">578</td>
	<td class="source"><code>        message_id: generate_uuid(),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">579</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">580</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">581</td>
	<td class="source"><code>          operation: Constants.operations.cancelScheduledMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">582</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">583</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">584</td>
	<td class="source"><code>      if (associatedLinkName) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">585</td>
	<td class="source"><code>        request.application_properties![Constants.associatedLinkName] = associatedLinkName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">586</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">587</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">588</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">589</td>
	<td class="source"><code>        "[%s] Cancel scheduled messages request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">590</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">591</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">592</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">593</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">594</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">595</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">596</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">597</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">598</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">599</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">600</td>
	<td class="source"><code>      await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">601</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">602</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">603</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">604</td>
	<td class="source"><code>        "An error occurred while sending the request to cancel the scheduled message to " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">605</td>
	<td class="source"><code>          "$management endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">606</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">607</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">608</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">609</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">610</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">611</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">612</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">613</td>
	<td class="source"><code>   * Receives a list of deferred messages identified by `sequenceNumbers`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">614</td>
	<td class="source"><code>   * @param sequenceNumbers A list containing the sequence numbers to receive.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">615</td>
	<td class="source"><code>   * @param receiveMode The mode in which the receiver was created.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">616</td>
	<td class="source"><code>   * @returns Promise&#60;ServiceBusMessage[]&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">617</td>
	<td class="source"><code>   * - Returns a list of messages identified by the given sequenceNumbers.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">618</td>
	<td class="source"><code>   * - Returns an empty list if no messages are found.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">619</td>
	<td class="source"><code>   * - Throws an error if the messages have not been deferred.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">620</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">621</td>
	<td class="source"><code>  async receiveDeferredMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">622</td>
	<td class="source"><code>    sequenceNumbers: Long[],</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">623</td>
	<td class="source"><code>    receiveMode: ReceiveMode,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">624</td>
	<td class="source"><code>    associatedLinkName?: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">625</td>
	<td class="source"><code>    sessionId?: string</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">626</td>
	<td class="source"><code>  ): Promise&#60;ServiceBusMessage[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">627</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">628</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">629</td>
	<td class="source"><code>    const messageList: ServiceBusMessage[] = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">630</td>
	<td class="source"><code>    const messageBody: any = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">631</td>
	<td class="source"><code>    messageBody[Constants.sequenceNumbers] = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">632</td>
	<td class="source"><code>    for (let i = 0; i &#60; sequenceNumbers.length; i++) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">633</td>
	<td class="source"><code>      const sequenceNumber = sequenceNumbers[i];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">634</td>
	<td class="source"><code>      try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">635</td>
	<td class="source"><code>        messageBody[Constants.sequenceNumbers].push(Buffer.from(sequenceNumber.toBytesBE()));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">636</td>
	<td class="source"><code>      } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">637</td>
	<td class="source"><code>        const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">638</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">639</td>
	<td class="source"><code>          "An error occurred while encoding the item at position %d in the " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">640</td>
	<td class="source"><code>            "sequenceNumbers array: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">641</td>
	<td class="source"><code>          i,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">642</td>
	<td class="source"><code>          error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">643</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">644</td>
	<td class="source"><code>        throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">645</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">646</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">647</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">648</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">649</td>
	<td class="source"><code>      messageBody[Constants.sequenceNumbers] = types.wrap_array(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">650</td>
	<td class="source"><code>        messageBody[Constants.sequenceNumbers],</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">651</td>
	<td class="source"><code>        0x81,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">652</td>
	<td class="source"><code>        undefined</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">653</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">654</td>
	<td class="source"><code>      const receiverSettleMode: number = receiveMode === ReceiveMode.receiveAndDelete ? 0 : 1;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">655</td>
	<td class="source"><code>      messageBody[Constants.receiverSettleMode] = types.wrap_uint(receiverSettleMode);</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 656, Column 21: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">656</td>
	<td class="source"><code>      if (sessionId != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">657</td>
	<td class="source"><code>        messageBody[Constants.sessionIdMapKey] = sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">658</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">659</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">660</td>
	<td class="source"><code>        body: messageBody,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">661</td>
	<td class="source"><code>        message_id: generate_uuid(),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">662</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">663</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">664</td>
	<td class="source"><code>          operation: Constants.operations.receiveBySequenceNumber</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">665</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">666</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">667</td>
	<td class="source"><code>      if (associatedLinkName) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">668</td>
	<td class="source"><code>        request.application_properties![Constants.associatedLinkName] = associatedLinkName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">669</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">670</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">671</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">672</td>
	<td class="source"><code>        "[%s] Receive deferred messages request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">673</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">674</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">675</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">676</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">677</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">678</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">679</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">680</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">681</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">682</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">683</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">684</td>
	<td class="source"><code>      const result = await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">685</td>
	<td class="source"><code>      const messages = result.body.messages as {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">686</td>
	<td class="source"><code>        message: Buffer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">687</td>
	<td class="source"><code>        "lock-token": Buffer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">688</td>
	<td class="source"><code>      }[];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">689</td>
	<td class="source"><code>      for (const msg of messages) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">690</td>
	<td class="source"><code>        const decodedMessage = RheaMessageUtil.decode(msg.message);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">691</td>
	<td class="source"><code>        const message = new ServiceBusMessage(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">692</td>
	<td class="source"><code>          this._context,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">693</td>
	<td class="source"><code>          decodedMessage as any,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">694</td>
	<td class="source"><code>          { tag: msg["lock-token"] } as any,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">695</td>
	<td class="source"><code>          false</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">696</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">697</td>
	<td class="source"><code>        if (message.lockToken && message.lockedUntilUtc) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">698</td>
	<td class="source"><code>          this._context.requestResponseLockedMessages.set(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">699</td>
	<td class="source"><code>            message.lockToken,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">700</td>
	<td class="source"><code>            message.lockedUntilUtc</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">701</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">702</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">703</td>
	<td class="source"><code>        messageList.push(message);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">704</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">705</td>
	<td class="source"><code>      return messageList;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">706</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">707</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">708</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">709</td>
	<td class="source"><code>        "An error occurred while sending the request to receive deferred messages to " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">710</td>
	<td class="source"><code>          "$management endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">711</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">712</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">713</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">714</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">715</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">716</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">717</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">718</td>
	<td class="source"><code>   * Updates the disposition status of deferred messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">719</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">720</td>
	<td class="source"><code>   * @param lockTokens Message lock tokens to update disposition status.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">721</td>
	<td class="source"><code>   * @param dispositionStatus The disposition status to be set</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">722</td>
	<td class="source"><code>   * @param options Optional parameters that can be provided while updating the disposition status.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">723</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">724</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">725</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">726</td>
	<td class="source"><code>  async updateDispositionStatus(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">727</td>
	<td class="source"><code>    lockToken: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">728</td>
	<td class="source"><code>    dispositionStatus: DispositionStatus,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">729</td>
	<td class="source"><code>    options?: DispositionStatusOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">730</td>
	<td class="source"><code>  ): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">731</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">732</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">733</td>
	<td class="source"><code>    if (!options) options = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">734</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">735</td>
	<td class="source"><code>      const messageBody: any = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">736</td>
	<td class="source"><code>      const lockTokenBuffer: Buffer[] = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">737</td>
	<td class="source"><code>      lockTokenBuffer.push(string_to_uuid(lockToken));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">738</td>
	<td class="source"><code>      messageBody[Constants.lockTokens] = types.wrap_array(lockTokenBuffer, 0x98, undefined);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">739</td>
	<td class="source"><code>      messageBody[Constants.dispositionStatus] = dispositionStatus;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 740, Column 41: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">740</td>
	<td class="source"><code>      if (options.deadLetterDescription != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">741</td>
	<td class="source"><code>        messageBody[Constants.deadLetterDescription] = options.deadLetterDescription;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">742</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 743, Column 36: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">743</td>
	<td class="source"><code>      if (options.deadLetterReason != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">744</td>
	<td class="source"><code>        messageBody[Constants.deadLetterReason] = options.deadLetterReason;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">745</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 746, Column 38: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">746</td>
	<td class="source"><code>      if (options.propertiesToModify != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">747</td>
	<td class="source"><code>        messageBody[Constants.propertiesToModify] = options.propertiesToModify;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">748</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 749, Column 29: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">749</td>
	<td class="source"><code>      if (options.sessionId != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">750</td>
	<td class="source"><code>        messageBody[Constants.sessionIdMapKey] = options.sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">751</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">752</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">753</td>
	<td class="source"><code>        body: messageBody,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">754</td>
	<td class="source"><code>        message_id: generate_uuid(),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">755</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">756</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">757</td>
	<td class="source"><code>          operation: Constants.operations.updateDisposition</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">758</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">759</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">760</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">761</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">762</td>
	<td class="source"><code>        "[%s] Update disposition status request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">763</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">764</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">765</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">766</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">767</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">768</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">769</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">770</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">771</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">772</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">773</td>
	<td class="source"><code>      await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">774</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">775</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">776</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">777</td>
	<td class="source"><code>        "An error occurred while sending the request to update disposition status to " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">778</td>
	<td class="source"><code>          "$management endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">779</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">780</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">781</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">782</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">783</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">784</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">785</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">786</td>
	<td class="source"><code>   * Renews the lock for the specified session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">787</td>
	<td class="source"><code>   * @param sessionId Id of the session for which the lock needs to be renewed</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">788</td>
	<td class="source"><code>   * @param {string} associatedLinkName associated link name on which operation is to be executed, if applicable</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">789</td>
	<td class="source"><code>   * @param options Options that can be set while sending the request.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">790</td>
	<td class="source"><code>   * @returns Promise&#60;Date&#62; New lock token expiry date and time in UTC format.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">791</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">792</td>
	<td class="source"><code>  async renewSessionLock(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">793</td>
	<td class="source"><code>    sessionId: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">794</td>
	<td class="source"><code>    associatedLinkName?: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">795</td>
	<td class="source"><code>    options?: SendRequestOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">796</td>
	<td class="source"><code>  ): Promise&#60;Date&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">797</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">798</td>
	<td class="source"><code>    if (!options) options = {};</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 799, Column 32: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">799</td>
	<td class="source"><code>    if (options.delayInSeconds == undefined) options.delayInSeconds = 1;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 800, Column 34: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">800</td>
	<td class="source"><code>    if (options.timeoutInSeconds == undefined) options.timeoutInSeconds = 5;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 801, Column 23: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">801</td>
	<td class="source"><code>    if (options.times == undefined) options.times = 5;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">802</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">803</td>
	<td class="source"><code>      const messageBody: any = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">804</td>
	<td class="source"><code>      messageBody[Constants.sessionIdMapKey] = sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">805</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">806</td>
	<td class="source"><code>        body: messageBody,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">807</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">808</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">809</td>
	<td class="source"><code>          operation: Constants.operations.renewSessionLock</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">810</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">811</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">812</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">813</td>
	<td class="source"><code>      if (associatedLinkName) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">814</td>
	<td class="source"><code>        request.application_properties![Constants.associatedLinkName] = associatedLinkName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">815</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">816</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">817</td>
	<td class="source"><code>        "[%s] Renew Session Lock request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">818</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">819</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">820</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">821</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">822</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">823</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">824</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">825</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">826</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">827</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">828</td>
	<td class="source"><code>      const result = await this._mgmtReqResLink!.sendRequest(request, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">829</td>
	<td class="source"><code>      const lockedUntilUtc = new Date(result.body.expiration);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">830</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">831</td>
	<td class="source"><code>        "[%s] Lock for session '%s' will expire at %s.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">832</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">833</td>
	<td class="source"><code>        sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">834</td>
	<td class="source"><code>        lockedUntilUtc.toString()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">835</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">836</td>
	<td class="source"><code>      return lockedUntilUtc;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">837</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">838</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">839</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">840</td>
	<td class="source"><code>        "An error occurred while sending the renew lock request to $management " + "endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">841</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">842</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">843</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">844</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">845</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">846</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">847</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">848</td>
	<td class="source"><code>   * Sets the state of the specified session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">849</td>
	<td class="source"><code>   * @param sessionId The session for which the state needs to be set</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">850</td>
	<td class="source"><code>   * @param state The state that needs to be set.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">851</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">852</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">853</td>
	<td class="source"><code>  async setSessionState(sessionId: string, state: any, associatedLinkName: string): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">854</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">855</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">856</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">857</td>
	<td class="source"><code>      const messageBody: any = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">858</td>
	<td class="source"><code>      messageBody[Constants.sessionIdMapKey] = sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">859</td>
	<td class="source"><code>      messageBody["session-state"] = toBuffer(state);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">860</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">861</td>
	<td class="source"><code>        body: messageBody,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">862</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">863</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">864</td>
	<td class="source"><code>          operation: Constants.operations.setSessionState</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">865</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">866</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">867</td>
	<td class="source"><code>      if (associatedLinkName) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">868</td>
	<td class="source"><code>        request.application_properties![Constants.associatedLinkName] = associatedLinkName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">869</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">870</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">871</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">872</td>
	<td class="source"><code>        "[%s] Set Session state request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">873</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">874</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">875</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">876</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">877</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">878</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">879</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">880</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">881</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">882</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">883</td>
	<td class="source"><code>      await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">884</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">885</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">886</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">887</td>
	<td class="source"><code>        "An error occurred while sending the renew lock request to $management " + "endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">888</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">889</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">890</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">891</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">892</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">893</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">894</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">895</td>
	<td class="source"><code>   * Gets the state of the specified session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">896</td>
	<td class="source"><code>   * @param sessionId The session for which the state needs to be retrieved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">897</td>
	<td class="source"><code>   * @returns Promise&#60;any&#62; The state of that session</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">898</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">899</td>
	<td class="source"><code>  async getSessionState(sessionId: string, associatedLinkName: string): Promise&#60;any&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">900</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">901</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">902</td>
	<td class="source"><code>      const messageBody: any = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">903</td>
	<td class="source"><code>      messageBody[Constants.sessionIdMapKey] = sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">904</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">905</td>
	<td class="source"><code>        body: messageBody,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">906</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">907</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">908</td>
	<td class="source"><code>          operation: Constants.operations.getSessionState</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">909</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">910</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">911</td>
	<td class="source"><code>      if (associatedLinkName) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">912</td>
	<td class="source"><code>        request.application_properties![Constants.associatedLinkName] = associatedLinkName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">913</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">914</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">915</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">916</td>
	<td class="source"><code>        "[%s] Get session state request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">917</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">918</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">919</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">920</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">921</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">922</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">923</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">924</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">925</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">926</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">927</td>
	<td class="source"><code>      const result = await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">928</td>
	<td class="source"><code>      return result.body["session-state"]</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">929</td>
	<td class="source"><code>        ? this._context.namespace.dataTransformer.decode(result.body["session-state"])</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">930</td>
	<td class="source"><code>        : result.body["session-state"];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">931</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">932</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">933</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">934</td>
	<td class="source"><code>        "An error occurred while sending the renew lock request to $management " + "endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">935</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">936</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">937</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">938</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">939</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">940</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">941</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">942</td>
	<td class="source"><code>   * Lists the sessions on the ServiceBus Queue/Topic.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">943</td>
	<td class="source"><code>   * @param lastUpdateTime Filter to include only sessions updated after a given time.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">944</td>
	<td class="source"><code>   * @param skip The number of sessions to skip</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">945</td>
	<td class="source"><code>   * @param top Maximum numer of sessions.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">946</td>
	<td class="source"><code>   * @returns Promise&#60;string[]&#62; A list of session ids.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">947</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">948</td>
	<td class="source"><code>  async listMessageSessions(skip: number, top: number, lastUpdatedTime?: Date): Promise&#60;string[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">949</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">950</td>
	<td class="source"><code>    const defaultLastUpdatedTimeForListingSessions: number = 259200000; // 3 * 24 * 3600 * 1000</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">951</td>
	<td class="source"><code>    if (typeof skip !== "number") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">952</td>
	<td class="source"><code>      throw new Error("'skip' is a required parameter and must be of type 'number'.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">953</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">954</td>
	<td class="source"><code>    if (typeof top !== "number") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">955</td>
	<td class="source"><code>      throw new Error("'top' is a required parameter and must be of type 'number'.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">956</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">957</td>
	<td class="source"><code>    if (lastUpdatedTime && !(lastUpdatedTime instanceof Date)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">958</td>
	<td class="source"><code>      throw new Error("'lastUpdatedTime' must be of type 'Date'.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">959</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">960</td>
	<td class="source"><code>    if (!lastUpdatedTime) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">961</td>
	<td class="source"><code>      lastUpdatedTime = new Date(Date.now() - defaultLastUpdatedTimeForListingSessions);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">962</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">963</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">964</td>
	<td class="source"><code>      const messageBody: any = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">965</td>
	<td class="source"><code>      messageBody["last-updated-time"] = lastUpdatedTime;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">966</td>
	<td class="source"><code>      messageBody["skip"] = types.wrap_int(skip);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">967</td>
	<td class="source"><code>      messageBody["top"] = types.wrap_int(top);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">968</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">969</td>
	<td class="source"><code>        body: messageBody,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">970</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">971</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">972</td>
	<td class="source"><code>          operation: Constants.operations.enumerateSessions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">973</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">974</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">975</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">976</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">977</td>
	<td class="source"><code>        "[%s] List sessions request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">978</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">979</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">980</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">981</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">982</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">983</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">984</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">985</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">986</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">987</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">988</td>
	<td class="source"><code>      const response = await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">989</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">990</td>
	<td class="source"><code>      return (response && response.body && response.body["sessions-ids"]) || [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">991</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">992</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">993</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">994</td>
	<td class="source"><code>        "An error occurred while sending the renew lock request to $management " + "endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">995</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">996</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">997</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">998</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">999</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1000</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1001</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1002</td>
	<td class="source"><code>   * Get all the rules on the Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1003</td>
	<td class="source"><code>   * @returns Promise&#60;RuleDescription[]&#62; A list of rules.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1004</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1005</td>
	<td class="source"><code>  async getRules(): Promise&#60;RuleDescription[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1006</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1007</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1008</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1009</td>
	<td class="source"><code>        body: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1010</td>
	<td class="source"><code>          top: types.wrap_int(max32BitNumber),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1011</td>
	<td class="source"><code>          skip: types.wrap_int(0)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1012</td>
	<td class="source"><code>        },</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1013</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1014</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1015</td>
	<td class="source"><code>          operation: Constants.operations.enumerateRules</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1016</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1017</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1018</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1019</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1020</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1021</td>
	<td class="source"><code>        "[%s] Get rules request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1022</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1023</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1024</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1025</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1026</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1027</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1028</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1029</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1030</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1031</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1032</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1033</td>
	<td class="source"><code>      const response = await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1034</td>
	<td class="source"><code>      if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1035</td>
	<td class="source"><code>        response.application_properties!.statusCode === 204 ||</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1036</td>
	<td class="source"><code>        !response.body ||</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1037</td>
	<td class="source"><code>        !Array.isArray(response.body.rules)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1038</td>
	<td class="source"><code>      ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1039</td>
	<td class="source"><code>        return [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1040</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1041</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1042</td>
	<td class="source"><code>      // Reference: https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-amqp-request-response#response-11</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1043</td>
	<td class="source"><code>      const result: { "rule-description": Typed }[] = response.body.rules || [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1044</td>
	<td class="source"><code>      const rules: RuleDescription[] = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1045</td>
	<td class="source"><code>      result.forEach((x) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1046</td>
	<td class="source"><code>        const ruleDescriptor = x["rule-description"];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1047</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1048</td>
	<td class="source"><code>        // We use the first three elements of the `ruleDescriptor.value` to get filter, action, name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1049</td>
	<td class="source"><code>        if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1050</td>
	<td class="source"><code>          !ruleDescriptor ||</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1051</td>
	<td class="source"><code>          !ruleDescriptor.descriptor ||</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1052</td>
	<td class="source"><code>          ruleDescriptor.descriptor.value !== Constants.descriptorCodes.ruleDescriptionList ||</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1053</td>
	<td class="source"><code>          !Array.isArray(ruleDescriptor.value) ||</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1054</td>
	<td class="source"><code>          ruleDescriptor.value.length &#60; 3</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1055</td>
	<td class="source"><code>        ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1056</td>
	<td class="source"><code>          return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1057</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1058</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1059</td>
	<td class="source"><code>        const filtersRawData: Typed = ruleDescriptor.value[0];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1060</td>
	<td class="source"><code>        const actionsRawData: Typed = ruleDescriptor.value[1];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1061</td>
	<td class="source"><code>        const rule: RuleDescription = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1062</td>
	<td class="source"><code>          name: ruleDescriptor.value[2].value</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1063</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1064</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1065</td>
	<td class="source"><code>        switch (filtersRawData.descriptor.value) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1066</td>
	<td class="source"><code>          case Constants.descriptorCodes.trueFilterList:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1067</td>
	<td class="source"><code>            rule.filter = "1=1";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1068</td>
	<td class="source"><code>            break;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1069</td>
	<td class="source"><code>          case Constants.descriptorCodes.falseFilterList:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1070</td>
	<td class="source"><code>            rule.filter = "1=0";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1071</td>
	<td class="source"><code>            break;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1072</td>
	<td class="source"><code>          case Constants.descriptorCodes.sqlFilterList:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1073</td>
	<td class="source"><code>            rule.filter = this._safelyGetTypedValueFromArray(filtersRawData.value, 0);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1074</td>
	<td class="source"><code>            break;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1075</td>
	<td class="source"><code>          case Constants.descriptorCodes.correlationFilterList:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1076</td>
	<td class="source"><code>            rule.filter = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1077</td>
	<td class="source"><code>              correlationId: this._safelyGetTypedValueFromArray(filtersRawData.value, 0),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1078</td>
	<td class="source"><code>              messageId: this._safelyGetTypedValueFromArray(filtersRawData.value, 1),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1079</td>
	<td class="source"><code>              to: this._safelyGetTypedValueFromArray(filtersRawData.value, 2),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1080</td>
	<td class="source"><code>              replyTo: this._safelyGetTypedValueFromArray(filtersRawData.value, 3),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1081</td>
	<td class="source"><code>              label: this._safelyGetTypedValueFromArray(filtersRawData.value, 4),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1082</td>
	<td class="source"><code>              sessionId: this._safelyGetTypedValueFromArray(filtersRawData.value, 5),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1083</td>
	<td class="source"><code>              replyToSessionId: this._safelyGetTypedValueFromArray(filtersRawData.value, 6),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1084</td>
	<td class="source"><code>              contentType: this._safelyGetTypedValueFromArray(filtersRawData.value, 7),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1085</td>
	<td class="source"><code>              userProperties: this._safelyGetTypedValueFromArray(filtersRawData.value, 8)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1086</td>
	<td class="source"><code>            };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1087</td>
	<td class="source"><code>            break;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1088</td>
	<td class="source"><code>          default:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1089</td>
	<td class="source"><code>            log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1090</td>
	<td class="source"><code>              `Found unexpected descriptor code for the filter: ${filtersRawData.descriptor.value}`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1091</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1092</td>
	<td class="source"><code>            break;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1093</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1094</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1095</td>
	<td class="source"><code>        if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1096</td>
	<td class="source"><code>          actionsRawData.descriptor.value === Constants.descriptorCodes.sqlRuleActionList &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1097</td>
	<td class="source"><code>          Array.isArray(actionsRawData.value) &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1098</td>
	<td class="source"><code>          actionsRawData.value.length</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1099</td>
	<td class="source"><code>        ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1100</td>
	<td class="source"><code>          rule.action = this._safelyGetTypedValueFromArray(actionsRawData.value, 0);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1101</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1102</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1103</td>
	<td class="source"><code>        rules.push(rule);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1104</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1105</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1106</td>
	<td class="source"><code>      return rules;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1107</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1108</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1109</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1110</td>
	<td class="source"><code>        "An error occurred while sending the get rules request to $management " + "endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1111</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1112</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1113</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1114</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1115</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1116</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1117</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1118</td>
	<td class="source"><code>   * Removes the rule on the Subscription identified by the given rule name.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1119</td>
	<td class="source"><code>   * @param ruleName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1120</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1121</td>
	<td class="source"><code>  async removeRule(ruleName: string): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1122</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1123</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(this._context.namespace.connectionId, "ruleName", ruleName);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1124</td>
	<td class="source"><code>    ruleName = String(ruleName);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1125</td>
	<td class="source"><code>    throwTypeErrorIfParameterIsEmptyString(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1126</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1127</td>
	<td class="source"><code>      "ruleName",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1128</td>
	<td class="source"><code>      ruleName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1129</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1130</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1131</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1132</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1133</td>
	<td class="source"><code>        body: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1134</td>
	<td class="source"><code>          "rule-name": types.wrap_string(ruleName)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1135</td>
	<td class="source"><code>        },</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1136</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1137</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1138</td>
	<td class="source"><code>          operation: Constants.operations.removeRule</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1139</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1140</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1141</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1142</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1143</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1144</td>
	<td class="source"><code>        "[%s] Remove Rule request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1145</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1146</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1147</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1148</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1149</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1150</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1151</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1152</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1153</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1154</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1155</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1156</td>
	<td class="source"><code>      await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1157</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1158</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1159</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1160</td>
	<td class="source"><code>        "An error occurred while sending the remove rule request to $management " + "endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1161</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1162</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1163</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1164</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1165</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1166</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1167</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1168</td>
	<td class="source"><code>   * Adds a rule on the subscription as defined by the given rule name, filter and action</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1169</td>
	<td class="source"><code>   * @param ruleName Name of the rule</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1170</td>
	<td class="source"><code>   * @param filter A Boolean, SQL expression or a Correlation filter</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1171</td>
	<td class="source"><code>   * @param sqlRuleActionExpression Action to perform if the message satisfies the filtering expression</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1172</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1173</td>
	<td class="source"><code>  async addRule(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1174</td>
	<td class="source"><code>    ruleName: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1175</td>
	<td class="source"><code>    filter: boolean | string | CorrelationFilter,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1176</td>
	<td class="source"><code>    sqlRuleActionExpression?: string</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1177</td>
	<td class="source"><code>  ): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1178</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1179</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1180</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(this._context.namespace.connectionId, "ruleName", ruleName);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1181</td>
	<td class="source"><code>    ruleName = String(ruleName);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1182</td>
	<td class="source"><code>    throwTypeErrorIfParameterIsEmptyString(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1183</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1184</td>
	<td class="source"><code>      "ruleName",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1185</td>
	<td class="source"><code>      ruleName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1186</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1187</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1188</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(this._context.namespace.connectionId, "filter", filter);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1189</td>
	<td class="source"><code>    if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1190</td>
	<td class="source"><code>      typeof filter !== "boolean" &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1191</td>
	<td class="source"><code>      typeof filter !== "string" &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1192</td>
	<td class="source"><code>      !correlationProperties.some((validProperty) =&#62; filter.hasOwnProperty(validProperty))</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1193</td>
	<td class="source"><code>    ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1194</td>
	<td class="source"><code>      throw new TypeError(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1195</td>
	<td class="source"><code>        `The parameter "filter" should be either a boolean, string or implement the CorrelationFilter interface.`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1196</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1197</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1198</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1199</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1200</td>
	<td class="source"><code>      const ruleDescription: any = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1201</td>
	<td class="source"><code>      switch (typeof filter) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1202</td>
	<td class="source"><code>        case "boolean":</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1203</td>
	<td class="source"><code>          ruleDescription["sql-filter"] = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1204</td>
	<td class="source"><code>            expression: filter ? "1=1" : "1=0"</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1205</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1206</td>
	<td class="source"><code>          break;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1207</td>
	<td class="source"><code>        case "string":</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1208</td>
	<td class="source"><code>          ruleDescription["sql-filter"] = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1209</td>
	<td class="source"><code>            expression: filter</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1210</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1211</td>
	<td class="source"><code>          break;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1212</td>
	<td class="source"><code>        default:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1213</td>
	<td class="source"><code>          ruleDescription["correlation-filter"] = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1214</td>
	<td class="source"><code>            "correlation-id": filter.correlationId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1215</td>
	<td class="source"><code>            "message-id": filter.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1216</td>
	<td class="source"><code>            to: filter.to,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1217</td>
	<td class="source"><code>            "reply-to": filter.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1218</td>
	<td class="source"><code>            label: filter.label,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1219</td>
	<td class="source"><code>            "session-id": filter.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1220</td>
	<td class="source"><code>            "reply-to-session-id": filter.replyToSessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1221</td>
	<td class="source"><code>            "content-type": filter.contentType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1222</td>
	<td class="source"><code>            properties: filter.userProperties</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1223</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1224</td>
	<td class="source"><code>          break;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1225</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1226</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1227</td>
	<td class="source"><code>      if (sqlRuleActionExpression !== undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1228</td>
	<td class="source"><code>        ruleDescription["sql-rule-action"] = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1229</td>
	<td class="source"><code>          expression: String(sqlRuleActionExpression)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1230</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1231</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1232</td>
	<td class="source"><code>      const request: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1233</td>
	<td class="source"><code>        body: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1234</td>
	<td class="source"><code>          "rule-name": types.wrap_string(ruleName),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1235</td>
	<td class="source"><code>          "rule-description": types.wrap_map(ruleDescription)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1236</td>
	<td class="source"><code>        },</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1237</td>
	<td class="source"><code>        reply_to: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1238</td>
	<td class="source"><code>        application_properties: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1239</td>
	<td class="source"><code>          operation: Constants.operations.addRule</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1240</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1241</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1242</td>
	<td class="source"><code>      request.application_properties![Constants.trackingId] = generate_uuid();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1243</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1244</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1245</td>
	<td class="source"><code>        "[%s] Add Rule request body: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1246</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1247</td>
	<td class="source"><code>        request.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1248</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1249</td>
	<td class="source"><code>      log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1250</td>
	<td class="source"><code>        "[%s] Acquiring lock to get the management req res link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1251</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1252</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1253</td>
	<td class="source"><code>      await defaultLock.acquire(this.managementLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1254</td>
	<td class="source"><code>        return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1255</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1256</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1257</td>
	<td class="source"><code>      await this._mgmtReqResLink!.sendRequest(request);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1258</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1259</td>
	<td class="source"><code>      const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1260</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1261</td>
	<td class="source"><code>        "An error occurred while sending the Add rule request to $management " + "endpoint: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1262</td>
	<td class="source"><code>        error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1263</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1264</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1265</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1266</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1267</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1268, Column 3: "Member _init should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">1268</td>
	<td class="source"><code>  private async _init(): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1269</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1270</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1271</td>
	<td class="source"><code>      if (!this._isMgmtRequestResponseLinkOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1272</td>
	<td class="source"><code>        await this._negotiateClaim();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1273</td>
	<td class="source"><code>        const rxopt: ReceiverOptions = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1274</td>
	<td class="source"><code>          source: { address: this.address },</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1275</td>
	<td class="source"><code>          name: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1276</td>
	<td class="source"><code>          target: { address: this.replyTo },</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1277</td>
	<td class="source"><code>          onSessionError: (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1278</td>
	<td class="source"><code>            const id = context.connection.options.id;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1279</td>
	<td class="source"><code>            const ehError = translate(context.session!.error!);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1280</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1281</td>
	<td class="source"><code>              "[%s] An error occurred on the session for request/response links for " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1282</td>
	<td class="source"><code>                "$management: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1283</td>
	<td class="source"><code>              id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1284</td>
	<td class="source"><code>              ehError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1285</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1286</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1287</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1288</td>
	<td class="source"><code>        const sropt: SenderOptions = { target: { address: this.address } };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1289</td>
	<td class="source"><code>        log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1290</td>
	<td class="source"><code>          "[%s] Creating sender/receiver links on a session for $management endpoint with " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1291</td>
	<td class="source"><code>            "srOpts: %o, receiverOpts: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1292</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1293</td>
	<td class="source"><code>          sropt,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1294</td>
	<td class="source"><code>          rxopt</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1295</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1296</td>
	<td class="source"><code>        this._mgmtReqResLink = await RequestResponseLink.create(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1297</td>
	<td class="source"><code>          this._context.namespace.connection,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1298</td>
	<td class="source"><code>          sropt,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1299</td>
	<td class="source"><code>          rxopt</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1300</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1301</td>
	<td class="source"><code>        this._mgmtReqResLink.sender.on(SenderEvents.senderError, (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1302</td>
	<td class="source"><code>          const id = context.connection.options.id;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1303</td>
	<td class="source"><code>          const ehError = translate(context.sender!.error!);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1304</td>
	<td class="source"><code>          log.error("[%s] An error occurred on the $management sender link.. %O", id, ehError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1305</td>
	<td class="source"><code>        });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1306</td>
	<td class="source"><code>        this._mgmtReqResLink.receiver.on(ReceiverEvents.receiverError, (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1307</td>
	<td class="source"><code>          const id = context.connection.options.id;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1308</td>
	<td class="source"><code>          const ehError = translate(context.receiver!.error!);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1309</td>
	<td class="source"><code>          log.error("[%s] An error occurred on the $management receiver link.. %O", id, ehError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1310</td>
	<td class="source"><code>        });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1311</td>
	<td class="source"><code>        log.mgmt(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1312</td>
	<td class="source"><code>          "[%s] Created sender '%s' and receiver '%s' links for $management endpoint.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1313</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1314</td>
	<td class="source"><code>          this._mgmtReqResLink.sender.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1315</td>
	<td class="source"><code>          this._mgmtReqResLink.receiver.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1316</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1317</td>
	<td class="source"><code>        await this._ensureTokenRenewal();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1318</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1319</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1320, Column 7: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">1320</td>
	<td class="source"><code>      err = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1321</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1322</td>
	<td class="source"><code>        "[%s] An error occured while establishing the $management links: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1323</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1324</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1325</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1326</td>
	<td class="source"><code>      throw err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1327</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1328</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1329</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1330, Column 3: "Member _isMgmtRequestResponseLinkOpen should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">1330</td>
	<td class="source"><code>  private _isMgmtRequestResponseLinkOpen(): boolean {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1331</td>
	<td class="source"><code>    return this._mgmtReqResLink! && this._mgmtReqResLink!.isOpen();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1332</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1333</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1334</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1335</td>
	<td class="source"><code>   * Given array of typed values, returns the element in given index</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1336</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1337, Column 3: "Member _safelyGetTypedValueFromArray should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">1337</td>
	<td class="source"><code>  private _safelyGetTypedValueFromArray(data: Typed[], index: number): any {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1338</td>
	<td class="source"><code>    return Array.isArray(data) && data.length &#62; index && data[index]</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1339</td>
	<td class="source"><code>      ? data[index].value</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1340</td>
	<td class="source"><code>      : undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1341</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1342</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1343</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcCoreMessageReceiverTs" class="lint-result bg-error" data-group="f-6" data-problem-count="7" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\core\messageReceiver.ts
    </th>
    <th class="result-summary">
      7 problems (7 errors, 0 warnings)
    </th>
</tr>
<tr class="f-6 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-6"
								data-content="detailSummary-6"
								aria-controls="detailSummary-6"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-6"
								data-content="sourceCode-6"
								aria-controls="sourceCode-6"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-6">
				<div class="row"></div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 267, Column 56: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 808, Column 15: "Each then() should return a value or throw"
		<a href="http://eslint.org/docs/rules/promise/always-return" target="_blank">promise/always-return</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 878, Column 68: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 938, Column 3: "Member _deleteFromCache should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 958, Column 3: "Member _init should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1020, Column 7: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1034, Column 3: "Member _createReceiverOptions should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-6">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>  translate,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>  Constants,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>  MessagingError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>  retry,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>  RetryOperationType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>  RetryConfig,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code>  ConditionErrorNameMapper</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>} from "@azure/amqp-common";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>  Receiver,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>  OnAmqpEvent,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code>  EventContext,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code>  ReceiverOptions,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code>  AmqpError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code>  isAmqpError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code>} from "rhea-promise";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code>import * as log from "../log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code>import { LinkEntity } from "./linkEntity";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code>import { ClientEntityContext } from "../clientEntityContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code>  ServiceBusMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code>  DispositionType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code>  ReceiveMode,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code>  throwIfMessageCannotBeSettled</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code>} from "../serviceBusMessage";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code>import { getUniqueName, calculateRenewAfterDuration } from "../util/utils";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code>import { MessageHandlerOptions } from "./streamingReceiver";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>import { messageDispositionTimeout } from "../util/constants";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code>interface CreateReceiverOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code>  onMessage: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code>  onClose: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code>  onSessionClose: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code>  onError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code>  onSettled: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>  onSessionError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code>export interface OnAmqpEventAsPromise extends OnAmqpEvent {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code>  (context: EventContext): Promise&#60;void&#62;;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>export interface PromiseLike {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code>  resolve: (value?: any) =&#62; void;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code>  reject: (reason?: any) =&#62; void;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code>  timer: NodeJS.Timer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>export interface DispositionOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code>  propertiesToModify?: { [key: string]: any };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>  error?: AmqpError;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">69</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code>export enum ReceiverType {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code>  batching = "batching",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code>  streaming = "streaming"</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">81</td>
	<td class="source"><code>export interface ReceiveOptions extends MessageHandlerOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>   * @property {number} [receiveMode] The mode in which messages should be received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">84</td>
	<td class="source"><code>   * Default: ReceiveMode.peekLock</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">85</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">86</td>
	<td class="source"><code>  receiveMode?: ReceiveMode;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">90</td>
	<td class="source"><code> * Describes the signature of the message handler passed to `registerMessageHandler` method.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>export interface OnMessage {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>   * Handler for processing each incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code>  (message: ServiceBusMessage): Promise&#60;void&#62;;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code> * Describes the signature of the error handler passed to `registerMessageHandler` method.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>export interface OnError {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code>   * Handler for any error that occurs while receiving or processing messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>  (error: MessagingError | Error): void;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">110</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">111</td>
	<td class="source"><code> * Describes the MessageReceiver that will receive messages from ServiceBus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code> * @class MessageReceiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code>export class MessageReceiver extends LinkEntity {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code>   * @property {string} receiverType The type of receiver: "batching" or "streaming".</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code>  receiverType: ReceiverType;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">119</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">120</td>
	<td class="source"><code>   * @property {number} [maxConcurrentCalls] The maximum number of messages that should be</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">121</td>
	<td class="source"><code>   * processed concurrently while in streaming mode. Once this limit has been reached, more</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">122</td>
	<td class="source"><code>   * messages will not be received until the user's message handler has completed processing current message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">123</td>
	<td class="source"><code>   * Default: 1</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">124</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">125</td>
	<td class="source"><code>  maxConcurrentCalls: number = 1;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">126</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">127</td>
	<td class="source"><code>   * @property {number} [receiveMode] The mode in which messages should be received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">128</td>
	<td class="source"><code>   * Default: ReceiveMode.peekLock</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">129</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">130</td>
	<td class="source"><code>  receiveMode: ReceiveMode;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">131</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">132</td>
	<td class="source"><code>   * @property {boolean} autoComplete Indicates whether `Message.complete()` should be called</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">133</td>
	<td class="source"><code>   * automatically after the message processing is complete while receiving messages with handlers.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">134</td>
	<td class="source"><code>   * Default: false.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">135</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">136</td>
	<td class="source"><code>  autoComplete: boolean;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">137</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">138</td>
	<td class="source"><code>   * @property {number} maxAutoRenewDurationInSeconds The maximum duration within which the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">139</td>
	<td class="source"><code>   * lock will be renewed automatically. This value should be greater than the longest message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">140</td>
	<td class="source"><code>   * lock duration; for example, the `lockDuration` property on the received message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">141</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">142</td>
	<td class="source"><code>   * Default: `300` (5 minutes);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">143</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">144</td>
	<td class="source"><code>  maxAutoRenewDurationInSeconds: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">145</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">146</td>
	<td class="source"><code>   * @property {number} [newMessageWaitTimeoutInSeconds] The maximum amount of idle time the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">147</td>
	<td class="source"><code>   * receiver will wait after a message has been received. If no messages are received by this</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">148</td>
	<td class="source"><code>   * time then the receive operation will end.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">149</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">150</td>
	<td class="source"><code>  newMessageWaitTimeoutInSeconds?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">151</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">152</td>
	<td class="source"><code>   * @property {boolean} autoRenewLock Should lock renewal happen automatically.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">153</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">154</td>
	<td class="source"><code>  autoRenewLock: boolean;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">155</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">156</td>
	<td class="source"><code>   * @property {Receiver} [_receiver] The AMQP receiver link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">157</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">158</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">159</td>
	<td class="source"><code>  protected _receiver?: Receiver;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">160</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">161</td>
	<td class="source"><code>   * @property {Map&#60;number, Promise&#60;any&#62;&#62;} _deliveryDispositionMap Maintains a map of deliveries that</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">162</td>
	<td class="source"><code>   * are being actively disposed. It acts as a store for correlating the responses received for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">163</td>
	<td class="source"><code>   * active dispositions.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">164</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">165</td>
	<td class="source"><code>  protected _deliveryDispositionMap: Map&#60;number, PromiseLike&#62; = new Map&#60;number, PromiseLike&#62;();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">166</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">167</td>
	<td class="source"><code>   * @property {OnMessage} _onMessage The message handler provided by the user that will be wrapped</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">168</td>
	<td class="source"><code>   * inside _onAmqpMessage.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">169</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">170</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">171</td>
	<td class="source"><code>  protected _onMessage!: OnMessage;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">172</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">173</td>
	<td class="source"><code>   * @property {OnMessage} _onError The error handler provided by the user that will be wrapped</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">174</td>
	<td class="source"><code>   * inside _onAmqpError.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">175</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">176</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">177</td>
	<td class="source"><code>  protected _onError?: OnError;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">178</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">179</td>
	<td class="source"><code>   * @property {OnAmqpEventAsPromise} _onAmqpMessage The message handler that will be set as the handler on the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">180</td>
	<td class="source"><code>   * underlying rhea receiver for the "message" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">181</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">182</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">183</td>
	<td class="source"><code>  protected _onAmqpMessage: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">184</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">185</td>
	<td class="source"><code>   * @property {OnAmqpEventAsPromise} _onAmqpClose The message handler that will be set as the handler on the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">186</td>
	<td class="source"><code>   * underlying rhea receiver for the "receiver_close" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">187</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">188</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">189</td>
	<td class="source"><code>  protected _onAmqpClose: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">190</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">191</td>
	<td class="source"><code>   * @property {OnAmqpEvent} _onSessionError The message handler that will be set as the handler on</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">192</td>
	<td class="source"><code>   * the underlying rhea receiver's session for the "session_error" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">193</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">194</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">195</td>
	<td class="source"><code>  protected _onSessionError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">196</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">197</td>
	<td class="source"><code>   * @property {OnAmqpEventAsPromise} _onSessionClose The message handler that will be set as the handler on</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">198</td>
	<td class="source"><code>   * the underlying rhea receiver's session for the "session_close" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">199</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">200</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">201</td>
	<td class="source"><code>  protected _onSessionClose: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">202</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">203</td>
	<td class="source"><code>   * @property {OnAmqpEvent} _onAmqpError The message handler that will be set as the handler on the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">204</td>
	<td class="source"><code>   * underlying rhea receiver for the "receiver_error" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">205</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">206</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">207</td>
	<td class="source"><code>  protected _onAmqpError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">208</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">209</td>
	<td class="source"><code>   * @property {OnAmqpEvent} _onSettled The message handler that will be set as the handler on the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">210</td>
	<td class="source"><code>   * underlying rhea receiver for the "settled" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">211</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">212</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">213</td>
	<td class="source"><code>  protected _onSettled: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">214</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">215</td>
	<td class="source"><code>   * @property {boolean} wasCloseInitiated Denotes if receiver was explicitly closed by user.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">216</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">217</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">218</td>
	<td class="source"><code>  protected wasCloseInitiated?: boolean;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">219</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">220</td>
	<td class="source"><code>   * @property {Map&#60;string, Function&#62;} _messageRenewLockTimers Maintains a map of messages for which</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">221</td>
	<td class="source"><code>   * the lock is automatically renewed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">222</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">223</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">224</td>
	<td class="source"><code>  protected _messageRenewLockTimers: Map&#60;string, NodeJS.Timer | undefined&#62; = new Map&#60;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">225</td>
	<td class="source"><code>    string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">226</td>
	<td class="source"><code>    NodeJS.Timer | undefined</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">227</td>
	<td class="source"><code>  &#62;();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">228</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">229</td>
	<td class="source"><code>   * @property {NodeJS.Timer} _newMessageReceivedTimer The timer that keeps track of time since the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">230</td>
	<td class="source"><code>   * last message was received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">231</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">232</td>
	<td class="source"><code>  protected _newMessageReceivedTimer?: NodeJS.Timer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">233</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">234</td>
	<td class="source"><code>   * Resets the `_newMessageReceivedTimer` timer when a new message is received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">235</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">236</td>
	<td class="source"><code>  protected resetTimerOnNewMessageReceived: () =&#62; void;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">237</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">238</td>
	<td class="source"><code>   * @property {Function} _clearMessageLockRenewTimer Clears the message lock renew timer for a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">239</td>
	<td class="source"><code>   * specific messageId.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">240</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">241</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">242</td>
	<td class="source"><code>  protected _clearMessageLockRenewTimer: (messageId: string) =&#62; void;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">243</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">244</td>
	<td class="source"><code>   * @property {Function} _clearMessageLockRenewTimer Clears the message lock renew timer for all</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">245</td>
	<td class="source"><code>   * the active messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">246</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">247</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">248</td>
	<td class="source"><code>  protected _clearAllMessageLockRenewTimers: () =&#62; void;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">249</td>
	<td class="source"><code>  constructor(context: ClientEntityContext, receiverType: ReceiverType, options?: ReceiveOptions) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">250</td>
	<td class="source"><code>    super(context.entityPath, context, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">251</td>
	<td class="source"><code>      address: context.entityPath,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">252</td>
	<td class="source"><code>      audience: `${context.namespace.config.endpoint}${context.entityPath}`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">253</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">254</td>
	<td class="source"><code>    if (!options) options = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">255</td>
	<td class="source"><code>    this.wasCloseInitiated = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">256</td>
	<td class="source"><code>    this.receiverType = receiverType;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">257</td>
	<td class="source"><code>    this.receiveMode = options.receiveMode || ReceiveMode.peekLock;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">258</td>
	<td class="source"><code>    if (typeof options.maxConcurrentCalls === "number" && options.maxConcurrentCalls &#62; 0) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">259</td>
	<td class="source"><code>      this.maxConcurrentCalls = options.maxConcurrentCalls;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">260</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">261</td>
	<td class="source"><code>    this.resetTimerOnNewMessageReceived = () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">262</td>
	<td class="source"><code>      /** */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">263</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">264</td>
	<td class="source"><code>    // If explicitly set to false then autoComplete is false else true (default).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">265</td>
	<td class="source"><code>    this.autoComplete = options.autoComplete === false ? options.autoComplete : true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">266</td>
	<td class="source"><code>    this.maxAutoRenewDurationInSeconds =</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 267, Column 56: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">267</td>
	<td class="source"><code>      options.maxMessageAutoRenewLockDurationInSeconds != undefined</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">268</td>
	<td class="source"><code>        ? options.maxMessageAutoRenewLockDurationInSeconds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">269</td>
	<td class="source"><code>        : 300;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">270</td>
	<td class="source"><code>    this.autoRenewLock =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">271</td>
	<td class="source"><code>      this.maxAutoRenewDurationInSeconds &#62; 0 && this.receiveMode === ReceiveMode.peekLock;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">272</td>
	<td class="source"><code>    this._clearMessageLockRenewTimer = (messageId: string) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">273</td>
	<td class="source"><code>      if (this._messageRenewLockTimers.has(messageId)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">274</td>
	<td class="source"><code>        clearTimeout(this._messageRenewLockTimers.get(messageId) as NodeJS.Timer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">275</td>
	<td class="source"><code>        log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">276</td>
	<td class="source"><code>          "[%s] Cleared the message renew lock timer for message with id '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">277</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">278</td>
	<td class="source"><code>          messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">279</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">280</td>
	<td class="source"><code>        this._messageRenewLockTimers.delete(messageId);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">281</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">282</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">283</td>
	<td class="source"><code>    this._clearAllMessageLockRenewTimers = () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">284</td>
	<td class="source"><code>      log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">285</td>
	<td class="source"><code>        "[%s] Clearing message renew lock timers for all the active messages.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">286</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">287</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">288</td>
	<td class="source"><code>      for (const messageId of this._messageRenewLockTimers.keys()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">289</td>
	<td class="source"><code>        this._clearMessageLockRenewTimer(messageId);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">290</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">291</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">292</td>
	<td class="source"><code>    // setting all the handlers</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">293</td>
	<td class="source"><code>    this._onSettled = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">294</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">295</td>
	<td class="source"><code>      const delivery = context.delivery;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">296</td>
	<td class="source"><code>      if (delivery) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">297</td>
	<td class="source"><code>        const id = delivery.id;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">298</td>
	<td class="source"><code>        const state = delivery.remote_state;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">299</td>
	<td class="source"><code>        const settled = delivery.remote_settled;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">300</td>
	<td class="source"><code>        log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">301</td>
	<td class="source"><code>          "[%s] Delivery with id %d, remote_settled: %s, remote_state: %o has been " + "received.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">302</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">303</td>
	<td class="source"><code>          id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">304</td>
	<td class="source"><code>          settled,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">305</td>
	<td class="source"><code>          state && state.error ? state.error : state</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">306</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">307</td>
	<td class="source"><code>        if (settled && this._deliveryDispositionMap.has(id)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">308</td>
	<td class="source"><code>          const promise = this._deliveryDispositionMap.get(id) as PromiseLike;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">309</td>
	<td class="source"><code>          clearTimeout(promise.timer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">310</td>
	<td class="source"><code>          log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">311</td>
	<td class="source"><code>            "[%s] Found the delivery with id %d in the map and cleared the timer.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">312</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">313</td>
	<td class="source"><code>            id</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">314</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">315</td>
	<td class="source"><code>          const deleteResult = this._deliveryDispositionMap.delete(id);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">316</td>
	<td class="source"><code>          log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">317</td>
	<td class="source"><code>            "[%s] Successfully deleted the delivery with id %d from the map.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">318</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">319</td>
	<td class="source"><code>            id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">320</td>
	<td class="source"><code>            deleteResult</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">321</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">322</td>
	<td class="source"><code>          if (state && state.error && (state.error.condition || state.error.description)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">323</td>
	<td class="source"><code>            const error = translate(state.error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">324</td>
	<td class="source"><code>            return promise.reject(error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">325</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">326</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">327</td>
	<td class="source"><code>          return promise.resolve();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">328</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">329</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">330</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">331</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">332</td>
	<td class="source"><code>    this._onAmqpMessage = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">333</td>
	<td class="source"><code>      // If the receiver got closed in PeekLock mode, avoid processing the message as we</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">334</td>
	<td class="source"><code>      // cannot settle the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">335</td>
	<td class="source"><code>      if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">336</td>
	<td class="source"><code>        this.receiveMode === ReceiveMode.peekLock &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">337</td>
	<td class="source"><code>        (!this._receiver || !this._receiver.isOpen())</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">338</td>
	<td class="source"><code>      ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">339</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">340</td>
	<td class="source"><code>          "[%s] Not calling the user's message handler for the current message " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">341</td>
	<td class="source"><code>            "as the receiver '%s' is closed",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">342</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">343</td>
	<td class="source"><code>          this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">344</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">345</td>
	<td class="source"><code>        return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">346</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">347</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">348</td>
	<td class="source"><code>      this.resetTimerOnNewMessageReceived();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">349</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">350</td>
	<td class="source"><code>      const bMessage: ServiceBusMessage = new ServiceBusMessage(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">351</td>
	<td class="source"><code>        this._context,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">352</td>
	<td class="source"><code>        context.message!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">353</td>
	<td class="source"><code>        context.delivery!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">354</td>
	<td class="source"><code>        true</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">355</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">356</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">357</td>
	<td class="source"><code>      if (this.autoRenewLock && bMessage.lockToken) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">358</td>
	<td class="source"><code>        const lockToken = bMessage.lockToken;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">359</td>
	<td class="source"><code>        // - We need to renew locks before they expire by looking at bMessage.lockedUntilUtc.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">360</td>
	<td class="source"><code>        // - This autorenewal needs to happen **NO MORE** than maxAutoRenewDurationInSeconds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">361</td>
	<td class="source"><code>        // - We should be able to clear the renewal timer when the user's message handler</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">362</td>
	<td class="source"><code>        // is done (whether it succeeds or fails).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">363</td>
	<td class="source"><code>        // Setting the messageId with undefined value in the _messageRenewockTimers Map because we</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">364</td>
	<td class="source"><code>        // track state by checking the presence of messageId in the map. It is removed from the map</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">365</td>
	<td class="source"><code>        // when an attempt is made to settle the message (either by the user or by the sdk) OR</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">366</td>
	<td class="source"><code>        // when the execution of user's message handler completes.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">367</td>
	<td class="source"><code>        this._messageRenewLockTimers.set(bMessage.messageId as string, undefined);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">368</td>
	<td class="source"><code>        log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">369</td>
	<td class="source"><code>          "[%s] message with id '%s' is locked until %s.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">370</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">371</td>
	<td class="source"><code>          bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">372</td>
	<td class="source"><code>          bMessage.lockedUntilUtc!.toString()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">373</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">374</td>
	<td class="source"><code>        const totalAutoLockRenewDuration = Date.now() + this.maxAutoRenewDurationInSeconds * 1000;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">375</td>
	<td class="source"><code>        log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">376</td>
	<td class="source"><code>          "[%s] Total autolockrenew duration for message with id '%s' is: ",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">377</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">378</td>
	<td class="source"><code>          bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">379</td>
	<td class="source"><code>          new Date(totalAutoLockRenewDuration).toString()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">380</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">381</td>
	<td class="source"><code>        const autoRenewLockTask = (): void =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">382</td>
	<td class="source"><code>          if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">383</td>
	<td class="source"><code>            new Date(totalAutoLockRenewDuration) &#62; bMessage.lockedUntilUtc! &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">384</td>
	<td class="source"><code>            Date.now() &#60; totalAutoLockRenewDuration</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">385</td>
	<td class="source"><code>          ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">386</td>
	<td class="source"><code>            if (this._messageRenewLockTimers.has(bMessage.messageId as string)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">387</td>
	<td class="source"><code>              // TODO: We can run into problems with clock skew between the client and the server.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">388</td>
	<td class="source"><code>              // It would be better to calculate the duration based on the "lockDuration" property</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">389</td>
	<td class="source"><code>              // of the queue. However, we do not have the management plane of the client ready for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">390</td>
	<td class="source"><code>              // now. Hence we rely on the lockedUntilUtc property on the message set by ServiceBus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">391</td>
	<td class="source"><code>              const amount = calculateRenewAfterDuration(bMessage.lockedUntilUtc!);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">392</td>
	<td class="source"><code>              log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">393</td>
	<td class="source"><code>                "[%s] Sleeping for %d milliseconds while renewing the lock for " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">394</td>
	<td class="source"><code>                  "message with id '%s' is: ",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">395</td>
	<td class="source"><code>                connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">396</td>
	<td class="source"><code>                amount,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">397</td>
	<td class="source"><code>                bMessage.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">398</td>
	<td class="source"><code>              );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">399</td>
	<td class="source"><code>              // Setting the value of the messageId to the actual timer. This will be cleared when</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">400</td>
	<td class="source"><code>              // an attempt is made to settle the message (either by the user or by the sdk) OR</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">401</td>
	<td class="source"><code>              // when the execution of user's message handler completes.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">402</td>
	<td class="source"><code>              this._messageRenewLockTimers.set(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">403</td>
	<td class="source"><code>                bMessage.messageId as string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">404</td>
	<td class="source"><code>                setTimeout(async () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">405</td>
	<td class="source"><code>                  try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">406</td>
	<td class="source"><code>                    log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">407</td>
	<td class="source"><code>                      "[%s] Attempting to renew the lock for message with id '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">408</td>
	<td class="source"><code>                      connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">409</td>
	<td class="source"><code>                      bMessage.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">410</td>
	<td class="source"><code>                    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">411</td>
	<td class="source"><code>                    bMessage.lockedUntilUtc = await this._context.managementClient!.renewLock(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">412</td>
	<td class="source"><code>                      lockToken,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">413</td>
	<td class="source"><code>                      this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">414</td>
	<td class="source"><code>                    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">415</td>
	<td class="source"><code>                    log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">416</td>
	<td class="source"><code>                      "[%s] Successfully renewed the lock for message with id '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">417</td>
	<td class="source"><code>                      connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">418</td>
	<td class="source"><code>                      bMessage.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">419</td>
	<td class="source"><code>                    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">420</td>
	<td class="source"><code>                    log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">421</td>
	<td class="source"><code>                      "[%s] Calling the autorenewlock task again for message with " + "id '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">422</td>
	<td class="source"><code>                      connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">423</td>
	<td class="source"><code>                      bMessage.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">424</td>
	<td class="source"><code>                    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">425</td>
	<td class="source"><code>                    autoRenewLockTask();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">426</td>
	<td class="source"><code>                  } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">427</td>
	<td class="source"><code>                    log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">428</td>
	<td class="source"><code>                      "[%s] An error occured while auto renewing the message lock '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">429</td>
	<td class="source"><code>                        "for message with id '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">430</td>
	<td class="source"><code>                      connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">431</td>
	<td class="source"><code>                      bMessage.lockToken,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">432</td>
	<td class="source"><code>                      bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">433</td>
	<td class="source"><code>                      err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">434</td>
	<td class="source"><code>                    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">435</td>
	<td class="source"><code>                    // Let the user know that there was an error renewing the message lock.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">436</td>
	<td class="source"><code>                    this._onError!(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">437</td>
	<td class="source"><code>                  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">438</td>
	<td class="source"><code>                }, amount)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">439</td>
	<td class="source"><code>              );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">440</td>
	<td class="source"><code>            } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">441</td>
	<td class="source"><code>              log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">442</td>
	<td class="source"><code>                "[%s] Looks like the message lock renew timer has already been " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">443</td>
	<td class="source"><code>                  "cleared for message with id '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">444</td>
	<td class="source"><code>                connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">445</td>
	<td class="source"><code>                bMessage.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">446</td>
	<td class="source"><code>              );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">447</td>
	<td class="source"><code>            }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">448</td>
	<td class="source"><code>          } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">449</td>
	<td class="source"><code>            log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">450</td>
	<td class="source"><code>              "[%s] Current time %s exceeds the total autolockrenew duration %s for " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">451</td>
	<td class="source"><code>                "message with messageId '%s'. Hence we will stop the autoLockRenewTask.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">452</td>
	<td class="source"><code>              connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">453</td>
	<td class="source"><code>              new Date(Date.now()).toString(),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">454</td>
	<td class="source"><code>              new Date(totalAutoLockRenewDuration).toString(),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">455</td>
	<td class="source"><code>              bMessage.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">456</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">457</td>
	<td class="source"><code>            this._clearMessageLockRenewTimer(bMessage.messageId as string);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">458</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">459</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">460</td>
	<td class="source"><code>        // start</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">461</td>
	<td class="source"><code>        autoRenewLockTask();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">462</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">463</td>
	<td class="source"><code>      try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">464</td>
	<td class="source"><code>        await this._onMessage(bMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">465</td>
	<td class="source"><code>        this._clearMessageLockRenewTimer(bMessage.messageId as string);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">466</td>
	<td class="source"><code>      } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">467</td>
	<td class="source"><code>        // This ensures we call users' error handler when users' message handler throws.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">468</td>
	<td class="source"><code>        if (!isAmqpError(err)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">469</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">470</td>
	<td class="source"><code>            "[%s] An error occurred while running user's message handler for the message " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">471</td>
	<td class="source"><code>              "with id '%s' on the receiver '%s': %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">472</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">473</td>
	<td class="source"><code>            bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">474</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">475</td>
	<td class="source"><code>            err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">476</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">477</td>
	<td class="source"><code>          this._onError!(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">478</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">479</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">480</td>
	<td class="source"><code>        // Do not want renewLock to happen unnecessarily, while abandoning the message. Hence,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">481</td>
	<td class="source"><code>        // doing this here. Otherwise, this should be done in finally.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">482</td>
	<td class="source"><code>        this._clearMessageLockRenewTimer(bMessage.messageId as string);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">483</td>
	<td class="source"><code>        const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">484</td>
	<td class="source"><code>        // Nothing much to do if user's message handler throws. Let us try abandoning the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">485</td>
	<td class="source"><code>        if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">486</td>
	<td class="source"><code>          !bMessage.delivery.remote_settled &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">487</td>
	<td class="source"><code>          error.name !== ConditionErrorNameMapper["com.microsoft:message-lock-lost"] &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">488</td>
	<td class="source"><code>          this.receiveMode === ReceiveMode.peekLock &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">489</td>
	<td class="source"><code>          this.isOpen() // only try to abandon the messages if the connection is still open</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">490</td>
	<td class="source"><code>        ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">491</td>
	<td class="source"><code>          try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">492</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">493</td>
	<td class="source"><code>              "[%s] Abandoning the message with id '%s' on the receiver '%s' since " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">494</td>
	<td class="source"><code>                "an error occured: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">495</td>
	<td class="source"><code>              connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">496</td>
	<td class="source"><code>              bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">497</td>
	<td class="source"><code>              this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">498</td>
	<td class="source"><code>              error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">499</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">500</td>
	<td class="source"><code>            await bMessage.abandon();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">501</td>
	<td class="source"><code>          } catch (abandonError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">502</td>
	<td class="source"><code>            const translatedError = translate(abandonError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">503</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">504</td>
	<td class="source"><code>              "[%s] An error occurred while abandoning the message with id '%s' on the " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">505</td>
	<td class="source"><code>                "receiver '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">506</td>
	<td class="source"><code>              connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">507</td>
	<td class="source"><code>              bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">508</td>
	<td class="source"><code>              this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">509</td>
	<td class="source"><code>              translatedError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">510</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">511</td>
	<td class="source"><code>            this._onError!(translatedError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">512</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">513</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">514</td>
	<td class="source"><code>        return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">515</td>
	<td class="source"><code>      } finally {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">516</td>
	<td class="source"><code>        if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">517</td>
	<td class="source"><code>          this._receiver.addCredit(1);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">518</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">519</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">520</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">521</td>
	<td class="source"><code>      // If we've made it this far, then user's message handler completed fine. Let us try</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">522</td>
	<td class="source"><code>      // completing the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">523</td>
	<td class="source"><code>      if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">524</td>
	<td class="source"><code>        this.autoComplete &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">525</td>
	<td class="source"><code>        this.receiveMode === ReceiveMode.peekLock &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">526</td>
	<td class="source"><code>        !bMessage.delivery.remote_settled</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">527</td>
	<td class="source"><code>      ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">528</td>
	<td class="source"><code>        try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">529</td>
	<td class="source"><code>          log[this.receiverType](</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">530</td>
	<td class="source"><code>            "[%s] Auto completing the message with id '%s' on " + "the receiver '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">531</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">532</td>
	<td class="source"><code>            bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">533</td>
	<td class="source"><code>            this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">534</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">535</td>
	<td class="source"><code>          await bMessage.complete();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">536</td>
	<td class="source"><code>        } catch (completeError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">537</td>
	<td class="source"><code>          const translatedError = translate(completeError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">538</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">539</td>
	<td class="source"><code>            "[%s] An error occurred while completing the message with id '%s' on the " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">540</td>
	<td class="source"><code>              "receiver '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">541</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">542</td>
	<td class="source"><code>            bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">543</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">544</td>
	<td class="source"><code>            translatedError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">545</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">546</td>
	<td class="source"><code>          this._onError!(translatedError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">547</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">548</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">549</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">550</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">551</td>
	<td class="source"><code>    this._onAmqpError = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">552</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">553</td>
	<td class="source"><code>      const receiver = this._receiver || context.receiver!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">554</td>
	<td class="source"><code>      const receiverError = context.receiver && context.receiver.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">555</td>
	<td class="source"><code>      if (receiverError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">556</td>
	<td class="source"><code>        const sbError = translate(receiverError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">557</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">558</td>
	<td class="source"><code>          "[%s] An error occurred for Receiver '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">559</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">560</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">561</td>
	<td class="source"><code>          sbError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">562</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">563</td>
	<td class="source"><code>        if (!sbError.retryable) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">564</td>
	<td class="source"><code>          if (receiver && !receiver.isItselfClosed()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">565</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">566</td>
	<td class="source"><code>              "[%s] Since the user did not close the receiver and the error is not " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">567</td>
	<td class="source"><code>                "retryable, we let the user know about it by calling the user's error handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">568</td>
	<td class="source"><code>              connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">569</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">570</td>
	<td class="source"><code>            this._onError!(sbError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">571</td>
	<td class="source"><code>          } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">572</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">573</td>
	<td class="source"><code>              "[%s] The received error is not retryable. However, the receiver was " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">574</td>
	<td class="source"><code>                "closed by the user. Hence not notifying the user's error handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">575</td>
	<td class="source"><code>              connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">576</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">577</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">578</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">579</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">580</td>
	<td class="source"><code>            "[%s] Since received error is retryable, we will NOT notify the user's " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">581</td>
	<td class="source"><code>              "error handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">582</td>
	<td class="source"><code>            connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">583</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">584</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">585</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">586</td>
	<td class="source"><code>      if (this._newMessageReceivedTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">587</td>
	<td class="source"><code>        clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">588</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">589</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">590</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">591</td>
	<td class="source"><code>    this._onSessionError = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">592</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">593</td>
	<td class="source"><code>      const receiver = this._receiver || context.receiver!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">594</td>
	<td class="source"><code>      const sessionError = context.session && context.session.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">595</td>
	<td class="source"><code>      if (sessionError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">596</td>
	<td class="source"><code>        const sbError = translate(sessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">597</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">598</td>
	<td class="source"><code>          "[%s] An error occurred on the session for Receiver '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">599</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">600</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">601</td>
	<td class="source"><code>          sbError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">602</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">603</td>
	<td class="source"><code>        if (receiver && !receiver.isSessionItselfClosed() && !sbError.retryable) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">604</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">605</td>
	<td class="source"><code>            "[%s] Since the user did not close the receiver and the session error is not " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">606</td>
	<td class="source"><code>              "retryable, we let the user know about it by calling the user's error handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">607</td>
	<td class="source"><code>            connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">608</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">609</td>
	<td class="source"><code>          this._onError!(sbError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">610</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">611</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">612</td>
	<td class="source"><code>      if (this._newMessageReceivedTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">613</td>
	<td class="source"><code>        clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">614</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">615</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">616</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">617</td>
	<td class="source"><code>    this._onAmqpClose = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">618</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">619</td>
	<td class="source"><code>      const receiverError = context.receiver && context.receiver.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">620</td>
	<td class="source"><code>      const receiver = this._receiver || context.receiver!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">621</td>
	<td class="source"><code>      if (receiverError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">622</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">623</td>
	<td class="source"><code>          "[%s] 'receiver_close' event occurred for receiver '%s' with address '%s'. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">624</td>
	<td class="source"><code>            "The associated error is: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">625</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">626</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">627</td>
	<td class="source"><code>          this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">628</td>
	<td class="source"><code>          receiverError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">629</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">630</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">631</td>
	<td class="source"><code>      this._clearAllMessageLockRenewTimers();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">632</td>
	<td class="source"><code>      if (receiver && !receiver.isItselfClosed()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">633</td>
	<td class="source"><code>        if (!this.isConnecting) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">634</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">635</td>
	<td class="source"><code>            "[%s] 'receiver_close' event occurred on the receiver '%s' with address '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">636</td>
	<td class="source"><code>              "and the sdk did not initiate this. The receiver is not reconnecting. Hence, calling " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">637</td>
	<td class="source"><code>              "detached from the _onAmqpClose() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">638</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">639</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">640</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">641</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">642</td>
	<td class="source"><code>          await this.onDetached(receiverError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">643</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">644</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">645</td>
	<td class="source"><code>            "[%s] 'receiver_close' event occurred on the receiver '%s' with address '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">646</td>
	<td class="source"><code>              "and the sdk did not initate this. Moreover the receiver is already re-connecting. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">647</td>
	<td class="source"><code>              "Hence not calling detached from the _onAmqpClose() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">648</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">649</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">650</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">651</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">652</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">653</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">654</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">655</td>
	<td class="source"><code>          "[%s] 'receiver_close' event occurred on the receiver '%s' with address '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">656</td>
	<td class="source"><code>            "because the sdk initiated it. Hence not calling detached from the _onAmqpClose" +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">657</td>
	<td class="source"><code>            "() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">658</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">659</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">660</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">661</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">662</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">663</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">664</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">665</td>
	<td class="source"><code>    this._onSessionClose = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">666</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">667</td>
	<td class="source"><code>      const receiver = this._receiver || context.receiver!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">668</td>
	<td class="source"><code>      const sessionError = context.session && context.session.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">669</td>
	<td class="source"><code>      if (sessionError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">670</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">671</td>
	<td class="source"><code>          "[%s] 'session_close' event occurred for receiver '%s' with address '%s'. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">672</td>
	<td class="source"><code>            "The associated error is: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">673</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">674</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">675</td>
	<td class="source"><code>          this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">676</td>
	<td class="source"><code>          sessionError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">677</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">678</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">679</td>
	<td class="source"><code>      this._clearAllMessageLockRenewTimers();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">680</td>
	<td class="source"><code>      if (receiver && !receiver.isSessionItselfClosed()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">681</td>
	<td class="source"><code>        if (!this.isConnecting) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">682</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">683</td>
	<td class="source"><code>            "[%s] 'session_close' event occurred on the session of receiver '%s' with " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">684</td>
	<td class="source"><code>              "address '%s' and the sdk did not initiate this. Hence calling detached from the " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">685</td>
	<td class="source"><code>              "_onSessionClose() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">686</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">687</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">688</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">689</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">690</td>
	<td class="source"><code>          await this.onDetached(sessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">691</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">692</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">693</td>
	<td class="source"><code>            "[%s] 'session_close' event occurred on the session of receiver '%s' with " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">694</td>
	<td class="source"><code>              "address '%s' and the sdk did not initiate this. Moreover the receiver is already " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">695</td>
	<td class="source"><code>              "re-connecting. Hence not calling detached from the _onSessionClose() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">696</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">697</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">698</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">699</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">700</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">701</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">702</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">703</td>
	<td class="source"><code>          "[%s] 'session_close' event occurred on the session of receiver '%s' with address " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">704</td>
	<td class="source"><code>            "'%s' because the sdk initiated it. Hence not calling detached from the _onSessionClose" +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">705</td>
	<td class="source"><code>            "() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">706</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">707</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">708</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">709</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">710</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">711</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">712</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">713</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">714</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">715</td>
	<td class="source"><code>   * Will reconnect the receiver link if necessary.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">716</td>
	<td class="source"><code>   * @param {AmqpError | Error} [receiverError] The receiver error if any.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">717</td>
	<td class="source"><code>   * @returns {Promise&#60;void&#62;} Promise&#60;void&#62;.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">718</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">719</td>
	<td class="source"><code>  async onDetached(receiverError?: AmqpError | Error): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">720</td>
	<td class="source"><code>    const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">721</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">722</td>
	<td class="source"><code>      // Local 'wasCloseInitiated' serves same purpose as {this.wasCloseInitiated}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">723</td>
	<td class="source"><code>      // but the condition is inferred based on state of receiver in context of network disconnect scenario</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">724</td>
	<td class="source"><code>      const wasCloseInitiated = this._receiver && this._receiver.isItselfClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">725</td>
	<td class="source"><code>      // Clears the token renewal timer. Closes the link and its session if they are open.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">726</td>
	<td class="source"><code>      // Removes the link and its session if they are present in rhea's cache.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">727</td>
	<td class="source"><code>      await this._closeLink(this._receiver);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">728</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">729</td>
	<td class="source"><code>      if (this.receiverType === ReceiverType.batching) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">730</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">731</td>
	<td class="source"><code>          "[%s] Receiver '%s' with address '%s' is a Batching Receiver, so we will not be " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">732</td>
	<td class="source"><code>            "re-establishing the receiver link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">733</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">734</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">735</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">736</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">737</td>
	<td class="source"><code>        return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">738</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">739</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">740</td>
	<td class="source"><code>      // We should attempt to reopen only when the receiver(sdk) did not initiate the close</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">741</td>
	<td class="source"><code>      let shouldReopen = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">742</td>
	<td class="source"><code>      if (receiverError && !wasCloseInitiated) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">743</td>
	<td class="source"><code>        const translatedError = translate(receiverError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">744</td>
	<td class="source"><code>        if (translatedError.retryable) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">745</td>
	<td class="source"><code>          shouldReopen = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">746</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">747</td>
	<td class="source"><code>            "[%s] close() method of Receiver '%s' with address '%s' was not called. There " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">748</td>
	<td class="source"><code>              "was an accompanying error and it is retryable. This is a candidate for re-establishing " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">749</td>
	<td class="source"><code>              "the receiver link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">750</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">751</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">752</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">753</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">754</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">755</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">756</td>
	<td class="source"><code>            "[%s] close() method of Receiver '%s' with address '%s' was not called. There " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">757</td>
	<td class="source"><code>              "was an accompanying error and it is NOT retryable. Hence NOT re-establishing " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">758</td>
	<td class="source"><code>              "the receiver link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">759</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">760</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">761</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">762</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">763</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">764</td>
	<td class="source"><code>      } else if (!wasCloseInitiated) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">765</td>
	<td class="source"><code>        shouldReopen = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">766</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">767</td>
	<td class="source"><code>          "[%s] close() method of Receiver '%s' with address '%s' was not called. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">768</td>
	<td class="source"><code>            "There was no accompanying error as well. This is a candidate for re-establishing " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">769</td>
	<td class="source"><code>            "the receiver link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">770</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">771</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">772</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">773</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">774</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">775</td>
	<td class="source"><code>        const state: any = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">776</td>
	<td class="source"><code>          wasCloseInitiated: wasCloseInitiated,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">777</td>
	<td class="source"><code>          receiverError: receiverError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">778</td>
	<td class="source"><code>          _receiver: this._receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">779</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">780</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">781</td>
	<td class="source"><code>          "[%s] Something went wrong. State of Receiver '%s' with address '%s' is: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">782</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">783</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">784</td>
	<td class="source"><code>          this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">785</td>
	<td class="source"><code>          state</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">786</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">787</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">788</td>
	<td class="source"><code>      if (shouldReopen) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">789</td>
	<td class="source"><code>        const disconnectedReceiverName = this.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">790</td>
	<td class="source"><code>        // provide a new name to the link while re-connecting it. This ensures that</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">791</td>
	<td class="source"><code>        // the service does not send an error stating that the link is still open.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">792</td>
	<td class="source"><code>        const options: ReceiverOptions = this._createReceiverOptions(true);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">793</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">794</td>
	<td class="source"><code>        this.name = options.name!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">795</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">796</td>
	<td class="source"><code>        log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">797</td>
	<td class="source"><code>          "[%s] Closing the disconnected Receiver '%s' and creating a new one with the name '%s'",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">798</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">799</td>
	<td class="source"><code>          disconnectedReceiverName,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">800</td>
	<td class="source"><code>          this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">801</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">802</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">803</td>
	<td class="source"><code>        // shall retry forever at an interval of 15 seconds if the error is a retryable error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">804</td>
	<td class="source"><code>        // else bail out when the error is not retryable or the oepration succeeds.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">805</td>
	<td class="source"><code>        const config: RetryConfig&#60;void&#62; = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">806</td>
	<td class="source"><code>          operation: () =&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">807</td>
	<td class="source"><code>            this._init(options).then(async () =&#62; {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 808, Column 15: "Each then() should return a value or throw"
		<a href="http://eslint.org/docs/rules/promise/always-return" target="_blank">promise/always-return</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">808</td>
	<td class="source"><code>              if (this.wasCloseInitiated) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">809</td>
	<td class="source"><code>                log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">810</td>
	<td class="source"><code>                  "[%s] close() method of Receiver '%s' with address '%s' was called. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">811</td>
	<td class="source"><code>                    "by the time the receiver finished getting created. Hence, disallowing messages from being received. ",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">812</td>
	<td class="source"><code>                  connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">813</td>
	<td class="source"><code>                  this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">814</td>
	<td class="source"><code>                  this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">815</td>
	<td class="source"><code>                );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">816</td>
	<td class="source"><code>                await this.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">817</td>
	<td class="source"><code>              } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">818</td>
	<td class="source"><code>                if (this._receiver && this.receiverType === ReceiverType.streaming) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">819</td>
	<td class="source"><code>                  this._receiver.addCredit(this.maxConcurrentCalls);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">820</td>
	<td class="source"><code>                }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">821</td>
	<td class="source"><code>              }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">822</td>
	<td class="source"><code>            }),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">823</td>
	<td class="source"><code>          connectionId: connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">824</td>
	<td class="source"><code>          operationType: RetryOperationType.receiverLink,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">825</td>
	<td class="source"><code>          times: Constants.defaultConnectionRetryAttempts,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">826</td>
	<td class="source"><code>          connectionHost: this._context.namespace.config.host,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">827</td>
	<td class="source"><code>          delayInSeconds: 15</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">828</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">829</td>
	<td class="source"><code>        if (!this.wasCloseInitiated) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">830</td>
	<td class="source"><code>          await retry&#60;void&#62;(config);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">831</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">832</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">833</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">834</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">835</td>
	<td class="source"><code>        "[%s] An error occurred while processing detached() of Receiver '%s': %O ",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">836</td>
	<td class="source"><code>        connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">837</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">838</td>
	<td class="source"><code>        this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">839</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">840</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">841</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">842</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">843</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">844</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">845</td>
	<td class="source"><code>   * Closes the underlying AMQP receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">846</td>
	<td class="source"><code>   * @return {Promise&#60;void&#62;} Promise&#60;void&#62;.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">847</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">848</td>
	<td class="source"><code>  async close(): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">849</td>
	<td class="source"><code>    this.wasCloseInitiated = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">850</td>
	<td class="source"><code>    log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">851</td>
	<td class="source"><code>      "[%s] Closing the [%s]Receiver for entity '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">852</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">853</td>
	<td class="source"><code>      this.receiverType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">854</td>
	<td class="source"><code>      this._context.entityPath</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">855</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">856</td>
	<td class="source"><code>    if (this._newMessageReceivedTimer) clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">857</td>
	<td class="source"><code>    this._clearAllMessageLockRenewTimers();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">858</td>
	<td class="source"><code>    if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">859</td>
	<td class="source"><code>      const receiverLink = this._receiver;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">860</td>
	<td class="source"><code>      this._deleteFromCache();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">861</td>
	<td class="source"><code>      await this._closeLink(receiverLink);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">862</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">863</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">864</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">865</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">866</td>
	<td class="source"><code>   * Settles the message with the specified disposition.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">867</td>
	<td class="source"><code>   * @param message The ServiceBus Message that needs to be settled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">868</td>
	<td class="source"><code>   * @param operation The disposition type.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">869</td>
	<td class="source"><code>   * @param options Optional parameters that can be provided while disposing the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">870</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">871</td>
	<td class="source"><code>  async settleMessage(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">872</td>
	<td class="source"><code>    message: ServiceBusMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">873</td>
	<td class="source"><code>    operation: DispositionType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">874</td>
	<td class="source"><code>    options?: DispositionOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">875</td>
	<td class="source"><code>  ): Promise&#60;any&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">876</td>
	<td class="source"><code>    return new Promise((resolve, reject) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">877</td>
	<td class="source"><code>      if (!options) options = {};</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 878, Column 68: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">878</td>
	<td class="source"><code>      if (operation.match(/^(complete|abandon|defer|deadletter)$/) == undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">879</td>
	<td class="source"><code>        return reject(new Error(`operation: '${operation}' is not a valid operation.`));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">880</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">881</td>
	<td class="source"><code>      this._clearMessageLockRenewTimer(message.messageId as string);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">882</td>
	<td class="source"><code>      const delivery = message.delivery;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">883</td>
	<td class="source"><code>      const timer = setTimeout(() =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">884</td>
	<td class="source"><code>        this._deliveryDispositionMap.delete(delivery.id);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">885</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">886</td>
	<td class="source"><code>        throwIfMessageCannotBeSettled(this, operation, delivery.remote_settled);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">887</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">888</td>
	<td class="source"><code>        log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">889</td>
	<td class="source"><code>          "[%s] Disposition for delivery id: %d, did not complete in %d milliseconds. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">890</td>
	<td class="source"><code>            "Hence resolving the promise.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">891</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">892</td>
	<td class="source"><code>          delivery.id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">893</td>
	<td class="source"><code>          messageDispositionTimeout</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">894</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">895</td>
	<td class="source"><code>        return resolve();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">896</td>
	<td class="source"><code>      }, messageDispositionTimeout);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">897</td>
	<td class="source"><code>      this._deliveryDispositionMap.set(delivery.id, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">898</td>
	<td class="source"><code>        resolve: resolve,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">899</td>
	<td class="source"><code>        reject: reject,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">900</td>
	<td class="source"><code>        timer: timer</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">901</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">902</td>
	<td class="source"><code>      if (operation === DispositionType.complete) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">903</td>
	<td class="source"><code>        delivery.accept();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">904</td>
	<td class="source"><code>      } else if (operation === DispositionType.abandon) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">905</td>
	<td class="source"><code>        const params: any = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">906</td>
	<td class="source"><code>          undeliverable_here: false</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">907</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">908</td>
	<td class="source"><code>        if (options.propertiesToModify) params.message_annotations = options.propertiesToModify;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">909</td>
	<td class="source"><code>        delivery.modified(params);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">910</td>
	<td class="source"><code>      } else if (operation === DispositionType.defer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">911</td>
	<td class="source"><code>        const params: any = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">912</td>
	<td class="source"><code>          undeliverable_here: true</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">913</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">914</td>
	<td class="source"><code>        if (options.propertiesToModify) params.message_annotations = options.propertiesToModify;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">915</td>
	<td class="source"><code>        delivery.modified(params);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">916</td>
	<td class="source"><code>      } else if (operation === DispositionType.deadletter) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">917</td>
	<td class="source"><code>        delivery.reject(options.error || {});</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">918</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">919</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">920</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">921</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">922</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">923</td>
	<td class="source"><code>   * Determines whether the AMQP receiver link is open. If open then returns true else returns false.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">924</td>
	<td class="source"><code>   * @return {boolean} boolean</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">925</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">926</td>
	<td class="source"><code>  isOpen(): boolean {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">927</td>
	<td class="source"><code>    const result: boolean = this._receiver! && this._receiver!.isOpen();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">928</td>
	<td class="source"><code>    log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">929</td>
	<td class="source"><code>      "[%s] Receiver '%s' with address '%s' is open? -&#62; %s",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">930</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">931</td>
	<td class="source"><code>      this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">932</td>
	<td class="source"><code>      this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">933</td>
	<td class="source"><code>      result</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">934</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">935</td>
	<td class="source"><code>    return result;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">936</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">937</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 938, Column 3: "Member _deleteFromCache should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">938</td>
	<td class="source"><code>  protected _deleteFromCache(): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">939</td>
	<td class="source"><code>    this._receiver = undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">940</td>
	<td class="source"><code>    if (this.receiverType === ReceiverType.streaming) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">941</td>
	<td class="source"><code>      this._context.streamingReceiver = undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">942</td>
	<td class="source"><code>    } else if (this.receiverType === ReceiverType.batching) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">943</td>
	<td class="source"><code>      this._context.batchingReceiver = undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">944</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">945</td>
	<td class="source"><code>    log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">946</td>
	<td class="source"><code>      "[%s] Deleted the receiver '%s' from the client cache.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">947</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">948</td>
	<td class="source"><code>      this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">949</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">950</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">951</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">952</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">953</td>
	<td class="source"><code>   * Creates a new AMQP receiver under a new AMQP session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">954</td>
	<td class="source"><code>   * @protected</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">955</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">956</td>
	<td class="source"><code>   * @returns {Promise&#60;void&#62;} Promise&#60;void&#62;.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">957</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 958, Column 3: "Member _init should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">958</td>
	<td class="source"><code>  protected async _init(options?: ReceiverOptions): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">959</td>
	<td class="source"><code>    const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">960</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">961</td>
	<td class="source"><code>      if (!this.isOpen() && !this.isConnecting) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">962</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">963</td>
	<td class="source"><code>          "[%s] The receiver '%s' with address '%s' is not open and is not currently " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">964</td>
	<td class="source"><code>            "establishing itself. Hence let's try to connect.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">965</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">966</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">967</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">968</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">969</td>
	<td class="source"><code>        this.isConnecting = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">970</td>
	<td class="source"><code>        await this._negotiateClaim();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">971</td>
	<td class="source"><code>        if (!options) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">972</td>
	<td class="source"><code>          options = this._createReceiverOptions();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">973</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">974</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">975</td>
	<td class="source"><code>          "[%s] Trying to create receiver '%s' with options %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">976</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">977</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">978</td>
	<td class="source"><code>          options</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">979</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">980</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">981</td>
	<td class="source"><code>        this._receiver = await this._context.namespace.connection.createReceiver(options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">982</td>
	<td class="source"><code>        this.isConnecting = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">983</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">984</td>
	<td class="source"><code>          "[%s] Receiver '%s' with address '%s' has established itself.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">985</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">986</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">987</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">988</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">989</td>
	<td class="source"><code>        log[this.receiverType](</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">990</td>
	<td class="source"><code>          "Promise to create the receiver resolved. " + "Created receiver with name: ",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">991</td>
	<td class="source"><code>          this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">992</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">993</td>
	<td class="source"><code>        log[this.receiverType](</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">994</td>
	<td class="source"><code>          "[%s] Receiver '%s' created with receiver options: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">995</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">996</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">997</td>
	<td class="source"><code>          options</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">998</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">999</td>
	<td class="source"><code>        // It is possible for someone to close the receiver and then start it again.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1000</td>
	<td class="source"><code>        // Thus make sure that the receiver is present in the client cache.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1001</td>
	<td class="source"><code>        if (this.receiverType === ReceiverType.streaming && !this._context.streamingReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1002</td>
	<td class="source"><code>          this._context.streamingReceiver = this as any;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1003</td>
	<td class="source"><code>        } else if (this.receiverType === ReceiverType.batching && !this._context.batchingReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1004</td>
	<td class="source"><code>          this._context.batchingReceiver = this as any;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1005</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1006</td>
	<td class="source"><code>        await this._ensureTokenRenewal();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1007</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1008</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1009</td>
	<td class="source"><code>          "[%s] The receiver '%s' with address '%s' is open -&#62; %s and is connecting " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1010</td>
	<td class="source"><code>            "-&#62; %s. Hence not reconnecting.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1011</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1012</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1013</td>
	<td class="source"><code>          this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1014</td>
	<td class="source"><code>          this.isOpen(),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1015</td>
	<td class="source"><code>          this.isConnecting</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1016</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1017</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1018</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1019</td>
	<td class="source"><code>      this.isConnecting = false;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1020, Column 7: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">1020</td>
	<td class="source"><code>      err = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1021</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1022</td>
	<td class="source"><code>        "[%s] An error occured while creating the receiver '%s': %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1023</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1024</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1025</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1026</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1027</td>
	<td class="source"><code>      throw err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1028</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1029</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1030</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1031</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1032</td>
	<td class="source"><code>   * Creates the options that need to be specified while creating an AMQP receiver link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1033</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1034, Column 3: "Member _createReceiverOptions should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">1034</td>
	<td class="source"><code>  protected _createReceiverOptions(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1035</td>
	<td class="source"><code>    useNewName?: boolean,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1036</td>
	<td class="source"><code>    options?: CreateReceiverOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1037</td>
	<td class="source"><code>  ): ReceiverOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1038</td>
	<td class="source"><code>    if (!options) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1039</td>
	<td class="source"><code>      options = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1040</td>
	<td class="source"><code>        onMessage: (context: EventContext) =&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1041</td>
	<td class="source"><code>          this._onAmqpMessage(context).catch(() =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1042</td>
	<td class="source"><code>            /* */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1043</td>
	<td class="source"><code>          }),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1044</td>
	<td class="source"><code>        onClose: (context: EventContext) =&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1045</td>
	<td class="source"><code>          this._onAmqpClose(context).catch(() =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1046</td>
	<td class="source"><code>            /* */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1047</td>
	<td class="source"><code>          }),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1048</td>
	<td class="source"><code>        onSessionClose: (context: EventContext) =&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1049</td>
	<td class="source"><code>          this._onSessionClose(context).catch(() =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1050</td>
	<td class="source"><code>            /* */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1051</td>
	<td class="source"><code>          }),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1052</td>
	<td class="source"><code>        onError: this._onAmqpError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1053</td>
	<td class="source"><code>        onSessionError: this._onSessionError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1054</td>
	<td class="source"><code>        onSettled: this._onSettled</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1055</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1056</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1057</td>
	<td class="source"><code>    const rcvrOptions: ReceiverOptions = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1058</td>
	<td class="source"><code>      name: useNewName ? getUniqueName(this._context.entityPath) : this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1059</td>
	<td class="source"><code>      autoaccept: this.receiveMode === ReceiveMode.receiveAndDelete ? true : false,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1060</td>
	<td class="source"><code>      // receiveAndDelete -&#62; first(0), peekLock -&#62; second (1)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1061</td>
	<td class="source"><code>      rcv_settle_mode: this.receiveMode === ReceiveMode.receiveAndDelete ? 0 : 1,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1062</td>
	<td class="source"><code>      // receiveAndDelete -&#62; settled (1), peekLock -&#62; unsettled (0)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1063</td>
	<td class="source"><code>      snd_settle_mode: this.receiveMode === ReceiveMode.receiveAndDelete ? 1 : 0,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1064</td>
	<td class="source"><code>      source: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1065</td>
	<td class="source"><code>        address: this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1066</td>
	<td class="source"><code>      },</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1067</td>
	<td class="source"><code>      credit_window: 0,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1068</td>
	<td class="source"><code>      ...options</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1069</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1070</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1071</td>
	<td class="source"><code>    return rcvrOptions;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1072</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1073</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1074</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcCoreMessageSenderTs" class="lint-result bg-error" data-group="f-7" data-problem-count="14" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\core\messageSender.ts
    </th>
    <th class="result-summary">
      14 problems (11 errors, 3 warnings)
    </th>
</tr>
<tr class="f-7 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-7"
								data-content="detailSummary-7"
								aria-controls="detailSummary-7"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-7"
								data-content="sourceCode-7"
								aria-controls="sourceCode-7"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-7">
				<div class="row"><div class="column">
	<h3 class="text-error">Top errors</h3>
	<table class="summary-table"><thead>
		<tr>
			<th>rule</th>
			<th>count</th>
		</tr>
	</thead><tbody>
		<tr>
	<td><a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a></td>
	<td>4</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a></td>
	<td>4</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a></td>
	<td>3</td>
</tr>
	</tbody></table>
</div>
<div class="column">
	<h3 class="text-warning">Top warnings</h3>
	<table class="summary-table"><thead>
		<tr>
			<th>rule</th>
			<th>count</th>
		</tr>
	</thead><tbody>
		<tr>
	<td><a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a></td>
	<td>2</td>
</tr>
<tr>
	<td><a href="http://eslint.org/docs/rules/@typescript-eslint/no-unused-vars" target="_blank">@typescript-eslint/no-unused-vars</a></td>
	<td>1</td>
</tr>
	</tbody></table>
</div>
</div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 369, Column 11: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 438, Column 13: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 483, Column 3: "Member _deleteFromCache should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 494, Column 3: "Member _createSenderOptions should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 521, Column 3: "Member _trySend should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 522, Column 30: "Missing return type on function."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 533, Column 15: "'onRejected' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 534, Column 15: "'onReleased' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 535, Column 15: "'onModified' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 536, Column 15: "'onAccepted' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 549, Column 25: "'context' is defined but never used."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/no-unused-vars" target="_blank">@typescript-eslint/no-unused-vars</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 608, Column 38: "Missing return type on function."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 675, Column 3: "Member _init should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 726, Column 7: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-7">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import * as log from "../log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>  messageProperties,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>  Sender,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>  EventContext,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>  OnAmqpEvent,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>  SenderOptions,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code>  SenderEvents,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>  message as RheaMessageUtil,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code>  AmqpError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>  generate_uuid</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>} from "rhea-promise";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code>  defaultLock,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code>  Func,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code>  retry,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code>  translate,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code>  AmqpMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code>  ErrorNameConditionMapper,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code>  RetryConfig,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code>  RetryOperationType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code>  Constants,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code>  randomNumberFromInterval</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code>} from "@azure/amqp-common";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code>  SendableMessageInfo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code>  toAmqpMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code>  getMessagePropertyTypeMismatchError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>} from "../serviceBusMessage";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code>import { ClientEntityContext } from "../clientEntityContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>import { LinkEntity } from "./linkEntity";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code>import { getUniqueName } from "../util/utils";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code>import { throwErrorIfConnectionClosed } from "../util/errors";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code>interface CreateSenderOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code>  newName?: boolean;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code> * Describes the MessageSender that will send messages to ServiceBus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code> * @class MessageSender</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code>export class MessageSender extends LinkEntity {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code>   * @property {string} senderLock The unqiue lock name per connection that is used to acquire the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code>   * lock for establishing a sender link by an entity on that connection.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>  readonly senderLock: string = `sender-${generate_uuid()}`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code>   * @property {OnAmqpEvent} _onAmqpError The handler function to handle errors that happen on the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code>   * underlying sender.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code>  private readonly _onAmqpError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code>   * @property {OnAmqpEvent} _onAmqpClose The handler function to handle "sender_close" event</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>   * that happens on the underlying sender.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>  private readonly _onAmqpClose: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">69</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code>   * @property {OnAmqpEvent} _onSessionError The message handler that will be set as the handler on</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code>   * the underlying rhea sender's session for the "session_error" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code>   * @private</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code>  private _onSessionError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code>   * @property {OnAmqpEvent} _onSessionClose The message handler that will be set as the handler on</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code>   * the underlying rhea sender's session for the "session_close" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code>   * @private</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code>  private _onSessionClose: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">81</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>   * @property {Sender} [_sender] The AMQP sender link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>   * @private</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">84</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">85</td>
	<td class="source"><code>  private _sender?: Sender;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">86</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code>   * Creates a new MessageSender instance.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code>   * @constructor</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">90</td>
	<td class="source"><code>   * @param {ClientEntityContext} context The client entity context.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>  constructor(context: ClientEntityContext) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>    super(context.entityPath, context, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>      address: context.entityPath,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>      audience: `${context.namespace.config.endpoint}${context.entityPath}`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code>    this._onAmqpError = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code>      const senderError = context.sender && context.sender.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>      if (senderError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code>        const err = translate(senderError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>          "[%s] An error occurred for sender '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>          err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">110</td>
	<td class="source"><code>    this._onSessionError = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">111</td>
	<td class="source"><code>      const sessionError = context.session && context.session.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code>      if (sessionError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code>        const err = translate(sessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>          "[%s] An error occurred on the session of sender '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code>          err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">119</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">120</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">121</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">122</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">123</td>
	<td class="source"><code>    this._onAmqpClose = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">124</td>
	<td class="source"><code>      const sender = this._sender || context.sender!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">125</td>
	<td class="source"><code>      const senderError = context.sender && context.sender.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">126</td>
	<td class="source"><code>      if (senderError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">127</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">128</td>
	<td class="source"><code>          "[%s] 'sender_close' event occurred for sender '%s' with address '%s'. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">129</td>
	<td class="source"><code>            "The associated error is: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">130</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">131</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">132</td>
	<td class="source"><code>          this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">133</td>
	<td class="source"><code>          senderError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">134</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">135</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">136</td>
	<td class="source"><code>      if (sender && !sender.isItselfClosed()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">137</td>
	<td class="source"><code>        if (!this.isConnecting) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">138</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">139</td>
	<td class="source"><code>            "[%s] 'sender_close' event occurred on the sender '%s' with address '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">140</td>
	<td class="source"><code>              "and the sdk did not initiate this. The sender is not reconnecting. Hence, calling " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">141</td>
	<td class="source"><code>              "detached from the _onAmqpClose() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">142</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">143</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">144</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">145</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">146</td>
	<td class="source"><code>          await this.onDetached(senderError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">147</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">148</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">149</td>
	<td class="source"><code>            "[%s] 'sender_close' event occurred on the sender '%s' with address '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">150</td>
	<td class="source"><code>              "and the sdk did not initate this. Moreover the sender is already re-connecting. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">151</td>
	<td class="source"><code>              "Hence not calling detached from the _onAmqpClose() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">152</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">153</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">154</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">155</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">156</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">157</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">158</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">159</td>
	<td class="source"><code>          "[%s] 'sender_close' event occurred on the sender '%s' with address '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">160</td>
	<td class="source"><code>            "because the sdk initiated it. Hence not calling detached from the _onAmqpClose" +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">161</td>
	<td class="source"><code>            "() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">162</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">163</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">164</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">165</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">166</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">167</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">168</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">169</td>
	<td class="source"><code>    this._onSessionClose = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">170</td>
	<td class="source"><code>      const sender = this._sender || context.sender!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">171</td>
	<td class="source"><code>      const sessionError = context.session && context.session.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">172</td>
	<td class="source"><code>      if (sessionError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">173</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">174</td>
	<td class="source"><code>          "[%s] 'session_close' event occurred for sender '%s' with address '%s'. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">175</td>
	<td class="source"><code>            "The associated error is: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">176</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">177</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">178</td>
	<td class="source"><code>          this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">179</td>
	<td class="source"><code>          sessionError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">180</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">181</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">182</td>
	<td class="source"><code>      if (sender && !sender.isSessionItselfClosed()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">183</td>
	<td class="source"><code>        if (!this.isConnecting) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">184</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">185</td>
	<td class="source"><code>            "[%s] 'session_close' event occurred on the session of sender '%s' with " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">186</td>
	<td class="source"><code>              "address '%s' and the sdk did not initiate this. Hence calling detached from the " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">187</td>
	<td class="source"><code>              "_onSessionClose() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">188</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">189</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">190</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">191</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">192</td>
	<td class="source"><code>          await this.onDetached(sessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">193</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">194</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">195</td>
	<td class="source"><code>            "[%s] 'session_close' event occurred on the session of sender '%s' with " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">196</td>
	<td class="source"><code>              "address '%s' and the sdk did not initiate this. Moreover the sender is already " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">197</td>
	<td class="source"><code>              "re-connecting. Hence not calling detached from the _onSessionClose() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">198</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">199</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">200</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">201</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">202</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">203</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">204</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">205</td>
	<td class="source"><code>          "[%s] 'session_close' event occurred on the session of sender '%s' with address " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">206</td>
	<td class="source"><code>            "'%s' because the sdk initiated it. Hence not calling detached from the _onSessionClose" +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">207</td>
	<td class="source"><code>            "() handler.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">208</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">209</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">210</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">211</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">212</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">213</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">214</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">215</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">216</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">217</td>
	<td class="source"><code>   * Will reconnect the sender link if necessary.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">218</td>
	<td class="source"><code>   * @param {AmqpError | Error} [senderError] The sender error if any.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">219</td>
	<td class="source"><code>   * @returns {Promise&#60;void&#62;} Promise&#60;void&#62;.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">220</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">221</td>
	<td class="source"><code>  async onDetached(senderError?: AmqpError | Error): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">222</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">223</td>
	<td class="source"><code>      const wasCloseInitiated = this._sender && this._sender.isItselfClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">224</td>
	<td class="source"><code>      // Clears the token renewal timer. Closes the link and its session if they are open.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">225</td>
	<td class="source"><code>      // Removes the link and its session if they are present in rhea's cache.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">226</td>
	<td class="source"><code>      await this._closeLink(this._sender);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">227</td>
	<td class="source"><code>      // We should attempt to reopen only when the sender(sdk) did not initiate the close</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">228</td>
	<td class="source"><code>      let shouldReopen = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">229</td>
	<td class="source"><code>      if (senderError && !wasCloseInitiated) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">230</td>
	<td class="source"><code>        const translatedError = translate(senderError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">231</td>
	<td class="source"><code>        if (translatedError.retryable) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">232</td>
	<td class="source"><code>          shouldReopen = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">233</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">234</td>
	<td class="source"><code>            "[%s] close() method of Sender '%s' with address '%s' was not called. There " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">235</td>
	<td class="source"><code>              "was an accompanying error an it is retryable. This is a candidate for re-establishing " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">236</td>
	<td class="source"><code>              "the sender link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">237</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">238</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">239</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">240</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">241</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">242</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">243</td>
	<td class="source"><code>            "[%s] close() method of Sender '%s' with address '%s' was not called. There " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">244</td>
	<td class="source"><code>              "was an accompanying error and it is NOT retryable. Hence NOT re-establishing " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">245</td>
	<td class="source"><code>              "the sender link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">246</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">247</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">248</td>
	<td class="source"><code>            this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">249</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">250</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">251</td>
	<td class="source"><code>      } else if (!wasCloseInitiated) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">252</td>
	<td class="source"><code>        shouldReopen = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">253</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">254</td>
	<td class="source"><code>          "[%s] close() method of Sender '%s' with address '%s' was not called. There " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">255</td>
	<td class="source"><code>            "was no accompanying error as well. This is a candidate for re-establishing " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">256</td>
	<td class="source"><code>            "the sender link.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">257</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">258</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">259</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">260</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">261</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">262</td>
	<td class="source"><code>        const state: any = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">263</td>
	<td class="source"><code>          wasCloseInitiated: wasCloseInitiated,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">264</td>
	<td class="source"><code>          senderError: senderError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">265</td>
	<td class="source"><code>          _sender: this._sender</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">266</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">267</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">268</td>
	<td class="source"><code>          "[%s] Something went wrong. State of sender '%s' with address '%s' is: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">269</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">270</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">271</td>
	<td class="source"><code>          this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">272</td>
	<td class="source"><code>          state</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">273</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">274</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">275</td>
	<td class="source"><code>      if (shouldReopen) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">276</td>
	<td class="source"><code>        await defaultLock.acquire(this.senderLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">277</td>
	<td class="source"><code>          const options: SenderOptions = this._createSenderOptions({</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">278</td>
	<td class="source"><code>            newName: true</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">279</td>
	<td class="source"><code>          });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">280</td>
	<td class="source"><code>          // shall retry forever at an interval of 15 seconds if the error is a retryable error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">281</td>
	<td class="source"><code>          // else bail out when the error is not retryable or the oepration succeeds.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">282</td>
	<td class="source"><code>          const config: RetryConfig&#60;void&#62; = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">283</td>
	<td class="source"><code>            operation: () =&#62; this._init(options),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">284</td>
	<td class="source"><code>            connectionId: this._context.namespace.connectionId!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">285</td>
	<td class="source"><code>            operationType: RetryOperationType.senderLink,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">286</td>
	<td class="source"><code>            times: Constants.defaultConnectionRetryAttempts,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">287</td>
	<td class="source"><code>            connectionHost: this._context.namespace.config.host,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">288</td>
	<td class="source"><code>            delayInSeconds: 15</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">289</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">290</td>
	<td class="source"><code>          return retry&#60;void&#62;(config);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">291</td>
	<td class="source"><code>        });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">292</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">293</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">294</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">295</td>
	<td class="source"><code>        "[%s] An error occurred while processing detached() of Sender '%s' with address " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">296</td>
	<td class="source"><code>          "'%s': %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">297</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">298</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">299</td>
	<td class="source"><code>        this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">300</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">301</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">302</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">303</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">304</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">305</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">306</td>
	<td class="source"><code>   * Deletes the sender fromt the context. Clears the token renewal timer. Closes the sender link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">307</td>
	<td class="source"><code>   * @return {Promise&#60;void&#62;} Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">308</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">309</td>
	<td class="source"><code>  async close(): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">310</td>
	<td class="source"><code>    if (this._sender) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">311</td>
	<td class="source"><code>      log.sender(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">312</td>
	<td class="source"><code>        "[%s] Closing the Sender for the entity '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">313</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">314</td>
	<td class="source"><code>        this._context.entityPath</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">315</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">316</td>
	<td class="source"><code>      const senderLink = this._sender;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">317</td>
	<td class="source"><code>      this._deleteFromCache();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">318</td>
	<td class="source"><code>      await this._closeLink(senderLink);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">319</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">320</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">321</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">322</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">323</td>
	<td class="source"><code>   * Determines whether the AMQP sender link is open. If open then returns true else returns false.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">324</td>
	<td class="source"><code>   * @return {boolean} boolean</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">325</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">326</td>
	<td class="source"><code>  isOpen(): boolean {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">327</td>
	<td class="source"><code>    const result: boolean = this._sender! && this._sender!.isOpen();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">328</td>
	<td class="source"><code>    log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">329</td>
	<td class="source"><code>      "[%s] Sender '%s' with address '%s' is open? -&#62; %s",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">330</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">331</td>
	<td class="source"><code>      this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">332</td>
	<td class="source"><code>      this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">333</td>
	<td class="source"><code>      result</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">334</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">335</td>
	<td class="source"><code>    return result;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">336</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">337</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">338</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">339</td>
	<td class="source"><code>   * Sends the given message, with the given options on this link</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">340</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">341</td>
	<td class="source"><code>   * @param {SendableMessageInfo} data Message to send.  Will be sent as UTF8-encoded JSON string.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">342</td>
	<td class="source"><code>   * @returns {Promise&#60;void&#62;}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">343</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">344</td>
	<td class="source"><code>  async send(data: SendableMessageInfo): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">345</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">346</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">347</td>
	<td class="source"><code>      if (!this.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">348</td>
	<td class="source"><code>        log.sender(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">349</td>
	<td class="source"><code>          "Acquiring lock %s for initializing the session, sender and " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">350</td>
	<td class="source"><code>            "possibly the connection.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">351</td>
	<td class="source"><code>          this.senderLock</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">352</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">353</td>
	<td class="source"><code>        await defaultLock.acquire(this.senderLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">354</td>
	<td class="source"><code>          return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">355</td>
	<td class="source"><code>        });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">356</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">357</td>
	<td class="source"><code>      const amqpMessage = toAmqpMessage(data);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">358</td>
	<td class="source"><code>      amqpMessage.body = this._context.namespace.dataTransformer.encode(data.body);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">359</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">360</td>
	<td class="source"><code>      let encodedMessage;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">361</td>
	<td class="source"><code>      try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">362</td>
	<td class="source"><code>        encodedMessage = RheaMessageUtil.encode(amqpMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">363</td>
	<td class="source"><code>      } catch (error) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">364</td>
	<td class="source"><code>        if (error instanceof TypeError || error.name === "TypeError") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">365</td>
	<td class="source"><code>          // `RheaMessageUtil.encode` can fail if message properties are of invalid type</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">366</td>
	<td class="source"><code>          // rhea throws errors with name `TypeError` but not an instance of `TypeError`, so catch them too</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">367</td>
	<td class="source"><code>          // Errors in such cases do not have user friendy message or call stack</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">368</td>
	<td class="source"><code>          // So use `getMessagePropertyTypeMismatchError` to get a better error message</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 369, Column 11: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">369</td>
	<td class="source"><code>          error = getMessagePropertyTypeMismatchError(data) || error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">370</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">371</td>
	<td class="source"><code>        throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">372</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">373</td>
	<td class="source"><code>      log.sender(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">374</td>
	<td class="source"><code>        "[%s] Sender '%s', trying to send message: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">375</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">376</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">377</td>
	<td class="source"><code>        data</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">378</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">379</td>
	<td class="source"><code>      return await this._trySend(encodedMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">380</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">381</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">382</td>
	<td class="source"><code>        "[%s] Sender '%s': An error occurred while sending the message: %O\nError: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">383</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">384</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">385</td>
	<td class="source"><code>        data,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">386</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">387</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">388</td>
	<td class="source"><code>      throw err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">389</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">390</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">391</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">392</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">393</td>
	<td class="source"><code>   * Send a batch of Message to the ServiceBus in a single AMQP message. The "message_annotations",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">394</td>
	<td class="source"><code>   * "application_properties" and "properties" of the first message will be set as that</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">395</td>
	<td class="source"><code>   * of the envelope (batch message).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">396</td>
	<td class="source"><code>   * @param {Array&#60;Message&#62;} inputMessages  An array of Message objects to be sent in a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">397</td>
	<td class="source"><code>   * Batch message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">398</td>
	<td class="source"><code>   * @return {Promise&#60;void&#62;}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">399</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">400</td>
	<td class="source"><code>  async sendBatch(inputMessages: SendableMessageInfo[]): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">401</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">402</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">403</td>
	<td class="source"><code>      if (!Array.isArray(inputMessages)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">404</td>
	<td class="source"><code>        inputMessages = [inputMessages];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">405</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">406</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">407</td>
	<td class="source"><code>      if (!this.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">408</td>
	<td class="source"><code>        log.sender(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">409</td>
	<td class="source"><code>          "Acquiring lock %s for initializing the session, sender and " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">410</td>
	<td class="source"><code>            "possibly the connection.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">411</td>
	<td class="source"><code>          this.senderLock</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">412</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">413</td>
	<td class="source"><code>        await defaultLock.acquire(this.senderLock, () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">414</td>
	<td class="source"><code>          return this._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">415</td>
	<td class="source"><code>        });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">416</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">417</td>
	<td class="source"><code>      log.sender(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">418</td>
	<td class="source"><code>        "[%s] Sender '%s', trying to send Message[]: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">419</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">420</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">421</td>
	<td class="source"><code>        inputMessages</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">422</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">423</td>
	<td class="source"><code>      const amqpMessages: AmqpMessage[] = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">424</td>
	<td class="source"><code>      const encodedMessages = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">425</td>
	<td class="source"><code>      // Convert Message to AmqpMessage.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">426</td>
	<td class="source"><code>      for (let i = 0; i &#60; inputMessages.length; i++) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">427</td>
	<td class="source"><code>        const amqpMessage = toAmqpMessage(inputMessages[i]);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">428</td>
	<td class="source"><code>        amqpMessage.body = this._context.namespace.dataTransformer.encode(inputMessages[i].body);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">429</td>
	<td class="source"><code>        amqpMessages[i] = amqpMessage;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">430</td>
	<td class="source"><code>        try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">431</td>
	<td class="source"><code>          encodedMessages[i] = RheaMessageUtil.encode(amqpMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">432</td>
	<td class="source"><code>        } catch (error) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">433</td>
	<td class="source"><code>          if (error instanceof TypeError || error.name === "TypeError") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">434</td>
	<td class="source"><code>            // `RheaMessageUtil.encode` can fail if message properties are of invalid type</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">435</td>
	<td class="source"><code>            // rhea throws errors with name `TypeError` but not an instance of `TypeError`, so catch them too</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">436</td>
	<td class="source"><code>            // Errors in such cases do not have user friendy message or call stack</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">437</td>
	<td class="source"><code>            // So use `getMessagePropertyTypeMismatchError` to get a better error message</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 438, Column 13: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">438</td>
	<td class="source"><code>            error = getMessagePropertyTypeMismatchError(inputMessages[i]) || error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">439</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">440</td>
	<td class="source"><code>          throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">441</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">442</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">443</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">444</td>
	<td class="source"><code>      // Convert every encoded message to amqp data section</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">445</td>
	<td class="source"><code>      const batchMessage: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">446</td>
	<td class="source"><code>        body: RheaMessageUtil.data_sections(encodedMessages)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">447</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">448</td>
	<td class="source"><code>      // Set message_annotations, application_properties and properties of the first message as</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">449</td>
	<td class="source"><code>      // that of the envelope (batch message).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">450</td>
	<td class="source"><code>      if (amqpMessages[0].message_annotations) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">451</td>
	<td class="source"><code>        batchMessage.message_annotations = amqpMessages[0].message_annotations;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">452</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">453</td>
	<td class="source"><code>      if (amqpMessages[0].application_properties) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">454</td>
	<td class="source"><code>        batchMessage.application_properties = amqpMessages[0].application_properties;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">455</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">456</td>
	<td class="source"><code>      for (const prop of messageProperties) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">457</td>
	<td class="source"><code>        if ((amqpMessages[0] as any)[prop]) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">458</td>
	<td class="source"><code>          (batchMessage as any)[prop] = (amqpMessages[0] as any)[prop];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">459</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">460</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">461</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">462</td>
	<td class="source"><code>      // Finally encode the envelope (batch message).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">463</td>
	<td class="source"><code>      const encodedBatchMessage = RheaMessageUtil.encode(batchMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">464</td>
	<td class="source"><code>      log.sender(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">465</td>
	<td class="source"><code>        "[%s]Sender '%s', sending encoded batch message.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">466</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">467</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">468</td>
	<td class="source"><code>        encodedBatchMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">469</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">470</td>
	<td class="source"><code>      return await this._trySend(encodedBatchMessage, true);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">471</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">472</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">473</td>
	<td class="source"><code>        "[%s] Sender '%s': An error occurred while sending the messages: %O\nError: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">474</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">475</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">476</td>
	<td class="source"><code>        inputMessages,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">477</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">478</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">479</td>
	<td class="source"><code>      throw err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">480</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">481</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">482</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 483, Column 3: "Member _deleteFromCache should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">483</td>
	<td class="source"><code>  private _deleteFromCache(): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">484</td>
	<td class="source"><code>    this._sender = undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">485</td>
	<td class="source"><code>    delete this._context.sender;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">486</td>
	<td class="source"><code>    log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">487</td>
	<td class="source"><code>      "[%s] Deleted the sender '%s' with address '%s' from the client cache.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">488</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">489</td>
	<td class="source"><code>      this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">490</td>
	<td class="source"><code>      this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">491</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">492</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">493</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 494, Column 3: "Member _createSenderOptions should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">494</td>
	<td class="source"><code>  private _createSenderOptions(options: CreateSenderOptions): SenderOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">495</td>
	<td class="source"><code>    if (options.newName) this.name = getUniqueName(this._context.entityPath);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">496</td>
	<td class="source"><code>    const srOptions: SenderOptions = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">497</td>
	<td class="source"><code>      name: this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">498</td>
	<td class="source"><code>      target: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">499</td>
	<td class="source"><code>        address: this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">500</td>
	<td class="source"><code>      },</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">501</td>
	<td class="source"><code>      onError: this._onAmqpError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">502</td>
	<td class="source"><code>      onClose: this._onAmqpClose,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">503</td>
	<td class="source"><code>      onSessionError: this._onSessionError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">504</td>
	<td class="source"><code>      onSessionClose: this._onSessionClose</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">505</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">506</td>
	<td class="source"><code>    log.sender("Creating sender with options: %O", srOptions);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">507</td>
	<td class="source"><code>    return srOptions;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">508</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">509</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">510</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">511</td>
	<td class="source"><code>   * Tries to send the message to ServiceBus if there is enough credit to send them</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">512</td>
	<td class="source"><code>   * and the circular buffer has available space to settle the message after sending them.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">513</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">514</td>
	<td class="source"><code>   * We have implemented a synchronous send over here in the sense that we shall be waiting</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">515</td>
	<td class="source"><code>   * for the message to be accepted or rejected and accordingly resolve or reject the promise.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">516</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">517</td>
	<td class="source"><code>   * @param encodedMessage The encoded message to be sent to ServiceBus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">518</td>
	<td class="source"><code>   * @param sendBatch Boolean indicating whether the encoded message represents a batch of messages or not</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">519</td>
	<td class="source"><code>   * @return {Promise&#60;Delivery&#62;} Promise&#60;Delivery&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">520</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 521, Column 3: "Member _trySend should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">521</td>
	<td class="source"><code>  private _trySend(encodedMessage: Buffer, sendBatch?: boolean): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 522, Column 30: "Missing return type on function."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a>
	</td>
</tr><tr class="hit bg-warning">
	<td class="line">522</td>
	<td class="source"><code>    const sendEventPromise = () =&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">523</td>
	<td class="source"><code>      new Promise&#60;void&#62;((resolve, reject) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">524</td>
	<td class="source"><code>        let waitTimer: any;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">525</td>
	<td class="source"><code>        log.sender(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">526</td>
	<td class="source"><code>          "[%s] Sender '%s', credit: %d available: %d",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">527</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">528</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">529</td>
	<td class="source"><code>          this._sender!.credit,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">530</td>
	<td class="source"><code>          this._sender!.session.outgoing.available()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">531</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">532</td>
	<td class="source"><code>        if (this._sender!.sendable()) {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 533, Column 15: "'onRejected' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">533</td>
	<td class="source"><code>          let onRejected: Func&#60;EventContext, void&#62;;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 534, Column 15: "'onReleased' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">534</td>
	<td class="source"><code>          let onReleased: Func&#60;EventContext, void&#62;;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 535, Column 15: "'onModified' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">535</td>
	<td class="source"><code>          let onModified: Func&#60;EventContext, void&#62;;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 536, Column 15: "'onAccepted' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">536</td>
	<td class="source"><code>          let onAccepted: Func&#60;EventContext, void&#62;;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">537</td>
	<td class="source"><code>          const removeListeners = (): void =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">538</td>
	<td class="source"><code>            clearTimeout(waitTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">539</td>
	<td class="source"><code>            // When `removeListeners` is called on timeout, the sender might be closed and cleared</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">540</td>
	<td class="source"><code>            // So, check if it exists, before removing listeners from it.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">541</td>
	<td class="source"><code>            if (this._sender) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">542</td>
	<td class="source"><code>              this._sender.removeListener(SenderEvents.rejected, onRejected);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">543</td>
	<td class="source"><code>              this._sender.removeListener(SenderEvents.accepted, onAccepted);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">544</td>
	<td class="source"><code>              this._sender.removeListener(SenderEvents.released, onReleased);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">545</td>
	<td class="source"><code>              this._sender.removeListener(SenderEvents.modified, onModified);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">546</td>
	<td class="source"><code>            }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">547</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">548</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 549, Column 25: "'context' is defined but never used."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/no-unused-vars" target="_blank">@typescript-eslint/no-unused-vars</a>
	</td>
</tr><tr class="hit bg-warning">
	<td class="line">549</td>
	<td class="source"><code>          onAccepted = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">550</td>
	<td class="source"><code>            // Since we will be adding listener for accepted and rejected event every time</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">551</td>
	<td class="source"><code>            // we send a message, we need to remove listener for both the events.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">552</td>
	<td class="source"><code>            // This will ensure duplicate listeners are not added for the same event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">553</td>
	<td class="source"><code>            removeListeners();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">554</td>
	<td class="source"><code>            log.sender(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">555</td>
	<td class="source"><code>              "[%s] Sender '%s', got event accepted.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">556</td>
	<td class="source"><code>              this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">557</td>
	<td class="source"><code>              this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">558</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">559</td>
	<td class="source"><code>            resolve();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">560</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">561</td>
	<td class="source"><code>          onRejected = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">562</td>
	<td class="source"><code>            removeListeners();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">563</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">564</td>
	<td class="source"><code>              "[%s] Sender '%s', got event rejected.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">565</td>
	<td class="source"><code>              this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">566</td>
	<td class="source"><code>              this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">567</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">568</td>
	<td class="source"><code>            const err = translate(context!.delivery!.remote_state!.error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">569</td>
	<td class="source"><code>            reject(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">570</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">571</td>
	<td class="source"><code>          onReleased = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">572</td>
	<td class="source"><code>            removeListeners();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">573</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">574</td>
	<td class="source"><code>              "[%s] Sender '%s', got event released.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">575</td>
	<td class="source"><code>              this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">576</td>
	<td class="source"><code>              this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">577</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">578</td>
	<td class="source"><code>            let err: Error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">579</td>
	<td class="source"><code>            if (context!.delivery!.remote_state!.error) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">580</td>
	<td class="source"><code>              err = translate(context!.delivery!.remote_state!.error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">581</td>
	<td class="source"><code>            } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">582</td>
	<td class="source"><code>              err = new Error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">583</td>
	<td class="source"><code>                `[${this._context.namespace.connectionId}]Sender '${this.name}', ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">584</td>
	<td class="source"><code>                  `received a release disposition.Hence we are rejecting the promise.`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">585</td>
	<td class="source"><code>              );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">586</td>
	<td class="source"><code>            }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">587</td>
	<td class="source"><code>            reject(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">588</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">589</td>
	<td class="source"><code>          onModified = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">590</td>
	<td class="source"><code>            removeListeners();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">591</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">592</td>
	<td class="source"><code>              "[%s] Sender '%s', got event modified.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">593</td>
	<td class="source"><code>              this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">594</td>
	<td class="source"><code>              this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">595</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">596</td>
	<td class="source"><code>            let err: Error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">597</td>
	<td class="source"><code>            if (context!.delivery!.remote_state!.error) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">598</td>
	<td class="source"><code>              err = translate(context!.delivery!.remote_state!.error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">599</td>
	<td class="source"><code>            } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">600</td>
	<td class="source"><code>              err = new Error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">601</td>
	<td class="source"><code>                `[${this._context.namespace.connectionId}]Sender "${this.name}", ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">602</td>
	<td class="source"><code>                  `received a modified disposition.Hence we are rejecting the promise.`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">603</td>
	<td class="source"><code>              );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">604</td>
	<td class="source"><code>            }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">605</td>
	<td class="source"><code>            reject(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">606</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">607</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-warning">Warning<strong></td>
	<td>
		Row 608, Column 38: "Missing return type on function."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/explicit-function-return-type" target="_blank">@typescript-eslint/explicit-function-return-type</a>
	</td>
</tr><tr class="hit bg-warning">
	<td class="line">608</td>
	<td class="source"><code>          const actionAfterTimeout = () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">609</td>
	<td class="source"><code>            removeListeners();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">610</td>
	<td class="source"><code>            const desc: string =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">611</td>
	<td class="source"><code>              `[${this._context.namespace.connectionId}] Sender "${this.name}" ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">612</td>
	<td class="source"><code>              `with address "${this.address}", was not able to send the message right now, due ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">613</td>
	<td class="source"><code>              `to operation timeout.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">614</td>
	<td class="source"><code>            log.error(desc);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">615</td>
	<td class="source"><code>            const e: AmqpError = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">616</td>
	<td class="source"><code>              condition: ErrorNameConditionMapper.ServiceUnavailableError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">617</td>
	<td class="source"><code>              description: desc</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">618</td>
	<td class="source"><code>            };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">619</td>
	<td class="source"><code>            return reject(translate(e));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">620</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">621</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">622</td>
	<td class="source"><code>          this._sender!.on(SenderEvents.accepted, onAccepted);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">623</td>
	<td class="source"><code>          this._sender!.on(SenderEvents.rejected, onRejected);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">624</td>
	<td class="source"><code>          this._sender!.on(SenderEvents.modified, onModified);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">625</td>
	<td class="source"><code>          this._sender!.on(SenderEvents.released, onReleased);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">626</td>
	<td class="source"><code>          waitTimer = setTimeout(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">627</td>
	<td class="source"><code>            actionAfterTimeout,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">628</td>
	<td class="source"><code>            Constants.defaultOperationTimeoutInSeconds * 1000</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">629</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">630</td>
	<td class="source"><code>          try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">631</td>
	<td class="source"><code>            const delivery = this._sender!.send(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">632</td>
	<td class="source"><code>              encodedMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">633</td>
	<td class="source"><code>              undefined,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">634</td>
	<td class="source"><code>              sendBatch ? 0x80013700 : 0</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">635</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">636</td>
	<td class="source"><code>            log.sender(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">637</td>
	<td class="source"><code>              "[%s] Sender '%s', sent message with delivery id: %d",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">638</td>
	<td class="source"><code>              this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">639</td>
	<td class="source"><code>              this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">640</td>
	<td class="source"><code>              delivery.id</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">641</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">642</td>
	<td class="source"><code>          } catch (error) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">643</td>
	<td class="source"><code>            removeListeners();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">644</td>
	<td class="source"><code>            return reject(error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">645</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">646</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">647</td>
	<td class="source"><code>          // let us retry to send the message after some time.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">648</td>
	<td class="source"><code>          const msg =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">649</td>
	<td class="source"><code>            `[${this._context.namespace.connectionId}] Sender "${this.name}", ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">650</td>
	<td class="source"><code>            `cannot send the message right now. Please try later.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">651</td>
	<td class="source"><code>          log.error(msg);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">652</td>
	<td class="source"><code>          const amqpError: AmqpError = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">653</td>
	<td class="source"><code>            condition: ErrorNameConditionMapper.SenderBusyError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">654</td>
	<td class="source"><code>            description: msg</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">655</td>
	<td class="source"><code>          };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">656</td>
	<td class="source"><code>          reject(translate(amqpError));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">657</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">658</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">659</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">660</td>
	<td class="source"><code>    const jitterInSeconds = randomNumberFromInterval(1, 4);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">661</td>
	<td class="source"><code>    const config: RetryConfig&#60;void&#62; = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">662</td>
	<td class="source"><code>      operation: sendEventPromise,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">663</td>
	<td class="source"><code>      connectionId: this._context.namespace.connectionId!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">664</td>
	<td class="source"><code>      operationType: RetryOperationType.sendMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">665</td>
	<td class="source"><code>      times: Constants.defaultRetryAttempts,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">666</td>
	<td class="source"><code>      delayInSeconds: Constants.defaultDelayBetweenOperationRetriesInSeconds + jitterInSeconds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">667</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">668</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">669</td>
	<td class="source"><code>    return retry&#60;void&#62;(config);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">670</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">671</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">672</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">673</td>
	<td class="source"><code>   * Initializes the sender session on the connection.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">674</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 675, Column 3: "Member _init should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">675</td>
	<td class="source"><code>  private async _init(options?: SenderOptions): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">676</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">677</td>
	<td class="source"><code>      // isOpen isConnecting  Should establish</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">678</td>
	<td class="source"><code>      // true     false          No</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">679</td>
	<td class="source"><code>      // true     true           No</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">680</td>
	<td class="source"><code>      // false    true           No</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">681</td>
	<td class="source"><code>      // false    false          Yes</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">682</td>
	<td class="source"><code>      if (!this.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">683</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">684</td>
	<td class="source"><code>          "[%s] The sender '%s' with address '%s' is not open and is not currently " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">685</td>
	<td class="source"><code>            "establishing itself. Hence let's try to connect.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">686</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">687</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">688</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">689</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">690</td>
	<td class="source"><code>        this.isConnecting = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">691</td>
	<td class="source"><code>        await this._negotiateClaim();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">692</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">693</td>
	<td class="source"><code>          "[%s] Trying to create sender '%s'...",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">694</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">695</td>
	<td class="source"><code>          this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">696</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">697</td>
	<td class="source"><code>        if (!options) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">698</td>
	<td class="source"><code>          options = this._createSenderOptions({});</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">699</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">700</td>
	<td class="source"><code>        this._sender = await this._context.namespace.connection.createSender(options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">701</td>
	<td class="source"><code>        this.isConnecting = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">702</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">703</td>
	<td class="source"><code>          "[%s] Sender '%s' with address '%s' has established itself.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">704</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">705</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">706</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">707</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">708</td>
	<td class="source"><code>        this._sender.setMaxListeners(1000);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">709</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">710</td>
	<td class="source"><code>          "[%s] Promise to create the sender resolved. Created sender with name: %s",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">711</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">712</td>
	<td class="source"><code>          this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">713</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">714</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">715</td>
	<td class="source"><code>          "[%s] Sender '%s' created with sender options: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">716</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">717</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">718</td>
	<td class="source"><code>          options</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">719</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">720</td>
	<td class="source"><code>        // It is possible for someone to close the sender and then start it again.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">721</td>
	<td class="source"><code>        // Thus make sure that the sender is present in the client cache.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">722</td>
	<td class="source"><code>        if (!this._sender) this._context.sender = this;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">723</td>
	<td class="source"><code>        await this._ensureTokenRenewal();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">724</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">725</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 726, Column 7: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">726</td>
	<td class="source"><code>      err = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">727</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">728</td>
	<td class="source"><code>        "[%s] An error occurred while creating the sender %s",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">729</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">730</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">731</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">732</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">733</td>
	<td class="source"><code>      throw err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">734</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">735</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">736</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">737</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">738</td>
	<td class="source"><code>   * Creates a new sender to the specifiec ServiceBus entity, and optionally to a given</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">739</td>
	<td class="source"><code>   * partition if it is not present in the context or returns the one present in the context.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">740</td>
	<td class="source"><code>   * @static</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">741</td>
	<td class="source"><code>   * @returns {Promise&#60;MessageSender&#62;}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">742</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">743</td>
	<td class="source"><code>  static create(context: ClientEntityContext): MessageSender {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">744</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">745</td>
	<td class="source"><code>    if (!context.sender) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">746</td>
	<td class="source"><code>      context.sender = new MessageSender(context);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">747</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">748</td>
	<td class="source"><code>    return context.sender;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">749</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">750</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">751</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcCoreStreamingReceiverTs" class="lint-result bg-error" data-group="f-8" data-problem-count="1" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\core\streamingReceiver.ts
    </th>
    <th class="result-summary">
      1 problem (1 error, 0 warnings)
    </th>
</tr>
<tr class="f-8 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-8"
								data-content="detailSummary-8"
								aria-controls="detailSummary-8"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-8"
								data-content="sourceCode-8"
								aria-controls="sourceCode-8"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-8">
				<div class="row"></div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 111, Column 30: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-8">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>  MessageReceiver,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>  ReceiveOptions,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>  OnMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>  OnError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>  ReceiverType</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>} from "./messageReceiver";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>import { ClientEntityContext } from "../clientEntityContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>import * as log from "../log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>import { throwErrorIfConnectionClosed } from "../util/errors";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code> * Describes the options passed to `registerMessageHandler` method when receiving messages from a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code> * Queue/Subscription which does not have sessions enabled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code>export interface MessageHandlerOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code>   * @property Indicates whether the `complete()` method on the message should automatically be</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code>   * called by the sdk after the user provided onMessage handler has been executed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code>   * Calling `complete()` on a message removes it from the Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code>   * - **Default**: `true`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code>  autoComplete?: boolean;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code>   * @property The maximum duration in seconds until which the lock on the message will be renewed</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code>   * by the sdk automatically. This auto renewal stops once the message is settled or once the user</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>   * provided onMessage handler completes ite execution.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>   * - **Default**: `300` seconds (5 minutes).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code>   * - **To disable autolock renewal**, set this to `0`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code>  maxMessageAutoRenewLockDurationInSeconds?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code>   * @property The maximum number of concurrent calls that the sdk can make to the user's message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code>   * handler. Once this limit has been reached, further messages will not be received until atleast</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code>   * one of the calls to the user's message handler has completed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code>   * - **Default**: `1`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code>  maxConcurrentCalls?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code> * Describes the streaming receiver where the user can receive the message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code> * by providing handler functions.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code> * @class StreamingReceiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code> * @extends MessageReceiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code>export class StreamingReceiver extends MessageReceiver {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>   * Instantiate a new Streaming receiver for receiving messages with handlers.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code>   * @constructor</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code>   * @param {ClientEntityContext} context                      The client entity context.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code>   * @param {ReceiveOptions} [options]                         Options for how you'd like to connect.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code>  constructor(context: ClientEntityContext, options?: ReceiveOptions) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code>    super(context, ReceiverType.streaming, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>    this.resetTimerOnNewMessageReceived = () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code>      if (this._newMessageReceivedTimer) clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>      if (this.newMessageWaitTimeoutInSeconds) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>        this._newMessageReceivedTimer = setTimeout(async () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">69</td>
	<td class="source"><code>          const msg =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code>            `StreamingReceiver '${this.name}' did not receive any messages in ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code>            `the last ${this.newMessageWaitTimeoutInSeconds} seconds. ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code>            `Hence ending this receive operation.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code>          log.error("[%s] %s", this._context.namespace.connectionId, msg);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code>          await this.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code>        }, this.newMessageWaitTimeoutInSeconds * 1000);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">81</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>   * Starts the receiver by establishing an AMQP session and an AMQP receiver link on the session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">84</td>
	<td class="source"><code>   * @param {OnMessage} onMessage The message handler to receive servicebus messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">85</td>
	<td class="source"><code>   * @param {OnError} onError The error handler to receive an error that occurs while receivin messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">86</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code>  receive(onMessage: OnMessage, onError: OnError): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code>    this._onMessage = onMessage;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">90</td>
	<td class="source"><code>    this._onError = onError;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>    if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>      this._receiver.addCredit(this.maxConcurrentCalls);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code>   * Creates a streaming receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>   * @static</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code>   * @param {ClientEntityContext} context    The connection context.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>   * @param {ReceiveOptions} [options]     Receive options.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code>   * @return {Promise&#60;StreamingReceiver&#62;} A promise that resolves with an instance of StreamingReceiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>  static async create(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>    context: ClientEntityContext,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code>    options?: ReceiveOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code>  ): Promise&#60;StreamingReceiver&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">110</td>
	<td class="source"><code>    if (!options) options = {};</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 111, Column 30: "Expected '===' and instead saw '=='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">111</td>
	<td class="source"><code>    if (options.autoComplete == undefined) options.autoComplete = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code>    const sReceiver = new StreamingReceiver(context, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code>    context.streamingReceiver = sReceiver;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code>    await sReceiver._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>    return sReceiver;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcIndexTs" class="lint-result bg-success" data-group="f-9" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\index.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcLogTs" class="lint-result bg-success" data-group="f-10" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\log.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcQueueClientTs" class="lint-result bg-success" data-group="f-11" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\queueClient.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcReceiverTs" class="lint-result bg-error" data-group="f-12" data-problem-count="7" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\receiver.ts
    </th>
    <th class="result-summary">
      7 problems (7 errors, 0 warnings)
    </th>
</tr>
<tr class="f-12 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-12"
								data-content="detailSummary-12"
								aria-controls="detailSummary-12"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-12"
								data-content="sourceCode-12"
								aria-controls="sourceCode-12"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-12">
				<div class="row"></div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 110, Column 9: "Each then() should return a value or throw"
		<a href="http://eslint.org/docs/rules/promise/always-return" target="_blank">promise/always-return</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 330, Column 3: "Member _throwIfAlreadyReceiving should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 339, Column 3: "Member _throwIfReceiverOrConnectionClosed should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 671, Column 9: "Each then() should return a value or throw"
		<a href="http://eslint.org/docs/rules/promise/always-return" target="_blank">promise/always-return</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 730, Column 3: "Member _throwIfReceiverOrConnectionClosed should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 745, Column 3: "Member _createMessageSessionIfDoesntExist should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 767, Column 3: "Member _throwIfAlreadyReceiving should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-12">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code>import Long from "long";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import * as log from "./log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>import { StreamingReceiver, MessageHandlerOptions } from "./core/streamingReceiver";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>import { BatchingReceiver } from "./core/batchingReceiver";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>import { ReceiveOptions, OnError, OnMessage } from "./core/messageReceiver";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>import { ClientEntityContext } from "./clientEntityContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>import { ServiceBusMessage, ReceiveMode, ReceivedMessageInfo } from "./serviceBusMessage";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code>  MessageSession,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>  SessionMessageHandlerOptions,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code>  SessionReceiverOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>} from "./session/messageSession";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code>  getAlreadyReceivingErrorMsg,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code>  getOpenReceiverErrorMsg,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code>  getReceiverClosedErrorMsg,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code>  throwErrorIfConnectionClosed,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code>  throwTypeErrorIfParameterMissing,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code>  throwTypeErrorIfParameterNotLong,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code>  throwTypeErrorIfParameterNotLongArray,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code>  getErrorMessageNotSupportedInReceiveAndDeleteMode</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code>} from "./util/errors";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code> * The Receiver class can be used to receive messages in a batch or by registering handlers.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code> * Use the `createReceiver` function on the QueueClient or SubscriptionClient to instantiate a Receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code> * The Receiver class is an abstraction over the underlying AMQP receiver link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code> * @class Receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>export class Receiver {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>   * @property Describes the amqp connection context for the QueueClient.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code>  private _context: ClientEntityContext;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code>  private _receiveMode: ReceiveMode;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code>   * @property {boolean} [_isClosed] Denotes if close() was called on this receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code>  private _isClosed: boolean = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code>   * @property Denotes receiveMode of this receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code>  public get receiveMode(): ReceiveMode {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code>    return this._receiveMode;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code>   * @property Returns `true` if the receiver is closed. This can happen either because the receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code>   * itself has been closed or the client that created it has been closed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>  public get isClosed(): boolean {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code>    return this._isClosed || this._context.isClosed;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code>   * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code>  constructor(context: ClientEntityContext, receiveMode: ReceiveMode) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>    this._context = context;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>    this._receiveMode =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>      receiveMode === ReceiveMode.receiveAndDelete ? receiveMode : ReceiveMode.peekLock;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">69</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code>   * Registers handlers to deal with the incoming stream of messages over an AMQP receiver link</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code>   * from a Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code>   * To stop receiving messages, call `close()` on the Receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code>   * @param onMessage - Handler for processing each incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code>   * @param onError - Handler for any error that occurs while receiving or processing messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code>   * @param options - Options to control if messages should be automatically completed, and/or have</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code>   * their locks automatically renewed. You can control the maximum number of messages that should</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code>   * be concurrently processed. You can also provide a timeout in seconds to denote the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">81</td>
	<td class="source"><code>   * amount of time to wait for a new message before closing the receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>   * @returns void</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">84</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">85</td>
	<td class="source"><code>  registerMessageHandler(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">86</td>
	<td class="source"><code>    onMessage: OnMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code>    onError: OnError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code>    options?: MessageHandlerOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code>  ): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">90</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code>    this._throwIfAlreadyReceiving();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>    const connId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(connId, "onMessage", onMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(connId, "onError", onError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>    if (typeof onMessage !== "function") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code>      throw new TypeError("The parameter 'onMessage' must be of type 'function'.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code>    if (typeof onError !== "function") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>      throw new TypeError("The parameter 'onError' must be of type 'function'.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>    StreamingReceiver.create(this._context, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code>      ...options,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code>      receiveMode: this._receiveMode</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>    })</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>      .then(async (sReceiver) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code>        if (!sReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code>          return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 110, Column 9: "Each then() should return a value or throw"
		<a href="http://eslint.org/docs/rules/promise/always-return" target="_blank">promise/always-return</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">110</td>
	<td class="source"><code>        if (!this.isClosed) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">111</td>
	<td class="source"><code>          return sReceiver.receive(onMessage, onError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code>          await sReceiver.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>      })</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code>      .catch((err) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code>        onError(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">119</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">120</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">121</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">122</td>
	<td class="source"><code>   * Returns a promise that resolves to an array of messages based on given count and timeout over</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">123</td>
	<td class="source"><code>   * an AMQP receiver link from a Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">124</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">125</td>
	<td class="source"><code>   * @param maxMessageCount      The maximum number of messages to receive from Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">126</td>
	<td class="source"><code>   * @param idleTimeoutInSeconds The maximum wait time in seconds for which the Receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">127</td>
	<td class="source"><code>   * should wait to receive the first message. If no message is received by this time,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">128</td>
	<td class="source"><code>   * the returned promise gets resolved to an empty array.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">129</td>
	<td class="source"><code>   * - **Default**: `60` seconds.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">130</td>
	<td class="source"><code>   * @returns Promise&#60;ServiceBusMessage[]&#62; A promise that resolves with an array of Message objects.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">131</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">132</td>
	<td class="source"><code>  async receiveMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">133</td>
	<td class="source"><code>    maxMessageCount: number,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">134</td>
	<td class="source"><code>    idleTimeoutInSeconds?: number</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">135</td>
	<td class="source"><code>  ): Promise&#60;ServiceBusMessage[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">136</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">137</td>
	<td class="source"><code>    this._throwIfAlreadyReceiving();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">138</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">139</td>
	<td class="source"><code>    if (!this._context.batchingReceiver || !this._context.batchingReceiver.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">140</td>
	<td class="source"><code>      const options: ReceiveOptions = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">141</td>
	<td class="source"><code>        maxConcurrentCalls: 0,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">142</td>
	<td class="source"><code>        receiveMode: this._receiveMode</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">143</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">144</td>
	<td class="source"><code>      this._context.batchingReceiver = BatchingReceiver.create(this._context, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">145</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">146</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">147</td>
	<td class="source"><code>    return this._context.batchingReceiver.receive(maxMessageCount, idleTimeoutInSeconds);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">148</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">149</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">150</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">151</td>
	<td class="source"><code>   * Gets an async iterator over messages from the receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">152</td>
	<td class="source"><code>   * While iterating, you will get `undefined` instead of a message, if the iterator is not able to</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">153</td>
	<td class="source"><code>   * fetch a new message in over a minute.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">154</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">155</td>
	<td class="source"><code>  async *getMessageIterator(): AsyncIterableIterator&#60;ServiceBusMessage&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">156</td>
	<td class="source"><code>    while (true) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">157</td>
	<td class="source"><code>      const currentBatch = await this.receiveMessages(1);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">158</td>
	<td class="source"><code>      yield currentBatch[0];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">159</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">160</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">161</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">162</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">163</td>
	<td class="source"><code>   * Renews the lock on the message for the duration as specified during the Queue/Subscription</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">164</td>
	<td class="source"><code>   * creation.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">165</td>
	<td class="source"><code>   * - Check the `lockedUntilUtc` property on the message for the time when the lock expires.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">166</td>
	<td class="source"><code>   * - If a message is not settled (using either `complete()`, `defer()` or `deadletter()`,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">167</td>
	<td class="source"><code>   * before its lock expires, then the message lands back in the Queue/Subscription for the next</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">168</td>
	<td class="source"><code>   * receive operation.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">169</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">170</td>
	<td class="source"><code>   * @param lockTokenOrMessage - The `lockToken` property of the message or the message itself.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">171</td>
	<td class="source"><code>   * @returns Promise&#60;Date&#62; - New lock token expiry date and time in UTC format.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">172</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">173</td>
	<td class="source"><code>  async renewMessageLock(lockTokenOrMessage: string | ServiceBusMessage): Promise&#60;Date&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">174</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">175</td>
	<td class="source"><code>    if (this._receiveMode !== ReceiveMode.peekLock) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">176</td>
	<td class="source"><code>      throw new Error(getErrorMessageNotSupportedInReceiveAndDeleteMode("renew the message lock"));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">177</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">178</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">179</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">180</td>
	<td class="source"><code>      "lockTokenOrMessage",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">181</td>
	<td class="source"><code>      lockTokenOrMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">182</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">183</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">184</td>
	<td class="source"><code>    const lockToken =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">185</td>
	<td class="source"><code>      lockTokenOrMessage instanceof ServiceBusMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">186</td>
	<td class="source"><code>        ? String(lockTokenOrMessage.lockToken)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">187</td>
	<td class="source"><code>        : String(lockTokenOrMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">188</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">189</td>
	<td class="source"><code>    let receiverName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">190</td>
	<td class="source"><code>    if (this._context.batchingReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">191</td>
	<td class="source"><code>      receiverName = this._context.batchingReceiver.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">192</td>
	<td class="source"><code>    } else if (this._context.streamingReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">193</td>
	<td class="source"><code>      receiverName = this._context.streamingReceiver.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">194</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">195</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">196</td>
	<td class="source"><code>    const lockedUntilUtc = await this._context.managementClient!.renewLock(lockToken, receiverName);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">197</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">198</td>
	<td class="source"><code>    return lockedUntilUtc;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">199</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">200</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">201</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">202</td>
	<td class="source"><code>   * Returns a promise that resolves to a deferred message identified by the given `sequenceNumber`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">203</td>
	<td class="source"><code>   * @param sequenceNumber The sequence number of the message that needs to be received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">204</td>
	<td class="source"><code>   * @returns Promise&#60;ServiceBusMessage | undefined&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">205</td>
	<td class="source"><code>   * - Returns `Message` identified by sequence number.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">206</td>
	<td class="source"><code>   * - Returns `undefined` if no such message is found.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">207</td>
	<td class="source"><code>   * - Throws an error if the message has not been deferred.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">208</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">209</td>
	<td class="source"><code>  async receiveDeferredMessage(sequenceNumber: Long): Promise&#60;ServiceBusMessage | undefined&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">210</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">211</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">212</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">213</td>
	<td class="source"><code>      "sequenceNumber",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">214</td>
	<td class="source"><code>      sequenceNumber</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">215</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">216</td>
	<td class="source"><code>    throwTypeErrorIfParameterNotLong(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">217</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">218</td>
	<td class="source"><code>      "sequenceNumber",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">219</td>
	<td class="source"><code>      sequenceNumber</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">220</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">221</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">222</td>
	<td class="source"><code>    let receiverName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">223</td>
	<td class="source"><code>    if (this._context.batchingReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">224</td>
	<td class="source"><code>      receiverName = this._context.batchingReceiver.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">225</td>
	<td class="source"><code>    } else if (this._context.streamingReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">226</td>
	<td class="source"><code>      receiverName = this._context.streamingReceiver.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">227</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">228</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">229</td>
	<td class="source"><code>    const messages = await this._context.managementClient!.receiveDeferredMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">230</td>
	<td class="source"><code>      [sequenceNumber],</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">231</td>
	<td class="source"><code>      this._receiveMode,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">232</td>
	<td class="source"><code>      receiverName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">233</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">234</td>
	<td class="source"><code>    return messages[0];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">235</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">236</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">237</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">238</td>
	<td class="source"><code>   * Returns a promise that resolves to an array of deferred messages identified by given `sequenceNumbers`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">239</td>
	<td class="source"><code>   * @param sequenceNumbers An array of sequence numbers for the messages that need to be received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">240</td>
	<td class="source"><code>   * @returns Promise&#60;ServiceBusMessage[]&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">241</td>
	<td class="source"><code>   * - Returns a list of messages identified by the given sequenceNumbers.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">242</td>
	<td class="source"><code>   * - Returns an empty list if no messages are found.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">243</td>
	<td class="source"><code>   * - Throws an error if the messages have not been deferred.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">244</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">245</td>
	<td class="source"><code>  async receiveDeferredMessages(sequenceNumbers: Long[]): Promise&#60;ServiceBusMessage[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">246</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">247</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">248</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">249</td>
	<td class="source"><code>      "sequenceNumbers",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">250</td>
	<td class="source"><code>      sequenceNumbers</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">251</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">252</td>
	<td class="source"><code>    if (!Array.isArray(sequenceNumbers)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">253</td>
	<td class="source"><code>      sequenceNumbers = [sequenceNumbers];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">254</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">255</td>
	<td class="source"><code>    throwTypeErrorIfParameterNotLongArray(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">256</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">257</td>
	<td class="source"><code>      "sequenceNumbers",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">258</td>
	<td class="source"><code>      sequenceNumbers</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">259</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">260</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">261</td>
	<td class="source"><code>    let receiverName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">262</td>
	<td class="source"><code>    if (this._context.batchingReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">263</td>
	<td class="source"><code>      receiverName = this._context.batchingReceiver.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">264</td>
	<td class="source"><code>    } else if (this._context.streamingReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">265</td>
	<td class="source"><code>      receiverName = this._context.streamingReceiver.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">266</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">267</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">268</td>
	<td class="source"><code>    return this._context.managementClient!.receiveDeferredMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">269</td>
	<td class="source"><code>      sequenceNumbers,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">270</td>
	<td class="source"><code>      this._receiveMode,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">271</td>
	<td class="source"><code>      receiverName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">272</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">273</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">274</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">275</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">276</td>
	<td class="source"><code>   * Closes the underlying AMQP receiver link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">277</td>
	<td class="source"><code>   * Once closed, the receiver cannot be used for any further operations.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">278</td>
	<td class="source"><code>   * Use the `createReceiver` function on the QueueClient or SubscriptionClient to instantiate</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">279</td>
	<td class="source"><code>   * a new Receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">280</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">281</td>
	<td class="source"><code>   * @returns {Promise&#60;void&#62;}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">282</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">283</td>
	<td class="source"><code>  async close(): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">284</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">285</td>
	<td class="source"><code>      if (this._context.namespace.connection && this._context.namespace.connection.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">286</td>
	<td class="source"><code>        // Close the streaming receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">287</td>
	<td class="source"><code>        if (this._context.streamingReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">288</td>
	<td class="source"><code>          await this._context.streamingReceiver.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">289</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">290</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">291</td>
	<td class="source"><code>        // Close the batching receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">292</td>
	<td class="source"><code>        if (this._context.batchingReceiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">293</td>
	<td class="source"><code>          await this._context.batchingReceiver.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">294</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">295</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">296</td>
	<td class="source"><code>        // Make sure that we clear the map of deferred messages</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">297</td>
	<td class="source"><code>        this._context.requestResponseLockedMessages.clear();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">298</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">299</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">300</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">301</td>
	<td class="source"><code>        "[%s] An error occurred while closing the Receiver for %s: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">302</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">303</td>
	<td class="source"><code>        this._context.entityPath,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">304</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">305</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">306</td>
	<td class="source"><code>      throw err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">307</td>
	<td class="source"><code>    } finally {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">308</td>
	<td class="source"><code>      this._isClosed = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">309</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">310</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">311</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">312</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">313</td>
	<td class="source"><code>   * Indicates whether the receiver is currently receiving messages or not.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">314</td>
	<td class="source"><code>   * When this returns true, new `registerMessageHandler()` or `receiveMessages()` calls cannot be made.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">315</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">316</td>
	<td class="source"><code>  isReceivingMessages(): boolean {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">317</td>
	<td class="source"><code>    if (this._context.streamingReceiver && this._context.streamingReceiver.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">318</td>
	<td class="source"><code>      return true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">319</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">320</td>
	<td class="source"><code>    if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">321</td>
	<td class="source"><code>      this._context.batchingReceiver &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">322</td>
	<td class="source"><code>      this._context.batchingReceiver.isOpen() &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">323</td>
	<td class="source"><code>      this._context.batchingReceiver.isReceivingMessages</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">324</td>
	<td class="source"><code>    ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">325</td>
	<td class="source"><code>      return true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">326</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">327</td>
	<td class="source"><code>    return false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">328</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">329</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 330, Column 3: "Member _throwIfAlreadyReceiving should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">330</td>
	<td class="source"><code>  private _throwIfAlreadyReceiving(): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">331</td>
	<td class="source"><code>    if (this.isReceivingMessages()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">332</td>
	<td class="source"><code>      const errorMessage = getAlreadyReceivingErrorMsg(this._context.entityPath);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">333</td>
	<td class="source"><code>      const error = new Error(errorMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">334</td>
	<td class="source"><code>      log.error(`[${this._context.namespace.connectionId}] %O`, error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">335</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">336</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">337</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">338</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 339, Column 3: "Member _throwIfReceiverOrConnectionClosed should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">339</td>
	<td class="source"><code>  private _throwIfReceiverOrConnectionClosed(): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">340</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">341</td>
	<td class="source"><code>    if (this.isClosed) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">342</td>
	<td class="source"><code>      const errorMessage = getReceiverClosedErrorMsg(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">343</td>
	<td class="source"><code>        this._context.entityPath,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">344</td>
	<td class="source"><code>        this._context.clientType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">345</td>
	<td class="source"><code>        this._context.isClosed</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">346</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">347</td>
	<td class="source"><code>      const error = new Error(errorMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">348</td>
	<td class="source"><code>      log.error(`[${this._context.namespace.connectionId}] %O`, error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">349</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">350</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">351</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">352</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">353</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">354</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">355</td>
	<td class="source"><code> * The SessionReceiver class can be used to receive messages from a session enabled Queue or</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">356</td>
	<td class="source"><code> * Subscription in a batch or by registering handlers.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">357</td>
	<td class="source"><code> * Use the `createReceiver` function on the QueueClient or SubscriptionClient to instantiate a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">358</td>
	<td class="source"><code> * SessionReceiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">359</td>
	<td class="source"><code> * The SessionReceiver class is an abstraction over the underlying AMQP receiver link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">360</td>
	<td class="source"><code> * @class SessionReceiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">361</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">362</td>
	<td class="source"><code>export class SessionReceiver {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">363</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">364</td>
	<td class="source"><code>   * @property {ClientEntityContext} _context Describes the amqp connection context for the QueueClient.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">365</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">366</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">367</td>
	<td class="source"><code>  private _context: ClientEntityContext;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">368</td>
	<td class="source"><code>  private _receiveMode: ReceiveMode;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">369</td>
	<td class="source"><code>  private _messageSession: MessageSession | undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">370</td>
	<td class="source"><code>  private _sessionOptions: SessionReceiverOptions;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">371</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">372</td>
	<td class="source"><code>   * @property {boolean} [_isClosed] Denotes if close() was called on this receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">373</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">374</td>
	<td class="source"><code>  private _isClosed: boolean = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">375</td>
	<td class="source"><code>  private _sessionId: string | undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">376</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">377</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">378</td>
	<td class="source"><code>   * @property Denotes receiveMode of this receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">379</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">380</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">381</td>
	<td class="source"><code>  public get receiveMode(): ReceiveMode {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">382</td>
	<td class="source"><code>    return this._receiveMode;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">383</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">384</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">385</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">386</td>
	<td class="source"><code>   * @property Returns `true` if the receiver is closed. This can happen either because the receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">387</td>
	<td class="source"><code>   * itself has been closed or the client that created it has been closed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">388</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">389</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">390</td>
	<td class="source"><code>  public get isClosed(): boolean {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">391</td>
	<td class="source"><code>    return (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">392</td>
	<td class="source"><code>      this._isClosed || (this.sessionId ? !this._context.messageSessions[this.sessionId] : false)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">393</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">394</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">395</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">396</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">397</td>
	<td class="source"><code>   * @property The id of the session from which this receiver will receive messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">398</td>
	<td class="source"><code>   * Will return undefined until a AMQP receiver link has been successfully set up for the session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">399</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">400</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">401</td>
	<td class="source"><code>  public get sessionId(): string | undefined {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">402</td>
	<td class="source"><code>    return this._sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">403</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">404</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">405</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">406</td>
	<td class="source"><code>   * @property The time in UTC until which the session is locked.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">407</td>
	<td class="source"><code>   * Everytime `renewSessionLock()` is called, this time gets updated to current time plus the lock</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">408</td>
	<td class="source"><code>   * duration as specified during the Queue/Subscription creation.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">409</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">410</td>
	<td class="source"><code>   * Will return undefined until a AMQP receiver link has been successfully set up for the session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">411</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">412</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">413</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">414</td>
	<td class="source"><code>  public get sessionLockedUntilUtc(): Date | undefined {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">415</td>
	<td class="source"><code>    return this._messageSession ? this._messageSession.sessionLockedUntilUtc : undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">416</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">417</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">418</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">419</td>
	<td class="source"><code>   * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">420</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">421</td>
	<td class="source"><code>  constructor(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">422</td>
	<td class="source"><code>    context: ClientEntityContext,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">423</td>
	<td class="source"><code>    receiveMode: ReceiveMode,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">424</td>
	<td class="source"><code>    sessionOptions: SessionReceiverOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">425</td>
	<td class="source"><code>  ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">426</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">427</td>
	<td class="source"><code>    this._context = context;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">428</td>
	<td class="source"><code>    this._receiveMode =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">429</td>
	<td class="source"><code>      receiveMode === ReceiveMode.receiveAndDelete ? receiveMode : ReceiveMode.peekLock;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">430</td>
	<td class="source"><code>    this._sessionOptions = sessionOptions;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">431</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">432</td>
	<td class="source"><code>    if (sessionOptions.sessionId) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">433</td>
	<td class="source"><code>      sessionOptions.sessionId = String(sessionOptions.sessionId);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">434</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">435</td>
	<td class="source"><code>      // Check if receiver for given session already exists</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">436</td>
	<td class="source"><code>      if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">437</td>
	<td class="source"><code>        this._context.messageSessions[sessionOptions.sessionId] &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">438</td>
	<td class="source"><code>        this._context.messageSessions[sessionOptions.sessionId].isOpen()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">439</td>
	<td class="source"><code>      ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">440</td>
	<td class="source"><code>        const errorMessage = getOpenReceiverErrorMsg(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">441</td>
	<td class="source"><code>          this._context.clientType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">442</td>
	<td class="source"><code>          this._context.entityPath,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">443</td>
	<td class="source"><code>          sessionOptions.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">444</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">445</td>
	<td class="source"><code>        const error = new Error(errorMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">446</td>
	<td class="source"><code>        log.error(`[${this._context.namespace.connectionId}] %O`, error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">447</td>
	<td class="source"><code>        throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">448</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">449</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">450</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">451</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">452</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">453</td>
	<td class="source"><code>   * Renews the lock on the session for the duration as specified during the Queue/Subscription</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">454</td>
	<td class="source"><code>   * creation.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">455</td>
	<td class="source"><code>   * - Check the `sessionLockedUntilUtc` property on the SessionReceiver for the time when the lock expires.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">456</td>
	<td class="source"><code>   * - When the lock on the session expires</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">457</td>
	<td class="source"><code>   *     - No more messages can be received using this receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">458</td>
	<td class="source"><code>   *     - If a message is not settled (using either `complete()`, `defer()` or `deadletter()`,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">459</td>
	<td class="source"><code>   *   before the session lock expires, then the message lands back in the Queue/Subscription for the next</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">460</td>
	<td class="source"><code>   *   receive operation.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">461</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">462</td>
	<td class="source"><code>   * @returns Promise&#60;Date&#62; - New lock token expiry date and time in UTC format.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">463</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">464</td>
	<td class="source"><code>  async renewSessionLock(): Promise&#60;Date&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">465</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">466</td>
	<td class="source"><code>    await this._createMessageSessionIfDoesntExist();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">467</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">468</td>
	<td class="source"><code>    this._messageSession!.sessionLockedUntilUtc = await this._context.managementClient!.renewSessionLock(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">469</td>
	<td class="source"><code>      this.sessionId!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">470</td>
	<td class="source"><code>      this._messageSession!.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">471</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">472</td>
	<td class="source"><code>    return this._messageSession!.sessionLockedUntilUtc!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">473</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">474</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">475</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">476</td>
	<td class="source"><code>   * Sets the state on the Session. For more on session states, see</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">477</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/en-us/azure/service-bus-messaging/message-sessions#message-session-state Session State}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">478</td>
	<td class="source"><code>   * @param state The state that needs to be set.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">479</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">480</td>
	<td class="source"><code>  async setState(state: any): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">481</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">482</td>
	<td class="source"><code>    await this._createMessageSessionIfDoesntExist();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">483</td>
	<td class="source"><code>    return this._context.managementClient!.setSessionState(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">484</td>
	<td class="source"><code>      this.sessionId!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">485</td>
	<td class="source"><code>      state,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">486</td>
	<td class="source"><code>      this._messageSession!.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">487</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">488</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">489</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">490</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">491</td>
	<td class="source"><code>   * Gets the state of the Session. For more on session states, see</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">492</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/en-us/azure/service-bus-messaging/message-sessions#message-session-state Session State}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">493</td>
	<td class="source"><code>   * @returns Promise&#60;any&#62; The state of that session</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">494</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">495</td>
	<td class="source"><code>  async getState(): Promise&#60;any&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">496</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">497</td>
	<td class="source"><code>    await this._createMessageSessionIfDoesntExist();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">498</td>
	<td class="source"><code>    return this._context.managementClient!.getSessionState(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">499</td>
	<td class="source"><code>      this.sessionId!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">500</td>
	<td class="source"><code>      this._messageSession!.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">501</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">502</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">503</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">504</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">505</td>
	<td class="source"><code>   * Fetches the next batch of active messages (including deferred but not deadlettered messages) in</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">506</td>
	<td class="source"><code>   * the current session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">507</td>
	<td class="source"><code>   * - The first call to `peek()` fetches the first active message. Each subsequent call fetches the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">508</td>
	<td class="source"><code>   * subsequent message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">509</td>
	<td class="source"><code>   * - Unlike a `received` message, `peeked` message is a read-only version of the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">510</td>
	<td class="source"><code>   * It cannot be `Completed/Abandoned/Deferred/Deadlettered`. The lock on it cannot be renewed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">511</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">512</td>
	<td class="source"><code>   * @param maxMessageCount The maximum number of messages to peek. Default value `1`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">513</td>
	<td class="source"><code>   * @returns Promise&#60;ReceivedMessageInfo[]&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">514</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">515</td>
	<td class="source"><code>  async peek(maxMessageCount?: number): Promise&#60;ReceivedMessageInfo[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">516</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">517</td>
	<td class="source"><code>    await this._createMessageSessionIfDoesntExist();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">518</td>
	<td class="source"><code>    return this._context.managementClient!.peekMessagesBySession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">519</td>
	<td class="source"><code>      this.sessionId!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">520</td>
	<td class="source"><code>      this._messageSession!.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">521</td>
	<td class="source"><code>      maxMessageCount</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">522</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">523</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">524</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">525</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">526</td>
	<td class="source"><code>   * Peeks the desired number of active messages (including deferred but not deadlettered messages)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">527</td>
	<td class="source"><code>   * from the specified sequence number in the current session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">528</td>
	<td class="source"><code>   * - Unlike a `received` message, `peeked` message is a read-only version of the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">529</td>
	<td class="source"><code>   * It cannot be `Completed/Abandoned/Deferred/Deadlettered`. The lock on it cannot be renewed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">530</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">531</td>
	<td class="source"><code>   * @param fromSequenceNumber The sequence number from where to read the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">532</td>
	<td class="source"><code>   * @param [maxMessageCount] The maximum number of messages to peek. Default value `1`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">533</td>
	<td class="source"><code>   * @returns Promise&#60;ReceivedSBMessage[]&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">534</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">535</td>
	<td class="source"><code>  async peekBySequenceNumber(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">536</td>
	<td class="source"><code>    fromSequenceNumber: Long,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">537</td>
	<td class="source"><code>    maxMessageCount?: number</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">538</td>
	<td class="source"><code>  ): Promise&#60;ReceivedMessageInfo[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">539</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">540</td>
	<td class="source"><code>    await this._createMessageSessionIfDoesntExist();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">541</td>
	<td class="source"><code>    return this._context.managementClient!.peekBySequenceNumber(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">542</td>
	<td class="source"><code>      fromSequenceNumber,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">543</td>
	<td class="source"><code>      maxMessageCount,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">544</td>
	<td class="source"><code>      this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">545</td>
	<td class="source"><code>      this._messageSession!.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">546</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">547</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">548</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">549</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">550</td>
	<td class="source"><code>   * Returns a promise that resolves to a deferred message identified by the given `sequenceNumber`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">551</td>
	<td class="source"><code>   * @param sequenceNumber The sequence number of the message that needs to be received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">552</td>
	<td class="source"><code>   * @returns Promise&#60;ServiceBusMessage | undefined&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">553</td>
	<td class="source"><code>   * - Returns `Message` identified by sequence number.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">554</td>
	<td class="source"><code>   * - Returns `undefined` if no such message is found.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">555</td>
	<td class="source"><code>   * - Throws an error if the message has not been deferred.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">556</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">557</td>
	<td class="source"><code>  async receiveDeferredMessage(sequenceNumber: Long): Promise&#60;ServiceBusMessage | undefined&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">558</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">559</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">560</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">561</td>
	<td class="source"><code>      "sequenceNumber",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">562</td>
	<td class="source"><code>      sequenceNumber</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">563</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">564</td>
	<td class="source"><code>    throwTypeErrorIfParameterNotLong(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">565</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">566</td>
	<td class="source"><code>      "sequenceNumber",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">567</td>
	<td class="source"><code>      sequenceNumber</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">568</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">569</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">570</td>
	<td class="source"><code>    await this._createMessageSessionIfDoesntExist();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">571</td>
	<td class="source"><code>    const messages = await this._context.managementClient!.receiveDeferredMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">572</td>
	<td class="source"><code>      [sequenceNumber],</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">573</td>
	<td class="source"><code>      this._receiveMode,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">574</td>
	<td class="source"><code>      this._messageSession!.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">575</td>
	<td class="source"><code>      this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">576</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">577</td>
	<td class="source"><code>    return messages[0];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">578</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">579</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">580</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">581</td>
	<td class="source"><code>   * Returns a promise that resolves to an array of deferred messages identified by given `sequenceNumbers`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">582</td>
	<td class="source"><code>   * @param sequenceNumbers An array of sequence numbers for the messages that need to be received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">583</td>
	<td class="source"><code>   * @returns Promise&#60;ServiceBusMessage[]&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">584</td>
	<td class="source"><code>   * - Returns a list of messages identified by the given sequenceNumbers.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">585</td>
	<td class="source"><code>   * - Returns an empty list if no messages are found.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">586</td>
	<td class="source"><code>   * - Throws an error if the messages have not been deferred.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">587</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">588</td>
	<td class="source"><code>  async receiveDeferredMessages(sequenceNumbers: Long[]): Promise&#60;ServiceBusMessage[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">589</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">590</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">591</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">592</td>
	<td class="source"><code>      "sequenceNumbers",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">593</td>
	<td class="source"><code>      sequenceNumbers</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">594</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">595</td>
	<td class="source"><code>    if (!Array.isArray(sequenceNumbers)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">596</td>
	<td class="source"><code>      sequenceNumbers = [sequenceNumbers];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">597</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">598</td>
	<td class="source"><code>    throwTypeErrorIfParameterNotLongArray(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">599</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">600</td>
	<td class="source"><code>      "sequenceNumbers",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">601</td>
	<td class="source"><code>      sequenceNumbers</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">602</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">603</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">604</td>
	<td class="source"><code>    await this._createMessageSessionIfDoesntExist();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">605</td>
	<td class="source"><code>    return this._context.managementClient!.receiveDeferredMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">606</td>
	<td class="source"><code>      sequenceNumbers,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">607</td>
	<td class="source"><code>      this._receiveMode,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">608</td>
	<td class="source"><code>      this._messageSession!.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">609</td>
	<td class="source"><code>      this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">610</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">611</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">612</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">613</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">614</td>
	<td class="source"><code>   * Returns a promise that resolves to an array of messages based on given count and timeout over</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">615</td>
	<td class="source"><code>   * an AMQP receiver link from a Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">616</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">617</td>
	<td class="source"><code>   * @param maxMessageCount      The maximum number of messages to receive from Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">618</td>
	<td class="source"><code>   * @param maxWaitTimeInSeconds The maximum wait time in seconds for which the Receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">619</td>
	<td class="source"><code>   * should wait to receive the first message. If no message is received by this time,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">620</td>
	<td class="source"><code>   * the returned promise gets resolved to an empty array.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">621</td>
	<td class="source"><code>   * - **Default**: `60` seconds.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">622</td>
	<td class="source"><code>   * @returns Promise&#60;ServiceBusMessage[]&#62; A promise that resolves with an array of Message objects.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">623</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">624</td>
	<td class="source"><code>  async receiveMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">625</td>
	<td class="source"><code>    maxMessageCount: number,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">626</td>
	<td class="source"><code>    maxWaitTimeInSeconds?: number</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">627</td>
	<td class="source"><code>  ): Promise&#60;ServiceBusMessage[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">628</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">629</td>
	<td class="source"><code>    this._throwIfAlreadyReceiving();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">630</td>
	<td class="source"><code>    await this._createMessageSessionIfDoesntExist();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">631</td>
	<td class="source"><code>    return this._messageSession!.receiveMessages(maxMessageCount, maxWaitTimeInSeconds);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">632</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">633</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">634</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">635</td>
	<td class="source"><code>   * Registers handlers to deal with the incoming stream of messages over an AMQP receiver link</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">636</td>
	<td class="source"><code>   * from a Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">637</td>
	<td class="source"><code>   * To stop receiving messages, call `close()` on the SessionReceiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">638</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">639</td>
	<td class="source"><code>   * @param onMessage - Handler for processing each incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">640</td>
	<td class="source"><code>   * @param onError - Handler for any error that occurs while receiving or processing messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">641</td>
	<td class="source"><code>   * @param options - Options to control whether messages should be automatically completed</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">642</td>
	<td class="source"><code>   * or if the lock on the session should be automatically renewed. You can control the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">643</td>
	<td class="source"><code>   * maximum number of messages that should be concurrently processed. You can</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">644</td>
	<td class="source"><code>   * also provide a timeout in seconds to denote the amount of time to wait for a new message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">645</td>
	<td class="source"><code>   * before closing the receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">646</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">647</td>
	<td class="source"><code>   * @returns void</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">648</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">649</td>
	<td class="source"><code>  registerMessageHandler(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">650</td>
	<td class="source"><code>    onMessage: OnMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">651</td>
	<td class="source"><code>    onError: OnError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">652</td>
	<td class="source"><code>    options?: SessionMessageHandlerOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">653</td>
	<td class="source"><code>  ): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">654</td>
	<td class="source"><code>    this._throwIfReceiverOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">655</td>
	<td class="source"><code>    this._throwIfAlreadyReceiving();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">656</td>
	<td class="source"><code>    const connId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">657</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(connId, "onMessage", onMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">658</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(connId, "onError", onError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">659</td>
	<td class="source"><code>    if (typeof onMessage !== "function") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">660</td>
	<td class="source"><code>      throw new TypeError("The parameter 'onMessage' must be of type 'function'.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">661</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">662</td>
	<td class="source"><code>    if (typeof onError !== "function") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">663</td>
	<td class="source"><code>      throw new TypeError("The parameter 'onError' must be of type 'function'.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">664</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">665</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">666</td>
	<td class="source"><code>    this._createMessageSessionIfDoesntExist()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">667</td>
	<td class="source"><code>      .then(async () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">668</td>
	<td class="source"><code>        if (!this._messageSession) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">669</td>
	<td class="source"><code>          return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">670</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 671, Column 9: "Each then() should return a value or throw"
		<a href="http://eslint.org/docs/rules/promise/always-return" target="_blank">promise/always-return</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">671</td>
	<td class="source"><code>        if (!this._isClosed) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">672</td>
	<td class="source"><code>          this._messageSession.receive(onMessage, onError, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">673</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">674</td>
	<td class="source"><code>          await this._messageSession.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">675</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">676</td>
	<td class="source"><code>      })</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">677</td>
	<td class="source"><code>      .catch((err) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">678</td>
	<td class="source"><code>        onError(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">679</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">680</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">681</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">682</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">683</td>
	<td class="source"><code>   * Gets an async iterator over messages from the receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">684</td>
	<td class="source"><code>   * While iterating, you will get `undefined` instead of a message, if the iterator is not able to</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">685</td>
	<td class="source"><code>   * fetch a new message in over a minute.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">686</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">687</td>
	<td class="source"><code>  async *getMessageIterator(): AsyncIterableIterator&#60;ServiceBusMessage&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">688</td>
	<td class="source"><code>    while (true) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">689</td>
	<td class="source"><code>      const currentBatch = await this.receiveMessages(1);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">690</td>
	<td class="source"><code>      yield currentBatch[0];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">691</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">692</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">693</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">694</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">695</td>
	<td class="source"><code>   * Closes the underlying AMQP receiver link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">696</td>
	<td class="source"><code>   * Once closed, the receiver cannot be used for any further operations.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">697</td>
	<td class="source"><code>   * Use the `createReceiver` function on the QueueClient or SubscriptionClient to instantiate</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">698</td>
	<td class="source"><code>   * a new Receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">699</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">700</td>
	<td class="source"><code>   * @returns {Promise&#60;void&#62;}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">701</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">702</td>
	<td class="source"><code>  async close(): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">703</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">704</td>
	<td class="source"><code>      if (this._messageSession) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">705</td>
	<td class="source"><code>        await this._messageSession.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">706</td>
	<td class="source"><code>        this._messageSession = undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">707</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">708</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">709</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">710</td>
	<td class="source"><code>        "[%s] An error occurred while closing the SessionReceiver for session %s in %s: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">711</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">712</td>
	<td class="source"><code>        this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">713</td>
	<td class="source"><code>        this._context.entityPath,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">714</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">715</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">716</td>
	<td class="source"><code>      throw err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">717</td>
	<td class="source"><code>    } finally {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">718</td>
	<td class="source"><code>      this._isClosed = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">719</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">720</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">721</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">722</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">723</td>
	<td class="source"><code>   * Indicates whether the receiver is currently receiving messages or not.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">724</td>
	<td class="source"><code>   * When this returns true, new `registerMessageHandler()` or `receiveMessages()` calls cannot be made.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">725</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">726</td>
	<td class="source"><code>  isReceivingMessages(): boolean {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">727</td>
	<td class="source"><code>    return this._messageSession ? this._messageSession.isReceivingMessages : false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">728</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">729</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 730, Column 3: "Member _throwIfReceiverOrConnectionClosed should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">730</td>
	<td class="source"><code>  private _throwIfReceiverOrConnectionClosed(): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">731</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">732</td>
	<td class="source"><code>    if (this.isClosed) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">733</td>
	<td class="source"><code>      const errorMessage = getReceiverClosedErrorMsg(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">734</td>
	<td class="source"><code>        this._context.entityPath,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">735</td>
	<td class="source"><code>        this._context.clientType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">736</td>
	<td class="source"><code>        this._context.isClosed,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">737</td>
	<td class="source"><code>        this.sessionId!</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">738</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">739</td>
	<td class="source"><code>      const error = new Error(errorMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">740</td>
	<td class="source"><code>      log.error(`[${this._context.namespace.connectionId}] %O`, error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">741</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">742</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">743</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">744</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 745, Column 3: "Member _createMessageSessionIfDoesntExist should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">745</td>
	<td class="source"><code>  private async _createMessageSessionIfDoesntExist(): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">746</td>
	<td class="source"><code>    if (this._messageSession) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">747</td>
	<td class="source"><code>      return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">748</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">749</td>
	<td class="source"><code>    this._context.isSessionEnabled = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">750</td>
	<td class="source"><code>    this._messageSession = await MessageSession.create(this._context, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">751</td>
	<td class="source"><code>      sessionId: this._sessionOptions.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">752</td>
	<td class="source"><code>      maxSessionAutoRenewLockDurationInSeconds: this._sessionOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">753</td>
	<td class="source"><code>        .maxSessionAutoRenewLockDurationInSeconds,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">754</td>
	<td class="source"><code>      receiveMode: this._receiveMode</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">755</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">756</td>
	<td class="source"><code>    // By this point, we should have a valid sessionId on the messageSession</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">757</td>
	<td class="source"><code>    // If not, the receiver cannot be used, so throw error.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">758</td>
	<td class="source"><code>    if (!this._messageSession.sessionId) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">759</td>
	<td class="source"><code>      const error = new Error("Something went wrong. Cannot lock a session.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">760</td>
	<td class="source"><code>      log.error(`[${this._context.namespace.connectionId}] %O`, error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">761</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">762</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">763</td>
	<td class="source"><code>    this._sessionId = this._messageSession.sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">764</td>
	<td class="source"><code>    delete this._context.expiredMessageSessions[this._messageSession.sessionId];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">765</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">766</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 767, Column 3: "Member _throwIfAlreadyReceiving should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">767</td>
	<td class="source"><code>  private _throwIfAlreadyReceiving(): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">768</td>
	<td class="source"><code>    if (this.isReceivingMessages()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">769</td>
	<td class="source"><code>      const errorMessage = getAlreadyReceivingErrorMsg(this._context.entityPath, this.sessionId);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">770</td>
	<td class="source"><code>      const error = new Error(errorMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">771</td>
	<td class="source"><code>      log.error(`[${this._context.namespace.connectionId}] %O`, error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">772</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">773</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">774</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">775</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">776</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcSenderTs" class="lint-result bg-error" data-group="f-13" data-problem-count="1" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\sender.ts
    </th>
    <th class="result-summary">
      1 problem (1 error, 0 warnings)
    </th>
</tr>
<tr class="f-13 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-13"
								data-content="detailSummary-13"
								aria-controls="detailSummary-13"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-13"
								data-content="sourceCode-13"
								aria-controls="sourceCode-13"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-13">
				<div class="row"></div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 244, Column 3: "Member _throwIfSenderOrConnectionClosed should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-13">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import * as Long from "long";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>import * as log from "./log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>import { MessageSender } from "./core/messageSender";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>import { SendableMessageInfo } from "./serviceBusMessage";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>import { ClientEntityContext } from "./clientEntityContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>  getSenderClosedErrorMsg,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code>  throwErrorIfConnectionClosed,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>  throwTypeErrorIfParameterMissing,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code>  throwTypeErrorIfParameterNotLong,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>  throwTypeErrorIfParameterNotLongArray</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>} from "./util/errors";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code> * The Sender class can be used to send messages, schedule messages to be sent at a later time</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code> * and cancel such scheduled messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code> * Use the `createSender` function on the QueueClient or TopicClient to instantiate a Sender.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code> * The Sender class is an abstraction over the underlying AMQP sender link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code> * @class Sender</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code>export class Sender {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code>   * @property Describes the amqp connection context for the Client.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code>  private _context: ClientEntityContext;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code>   * @property Denotes if close() was called on this sender</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>  private _isClosed: boolean = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code>   * @property Returns `true` if either the sender or the client that created it has been closed</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code>  public get isClosed(): boolean {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code>    return this._isClosed || this._context.isClosed;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>   * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code>  constructor(context: ClientEntityContext) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code>    this._context = context;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code>   * Sends the given message after creating an AMQP Sender link if it doesnt already exists.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code>   * To send a message to a `session` and/or `partition` enabled Queue/Topic, set the `sessionId`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code>   * and/or `partitionKey` properties respectively on the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code>   * @param message - Message to send.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code>  async send(message: SendableMessageInfo): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code>    this._throwIfSenderOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(this._context.namespace.connectionId, "message", message);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code>    const sender = MessageSender.create(this._context);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code>    return sender.send(message);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code>   * Sends the given messages in a single batch i.e. in a single AMQP message after creating an AMQP</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>   * Sender link if it doesnt already exists.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">69</td>
	<td class="source"><code>   * - To send messages to a `session` and/or `partition` enabled Queue/Topic, set the `sessionId`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code>   * and/or `partitionKey` properties respectively on the messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code>   * - When doing so, all</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code>   * messages in the batch should have the same `sessionId` (if using sessions) and the same</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code>   * `parititionKey` (if using paritions).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code>   * @param messages - An array of SendableMessageInfo objects to be sent in a Batch message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code>   * @return Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code>  async sendBatch(messages: SendableMessageInfo[]): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code>    this._throwIfSenderOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(this._context.namespace.connectionId, "messages", messages);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">81</td>
	<td class="source"><code>    if (!Array.isArray(messages)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>      messages = [messages];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">84</td>
	<td class="source"><code>    const sender = MessageSender.create(this._context);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">85</td>
	<td class="source"><code>    return sender.sendBatch(messages);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">86</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code>   * Schedules given message to appear on Service Bus Queue/Subscription at a later time.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">90</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code>   * @param scheduledEnqueueTimeUtc - The UTC time at which the message should be enqueued.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>   * @param message - The message that needs to be scheduled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>   * @returns Promise&#60;Long&#62; - The sequence number of the message that was scheduled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>   * You will need the sequence number if you intend to cancel the scheduling of the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>   * Save the `Long` type as-is in your application without converting to number. Since JavaScript</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code>   * only supports 53 bit numbers, converting the `Long` to number will cause loss in precision.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code>  async scheduleMessage(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>    scheduledEnqueueTimeUtc: Date,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code>    message: SendableMessageInfo</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code>  ): Promise&#60;Long&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>    this._throwIfSenderOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>      "scheduledEnqueueTimeUtc",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>      scheduledEnqueueTimeUtc</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(this._context.namespace.connectionId, "message", message);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">110</td>
	<td class="source"><code>    let senderName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">111</td>
	<td class="source"><code>    if (this._context.sender) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code>      senderName = this._context.sender.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>    const messages = [message];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code>    const result = await this._context.managementClient!.scheduleMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code>      scheduledEnqueueTimeUtc,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code>      messages,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">119</td>
	<td class="source"><code>      senderName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">120</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">121</td>
	<td class="source"><code>    return result[0];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">122</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">123</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">124</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">125</td>
	<td class="source"><code>   * Schedules given messages to appear on Service Bus Queue/Subscription at a later time.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">126</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">127</td>
	<td class="source"><code>   * @param scheduledEnqueueTimeUtc - The UTC time at which the messages should be enqueued.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">128</td>
	<td class="source"><code>   * @param messages - Array of Messages that need to be scheduled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">129</td>
	<td class="source"><code>   * @returns Promise&#60;Long[]&#62; - The sequence numbers of messages that were scheduled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">130</td>
	<td class="source"><code>   * You will need the sequence number if you intend to cancel the scheduling of the messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">131</td>
	<td class="source"><code>   * Save the `Long` type as-is in your application without converting to number. Since JavaScript</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">132</td>
	<td class="source"><code>   * only supports 53 bit numbers, converting the `Long` to number will cause loss in precision.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">133</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">134</td>
	<td class="source"><code>  async scheduleMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">135</td>
	<td class="source"><code>    scheduledEnqueueTimeUtc: Date,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">136</td>
	<td class="source"><code>    messages: SendableMessageInfo[]</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">137</td>
	<td class="source"><code>  ): Promise&#60;Long[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">138</td>
	<td class="source"><code>    this._throwIfSenderOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">139</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">140</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">141</td>
	<td class="source"><code>      "scheduledEnqueueTimeUtc",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">142</td>
	<td class="source"><code>      scheduledEnqueueTimeUtc</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">143</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">144</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(this._context.namespace.connectionId, "messages", messages);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">145</td>
	<td class="source"><code>    if (!Array.isArray(messages)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">146</td>
	<td class="source"><code>      messages = [messages];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">147</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">148</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">149</td>
	<td class="source"><code>    let senderName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">150</td>
	<td class="source"><code>    if (this._context.sender) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">151</td>
	<td class="source"><code>      senderName = this._context.sender.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">152</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">153</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">154</td>
	<td class="source"><code>    return this._context.managementClient!.scheduleMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">155</td>
	<td class="source"><code>      scheduledEnqueueTimeUtc,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">156</td>
	<td class="source"><code>      messages,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">157</td>
	<td class="source"><code>      senderName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">158</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">159</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">160</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">161</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">162</td>
	<td class="source"><code>   * Cancels a message that was scheduled to appear on a ServiceBus Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">163</td>
	<td class="source"><code>   * @param sequenceNumber - The sequence number of the message to be cancelled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">164</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">165</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">166</td>
	<td class="source"><code>  async cancelScheduledMessage(sequenceNumber: Long): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">167</td>
	<td class="source"><code>    this._throwIfSenderOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">168</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">169</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">170</td>
	<td class="source"><code>      "sequenceNumber",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">171</td>
	<td class="source"><code>      sequenceNumber</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">172</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">173</td>
	<td class="source"><code>    throwTypeErrorIfParameterNotLong(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">174</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">175</td>
	<td class="source"><code>      "sequenceNumber",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">176</td>
	<td class="source"><code>      sequenceNumber</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">177</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">178</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">179</td>
	<td class="source"><code>    let senderName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">180</td>
	<td class="source"><code>    if (this._context.sender) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">181</td>
	<td class="source"><code>      senderName = this._context.sender.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">182</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">183</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">184</td>
	<td class="source"><code>    return this._context.managementClient!.cancelScheduledMessages([sequenceNumber], senderName);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">185</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">186</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">187</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">188</td>
	<td class="source"><code>   * Cancels multiple messages that were scheduled to appear on a ServiceBus Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">189</td>
	<td class="source"><code>   * @param sequenceNumbers - An Array of sequence numbers of the messages to be cancelled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">190</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">191</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">192</td>
	<td class="source"><code>  async cancelScheduledMessages(sequenceNumbers: Long[]): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">193</td>
	<td class="source"><code>    this._throwIfSenderOrConnectionClosed();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">194</td>
	<td class="source"><code>    throwTypeErrorIfParameterMissing(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">195</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">196</td>
	<td class="source"><code>      "sequenceNumbers",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">197</td>
	<td class="source"><code>      sequenceNumbers</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">198</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">199</td>
	<td class="source"><code>    if (!Array.isArray(sequenceNumbers)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">200</td>
	<td class="source"><code>      sequenceNumbers = [sequenceNumbers];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">201</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">202</td>
	<td class="source"><code>    throwTypeErrorIfParameterNotLongArray(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">203</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">204</td>
	<td class="source"><code>      "sequenceNumbers",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">205</td>
	<td class="source"><code>      sequenceNumbers</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">206</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">207</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">208</td>
	<td class="source"><code>    let senderName;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">209</td>
	<td class="source"><code>    if (this._context.sender) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">210</td>
	<td class="source"><code>      senderName = this._context.sender.name;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">211</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">212</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">213</td>
	<td class="source"><code>    return this._context.managementClient!.cancelScheduledMessages(sequenceNumbers, senderName);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">214</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">215</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">216</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">217</td>
	<td class="source"><code>   * Closes the underlying AMQP sender link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">218</td>
	<td class="source"><code>   * Once closed, the sender cannot be used for any further operations.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">219</td>
	<td class="source"><code>   * Use the `createSender` function on the QueueClient or TopicClient to instantiate a new Sender</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">220</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">221</td>
	<td class="source"><code>   * @returns {Promise&#60;void&#62;}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">222</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">223</td>
	<td class="source"><code>  async close(): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">224</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">225</td>
	<td class="source"><code>      if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">226</td>
	<td class="source"><code>        this._context.namespace.connection &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">227</td>
	<td class="source"><code>        this._context.namespace.connection.isOpen() &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">228</td>
	<td class="source"><code>        this._context.sender</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">229</td>
	<td class="source"><code>      ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">230</td>
	<td class="source"><code>        await this._context.sender.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">231</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">232</td>
	<td class="source"><code>      this._isClosed = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">233</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">234</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">235</td>
	<td class="source"><code>        "[%s] An error occurred while closing the Sender for %s: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">236</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">237</td>
	<td class="source"><code>        this._context.entityPath,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">238</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">239</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">240</td>
	<td class="source"><code>      throw err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">241</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">242</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">243</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 244, Column 3: "Member _throwIfSenderOrConnectionClosed should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">244</td>
	<td class="source"><code>  private _throwIfSenderOrConnectionClosed(): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">245</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(this._context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">246</td>
	<td class="source"><code>    if (this.isClosed) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">247</td>
	<td class="source"><code>      const errorMessage = getSenderClosedErrorMsg(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">248</td>
	<td class="source"><code>        this._context.entityPath,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">249</td>
	<td class="source"><code>        this._context.clientType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">250</td>
	<td class="source"><code>        this._context.isClosed</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">251</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">252</td>
	<td class="source"><code>      const error = new Error(errorMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">253</td>
	<td class="source"><code>      log.error(`[${this._context.namespace.connectionId}] %O`, error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">254</td>
	<td class="source"><code>      throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">255</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">256</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">257</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">258</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcServiceBusClientTs" class="lint-result bg-error" data-group="f-14" data-problem-count="1" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\serviceBusClient.ts
    </th>
    <th class="result-summary">
      1 problem (1 error, 0 warnings)
    </th>
</tr>
<tr class="f-14 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-14"
								data-content="detailSummary-14"
								aria-controls="detailSummary-14"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-14"
								data-content="sourceCode-14"
								aria-controls="sourceCode-14"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-14">
				<div class="row"></div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 150, Column 7: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-14">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import * as log from "./log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>  ApplicationTokenCredentials,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>  DeviceTokenCredentials,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>  UserTokenCredentials,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>  MSITokenCredentials</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>} from "@azure/ms-rest-nodeauth";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code>import { WebSocketImpl } from "rhea-promise";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>import { ConnectionContext } from "./connectionContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code>import { QueueClient } from "./queueClient";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>import { TopicClient } from "./topicClient";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code>  ConnectionConfig,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code>  DataTransformer,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code>  TokenProvider,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code>  AadTokenProvider,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code>  SasTokenProvider</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code>} from "@azure/amqp-common";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code>import { SubscriptionClient } from "./subscriptionClient";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code> * Describes the options that can be provided while creating the ServiceBusClient.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code> * @interface ServiceBusClientOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code>export interface ServiceBusClientOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code>   * @property The data transformer that will be used to encode</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code>   * and decode the sent and received messages respectively. If not provided then we will use the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>   * DefaultDataTransformer. The default transformer should handle majority of the cases. This</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code>   * option needs to be used only for specialized scenarios.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code>  dataTransformer?: DataTransformer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code>   * @property The WebSocket constructor used to create an AMQP connection</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code>   * over a WebSocket. In browsers, the built-in WebSocket will be  used by default. In Node, a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code>   * TCP socket will be used if a WebSocket constructor is not provided.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code>  webSocket?: WebSocketImpl;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>   * @property Options to be passed to the WebSocket constructor</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code>  webSocketConstructorOptions?: any;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code> * Describes the client that allows interacting with a Service Bus instance.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code> * Holds the AMQP connection to the Service Bus Namespace and is the entry point for using Queues,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code> * Topics and Subscriptions.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code>export class ServiceBusClient {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>   * @property The name of the Service Bus Namespace.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code>  readonly name: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code>   * @property Describes the amqp connection context for the Namespace.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code>   * @private</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code>  private _context: ConnectionContext;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code>   * Instantiates a ServiceBusClient to interact with a Service Bus Namespace.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>   * @constructor</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">69</td>
	<td class="source"><code>   * @param {ConnectionConfig} config - The connection configuration needed to connect to the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code>   * Service Bus Namespace.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code>   * @param {TokenProvider} [tokenProvider] - The token provider that provides the token for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code>   * authentication.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code>   * @param {ServiceBusClientOptions} - Options to control ways to interact with the Service Bus</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code>   * Namespace.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code>  private constructor(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code>    config: ConnectionConfig,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code>    tokenProvider: TokenProvider,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code>    options?: ServiceBusClientOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code>  ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">81</td>
	<td class="source"><code>    if (!options) options = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>    this.name = config.endpoint;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>    this._context = ConnectionContext.create(config, tokenProvider, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">84</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">85</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">86</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code>   * Creates a QueueClient for an existing Service Bus Queue.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code>   * @param {string} queueName The queue name.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code>   * @returns QueueClient.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">90</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code>  createQueueClient(queueName: string): QueueClient {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>    const client = new QueueClient(queueName, this._context);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>    log.ns("Created the QueueClient for Queue: %s", queueName);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>    return client;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code>   * Creates a TopicClient for an existing Service Bus Topic.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>   * @param {string} topicName The topic name.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code>   * @returns TopicClient.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>  createTopicClient(topicName: string): TopicClient {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code>    const client = new TopicClient(topicName, this._context);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code>    log.ns("Created the TopicClient for Topic: %s", topicName);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>    return client;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code>   * Creates a SubscriptionClient for an existing Service Bus Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">110</td>
	<td class="source"><code>   * @param {string} topicName The topic name.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">111</td>
	<td class="source"><code>   * @param {string} subscriptionName The subscription name.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code>   * @returns SubscriptionClient.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code>  createSubscriptionClient(topicName: string, subscriptionName: string): SubscriptionClient {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>    const client = new SubscriptionClient(topicName, subscriptionName, this._context);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code>    log.ns(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code>      "Created the SubscriptionClient for Topic: %s and Subscription: %s",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code>      topicName,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">119</td>
	<td class="source"><code>      subscriptionName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">120</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">121</td>
	<td class="source"><code>    return client;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">122</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">123</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">124</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">125</td>
	<td class="source"><code>   * Closes the AMQP connection created by this ServiceBusClient along with AMQP links for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">126</td>
	<td class="source"><code>   * sender/receivers created by the queue/topic/subscription clients created by this</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">127</td>
	<td class="source"><code>   * ServiceBusClient.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">128</td>
	<td class="source"><code>   * Once closed,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">129</td>
	<td class="source"><code>   * - the clients created by this ServiceBusClient cannot be used to send/receive messages anymore.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">130</td>
	<td class="source"><code>   * - this ServiceBusClient cannot be used to create any new queues/topics/subscriptions clients.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">131</td>
	<td class="source"><code>   * @returns {Promise&#60;any&#62;}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">132</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">133</td>
	<td class="source"><code>  async close(): Promise&#60;any&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">134</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">135</td>
	<td class="source"><code>      if (this._context.connection.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">136</td>
	<td class="source"><code>        log.ns("Closing the amqp connection '%s' on the client.", this._context.connectionId);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">137</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">138</td>
	<td class="source"><code>        // Close all the clients.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">139</td>
	<td class="source"><code>        for (const id of Object.keys(this._context.clientContexts)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">140</td>
	<td class="source"><code>          const clientContext = this._context.clientContexts[id];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">141</td>
	<td class="source"><code>          await clientContext.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">142</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">143</td>
	<td class="source"><code>        await this._context.cbsSession.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">144</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">145</td>
	<td class="source"><code>        await this._context.connection.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">146</td>
	<td class="source"><code>        this._context.wasConnectionCloseCalled = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">147</td>
	<td class="source"><code>        log.ns("Closed the amqp connection '%s' on the client.", this._context.connectionId);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">148</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">149</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 150, Column 7: "Do not assign to the exception parameter."
		<a href="http://eslint.org/docs/rules/no-ex-assign" target="_blank">no-ex-assign</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">150</td>
	<td class="source"><code>      err = err instanceof Error ? err : new Error(JSON.stringify(err));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">151</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">152</td>
	<td class="source"><code>        `An error occurred while closing the connection "${this._context.connectionId}":\n${err}`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">153</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">154</td>
	<td class="source"><code>      throw err;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">155</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">156</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">157</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">158</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">159</td>
	<td class="source"><code>   * Creates a ServiceBusClient for the Service Bus Namespace represented in the given connection</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">160</td>
	<td class="source"><code>   * string.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">161</td>
	<td class="source"><code>   * @param {string} connectionString - Connection string of the form</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">162</td>
	<td class="source"><code>   * 'Endpoint=sb://my-servicebus-namespace.servicebus.windows.net/;SharedAccessKeyName=my-SA-name;SharedAccessKey=my-SA-key'</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">163</td>
	<td class="source"><code>   * @param {ServiceBusClientOptions} [options] Options to control ways to interact with the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">164</td>
	<td class="source"><code>   * Service Bus Namespace.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">165</td>
	<td class="source"><code>   * @returns {ServiceBusClient}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">166</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">167</td>
	<td class="source"><code>  static createFromConnectionString(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">168</td>
	<td class="source"><code>    connectionString: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">169</td>
	<td class="source"><code>    options?: ServiceBusClientOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">170</td>
	<td class="source"><code>  ): ServiceBusClient {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">171</td>
	<td class="source"><code>    const config = ConnectionConfig.create(connectionString);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">172</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">173</td>
	<td class="source"><code>    config.webSocket = options && options.webSocket;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">174</td>
	<td class="source"><code>    config.webSocketEndpointPath = "$servicebus/websocket";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">175</td>
	<td class="source"><code>    config.webSocketConstructorOptions = options && options.webSocketConstructorOptions;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">176</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">177</td>
	<td class="source"><code>    ConnectionConfig.validate(config);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">178</td>
	<td class="source"><code>    const tokenProvider = new SasTokenProvider(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">179</td>
	<td class="source"><code>      config.endpoint,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">180</td>
	<td class="source"><code>      config.sharedAccessKeyName,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">181</td>
	<td class="source"><code>      config.sharedAccessKey</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">182</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">183</td>
	<td class="source"><code>    return new ServiceBusClient(config, tokenProvider, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">184</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">185</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">186</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">187</td>
	<td class="source"><code>   * Creates a ServiceBusClient for the Service Bus Namespace represented by the given host using</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">188</td>
	<td class="source"><code>   * the given TokenProvider.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">189</td>
	<td class="source"><code>   * @param {string} host - Fully qualified domain name for Servicebus. Most likely,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">190</td>
	<td class="source"><code>   * `&#60;yournamespace&#62;.servicebus.windows.net`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">191</td>
	<td class="source"><code>   * @param {TokenProvider} tokenProvider - Your token provider that implements the TokenProvider interface.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">192</td>
	<td class="source"><code>   * @param {ServiceBusClientOptions} options - Options to control ways to interact with the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">193</td>
	<td class="source"><code>   * Service Bus Namespace.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">194</td>
	<td class="source"><code>   * @returns {ServiceBusClient}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">195</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">196</td>
	<td class="source"><code>  static createFromTokenProvider(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">197</td>
	<td class="source"><code>    host: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">198</td>
	<td class="source"><code>    tokenProvider: TokenProvider,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">199</td>
	<td class="source"><code>    options?: ServiceBusClientOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">200</td>
	<td class="source"><code>  ): ServiceBusClient {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">201</td>
	<td class="source"><code>    host = String(host);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">202</td>
	<td class="source"><code>    if (!tokenProvider) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">203</td>
	<td class="source"><code>      throw new TypeError('Missing parameter "tokenProvider"');</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">204</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">205</td>
	<td class="source"><code>    if (!host.endsWith("/")) host += "/";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">206</td>
	<td class="source"><code>    const connectionString =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">207</td>
	<td class="source"><code>      `Endpoint=sb://${host};SharedAccessKeyName=defaultKeyName;` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">208</td>
	<td class="source"><code>      `SharedAccessKey=defaultKeyValue`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">209</td>
	<td class="source"><code>    const config = ConnectionConfig.create(connectionString);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">210</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">211</td>
	<td class="source"><code>    config.webSocket = options && options.webSocket;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">212</td>
	<td class="source"><code>    config.webSocketEndpointPath = "$servicebus/websocket";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">213</td>
	<td class="source"><code>    config.webSocketConstructorOptions = options && options.webSocketConstructorOptions;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">214</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">215</td>
	<td class="source"><code>    ConnectionConfig.validate(config);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">216</td>
	<td class="source"><code>    return new ServiceBusClient(config, tokenProvider, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">217</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">218</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">219</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">220</td>
	<td class="source"><code>   * Creates a ServiceBusClient for the Service Bus Namespace represented by the given host using</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">221</td>
	<td class="source"><code>   * the TokenCredentials generated by the `ms-rest-azure` library.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">222</td>
	<td class="source"><code>   * @param {string} host - Fully qualified domain name for ServiceBus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">223</td>
	<td class="source"><code>   * Most likely, {yournamespace}.servicebus.windows.net</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">224</td>
	<td class="source"><code>   * @param {ServiceClientCredentials} credentials - The Token credentials as implemented in the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">225</td>
	<td class="source"><code>   * `ms-rest-azure` library. It can be one of the following:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">226</td>
	<td class="source"><code>   *  - ApplicationTokenCredentials</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">227</td>
	<td class="source"><code>   *  - UserTokenCredentials</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">228</td>
	<td class="source"><code>   *  - DeviceTokenCredentials</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">229</td>
	<td class="source"><code>   *  - MSITokenCredentials.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">230</td>
	<td class="source"><code>   * @param {ServiceBusClientOptions} options - Options to control ways to interact with the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">231</td>
	<td class="source"><code>   * Service Bus Namespace.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">232</td>
	<td class="source"><code>   * @returns {ServiceBusClient}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">233</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">234</td>
	<td class="source"><code>  static createFromAadTokenCredentials(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">235</td>
	<td class="source"><code>    host: string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">236</td>
	<td class="source"><code>    credentials:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">237</td>
	<td class="source"><code>      | ApplicationTokenCredentials</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">238</td>
	<td class="source"><code>      | UserTokenCredentials</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">239</td>
	<td class="source"><code>      | DeviceTokenCredentials</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">240</td>
	<td class="source"><code>      | MSITokenCredentials,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">241</td>
	<td class="source"><code>    options?: ServiceBusClientOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">242</td>
	<td class="source"><code>  ): ServiceBusClient {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">243</td>
	<td class="source"><code>    host = String(host);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">244</td>
	<td class="source"><code>    const tokenProvider = new AadTokenProvider(credentials);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">245</td>
	<td class="source"><code>    return ServiceBusClient.createFromTokenProvider(host, tokenProvider, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">246</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">247</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">248</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcServiceBusMessageTs" class="lint-result bg-error" data-group="f-15" data-problem-count="43" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\serviceBusMessage.ts
    </th>
    <th class="result-summary">
      43 problems (43 errors, 0 warnings)
    </th>
</tr>
<tr class="f-15 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-15"
								data-content="detailSummary-15"
								aria-controls="detailSummary-15"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-15"
								data-content="sourceCode-15"
								aria-controls="sourceCode-15"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-15">
				<div class="row"><div class="column">
	<h3 class="text-error">Top errors</h3>
	<table class="summary-table"><thead>
		<tr>
			<th>rule</th>
			<th>count</th>
		</tr>
	</thead><tbody>
		<tr>
	<td><a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a></td>
	<td>43</td>
</tr>
	</tbody></table>
</div>
</div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 248, Column 23: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 252, Column 17: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 256, Column 14: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 260, Column 19: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 264, Column 28: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 268, Column 22: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 272, Column 21: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 277, Column 19: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 288, Column 23: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 309, Column 26: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 312, Column 23: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 315, Column 21: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 323, Column 19: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 326, Column 14: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 329, Column 17: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 332, Column 21: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 340, Column 25: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 343, Column 28: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 346, Column 22: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 355, Column 24: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 363, Column 27: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 371, Column 35: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 470, Column 34: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 473, Column 24: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 476, Column 20: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 479, Column 20: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 482, Column 14: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 485, Column 15: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 488, Column 19: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 491, Column 22: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 494, Column 26: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 497, Column 29: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 501, Column 31: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 502, Column 57: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 505, Column 60: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 508, Column 65: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 514, Column 31: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 515, Column 61: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 518, Column 66: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 521, Column 59: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 528, Column 57: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 531, Column 56: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 536, Column 13: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-15">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import Long from "long";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>  Delivery,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>  uuid_to_string,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>  AmqpError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>  MessageAnnotations,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>  DeliveryAnnotations</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code>} from "rhea-promise";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>import { Constants, AmqpMessage } from "@azure/amqp-common";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code>import * as log from "./log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>import { ClientEntityContext } from "./clientEntityContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>import { reorderLockToken } from "../src/util/utils";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code>import { MessageReceiver } from "../src/core/messageReceiver";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code>import { MessageSession } from "../src/session/messageSession";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code>import { getErrorMessageNotSupportedInReceiveAndDeleteMode } from "./util/errors";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code> * The mode in which messages should be received. The 2 modes are `peekLock` and `receiveAndDelete`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code>export enum ReceiveMode {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code>   * Once a message is received in this mode, the receiver has a lock on the message for a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code>   * particular duration. If the message is not settled by this time, it lands back on Service Bus</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code>   * to be fetched by the next receive operation.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code>   * @type {Number}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code>  peekLock = 1,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>   * Messages received in this mode get automatically removed from Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code>   * @type {Number}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code>  receiveAndDelete = 2</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code>export enum DispositionType {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code>  complete = "complete",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>  deadletter = "deadletter",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code>  abandon = "abandon",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code>  defer = "defer"</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code>export enum DispositionStatus {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code>  completed = "completed",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code>  defered = "defered",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code>  suspended = "suspended",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code>  abandoned = "abandoned",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>  renewed = "renewed"</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code> * Describes the delivery annotations for Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code> * @interface</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code>export interface ServiceBusDeliveryAnnotations extends DeliveryAnnotations {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code>   * @property {string} [last_enqueued_offset] The offset of the last event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>  last_enqueued_offset?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">69</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code>   * @property {number} [last_enqueued_sequence_number] The sequence number of the last event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code>  last_enqueued_sequence_number?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code>   * @property {number} [last_enqueued_time_utc] The enqueued time of the last event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code>  last_enqueued_time_utc?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code>   * @property {number} [runtime_info_retrieval_time_utc] The retrieval time of the last event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code>  runtime_info_retrieval_time_utc?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">81</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>   * @property {string} Any unknown delivery annotations.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">84</td>
	<td class="source"><code>  [x: string]: any;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">85</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">86</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code> * Describes the message annotations for Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">90</td>
	<td class="source"><code> * @interface ServiceBusMessageAnnotations</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>export interface ServiceBusMessageAnnotations extends MessageAnnotations {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>   * @property {string | null} [x-opt-partition-key] Annotation for the partition key set for the event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code>  "x-opt-partition-key"?: string | null;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code>   * @property {number} [x-opt-sequence-number] Annontation for the sequence number of the event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code>  "x-opt-sequence-number"?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>   * @property {number} [x-opt-enqueued-time] Annotation for the enqueued time of the event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code>  "x-opt-enqueued-time"?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>   * @property {string} [x-opt-offset] Annotation for the offset of the event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code>  "x-opt-offset"?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">110</td>
	<td class="source"><code>   * @property {string} [x-opt-locked-until] Annotation for the message being locked until.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">111</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code>  "x-opt-locked-until"?: Date | number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code> * Describes the reason and error description for dead lettering a message using the `deadLetter()`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code> * method on the message received from Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code> * @interface DeadLetterOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">119</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">120</td>
	<td class="source"><code>export interface DeadLetterOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">121</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">122</td>
	<td class="source"><code>   * @property The reason for deadlettering the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">123</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">124</td>
	<td class="source"><code>  deadletterReason: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">125</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">126</td>
	<td class="source"><code>   * @property The error description for deadlettering the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">127</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">128</td>
	<td class="source"><code>  deadLetterErrorDescription: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">129</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">130</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">131</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">132</td>
	<td class="source"><code> * Describes the message to be sent to Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">133</td>
	<td class="source"><code> * @interface SendableMessageInfo.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">134</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">135</td>
	<td class="source"><code>export interface SendableMessageInfo {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">136</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">137</td>
	<td class="source"><code>   * @property The message body that needs to be sent or is received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">138</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">139</td>
	<td class="source"><code>  body: any;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">140</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">141</td>
	<td class="source"><code>   * @property The message identifier is an</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">142</td>
	<td class="source"><code>   * application-defined value that uniquely identifies the message and its payload.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">143</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">144</td>
	<td class="source"><code>   * Note: Numbers that are not whole integers are not allowed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">145</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">146</td>
	<td class="source"><code>  messageId?: string | number | Buffer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">147</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">148</td>
	<td class="source"><code>   * @property The content type of the message. Optionally describes</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">149</td>
	<td class="source"><code>   * the payload of the message, with a descriptor following the format of RFC2045, Section 5, for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">150</td>
	<td class="source"><code>   * example "application/json".</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">151</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">152</td>
	<td class="source"><code>  contentType?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">153</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">154</td>
	<td class="source"><code>   * @property The correlation identifier that allows an</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">155</td>
	<td class="source"><code>   * application to specify a context for the message for the purposes of correlation, for example</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">156</td>
	<td class="source"><code>   * reflecting the MessageId of a message that is being replied to.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">157</td>
	<td class="source"><code>   * See {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messages-payloads?#message-routing-and-correlation Message Routing and Correlation}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">158</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">159</td>
	<td class="source"><code>  correlationId?: string | number | Buffer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">160</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">161</td>
	<td class="source"><code>   * @property The partition key for sending a message to a partitioned entity.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">162</td>
	<td class="source"><code>   * Maximum length is 128 characters. For {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning partitioned entities},</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">163</td>
	<td class="source"><code>   * setting this value enables assigning related messages to the same internal partition,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">164</td>
	<td class="source"><code>   * so that submission sequence order is correctly recorded. The partition is chosen by a hash</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">165</td>
	<td class="source"><code>   * function over this value and cannot be chosen directly.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">166</td>
	<td class="source"><code>   * - For session-aware entities, the `sessionId` property overrides this value.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">167</td>
	<td class="source"><code>   * - For non partitioned entities, partition key will be ignored</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">168</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">169</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">170</td>
	<td class="source"><code>  partitionKey?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">171</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">172</td>
	<td class="source"><code>   * @property The partition key for sending a message into an entity</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">173</td>
	<td class="source"><code>   * via a partitioned transfer queue. Maximum length is 128 characters. If a message is sent via a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">174</td>
	<td class="source"><code>   * transfer queue in the scope of a transaction, this value selects the transfer queue partition:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">175</td>
	<td class="source"><code>   * This is functionally equivalent to `partitionKey` property and ensures that messages are kept</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">176</td>
	<td class="source"><code>   * together and in order as they are transferred.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">177</td>
	<td class="source"><code>   * See {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions#transfers-and-send-via Transfers and Send Via}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">178</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">179</td>
	<td class="source"><code>  viaPartitionKey?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">180</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">181</td>
	<td class="source"><code>   * @property The session identifier for a session-aware entity. Maximum</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">182</td>
	<td class="source"><code>   * length is 128 characters. For session-aware entities, this application-defined value specifies</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">183</td>
	<td class="source"><code>   * the session affiliation of the message. Messages with the same session identifier are subject</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">184</td>
	<td class="source"><code>   * to summary locking and enable exact in-order processing and demultiplexing. For</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">185</td>
	<td class="source"><code>   * session-unaware entities, this value is ignored.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">186</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/azure/service-bus-messaging/message-sessions Message Sessions}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">187</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">188</td>
	<td class="source"><code>  sessionId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">189</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">190</td>
	<td class="source"><code>   * @property The session identifier augmenting the `replyTo` address.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">191</td>
	<td class="source"><code>   * Maximum length is 128 characters. This value augments the ReplyTo information and specifies</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">192</td>
	<td class="source"><code>   * which SessionId should be set for the reply when sent to the reply entity.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">193</td>
	<td class="source"><code>   * See {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messages-payloads?#message-routing-and-correlation Message Routing and Correlation}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">194</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">195</td>
	<td class="source"><code>  replyToSessionId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">196</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">197</td>
	<td class="source"><code>   * @property The message’s time to live value. This value is the relative</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">198</td>
	<td class="source"><code>   * duration after which the message expires, starting from the instant the message has been</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">199</td>
	<td class="source"><code>   * accepted and stored by the broker, as captured in `enqueuedTimeUtc`. When not set explicitly,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">200</td>
	<td class="source"><code>   * the assumed value is the DefaultTimeToLive for the respective queue or topic. A message-level</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">201</td>
	<td class="source"><code>   * `timeToLive` value cannot be longer than the entity's DefaultTimeToLive setting and it is</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">202</td>
	<td class="source"><code>   * silently adjusted if it does. See</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">203</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/azure/service-bus-messaging/message-expiration Expiration}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">204</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">205</td>
	<td class="source"><code>  timeToLive?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">206</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">207</td>
	<td class="source"><code>   * @property The application specific label. This property enables the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">208</td>
	<td class="source"><code>   * application to indicate the purpose of the message to the receiver in a standardized. fashion,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">209</td>
	<td class="source"><code>   * similar to an email subject line. The mapped AMQP property is "subject".</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">210</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">211</td>
	<td class="source"><code>  label?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">212</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">213</td>
	<td class="source"><code>   * @property The "to" address. This property is reserved for future use in routing</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">214</td>
	<td class="source"><code>   * scenarios and presently ignored by the broker itself. Applications can use this value in</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">215</td>
	<td class="source"><code>   * rule-driven {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-auto-forwarding auto-forward chaining}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">216</td>
	<td class="source"><code>   * scenarios to indicate the intended logical destination of the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">217</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">218</td>
	<td class="source"><code>  to?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">219</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">220</td>
	<td class="source"><code>   * @property The address of an entity to send replies to. This optional and</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">221</td>
	<td class="source"><code>   * application-defined value is a standard way to express a reply path to the receiver of the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">222</td>
	<td class="source"><code>   * message. When a sender expects a reply, it sets the value to the absolute or relative path of</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">223</td>
	<td class="source"><code>   * the queue or topic it expects the reply to be sent to. See</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">224</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messages-payloads?#message-routing-and-correlation Message Routing and Correlation}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">225</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">226</td>
	<td class="source"><code>  replyTo?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">227</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">228</td>
	<td class="source"><code>   * @property The date and time in UTC at which the message will</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">229</td>
	<td class="source"><code>   * be enqueued. This property returns the time in UTC; when setting the property, the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">230</td>
	<td class="source"><code>   * supplied DateTime value must also be in UTC. This value is for delayed message sending.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">231</td>
	<td class="source"><code>   * It is utilized to delay messages sending to a specific time in the future. Message enqueuing</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">232</td>
	<td class="source"><code>   * time does not mean that the message will be sent at the same time. It will get enqueued,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">233</td>
	<td class="source"><code>   * but the actual sending time depends on the queue's workload and its state.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">234</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">235</td>
	<td class="source"><code>  scheduledEnqueueTimeUtc?: Date;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">236</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">237</td>
	<td class="source"><code>   * @property The application specific properties which can be</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">238</td>
	<td class="source"><code>   * used for custom message metadata.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">239</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">240</td>
	<td class="source"><code>  userProperties?: { [key: string]: any };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">241</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">242</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">243</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">244</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">245</td>
	<td class="source"><code> * Gets the error message for when a property on given message is not of expected type</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">246</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">247</td>
	<td class="source"><code>export function getMessagePropertyTypeMismatchError(msg: SendableMessageInfo): Error | undefined {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 248, Column 23: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">248</td>
	<td class="source"><code>  if (msg.contentType != undefined && typeof msg.contentType !== "string") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">249</td>
	<td class="source"><code>    return new TypeError("The property 'contentType' on the message must be of type 'string'");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">250</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">251</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 252, Column 17: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">252</td>
	<td class="source"><code>  if (msg.label != undefined && typeof msg.label !== "string") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">253</td>
	<td class="source"><code>    return new TypeError("The property 'label' on the message must be of type 'string'");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">254</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">255</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 256, Column 14: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">256</td>
	<td class="source"><code>  if (msg.to != undefined && typeof msg.to !== "string") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">257</td>
	<td class="source"><code>    return new TypeError("The property 'to' on the message must be of type 'string'");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">258</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">259</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 260, Column 19: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">260</td>
	<td class="source"><code>  if (msg.replyTo != undefined && typeof msg.replyTo !== "string") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">261</td>
	<td class="source"><code>    return new TypeError("The property 'replyTo' on the message must be of type 'string'");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">262</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">263</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 264, Column 28: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">264</td>
	<td class="source"><code>  if (msg.replyToSessionId != undefined && typeof msg.replyToSessionId !== "string") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">265</td>
	<td class="source"><code>    return new TypeError("The property 'replyToSessionId' on the message must be of type 'string'");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">266</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">267</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 268, Column 22: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">268</td>
	<td class="source"><code>  if (msg.timeToLive != undefined && typeof msg.timeToLive !== "number") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">269</td>
	<td class="source"><code>    return new TypeError("The property 'timeToLive' on the message must be of type 'number'");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">270</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">271</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 272, Column 21: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">272</td>
	<td class="source"><code>  if (msg.sessionId != undefined && typeof msg.sessionId !== "string") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">273</td>
	<td class="source"><code>    return new TypeError("The property 'sessionId' on the message must be of type 'string'");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">274</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">275</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">276</td>
	<td class="source"><code>  if (</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 277, Column 19: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">277</td>
	<td class="source"><code>    msg.messageId != undefined &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">278</td>
	<td class="source"><code>    typeof msg.messageId !== "string" &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">279</td>
	<td class="source"><code>    typeof msg.messageId !== "number" &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">280</td>
	<td class="source"><code>    !Buffer.isBuffer(msg.messageId)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">281</td>
	<td class="source"><code>  ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">282</td>
	<td class="source"><code>    return new TypeError(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">283</td>
	<td class="source"><code>      "The property 'messageId' on the message must be of type string, number or Buffer"</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">284</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">285</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">286</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">287</td>
	<td class="source"><code>  if (</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 288, Column 23: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">288</td>
	<td class="source"><code>    msg.correlationId != undefined &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">289</td>
	<td class="source"><code>    typeof msg.correlationId !== "string" &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">290</td>
	<td class="source"><code>    typeof msg.correlationId !== "number" &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">291</td>
	<td class="source"><code>    !Buffer.isBuffer(msg.correlationId)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">292</td>
	<td class="source"><code>  ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">293</td>
	<td class="source"><code>    return new TypeError(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">294</td>
	<td class="source"><code>      "The property 'correlationId' on the message must be of type string, number or Buffer"</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">295</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">296</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">297</td>
	<td class="source"><code>  return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">298</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">299</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">300</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">301</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">302</td>
	<td class="source"><code> * Converts given SendableMessageInfo to AmqpMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">303</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">304</td>
	<td class="source"><code>export function toAmqpMessage(msg: SendableMessageInfo): AmqpMessage {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">305</td>
	<td class="source"><code>  const amqpMsg: AmqpMessage = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">306</td>
	<td class="source"><code>    body: msg.body,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">307</td>
	<td class="source"><code>    message_annotations: {}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">308</td>
	<td class="source"><code>  };</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 309, Column 26: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">309</td>
	<td class="source"><code>  if (msg.userProperties != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">310</td>
	<td class="source"><code>    amqpMsg.application_properties = msg.userProperties;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">311</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 312, Column 23: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">312</td>
	<td class="source"><code>  if (msg.contentType != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">313</td>
	<td class="source"><code>    amqpMsg.content_type = msg.contentType;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">314</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 315, Column 21: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">315</td>
	<td class="source"><code>  if (msg.sessionId != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">316</td>
	<td class="source"><code>    if (msg.sessionId.length &#62; Constants.maxSessionIdLength) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">317</td>
	<td class="source"><code>      throw new Error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">318</td>
	<td class="source"><code>        "Length of 'sessionId' property on the message cannot be greater than 128 characters."</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">319</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">320</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">321</td>
	<td class="source"><code>    amqpMsg.group_id = msg.sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">322</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 323, Column 19: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">323</td>
	<td class="source"><code>  if (msg.replyTo != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">324</td>
	<td class="source"><code>    amqpMsg.reply_to = msg.replyTo;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">325</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 326, Column 14: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">326</td>
	<td class="source"><code>  if (msg.to != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">327</td>
	<td class="source"><code>    amqpMsg.to = msg.to;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">328</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 329, Column 17: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">329</td>
	<td class="source"><code>  if (msg.label != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">330</td>
	<td class="source"><code>    amqpMsg.subject = msg.label;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">331</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 332, Column 21: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">332</td>
	<td class="source"><code>  if (msg.messageId != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">333</td>
	<td class="source"><code>    if (typeof msg.messageId === "string" && msg.messageId.length &#62; Constants.maxMessageIdLength) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">334</td>
	<td class="source"><code>      throw new Error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">335</td>
	<td class="source"><code>        "Length of 'messageId' property on the message cannot be greater than 128 characters."</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">336</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">337</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">338</td>
	<td class="source"><code>    amqpMsg.message_id = msg.messageId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">339</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 340, Column 25: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">340</td>
	<td class="source"><code>  if (msg.correlationId != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">341</td>
	<td class="source"><code>    amqpMsg.correlation_id = msg.correlationId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">342</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 343, Column 28: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">343</td>
	<td class="source"><code>  if (msg.replyToSessionId != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">344</td>
	<td class="source"><code>    amqpMsg.reply_to_group_id = msg.replyToSessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">345</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 346, Column 22: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">346</td>
	<td class="source"><code>  if (msg.timeToLive != undefined && msg.timeToLive !== Constants.maxDurationValue) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">347</td>
	<td class="source"><code>    amqpMsg.ttl = msg.timeToLive;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">348</td>
	<td class="source"><code>    amqpMsg.creation_time = Date.now();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">349</td>
	<td class="source"><code>    if (Constants.maxAbsoluteExpiryTime - amqpMsg.creation_time &#62; amqpMsg.ttl) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">350</td>
	<td class="source"><code>      amqpMsg.absolute_expiry_time = amqpMsg.creation_time + amqpMsg.ttl;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">351</td>
	<td class="source"><code>    } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">352</td>
	<td class="source"><code>      amqpMsg.absolute_expiry_time = Constants.maxAbsoluteExpiryTime;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">353</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">354</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 355, Column 24: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">355</td>
	<td class="source"><code>  if (msg.partitionKey != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">356</td>
	<td class="source"><code>    if (msg.partitionKey.length &#62; Constants.maxPartitionKeyLength) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">357</td>
	<td class="source"><code>      throw new Error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">358</td>
	<td class="source"><code>        "Length of 'partitionKey' property on the message cannot be greater than 128 characters."</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">359</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">360</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">361</td>
	<td class="source"><code>    amqpMsg.message_annotations![Constants.partitionKey] = msg.partitionKey;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">362</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 363, Column 27: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">363</td>
	<td class="source"><code>  if (msg.viaPartitionKey != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">364</td>
	<td class="source"><code>    if (msg.viaPartitionKey.length &#62; Constants.maxPartitionKeyLength) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">365</td>
	<td class="source"><code>      throw new Error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">366</td>
	<td class="source"><code>        "Length of 'viaPartitionKey' property on the message cannot be greater than 128 characters."</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">367</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">368</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">369</td>
	<td class="source"><code>    amqpMsg.message_annotations![Constants.viaPartitionKey] = msg.viaPartitionKey;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">370</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 371, Column 35: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">371</td>
	<td class="source"><code>  if (msg.scheduledEnqueueTimeUtc != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">372</td>
	<td class="source"><code>    amqpMsg.message_annotations![Constants.scheduledEnqueueTime] = msg.scheduledEnqueueTimeUtc;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">373</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">374</td>
	<td class="source"><code>  log.message("SBMessage to AmqpMessage: %O", amqpMsg);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">375</td>
	<td class="source"><code>  return amqpMsg;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">376</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">377</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">378</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">379</td>
	<td class="source"><code> * Describes the message received from Service Bus during peek operations and so cannot be settled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">380</td>
	<td class="source"><code> * @class ReceivedSBMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">381</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">382</td>
	<td class="source"><code>export interface ReceivedMessageInfo extends SendableMessageInfo {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">383</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">384</td>
	<td class="source"><code>   * @property The lock token is a reference to the lock that is being held by the broker in</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">385</td>
	<td class="source"><code>   * `ReceiveMode.PeekLock` mode. Locks are used internally settle messages as explained in the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">386</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/azure/service-bus-messaging/message-transfers-locks-settlement product documentation in more detail}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">387</td>
	<td class="source"><code>   * - Not applicable when the message is received in `ReceiveMode.receiveAndDelete`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">388</td>
	<td class="source"><code>   * mode.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">389</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">390</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">391</td>
	<td class="source"><code>  readonly lockToken?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">392</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">393</td>
	<td class="source"><code>   * @property Number of deliveries that have been attempted for this message. The count is</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">394</td>
	<td class="source"><code>   * incremented when a message lock expires, or the message is explicitly abandoned using the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">395</td>
	<td class="source"><code>   * `abandon()` method on the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">396</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">397</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">398</td>
	<td class="source"><code>  readonly deliveryCount?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">399</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">400</td>
	<td class="source"><code>   * @property The UTC instant at which the message has been accepted and stored in Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">401</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">402</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">403</td>
	<td class="source"><code>  readonly enqueuedTimeUtc?: Date;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">404</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">405</td>
	<td class="source"><code>   * @property The UTC instant at which the message is marked for removal and no longer available for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">406</td>
	<td class="source"><code>   * retrieval from the entity due to expiration. This property is computed from 2 other properties</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">407</td>
	<td class="source"><code>   * on the message: `enqueuedTimeUtc` + `timeToLive`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">408</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">409</td>
	<td class="source"><code>  readonly expiresAtUtc?: Date;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">410</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">411</td>
	<td class="source"><code>   * @property The UTC instant until which the message is held locked in the queue/subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">412</td>
	<td class="source"><code>   * When the lock expires, the `deliveryCount` is incremented and the message is again available</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">413</td>
	<td class="source"><code>   * for retrieval.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">414</td>
	<td class="source"><code>   * - Not applicable when the message is received in `ReceiveMode.receiveAndDelete`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">415</td>
	<td class="source"><code>   * mode.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">416</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">417</td>
	<td class="source"><code>  lockedUntilUtc?: Date;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">418</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">419</td>
	<td class="source"><code>   * @property The original sequence number of the message. For</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">420</td>
	<td class="source"><code>   * messages that have been auto-forwarded, this property reflects the sequence number that had</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">421</td>
	<td class="source"><code>   * first been assigned to the message at its original point of submission.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">422</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">423</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">424</td>
	<td class="source"><code>  readonly enqueuedSequenceNumber?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">425</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">426</td>
	<td class="source"><code>   * @property The unique number assigned to a message by Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">427</td>
	<td class="source"><code>   * The sequence number is a unique 64-bit integer assigned to a message as it is accepted</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">428</td>
	<td class="source"><code>   * and stored by the broker and functions as its true identifier. For partitioned entities,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">429</td>
	<td class="source"><code>   * the topmost 16 bits reflect the partition identifier. Sequence numbers monotonically increase.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">430</td>
	<td class="source"><code>   * They roll over to 0 when the 48-64 bit range is exhausted.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">431</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">432</td>
	<td class="source"><code>   * **Max safe integer** that Javascript currently supports is `2^53 - 1`. The sequence number</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">433</td>
	<td class="source"><code>   * is an AMQP `Long` type which can be upto 64 bits long. To represent that we are using a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">434</td>
	<td class="source"><code>   * library named {@link https://github.com/dcodeIO/long.js long.js}. We expect customers</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">435</td>
	<td class="source"><code>   * to use the **`Long`** type exported by this library.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">436</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">437</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">438</td>
	<td class="source"><code>  readonly sequenceNumber?: Long;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">439</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">440</td>
	<td class="source"><code>   * @property {string} [deadLetterSource] The name of the queue or subscription that this message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">441</td>
	<td class="source"><code>   * was enqueued on, before it was deadlettered. Only set in messages that have been dead-lettered</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">442</td>
	<td class="source"><code>   * and subsequently auto-forwarded from the dead-letter queue to another entity. Indicates the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">443</td>
	<td class="source"><code>   * entity in which the message was dead-lettered.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">444</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">445</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">446</td>
	<td class="source"><code>  readonly deadLetterSource?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">447</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">448</td>
	<td class="source"><code>   * @property {AmqpMessage} _amqpMessage The underlying raw amqp message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">449</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">450</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">451</td>
	<td class="source"><code>  readonly _amqpMessage: AmqpMessage;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">452</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">453</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">454</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">455</td>
	<td class="source"><code> * @ignore</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">456</td>
	<td class="source"><code> * Converts given AmqpMessage to ReceivedMessageInfo</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">457</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">458</td>
	<td class="source"><code>export function fromAmqpMessage(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">459</td>
	<td class="source"><code>  msg: AmqpMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">460</td>
	<td class="source"><code>  delivery?: Delivery,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">461</td>
	<td class="source"><code>  shouldReorderLockToken?: boolean</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">462</td>
	<td class="source"><code>): ReceivedMessageInfo {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">463</td>
	<td class="source"><code>  if (!msg) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">464</td>
	<td class="source"><code>    throw new Error("'msg' cannot be null or undefined.");</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">465</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">466</td>
	<td class="source"><code>  const sbmsg: SendableMessageInfo = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">467</td>
	<td class="source"><code>    body: msg.body</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">468</td>
	<td class="source"><code>  };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">469</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 470, Column 34: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">470</td>
	<td class="source"><code>  if (msg.application_properties != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">471</td>
	<td class="source"><code>    sbmsg.userProperties = msg.application_properties;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">472</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 473, Column 24: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">473</td>
	<td class="source"><code>  if (msg.content_type != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">474</td>
	<td class="source"><code>    sbmsg.contentType = msg.content_type;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">475</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 476, Column 20: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">476</td>
	<td class="source"><code>  if (msg.group_id != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">477</td>
	<td class="source"><code>    sbmsg.sessionId = msg.group_id;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">478</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 479, Column 20: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">479</td>
	<td class="source"><code>  if (msg.reply_to != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">480</td>
	<td class="source"><code>    sbmsg.replyTo = msg.reply_to;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">481</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 482, Column 14: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">482</td>
	<td class="source"><code>  if (msg.to != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">483</td>
	<td class="source"><code>    sbmsg.to = msg.to;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">484</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 485, Column 15: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">485</td>
	<td class="source"><code>  if (msg.ttl != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">486</td>
	<td class="source"><code>    sbmsg.timeToLive = msg.ttl;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">487</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 488, Column 19: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">488</td>
	<td class="source"><code>  if (msg.subject != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">489</td>
	<td class="source"><code>    sbmsg.label = msg.subject;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">490</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 491, Column 22: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">491</td>
	<td class="source"><code>  if (msg.message_id != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">492</td>
	<td class="source"><code>    sbmsg.messageId = msg.message_id;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">493</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 494, Column 26: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">494</td>
	<td class="source"><code>  if (msg.correlation_id != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">495</td>
	<td class="source"><code>    sbmsg.correlationId = msg.correlation_id;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">496</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 497, Column 29: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">497</td>
	<td class="source"><code>  if (msg.reply_to_group_id != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">498</td>
	<td class="source"><code>    sbmsg.replyToSessionId = msg.reply_to_group_id;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">499</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">500</td>
	<td class="source"><code></code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 501, Column 31: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">501</td>
	<td class="source"><code>  if (msg.message_annotations != undefined) {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 502, Column 57: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">502</td>
	<td class="source"><code>    if (msg.message_annotations[Constants.partitionKey] != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">503</td>
	<td class="source"><code>      sbmsg.partitionKey = msg.message_annotations[Constants.partitionKey];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">504</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 505, Column 60: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">505</td>
	<td class="source"><code>    if (msg.message_annotations[Constants.viaPartitionKey] != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">506</td>
	<td class="source"><code>      sbmsg.viaPartitionKey = msg.message_annotations[Constants.viaPartitionKey];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">507</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 508, Column 65: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">508</td>
	<td class="source"><code>    if (msg.message_annotations[Constants.scheduledEnqueueTime] != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">509</td>
	<td class="source"><code>      sbmsg.scheduledEnqueueTimeUtc = msg.message_annotations[Constants.scheduledEnqueueTime];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">510</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">511</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">512</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">513</td>
	<td class="source"><code>  const props: any = {};</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 514, Column 31: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">514</td>
	<td class="source"><code>  if (msg.message_annotations != undefined) {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 515, Column 61: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">515</td>
	<td class="source"><code>    if (msg.message_annotations[Constants.deadLetterSource] != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">516</td>
	<td class="source"><code>      props.deadLetterSource = msg.message_annotations[Constants.deadLetterSource];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">517</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 518, Column 66: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">518</td>
	<td class="source"><code>    if (msg.message_annotations[Constants.enqueueSequenceNumber] != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">519</td>
	<td class="source"><code>      props.enqueuedSequenceNumber = msg.message_annotations[Constants.enqueueSequenceNumber];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">520</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 521, Column 59: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">521</td>
	<td class="source"><code>    if (msg.message_annotations[Constants.sequenceNumber] != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">522</td>
	<td class="source"><code>      if (Buffer.isBuffer(msg.message_annotations[Constants.sequenceNumber])) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">523</td>
	<td class="source"><code>        props.sequenceNumber = Long.fromBytesBE(msg.message_annotations[Constants.sequenceNumber]);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">524</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">525</td>
	<td class="source"><code>        props.sequenceNumber = Long.fromNumber(msg.message_annotations[Constants.sequenceNumber]);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">526</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">527</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 528, Column 57: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">528</td>
	<td class="source"><code>    if (msg.message_annotations[Constants.enqueuedTime] != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">529</td>
	<td class="source"><code>      props.enqueuedTimeUtc = new Date(msg.message_annotations[Constants.enqueuedTime] as number);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">530</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 531, Column 56: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">531</td>
	<td class="source"><code>    if (msg.message_annotations[Constants.lockedUntil] != undefined) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">532</td>
	<td class="source"><code>      props.lockedUntilUtc = new Date(msg.message_annotations[Constants.lockedUntil] as number);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">533</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">534</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">535</td>
	<td class="source"><code>  if (</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 536, Column 13: "Expected '!==' and instead saw '!='."
		<a href="http://eslint.org/docs/rules/eqeqeq" target="_blank">eqeqeq</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">536</td>
	<td class="source"><code>    msg.ttl != undefined &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">537</td>
	<td class="source"><code>    msg.ttl &#62;= Constants.maxDurationValue - props.enqueuedTimeUtc.getTime()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">538</td>
	<td class="source"><code>  ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">539</td>
	<td class="source"><code>    props.expiresAtUtc = new Date(Constants.maxDurationValue);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">540</td>
	<td class="source"><code>  } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">541</td>
	<td class="source"><code>    props.expiresAtUtc = new Date(props.enqueuedTimeUtc.getTime() + msg.ttl!);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">542</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">543</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">544</td>
	<td class="source"><code>  const rcvdsbmsg: ReceivedMessageInfo = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">545</td>
	<td class="source"><code>    _amqpMessage: msg,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">546</td>
	<td class="source"><code>    _delivery: delivery,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">547</td>
	<td class="source"><code>    deliveryCount: msg.delivery_count,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">548</td>
	<td class="source"><code>    lockToken:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">549</td>
	<td class="source"><code>      delivery && delivery.tag && delivery.tag.length !== 0</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">550</td>
	<td class="source"><code>        ? uuid_to_string(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">551</td>
	<td class="source"><code>            shouldReorderLockToken === true</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">552</td>
	<td class="source"><code>              ? reorderLockToken(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">553</td>
	<td class="source"><code>                  typeof delivery.tag === "string" ? Buffer.from(delivery.tag) : delivery.tag</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">554</td>
	<td class="source"><code>                )</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">555</td>
	<td class="source"><code>              : typeof delivery.tag === "string"</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">556</td>
	<td class="source"><code>              ? Buffer.from(delivery.tag)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">557</td>
	<td class="source"><code>              : delivery.tag</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">558</td>
	<td class="source"><code>          )</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">559</td>
	<td class="source"><code>        : undefined,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">560</td>
	<td class="source"><code>    ...sbmsg,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">561</td>
	<td class="source"><code>    ...props</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">562</td>
	<td class="source"><code>  };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">563</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">564</td>
	<td class="source"><code>  log.message("AmqpMessage to ReceivedSBMessage: %O", rcvdsbmsg);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">565</td>
	<td class="source"><code>  return rcvdsbmsg;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">566</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">567</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">568</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">569</td>
	<td class="source"><code> * Describes the message received from Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">570</td>
	<td class="source"><code> * @interface ReceivedMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">571</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">572</td>
	<td class="source"><code>interface ReceivedMessage extends ReceivedMessageInfo {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">573</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">574</td>
	<td class="source"><code>   * Removes the message from Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">575</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">576</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">577</td>
	<td class="source"><code>  complete(): Promise&#60;void&#62;;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">578</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">579</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">580</td>
	<td class="source"><code>   * The lock held on the message by the receiver is let go, making the message available again in</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">581</td>
	<td class="source"><code>   * Service Bus for another receive operation.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">582</td>
	<td class="source"><code>   * @param propertiesToModify The properties of the message to modify while abandoning the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">583</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">584</td>
	<td class="source"><code>   * @return Promise&#60;void&#62;.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">585</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">586</td>
	<td class="source"><code>  abandon(propertiesToModify?: { [key: string]: any }): Promise&#60;void&#62;;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">587</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">588</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">589</td>
	<td class="source"><code>   * Defers the processing of the message. Save the `sequenceNumber` of the message, in order to</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">590</td>
	<td class="source"><code>   * receive it message again in the future using the `receiveDeferredMessage` method.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">591</td>
	<td class="source"><code>   * @param propertiesToModify The properties of the message to modify while deferring the message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">592</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">593</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">594</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">595</td>
	<td class="source"><code>  defer(propertiesToModify?: { [key: string]: any }): Promise&#60;void&#62;;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">596</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">597</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">598</td>
	<td class="source"><code>   * Moves the message to the deadletter sub-queue. To receive a deadletted message, create a new</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">599</td>
	<td class="source"><code>   * QueueClient/SubscriptionClient using the path for the deadletter sub-queue.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">600</td>
	<td class="source"><code>   * @param options The DeadLetter options that can be provided while</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">601</td>
	<td class="source"><code>   * rejecting the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">602</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">603</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">604</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">605</td>
	<td class="source"><code>  deadLetter(options?: DeadLetterOptions): Promise&#60;void&#62;;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">606</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">607</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">608</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">609</td>
	<td class="source"><code> * Describes the message received from Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">610</td>
	<td class="source"><code> * @class ServiceBusMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">611</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">612</td>
	<td class="source"><code>export class ServiceBusMessage implements ReceivedMessage {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">613</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">614</td>
	<td class="source"><code>   * @property The message body that needs to be sent or is received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">615</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">616</td>
	<td class="source"><code>  body: any;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">617</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">618</td>
	<td class="source"><code>   * @property The application specific properties.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">619</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">620</td>
	<td class="source"><code>  userProperties?: { [key: string]: any };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">621</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">622</td>
	<td class="source"><code>   * @property The message identifier is an</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">623</td>
	<td class="source"><code>   * application-defined value that uniquely identifies the message and its payload. The identifier</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">624</td>
	<td class="source"><code>   * is a free-form string and can reflect a GUID or an identifier derived from the application</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">625</td>
	<td class="source"><code>   * context. If enabled, the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">626</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection duplicate detection}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">627</td>
	<td class="source"><code>   * identifies and removes second and further submissions of messages with the same MessageId.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">628</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">629</td>
	<td class="source"><code>  messageId?: string | number | Buffer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">630</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">631</td>
	<td class="source"><code>   * @property The content type of the message. Optionally describes</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">632</td>
	<td class="source"><code>   * the payload of the message, with a descriptor following the format of RFC2045, Section 5, for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">633</td>
	<td class="source"><code>   * example "application/json".</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">634</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">635</td>
	<td class="source"><code>  contentType?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">636</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">637</td>
	<td class="source"><code>   * @property The correlation identifier that allows an</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">638</td>
	<td class="source"><code>   * application to specify a context for the message for the purposes of correlation, for example</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">639</td>
	<td class="source"><code>   * reflecting the MessageId of a message that is being replied to.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">640</td>
	<td class="source"><code>   * See {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messages-payloads?#message-routing-and-correlation Message Routing and Correlation}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">641</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">642</td>
	<td class="source"><code>  correlationId?: string | number | Buffer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">643</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">644</td>
	<td class="source"><code>   * @property The partition key for sending a message to a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">645</td>
	<td class="source"><code>   * partitioned entity. Maximum length is 128 characters. For {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning partitioned entities},</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">646</td>
	<td class="source"><code>   * setting this value enables assigning related messages to the same internal partition,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">647</td>
	<td class="source"><code>   * so that submission sequence order is correctly recorded. The partition is chosen by a hash</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">648</td>
	<td class="source"><code>   * function over this value and cannot be chosen directly. For session-aware entities,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">649</td>
	<td class="source"><code>   * the `sessionId` property overrides this value.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">650</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">651</td>
	<td class="source"><code>  partitionKey?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">652</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">653</td>
	<td class="source"><code>   * @property The partition key for sending a message into an entity</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">654</td>
	<td class="source"><code>   * via a partitioned transfer queue. Maximum length is 128 characters. If a message is sent via a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">655</td>
	<td class="source"><code>   * transfer queue in the scope of a transaction, this value selects the transfer queue partition:</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">656</td>
	<td class="source"><code>   * This is functionally equivalent to `partitionKey` property and ensures that messages are kept</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">657</td>
	<td class="source"><code>   * together and in order as they are transferred.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">658</td>
	<td class="source"><code>   * See {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions#transfers-and-send-via Transfers and Send Via}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">659</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">660</td>
	<td class="source"><code>  viaPartitionKey?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">661</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">662</td>
	<td class="source"><code>   * @property The session identifier for a session-aware entity. Maximum</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">663</td>
	<td class="source"><code>   * length is 128 characters. For session-aware entities, this application-defined value specifies</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">664</td>
	<td class="source"><code>   * the session affiliation of the message. Messages with the same session identifier are subject</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">665</td>
	<td class="source"><code>   * to summary locking and enable exact in-order processing and demultiplexing. For</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">666</td>
	<td class="source"><code>   * session-unaware entities, this value is ignored.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">667</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/azure/service-bus-messaging/message-sessions Message Sessions}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">668</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">669</td>
	<td class="source"><code>  sessionId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">670</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">671</td>
	<td class="source"><code>   * @property The session identifier augmenting the `replyTo` address.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">672</td>
	<td class="source"><code>   * Maximum length is 128 characters. This value augments the ReplyTo information and specifies</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">673</td>
	<td class="source"><code>   * which SessionId should be set for the reply when sent to the reply entity.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">674</td>
	<td class="source"><code>   * See {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messages-payloads?#message-routing-and-correlation Message Routing and Correlation}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">675</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">676</td>
	<td class="source"><code>  replyToSessionId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">677</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">678</td>
	<td class="source"><code>   * @property The message’s time to live value. This value is the relative</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">679</td>
	<td class="source"><code>   * duration after which the message expires, starting from the instant the message has been</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">680</td>
	<td class="source"><code>   * accepted and stored by the broker, as captured in `enqueuedTimeUtc`. When not set explicitly,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">681</td>
	<td class="source"><code>   * the assumed value is the DefaultTimeToLive for the respective queue or topic. A message-level</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">682</td>
	<td class="source"><code>   * `timeToLive` value cannot be longer than the entity's DefaultTimeToLive setting and it is</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">683</td>
	<td class="source"><code>   * silently adjusted if it does. See</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">684</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/azure/service-bus-messaging/message-expiration Expiration}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">685</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">686</td>
	<td class="source"><code>  timeToLive?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">687</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">688</td>
	<td class="source"><code>   * @property The application specific label. This property enables the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">689</td>
	<td class="source"><code>   * application to indicate the purpose of the message to the receiver in a standardized. fashion,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">690</td>
	<td class="source"><code>   * similar to an email subject line. The mapped AMQP property is "subject".</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">691</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">692</td>
	<td class="source"><code>  label?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">693</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">694</td>
	<td class="source"><code>   * @property The "to" address. This property is reserved for future use in routing</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">695</td>
	<td class="source"><code>   * scenarios and presently ignored by the broker itself. Applications can use this value in</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">696</td>
	<td class="source"><code>   * rule-driven {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-auto-forwarding auto-forward chaining}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">697</td>
	<td class="source"><code>   * scenarios to indicate the intended logical destination of the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">698</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">699</td>
	<td class="source"><code>  to?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">700</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">701</td>
	<td class="source"><code>   * @property The address of an entity to send replies to. This optional and</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">702</td>
	<td class="source"><code>   * application-defined value is a standard way to express a reply path to the receiver of the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">703</td>
	<td class="source"><code>   * message. When a sender expects a reply, it sets the value to the absolute or relative path of</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">704</td>
	<td class="source"><code>   * the queue or topic it expects the reply to be sent to. See</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">705</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messages-payloads?#message-routing-and-correlation Message Routing and Correlation}.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">706</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">707</td>
	<td class="source"><code>  replyTo?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">708</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">709</td>
	<td class="source"><code>   * @property The date and time in UTC at which the message will</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">710</td>
	<td class="source"><code>   * be enqueued. This property returns the time in UTC; when setting the property, the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">711</td>
	<td class="source"><code>   * supplied DateTime value must also be in UTC. This value is for delayed message sending.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">712</td>
	<td class="source"><code>   * It is utilized to delay messages sending to a specific time in the future. Message enqueuing</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">713</td>
	<td class="source"><code>   * time does not mean that the message will be sent at the same time. It will get enqueued,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">714</td>
	<td class="source"><code>   * but the actual sending time depends on the queue's workload and its state.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">715</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">716</td>
	<td class="source"><code>  scheduledEnqueueTimeUtc?: Date;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">717</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">718</td>
	<td class="source"><code>   * @property The lock token is a reference to the lock that is being held by the broker in</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">719</td>
	<td class="source"><code>   * `ReceiveMode.PeekLock` mode. Locks are used internally settle messages as explained in the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">720</td>
	<td class="source"><code>   * {@link https://docs.microsoft.com/azure/service-bus-messaging/message-transfers-locks-settlement product documentation in more detail}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">721</td>
	<td class="source"><code>   * - Not applicable when the message is received in `ReceiveMode.receiveAndDelete`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">722</td>
	<td class="source"><code>   * mode.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">723</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">724</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">725</td>
	<td class="source"><code>  readonly lockToken?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">726</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">727</td>
	<td class="source"><code>   * @property Number of deliveries that have been attempted for this message. The count is</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">728</td>
	<td class="source"><code>   * incremented when a message lock expires, or the message is explicitly abandoned using the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">729</td>
	<td class="source"><code>   * `abandon()` method on the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">730</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">731</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">732</td>
	<td class="source"><code>  readonly deliveryCount?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">733</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">734</td>
	<td class="source"><code>   * @property The UTC instant at which the message has been accepted and stored in Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">735</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">736</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">737</td>
	<td class="source"><code>  readonly enqueuedTimeUtc?: Date;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">738</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">739</td>
	<td class="source"><code>   * @property The UTC instant at which the message is marked for removal and no longer available for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">740</td>
	<td class="source"><code>   * retrieval from the entity due to expiration. This property is computed from 2 other properties</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">741</td>
	<td class="source"><code>   * on the message: `enqueuedTimeUtc` + `timeToLive`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">742</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">743</td>
	<td class="source"><code>  readonly expiresAtUtc?: Date;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">744</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">745</td>
	<td class="source"><code>   * @property The UTC instant until which the message is held locked in the queue/subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">746</td>
	<td class="source"><code>   * When the lock expires, the `deliveryCount` is incremented and the message is again available</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">747</td>
	<td class="source"><code>   * for retrieval.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">748</td>
	<td class="source"><code>   * - Not applicable when the message is received in `ReceiveMode.receiveAndDelete`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">749</td>
	<td class="source"><code>   * mode.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">750</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">751</td>
	<td class="source"><code>  lockedUntilUtc?: Date;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">752</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">753</td>
	<td class="source"><code>   * @property The original sequence number of the message. For</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">754</td>
	<td class="source"><code>   * messages that have been auto-forwarded, this property reflects the sequence number that had</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">755</td>
	<td class="source"><code>   * first been assigned to the message at its original point of submission.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">756</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">757</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">758</td>
	<td class="source"><code>  readonly enqueuedSequenceNumber?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">759</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">760</td>
	<td class="source"><code>   * @property The unique number assigned to a message by Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">761</td>
	<td class="source"><code>   * The sequence number is a unique 64-bit integer assigned to a message as it is accepted</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">762</td>
	<td class="source"><code>   * and stored by the broker and functions as its true identifier. For partitioned entities,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">763</td>
	<td class="source"><code>   * the topmost 16 bits reflect the partition identifier. Sequence numbers monotonically increase.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">764</td>
	<td class="source"><code>   * They roll over to 0 when the 48-64 bit range is exhausted.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">765</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">766</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">767</td>
	<td class="source"><code>  readonly sequenceNumber?: Long;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">768</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">769</td>
	<td class="source"><code>   * @property The name of the queue or subscription that this message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">770</td>
	<td class="source"><code>   * was enqueued on, before it was deadlettered. Only set in messages that have been dead-lettered</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">771</td>
	<td class="source"><code>   * and subsequently auto-forwarded from the dead-letter queue to another entity. Indicates the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">772</td>
	<td class="source"><code>   * entity in which the message was dead-lettered.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">773</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">774</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">775</td>
	<td class="source"><code>  readonly deadLetterSource?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">776</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">777</td>
	<td class="source"><code>   * The associated delivery of the received message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">778</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">779</td>
	<td class="source"><code>  readonly delivery: Delivery;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">780</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">781</td>
	<td class="source"><code>   * @property {AmqpMessage} _amqpMessage The underlying raw amqp message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">782</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">783</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">784</td>
	<td class="source"><code>  readonly _amqpMessage: AmqpMessage;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">785</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">786</td>
	<td class="source"><code>   * @property {ClientEntityContext} _context The client entity context.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">787</td>
	<td class="source"><code>   * @readonly</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">788</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">789</td>
	<td class="source"><code>  private readonly _context: ClientEntityContext;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">790</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">791</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">792</td>
	<td class="source"><code>   * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">793</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">794</td>
	<td class="source"><code>  constructor(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">795</td>
	<td class="source"><code>    context: ClientEntityContext,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">796</td>
	<td class="source"><code>    msg: AmqpMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">797</td>
	<td class="source"><code>    delivery: Delivery,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">798</td>
	<td class="source"><code>    shouldReorderLockToken: boolean</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">799</td>
	<td class="source"><code>  ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">800</td>
	<td class="source"><code>    Object.assign(this, fromAmqpMessage(msg, delivery, shouldReorderLockToken));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">801</td>
	<td class="source"><code>    this._context = context;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">802</td>
	<td class="source"><code>    if (msg.body) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">803</td>
	<td class="source"><code>      this.body = this._context.namespace.dataTransformer.decode(msg.body);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">804</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">805</td>
	<td class="source"><code>    this._amqpMessage = msg;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">806</td>
	<td class="source"><code>    this.delivery = delivery;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">807</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">808</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">809</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">810</td>
	<td class="source"><code>   * Removes the message from Service Bus.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">811</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">812</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">813</td>
	<td class="source"><code>  async complete(): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">814</td>
	<td class="source"><code>    log.message(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">815</td>
	<td class="source"><code>      "[%s] Completing the message with id '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">816</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">817</td>
	<td class="source"><code>      this.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">818</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">819</td>
	<td class="source"><code>    if (this._context.requestResponseLockedMessages.has(this.lockToken!)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">820</td>
	<td class="source"><code>      await this._context.managementClient!.updateDispositionStatus(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">821</td>
	<td class="source"><code>        this.lockToken!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">822</td>
	<td class="source"><code>        DispositionStatus.completed,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">823</td>
	<td class="source"><code>        {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">824</td>
	<td class="source"><code>          sessionId: this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">825</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">826</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">827</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">828</td>
	<td class="source"><code>      // Remove the message from the internal map of deferred messages</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">829</td>
	<td class="source"><code>      this._context.requestResponseLockedMessages.delete(this.lockToken!);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">830</td>
	<td class="source"><code>      return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">831</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">832</td>
	<td class="source"><code>    const receiver = this._context.getReceiver(this.delivery.link.name, this.sessionId);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">833</td>
	<td class="source"><code>    throwIfMessageCannotBeSettled(receiver, DispositionType.complete, this.delivery.remote_settled);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">834</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">835</td>
	<td class="source"><code>    return receiver!.settleMessage(this, DispositionType.complete);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">836</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">837</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">838</td>
	<td class="source"><code>   * The lock held on the message by the receiver is let go, making the message available again in</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">839</td>
	<td class="source"><code>   * Service Bus for another receive operation.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">840</td>
	<td class="source"><code>   * @param propertiesToModify The properties of the message to modify while abandoning the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">841</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">842</td>
	<td class="source"><code>   * @return Promise&#60;void&#62;.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">843</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">844</td>
	<td class="source"><code>  async abandon(propertiesToModify?: { [key: string]: any }): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">845</td>
	<td class="source"><code>    // TODO: Figure out a mechanism to convert specified properties to message_annotations.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">846</td>
	<td class="source"><code>    log.message(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">847</td>
	<td class="source"><code>      "[%s] Abandoning the message with id '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">848</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">849</td>
	<td class="source"><code>      this.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">850</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">851</td>
	<td class="source"><code>    if (this._context.requestResponseLockedMessages.has(this.lockToken!)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">852</td>
	<td class="source"><code>      await this._context.managementClient!.updateDispositionStatus(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">853</td>
	<td class="source"><code>        this.lockToken!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">854</td>
	<td class="source"><code>        DispositionStatus.abandoned,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">855</td>
	<td class="source"><code>        { propertiesToModify: propertiesToModify, sessionId: this.sessionId }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">856</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">857</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">858</td>
	<td class="source"><code>      // Remove the message from the internal map of deferred messages</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">859</td>
	<td class="source"><code>      this._context.requestResponseLockedMessages.delete(this.lockToken!);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">860</td>
	<td class="source"><code>      return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">861</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">862</td>
	<td class="source"><code>    const receiver = this._context.getReceiver(this.delivery.link.name, this.sessionId);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">863</td>
	<td class="source"><code>    throwIfMessageCannotBeSettled(receiver, DispositionType.abandon, this.delivery.remote_settled);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">864</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">865</td>
	<td class="source"><code>    return receiver!.settleMessage(this, DispositionType.abandon, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">866</td>
	<td class="source"><code>      propertiesToModify: propertiesToModify</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">867</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">868</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">869</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">870</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">871</td>
	<td class="source"><code>   * Defers the processing of the message. Save the `sequenceNumber` of the message, in order to</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">872</td>
	<td class="source"><code>   * receive it message again in the future using the `receiveDeferredMessage` method.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">873</td>
	<td class="source"><code>   * @param propertiesToModify The properties of the message to modify while deferring the message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">874</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">875</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">876</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">877</td>
	<td class="source"><code>  async defer(propertiesToModify?: { [key: string]: any }): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">878</td>
	<td class="source"><code>    log.message(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">879</td>
	<td class="source"><code>      "[%s] Deferring the message with id '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">880</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">881</td>
	<td class="source"><code>      this.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">882</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">883</td>
	<td class="source"><code>    if (this._context.requestResponseLockedMessages.has(this.lockToken!)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">884</td>
	<td class="source"><code>      await this._context.managementClient!.updateDispositionStatus(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">885</td>
	<td class="source"><code>        this.lockToken!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">886</td>
	<td class="source"><code>        DispositionStatus.defered,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">887</td>
	<td class="source"><code>        { propertiesToModify: propertiesToModify, sessionId: this.sessionId }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">888</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">889</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">890</td>
	<td class="source"><code>      // Remove the message from the internal map of deferred messages</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">891</td>
	<td class="source"><code>      this._context.requestResponseLockedMessages.delete(this.lockToken!);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">892</td>
	<td class="source"><code>      return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">893</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">894</td>
	<td class="source"><code>    const receiver = this._context.getReceiver(this.delivery.link.name, this.sessionId);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">895</td>
	<td class="source"><code>    throwIfMessageCannotBeSettled(receiver, DispositionType.defer, this.delivery.remote_settled);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">896</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">897</td>
	<td class="source"><code>    return receiver!.settleMessage(this, DispositionType.defer, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">898</td>
	<td class="source"><code>      propertiesToModify: propertiesToModify</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">899</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">900</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">901</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">902</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">903</td>
	<td class="source"><code>   * Moves the message to the deadletter sub-queue. To receive a deadletted message, create a new</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">904</td>
	<td class="source"><code>   * QueueClient/SubscriptionClient using the path for the deadletter sub-queue.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">905</td>
	<td class="source"><code>   * @param options The DeadLetter options that can be provided while</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">906</td>
	<td class="source"><code>   * rejecting the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">907</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">908</td>
	<td class="source"><code>   * @returns Promise&#60;void&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">909</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">910</td>
	<td class="source"><code>  async deadLetter(options?: DeadLetterOptions): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">911</td>
	<td class="source"><code>    const error: AmqpError = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">912</td>
	<td class="source"><code>      condition: Constants.deadLetterName</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">913</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">914</td>
	<td class="source"><code>    if (options) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">915</td>
	<td class="source"><code>      error.info = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">916</td>
	<td class="source"><code>        DeadLetterReason: options.deadletterReason,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">917</td>
	<td class="source"><code>        DeadLetterErrorDescription: options.deadLetterErrorDescription</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">918</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">919</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">920</td>
	<td class="source"><code>    log.message(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">921</td>
	<td class="source"><code>      "[%s] Deadlettering the message with id '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">922</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">923</td>
	<td class="source"><code>      this.messageId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">924</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">925</td>
	<td class="source"><code>    if (this._context.requestResponseLockedMessages.has(this.lockToken!)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">926</td>
	<td class="source"><code>      await this._context.managementClient!.updateDispositionStatus(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">927</td>
	<td class="source"><code>        this.lockToken!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">928</td>
	<td class="source"><code>        DispositionStatus.suspended,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">929</td>
	<td class="source"><code>        {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">930</td>
	<td class="source"><code>          deadLetterReason: error.condition,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">931</td>
	<td class="source"><code>          deadLetterDescription: error.description,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">932</td>
	<td class="source"><code>          sessionId: this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">933</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">934</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">935</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">936</td>
	<td class="source"><code>      // Remove the message from the internal map of deferred messages</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">937</td>
	<td class="source"><code>      this._context.requestResponseLockedMessages.delete(this.lockToken!);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">938</td>
	<td class="source"><code>      return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">939</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">940</td>
	<td class="source"><code>    const receiver = this._context.getReceiver(this.delivery.link.name, this.sessionId);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">941</td>
	<td class="source"><code>    throwIfMessageCannotBeSettled(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">942</td>
	<td class="source"><code>      receiver,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">943</td>
	<td class="source"><code>      DispositionType.deadletter,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">944</td>
	<td class="source"><code>      this.delivery.remote_settled</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">945</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">946</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">947</td>
	<td class="source"><code>    return receiver!.settleMessage(this, DispositionType.deadletter, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">948</td>
	<td class="source"><code>      error: error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">949</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">950</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">951</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">952</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">953</td>
	<td class="source"><code>   * Creates a clone of the current message to allow it to be re-sent to the queue</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">954</td>
	<td class="source"><code>   * @returns ServiceBusMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">955</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">956</td>
	<td class="source"><code>  clone(): SendableMessageInfo {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">957</td>
	<td class="source"><code>    // We are returning a SendableMessageInfo object because that object can then be sent to Service Bus</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">958</td>
	<td class="source"><code>    const clone: SendableMessageInfo = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">959</td>
	<td class="source"><code>      body: this.body,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">960</td>
	<td class="source"><code>      contentType: this.contentType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">961</td>
	<td class="source"><code>      correlationId: this.correlationId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">962</td>
	<td class="source"><code>      label: this.label,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">963</td>
	<td class="source"><code>      messageId: this.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">964</td>
	<td class="source"><code>      partitionKey: this.partitionKey,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">965</td>
	<td class="source"><code>      replyTo: this.replyTo,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">966</td>
	<td class="source"><code>      replyToSessionId: this.replyToSessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">967</td>
	<td class="source"><code>      scheduledEnqueueTimeUtc: this.scheduledEnqueueTimeUtc,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">968</td>
	<td class="source"><code>      sessionId: this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">969</td>
	<td class="source"><code>      timeToLive: this.timeToLive,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">970</td>
	<td class="source"><code>      to: this.to,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">971</td>
	<td class="source"><code>      userProperties: this.userProperties,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">972</td>
	<td class="source"><code>      viaPartitionKey: this.viaPartitionKey</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">973</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">974</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">975</td>
	<td class="source"><code>    return clone;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">976</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">977</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">978</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">979</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">980</td>
	<td class="source"><code> * Logs and Throws an error if the given message cannot be settled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">981</td>
	<td class="source"><code> * @param receiver Receiver to be used to settle this message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">982</td>
	<td class="source"><code> * @param operation Settle operation: complete, abandon, defer or deadLetter</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">983</td>
	<td class="source"><code> * @param isRemoteSettled Boolean indicating if the message has been settled at the remote</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">984</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">985</td>
	<td class="source"><code>export function throwIfMessageCannotBeSettled(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">986</td>
	<td class="source"><code>  receiver: MessageReceiver | MessageSession | undefined,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">987</td>
	<td class="source"><code>  operation: DispositionType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">988</td>
	<td class="source"><code>  isRemoteSettled: boolean</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">989</td>
	<td class="source"><code>): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">990</td>
	<td class="source"><code>  let errorMessage;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">991</td>
	<td class="source"><code>  if (!receiver || !receiver.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">992</td>
	<td class="source"><code>    errorMessage = `Failed to ${operation} the message as it's receiver has been closed.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">993</td>
	<td class="source"><code>  } else if (receiver.receiveMode !== ReceiveMode.peekLock) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">994</td>
	<td class="source"><code>    errorMessage = getErrorMessageNotSupportedInReceiveAndDeleteMode(`${operation} the message`);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">995</td>
	<td class="source"><code>  } else if (isRemoteSettled) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">996</td>
	<td class="source"><code>    errorMessage = `Failed to ${operation} the message as this message has been already settled.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">997</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">998</td>
	<td class="source"><code>  if (!errorMessage) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">999</td>
	<td class="source"><code>    return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1000</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1001</td>
	<td class="source"><code>  const error = new Error(errorMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1002</td>
	<td class="source"><code>  if (receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1003</td>
	<td class="source"><code>    log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1004</td>
	<td class="source"><code>      "An error occured when settling a message using the receiver %s: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1005</td>
	<td class="source"><code>      receiver.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1006</td>
	<td class="source"><code>      error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1007</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1008</td>
	<td class="source"><code>  } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1009</td>
	<td class="source"><code>    log.error("An error occured when settling a message: %O", error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1010</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1011</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1012</td>
	<td class="source"><code>  throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1013</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1014</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcSessionMessageSessionTs" class="lint-result bg-error" data-group="f-16" data-problem-count="7" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\session\messageSession.ts
    </th>
    <th class="result-summary">
      7 problems (7 errors, 0 warnings)
    </th>
</tr>
<tr class="f-16 hidden">
	<td colspan="5">
		<ul class="nav-tabs" role="tablist">
			<li role="presentation" class="active">
				<button data-parent=".f-16"
								data-content="detailSummary-16"
								aria-controls="detailSummary-16"
								type="button"
								role="tab">
					Summary
				</button>
			</li>
			<li role="presentation">
				<button data-parent=".f-16"
								data-content="sourceCode-16"
								aria-controls="sourceCode-16"
								type="button"
								role="tab">
					SourceCode
				</button>
			</li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane" id="detailSummary-16">
				<div class="row"></div>
<div class="row">
	<h3 class="page-header">All Rules</h3>
	<table class="summary-table">
		<thead>
			<tr>
				<th>Severity</th>
				<th>Rule</th>
			</tr>
		</thead>
		<tbody>
			<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 724, Column 11: "'onReceiveMessage' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 725, Column 11: "'onReceiveDrain' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 820, Column 7: "'actionAfterWaitTimeout' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 975, Column 3: "Member _deleteFromCache should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 989, Column 3: "Member _init should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1097, Column 3: "Member _createMessageSessionOptions should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1130, Column 3: "Member _ensureSessionLockRenewal should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr>
		</tbody>
	</table>
</div>
			</div>
			<div role="tabpanel" class="tab-pane hidden" id="sourceCode-16">
				<table class="source-code">
	<thead>
		<tr>
			<th>Line</th>
			<th>Source</th>
		</tr>
	</thead>
	<tbody>
		<tr class="hit bg-success">
	<td class="line">1</td>
	<td class="source"><code>// Copyright (c) Microsoft Corporation. All rights reserved.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">2</td>
	<td class="source"><code>// Licensed under the MIT License.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">3</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">4</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">5</td>
	<td class="source"><code>  translate,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">6</td>
	<td class="source"><code>  Constants,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">7</td>
	<td class="source"><code>  ErrorNameConditionMapper,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">8</td>
	<td class="source"><code>  MessagingError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">9</td>
	<td class="source"><code>  Func</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">10</td>
	<td class="source"><code>} from "@azure/amqp-common";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">11</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">12</td>
	<td class="source"><code>  Receiver,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">13</td>
	<td class="source"><code>  OnAmqpEvent,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">14</td>
	<td class="source"><code>  EventContext,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">15</td>
	<td class="source"><code>  ReceiverOptions,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">16</td>
	<td class="source"><code>  ReceiverEvents,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">17</td>
	<td class="source"><code>  isAmqpError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">18</td>
	<td class="source"><code>} from "rhea-promise";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">19</td>
	<td class="source"><code>import * as log from "../log";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">20</td>
	<td class="source"><code>import {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">21</td>
	<td class="source"><code>  OnError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">22</td>
	<td class="source"><code>  OnAmqpEventAsPromise,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">23</td>
	<td class="source"><code>  PromiseLike,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">24</td>
	<td class="source"><code>  DispositionOptions,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">25</td>
	<td class="source"><code>  OnMessage</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">26</td>
	<td class="source"><code>} from "../core/messageReceiver";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">27</td>
	<td class="source"><code>import { LinkEntity } from "../core/linkEntity";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">28</td>
	<td class="source"><code>import { ClientEntityContext } from "../clientEntityContext";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">29</td>
	<td class="source"><code>import { convertTicksToDate, calculateRenewAfterDuration } from "../util/utils";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">30</td>
	<td class="source"><code>import { throwErrorIfConnectionClosed } from "../util/errors";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">31</td>
	<td class="source"><code>import { ServiceBusMessage, DispositionType, ReceiveMode } from "../serviceBusMessage";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">32</td>
	<td class="source"><code>import { messageDispositionTimeout } from "../util/constants";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">33</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">34</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">35</td>
	<td class="source"><code> * Enum to denote who is calling the session receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">36</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">37</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">38</td>
	<td class="source"><code>export enum SessionCallee {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">39</td>
	<td class="source"><code>  standalone = "standalone",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">40</td>
	<td class="source"><code>  sessionManager = "sessionManager"</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">41</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">42</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">43</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">44</td>
	<td class="source"><code> * Describes the options that need to be provided while creating a message session receiver link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">45</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">46</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">47</td>
	<td class="source"><code>export interface CreateMessageSessionReceiverLinkOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">48</td>
	<td class="source"><code>  onClose: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">49</td>
	<td class="source"><code>  onSessionClose: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">50</td>
	<td class="source"><code>  onError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">51</td>
	<td class="source"><code>  onSessionError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">52</td>
	<td class="source"><code>  onSettled: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">53</td>
	<td class="source"><code>  sessionId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">54</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">55</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">56</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">57</td>
	<td class="source"><code> * Describes the options passed to the `createReceiver` method when using a Queue/Subscription that</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">58</td>
	<td class="source"><code> * has sessions enabled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">59</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">60</td>
	<td class="source"><code>export interface SessionReceiverOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">61</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">62</td>
	<td class="source"><code>   * @property The id of the session from which messages need to be received. If null or undefined is</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">63</td>
	<td class="source"><code>   * provided, Service Bus chooses a random session from available sessions.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">64</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">65</td>
	<td class="source"><code>  sessionId: string | undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">66</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">67</td>
	<td class="source"><code>   * @property The maximum duration in seconds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">68</td>
	<td class="source"><code>   * until which, the lock on the session will be renewed automatically by the sdk.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">69</td>
	<td class="source"><code>   * - **Default**: `300` seconds (5 minutes).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">70</td>
	<td class="source"><code>   * - **To disable autolock renewal**, set this to `0`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">71</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">72</td>
	<td class="source"><code>  maxSessionAutoRenewLockDurationInSeconds?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">73</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">74</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">75</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">76</td>
	<td class="source"><code> * Describes the options passed to `registerMessageHandler` method when receiving messages from a</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">77</td>
	<td class="source"><code> * Queue/Subscription which has sessions enabled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">78</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">79</td>
	<td class="source"><code>export interface SessionMessageHandlerOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">80</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">81</td>
	<td class="source"><code>   * @property Indicates whether the `complete()` method on the message should automatically be</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">82</td>
	<td class="source"><code>   * called by the sdk after the user provided onMessage handler has been executed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">83</td>
	<td class="source"><code>   * Calling `complete()` on a message removes it from the Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">84</td>
	<td class="source"><code>   * - **Default**: `true`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">85</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">86</td>
	<td class="source"><code>  autoComplete?: boolean;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">87</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">88</td>
	<td class="source"><code>   * @property The maximum number of concurrent calls that the library</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">89</td>
	<td class="source"><code>   * can make to the user's message handler. Once this limit has been reached, more messages will</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">90</td>
	<td class="source"><code>   * not be received until atleast one of the calls to the user's message handler has completed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">91</td>
	<td class="source"><code>   * - **Default**: `1`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">92</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">93</td>
	<td class="source"><code>  maxConcurrentCalls?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">94</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">95</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">96</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">97</td>
	<td class="source"><code> * Describes the options for creating a Session Manager.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">98</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">99</td>
	<td class="source"><code>export interface SessionManagerOptions extends SessionMessageHandlerOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">100</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">101</td>
	<td class="source"><code>   * @property {number} [maxConcurrentSessions] The maximum number of sessions that the user wants to</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">102</td>
	<td class="source"><code>   * handle concurrently.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">103</td>
	<td class="source"><code>   * - **Default**: `2000`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">104</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">105</td>
	<td class="source"><code>  maxConcurrentSessions?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">106</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">107</td>
	<td class="source"><code>   * @property The maximum amount of time the receiver will wait to receive a new message. If no new</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">108</td>
	<td class="source"><code>   * message is received in this time, then the receiver will be closed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">109</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">110</td>
	<td class="source"><code>   * If this option is not provided, then receiver link will stay open until manually closed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">111</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">112</td>
	<td class="source"><code>   * **Caution**: When setting this value, take into account the time taken to process messages. Once</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">113</td>
	<td class="source"><code>   * the receiver is closed, operations like complete()/abandon()/defer()/deadletter() cannot be</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">114</td>
	<td class="source"><code>   * invoked on messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">115</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">116</td>
	<td class="source"><code>  newMessageWaitTimeoutInSeconds?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">117</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">118</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">119</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">120</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">121</td>
	<td class="source"><code> * Describes all the options that can be set while instantiating a MessageSession object.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">122</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">123</td>
	<td class="source"><code>export type MessageSessionOptions = SessionManagerOptions &</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">124</td>
	<td class="source"><code>  SessionReceiverOptions & {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">125</td>
	<td class="source"><code>    callee?: SessionCallee;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">126</td>
	<td class="source"><code>    receiveMode?: ReceiveMode;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">127</td>
	<td class="source"><code>  };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">128</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">129</td>
	<td class="source"><code>/**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">130</td>
	<td class="source"><code> * @internal</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">131</td>
	<td class="source"><code> * Describes the receiver for a Message Session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">132</td>
	<td class="source"><code> */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">133</td>
	<td class="source"><code>export class MessageSession extends LinkEntity {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">134</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">135</td>
	<td class="source"><code>   * @property {Date} [sessionLockedUntilUtc] Provides the duration until which the session is locked.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">136</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">137</td>
	<td class="source"><code>  sessionLockedUntilUtc?: Date;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">138</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">139</td>
	<td class="source"><code>   * @property {string} [sessionId] The sessionId for the message session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">140</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">141</td>
	<td class="source"><code>  sessionId?: string;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">142</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">143</td>
	<td class="source"><code>   * @property {number} [maxConcurrentSessions] The maximum number of concurrent sessions that the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">144</td>
	<td class="source"><code>   * client should initate.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">145</td>
	<td class="source"><code>   * - **Default**: `1`.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">146</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">147</td>
	<td class="source"><code>  maxConcurrentSessions?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">148</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">149</td>
	<td class="source"><code>   * @property {number} [maxConcurrentCalls] The maximum number of messages that should be</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">150</td>
	<td class="source"><code>   * processed concurrently in a session while in streaming mode. Once this limit has been reached,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">151</td>
	<td class="source"><code>   * more messages will not be received until the user's message handler has completed processing current message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">152</td>
	<td class="source"><code>   * - **Default**: `1` (message in a session at a time).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">153</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">154</td>
	<td class="source"><code>  maxConcurrentCalls: number = 1;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">155</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">156</td>
	<td class="source"><code>   * @property {number} [receiveMode] The mode in which messages should be received.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">157</td>
	<td class="source"><code>   * Default: ReceiveMode.peekLock</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">158</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">159</td>
	<td class="source"><code>  receiveMode: ReceiveMode;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">160</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">161</td>
	<td class="source"><code>   * @property {boolean} autoComplete Indicates whether `Message.complete()` should be called</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">162</td>
	<td class="source"><code>   * automatically after the message processing is complete while receiving messages with handlers.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">163</td>
	<td class="source"><code>   * Default: false.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">164</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">165</td>
	<td class="source"><code>  autoComplete: boolean;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">166</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">167</td>
	<td class="source"><code>   * @property {number} maxAutoRenewDurationInSeconds The maximum duration within which the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">168</td>
	<td class="source"><code>   * lock will be renewed automatically. This value should be greater than the longest message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">169</td>
	<td class="source"><code>   * lock duration; for example, the `lockDuration` property on the received message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">170</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">171</td>
	<td class="source"><code>   * Default: `300` (5 minutes);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">172</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">173</td>
	<td class="source"><code>  maxAutoRenewDurationInSeconds: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">174</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">175</td>
	<td class="source"><code>   * @property {number} [newMessageWaitTimeoutInSeconds] The maximum amount of idle time the session</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">176</td>
	<td class="source"><code>   * reaceiver will wait ater a message has been received. If no messages are received in that</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">177</td>
	<td class="source"><code>   * time frame then the session will be closed.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">178</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">179</td>
	<td class="source"><code>  newMessageWaitTimeoutInSeconds?: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">180</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">181</td>
	<td class="source"><code>   * @property {boolean} autoRenewLock Should lock renewal happen automatically.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">182</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">183</td>
	<td class="source"><code>  autoRenewLock: boolean;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">184</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">185</td>
	<td class="source"><code>   * @property {SessionCallee} callee Describes who instantied the MessageSession. Whether it was</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">186</td>
	<td class="source"><code>   * called by the SessionManager or it was called standalone.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">187</td>
	<td class="source"><code>   * - Default: "standalone"</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">188</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">189</td>
	<td class="source"><code>  callee: SessionCallee;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">190</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">191</td>
	<td class="source"><code>   * Denotes if we are currently receiving messages</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">192</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">193</td>
	<td class="source"><code>  isReceivingMessages: boolean;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">194</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">195</td>
	<td class="source"><code>   * @property {Receiver} [_receiver] The AMQP receiver link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">196</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">197</td>
	<td class="source"><code>  private _receiver?: Receiver;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">198</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">199</td>
	<td class="source"><code>   * @property {Map&#60;number, Promise&#60;any&#62;&#62;} _deliveryDispositionMap Maintains a map of deliveries that</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">200</td>
	<td class="source"><code>   * are being actively disposed. It acts as a store for correlating the responses received for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">201</td>
	<td class="source"><code>   * active dispositions.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">202</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">203</td>
	<td class="source"><code>  private _deliveryDispositionMap: Map&#60;number, PromiseLike&#62; = new Map&#60;number, PromiseLike&#62;();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">204</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">205</td>
	<td class="source"><code>   * @property {OnMessage} _onMessage The message handler provided by the user that will</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">206</td>
	<td class="source"><code>   * be wrapped inside _onAmqpMessage.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">207</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">208</td>
	<td class="source"><code>  private _onMessage!: OnMessage;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">209</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">210</td>
	<td class="source"><code>   * @property {OnError} _onError The error handler provided by the user that will be wrapped</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">211</td>
	<td class="source"><code>   * inside _onAmqpError.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">212</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">213</td>
	<td class="source"><code>  private _onError?: OnError;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">214</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">215</td>
	<td class="source"><code>   * @property {OnError} _notifyError If the user provided error handler is present then it will</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">216</td>
	<td class="source"><code>   * notify the user's error handler about the error.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">217</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">218</td>
	<td class="source"><code>  private _notifyError: OnError;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">219</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">220</td>
	<td class="source"><code>   * @property {OnAmqpEventAsPromise} _onAmqpClose The message handler that will be set as the handler on the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">221</td>
	<td class="source"><code>   * underlying rhea receiver for the "receiver_close" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">222</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">223</td>
	<td class="source"><code>  private _onAmqpClose: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">224</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">225</td>
	<td class="source"><code>   * @property {OnAmqpEvent} _onSessionError The message handler that will be set as the handler on</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">226</td>
	<td class="source"><code>   * the underlying rhea receiver's session for the "session_error" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">227</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">228</td>
	<td class="source"><code>  private _onSessionError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">229</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">230</td>
	<td class="source"><code>   * @property {OnAmqpEventAsPromise} _onSessionClose The message handler that will be set as the handler on</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">231</td>
	<td class="source"><code>   * the underlying rhea receiver's session for the "session_close" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">232</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">233</td>
	<td class="source"><code>  private _onSessionClose: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">234</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">235</td>
	<td class="source"><code>   * @property {OnAmqpEvent} _onAmqpError The message handler that will be set as the handler on the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">236</td>
	<td class="source"><code>   * underlying rhea receiver for the "receiver_error" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">237</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">238</td>
	<td class="source"><code>  private _onAmqpError: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">239</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">240</td>
	<td class="source"><code>   * @property {OnAmqpEvent} _onSettled The message handler that will be set as the handler on the</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">241</td>
	<td class="source"><code>   * underlying rhea receiver for the "settled" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">242</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">243</td>
	<td class="source"><code>  private _onSettled: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">244</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">245</td>
	<td class="source"><code>   * @property {NodeJS.Timer} _sessionLockRenewalTimer The session lock renewal timer that keeps</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">246</td>
	<td class="source"><code>   * track of when the MessageSession is due for session lock renewal.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">247</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">248</td>
	<td class="source"><code>  private _sessionLockRenewalTimer?: NodeJS.Timer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">249</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">250</td>
	<td class="source"><code>   * @property {NodeJS.Timer} _newMessageReceivedTimer The new message received timer that keeps</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">251</td>
	<td class="source"><code>   * track of closing the MessageSession if no message was received in the configured</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">252</td>
	<td class="source"><code>   * `newMessageWaitTimeoutInSeconds` seconds.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">253</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">254</td>
	<td class="source"><code>  private _newMessageReceivedTimer?: NodeJS.Timer;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">255</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">256</td>
	<td class="source"><code>  private _totalAutoLockRenewDuration: number;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">257</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">258</td>
	<td class="source"><code>  constructor(context: ClientEntityContext, options?: MessageSessionOptions) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">259</td>
	<td class="source"><code>    super(context.entityPath, context, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">260</td>
	<td class="source"><code>      address: context.entityPath,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">261</td>
	<td class="source"><code>      audience: `${context.namespace.config.endpoint}${context.entityPath}`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">262</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">263</td>
	<td class="source"><code>    this._context.isSessionEnabled = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">264</td>
	<td class="source"><code>    this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">265</td>
	<td class="source"><code>    if (!options) options = { sessionId: undefined };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">266</td>
	<td class="source"><code>    this.autoComplete = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">267</td>
	<td class="source"><code>    this.sessionId = options.sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">268</td>
	<td class="source"><code>    this.receiveMode = options.receiveMode || ReceiveMode.peekLock;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">269</td>
	<td class="source"><code>    this.callee = options.callee || SessionCallee.standalone;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">270</td>
	<td class="source"><code>    this.maxAutoRenewDurationInSeconds =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">271</td>
	<td class="source"><code>      options.maxSessionAutoRenewLockDurationInSeconds != null</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">272</td>
	<td class="source"><code>        ? options.maxSessionAutoRenewLockDurationInSeconds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">273</td>
	<td class="source"><code>        : 300;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">274</td>
	<td class="source"><code>    this._totalAutoLockRenewDuration = Date.now() + this.maxAutoRenewDurationInSeconds * 1000;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">275</td>
	<td class="source"><code>    this.autoRenewLock =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">276</td>
	<td class="source"><code>      this.maxAutoRenewDurationInSeconds &#62; 0 && this.receiveMode === ReceiveMode.peekLock;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">277</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">278</td>
	<td class="source"><code>    // setting all the handlers</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">279</td>
	<td class="source"><code>    this._onSettled = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">280</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">281</td>
	<td class="source"><code>      const delivery = context.delivery;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">282</td>
	<td class="source"><code>      if (delivery) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">283</td>
	<td class="source"><code>        const id = delivery.id;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">284</td>
	<td class="source"><code>        const state = delivery.remote_state;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">285</td>
	<td class="source"><code>        const settled = delivery.remote_settled;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">286</td>
	<td class="source"><code>        log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">287</td>
	<td class="source"><code>          "[%s] Delivery with id %d, remote_settled: %s, remote_state: %o has been " + "received.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">288</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">289</td>
	<td class="source"><code>          id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">290</td>
	<td class="source"><code>          settled,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">291</td>
	<td class="source"><code>          state && state.error ? state.error : state</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">292</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">293</td>
	<td class="source"><code>        if (settled && this._deliveryDispositionMap.has(id)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">294</td>
	<td class="source"><code>          const promise = this._deliveryDispositionMap.get(id) as PromiseLike;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">295</td>
	<td class="source"><code>          clearTimeout(promise.timer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">296</td>
	<td class="source"><code>          log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">297</td>
	<td class="source"><code>            "[%s] Found the delivery with id %d in the map and cleared the timer.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">298</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">299</td>
	<td class="source"><code>            id</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">300</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">301</td>
	<td class="source"><code>          const deleteResult = this._deliveryDispositionMap.delete(id);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">302</td>
	<td class="source"><code>          log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">303</td>
	<td class="source"><code>            "[%s] Successfully deleted the delivery with id %d from the map.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">304</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">305</td>
	<td class="source"><code>            id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">306</td>
	<td class="source"><code>            deleteResult</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">307</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">308</td>
	<td class="source"><code>          if (state && state.error && (state.error.condition || state.error.description)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">309</td>
	<td class="source"><code>            const error = translate(state.error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">310</td>
	<td class="source"><code>            return promise.reject(error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">311</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">312</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">313</td>
	<td class="source"><code>          return promise.resolve();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">314</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">315</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">316</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">317</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">318</td>
	<td class="source"><code>    this._notifyError = (error: MessagingError | Error) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">319</td>
	<td class="source"><code>      if (this._onError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">320</td>
	<td class="source"><code>        this._onError(error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">321</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">322</td>
	<td class="source"><code>          "[%s] Notified the user's error handler about the error received by the " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">323</td>
	<td class="source"><code>            "Receiver '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">324</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">325</td>
	<td class="source"><code>          this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">326</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">327</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">328</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">329</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">330</td>
	<td class="source"><code>    this._onAmqpError = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">331</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">332</td>
	<td class="source"><code>      const receiverError = context.receiver && context.receiver.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">333</td>
	<td class="source"><code>      if (receiverError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">334</td>
	<td class="source"><code>        const sbError = translate(receiverError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">335</td>
	<td class="source"><code>        if (sbError.name === "SessionLockLostError") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">336</td>
	<td class="source"><code>          this._context.expiredMessageSessions[this.sessionId!] = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">337</td>
	<td class="source"><code>          sbError.message = `The session lock has expired on the session with id ${</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">338</td>
	<td class="source"><code>            this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">339</td>
	<td class="source"><code>          }.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">340</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">341</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">342</td>
	<td class="source"><code>          "[%s] An error occurred for Receiver '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">343</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">344</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">345</td>
	<td class="source"><code>          sbError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">346</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">347</td>
	<td class="source"><code>        this._notifyError(sbError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">348</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">349</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">350</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">351</td>
	<td class="source"><code>    this._onSessionError = (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">352</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">353</td>
	<td class="source"><code>      const sessionError = context.session && context.session.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">354</td>
	<td class="source"><code>      if (sessionError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">355</td>
	<td class="source"><code>        const sbError = translate(sessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">356</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">357</td>
	<td class="source"><code>          "[%s] An error occurred on the session for Receiver '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">358</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">359</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">360</td>
	<td class="source"><code>          sbError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">361</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">362</td>
	<td class="source"><code>        this._notifyError(sbError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">363</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">364</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">365</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">366</td>
	<td class="source"><code>    this._onAmqpClose = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">367</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">368</td>
	<td class="source"><code>      const receiverError = context.receiver && context.receiver.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">369</td>
	<td class="source"><code>      const receiver = this._receiver || context.receiver!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">370</td>
	<td class="source"><code>      let isClosedDueToExpiry = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">371</td>
	<td class="source"><code>      if (receiverError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">372</td>
	<td class="source"><code>        const sbError = translate(receiverError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">373</td>
	<td class="source"><code>        if (sbError.name === "SessionLockLostError") {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">374</td>
	<td class="source"><code>          isClosedDueToExpiry = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">375</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">376</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">377</td>
	<td class="source"><code>          "[%s] 'receiver_close' event occurred for receiver '%s' for sessionId '%s'. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">378</td>
	<td class="source"><code>            "The associated error is: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">379</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">380</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">381</td>
	<td class="source"><code>          this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">382</td>
	<td class="source"><code>          sbError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">383</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">384</td>
	<td class="source"><code>        // no need to notify the user's error handler since rhea guarantees that receiver_error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">385</td>
	<td class="source"><code>        // will always be emitted before receiver_close.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">386</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">387</td>
	<td class="source"><code>      if (receiver && !receiver.isItselfClosed()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">388</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">389</td>
	<td class="source"><code>          "[%s] 'receiver_close' event occurred on the receiver '%s' for sessionId '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">390</td>
	<td class="source"><code>            "and the sdk did not initiate this. Hence, let's gracefully close the receiver.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">391</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">392</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">393</td>
	<td class="source"><code>          this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">394</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">395</td>
	<td class="source"><code>        try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">396</td>
	<td class="source"><code>          await this.close(isClosedDueToExpiry);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">397</td>
	<td class="source"><code>        } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">398</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">399</td>
	<td class="source"><code>            "[%s] An error occurred while closing the receiver '%s' for sessionId '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">400</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">401</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">402</td>
	<td class="source"><code>            this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">403</td>
	<td class="source"><code>            err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">404</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">405</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">406</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">407</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">408</td>
	<td class="source"><code>          "[%s] 'receiver_close' event occurred on the receiver '%s' for sessionId '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">409</td>
	<td class="source"><code>            "because the sdk initiated it. Hence no need to gracefully close the receiver",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">410</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">411</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">412</td>
	<td class="source"><code>          this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">413</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">414</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">415</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">416</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">417</td>
	<td class="source"><code>    this._onSessionClose = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">418</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">419</td>
	<td class="source"><code>      const receiver = this._receiver || context.receiver!;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">420</td>
	<td class="source"><code>      const sessionError = context.session && context.session.error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">421</td>
	<td class="source"><code>      if (sessionError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">422</td>
	<td class="source"><code>        const sbError = translate(sessionError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">423</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">424</td>
	<td class="source"><code>          "[%s] 'session_close' event occurred for receiver '%s' for sessionId '%s'. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">425</td>
	<td class="source"><code>            "The associated error is: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">426</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">427</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">428</td>
	<td class="source"><code>          this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">429</td>
	<td class="source"><code>          sbError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">430</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">431</td>
	<td class="source"><code>        // no need to notify the user's error handler since rhea guarantees that session_error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">432</td>
	<td class="source"><code>        // will always be emitted before session_close.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">433</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">434</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">435</td>
	<td class="source"><code>      if (receiver && !receiver.isSessionItselfClosed()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">436</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">437</td>
	<td class="source"><code>          "[%s] 'session_close' event occurred on the receiver '%s' for sessionId '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">438</td>
	<td class="source"><code>            "and the sdk did not initiate this. Hence, let's gracefully close the receiver.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">439</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">440</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">441</td>
	<td class="source"><code>          this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">442</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">443</td>
	<td class="source"><code>        try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">444</td>
	<td class="source"><code>          await this.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">445</td>
	<td class="source"><code>        } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">446</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">447</td>
	<td class="source"><code>            "[%s] An error occurred while closing the receiver '%s' for sessionId '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">448</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">449</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">450</td>
	<td class="source"><code>            this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">451</td>
	<td class="source"><code>            err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">452</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">453</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">454</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">455</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">456</td>
	<td class="source"><code>          "[%s] 'session_close' event occurred on the receiver '%s' for sessionId '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">457</td>
	<td class="source"><code>            "because the sdk initiated it. Hence no need to gracefully close the receiver",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">458</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">459</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">460</td>
	<td class="source"><code>          this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">461</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">462</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">463</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">464</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">465</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">466</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">467</td>
	<td class="source"><code>   * Closes the underlying AMQP receiver link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">468</td>
	<td class="source"><code>   * @param isClosedDueToExpiry Flag that denotes if close is invoked due to session expiring.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">469</td>
	<td class="source"><code>   * This is so that the internal map of expired sessions doesn't get cleared when session is</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">470</td>
	<td class="source"><code>   * closed due to expiry.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">471</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">472</td>
	<td class="source"><code>  async close(isClosedDueToExpiry?: boolean): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">473</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">474</td>
	<td class="source"><code>      log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">475</td>
	<td class="source"><code>        "[%s] Closing the MessageSession '%s' for queue '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">476</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">477</td>
	<td class="source"><code>        this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">478</td>
	<td class="source"><code>        this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">479</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">480</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">481</td>
	<td class="source"><code>      this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">482</td>
	<td class="source"><code>      if (this._newMessageReceivedTimer) clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">483</td>
	<td class="source"><code>      if (this._sessionLockRenewalTimer) clearTimeout(this._sessionLockRenewalTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">484</td>
	<td class="source"><code>      log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">485</td>
	<td class="source"><code>        "[%s] Cleared the timers for 'no new message received' task and " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">486</td>
	<td class="source"><code>          "'session lock renewal' task.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">487</td>
	<td class="source"><code>        this._context.namespace.connectionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">488</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">489</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">490</td>
	<td class="source"><code>      if (!isClosedDueToExpiry) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">491</td>
	<td class="source"><code>        delete this._context.expiredMessageSessions[this.sessionId!];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">492</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">493</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">494</td>
	<td class="source"><code>      if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">495</td>
	<td class="source"><code>        const receiverLink = this._receiver;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">496</td>
	<td class="source"><code>        this._deleteFromCache();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">497</td>
	<td class="source"><code>        await this._closeLink(receiverLink);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">498</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">499</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">500</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">501</td>
	<td class="source"><code>        "[%s] An error occurred while closing the message session with id '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">502</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">503</td>
	<td class="source"><code>        this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">504</td>
	<td class="source"><code>        err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">505</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">506</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">507</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">508</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">509</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">510</td>
	<td class="source"><code>   * Determines whether the AMQP receiver link is open. If open then returns true else returns false.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">511</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">512</td>
	<td class="source"><code>  isOpen(): boolean {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">513</td>
	<td class="source"><code>    const result: boolean = this._receiver! && this._receiver!.isOpen();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">514</td>
	<td class="source"><code>    log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">515</td>
	<td class="source"><code>      "[%s] Receiver '%s' for sessionId '%s' is open? -&#62; %s",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">516</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">517</td>
	<td class="source"><code>      this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">518</td>
	<td class="source"><code>      this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">519</td>
	<td class="source"><code>      result</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">520</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">521</td>
	<td class="source"><code>    return result;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">522</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">523</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">524</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">525</td>
	<td class="source"><code>   * Registers handlers to deal with the incoming stream of messages over an AMQP receiver link</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">526</td>
	<td class="source"><code>   * from a Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">527</td>
	<td class="source"><code>   * To stop receiving messages, call `close()` on the SessionReceiver or set the property</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">528</td>
	<td class="source"><code>   * `newMessageWaitTimeoutInSeconds` in the options to provide a timeout.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">529</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">530</td>
	<td class="source"><code>   * @param onMessage - Handler for processing each incoming message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">531</td>
	<td class="source"><code>   * @param onError - Handler for any error that occurs while receiving or processing messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">532</td>
	<td class="source"><code>   * @param options - Options to control whether messages should be automatically completed. You can</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">533</td>
	<td class="source"><code>   * also provide a timeout in seconds to denote the amount of time to wait for a new message</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">534</td>
	<td class="source"><code>   * before closing the receiver.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">535</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">536</td>
	<td class="source"><code>   * @returns void</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">537</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">538</td>
	<td class="source"><code>  receive(onMessage: OnMessage, onError: OnError, options?: SessionMessageHandlerOptions): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">539</td>
	<td class="source"><code>    if (!options) options = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">540</td>
	<td class="source"><code>    this.isReceivingMessages = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">541</td>
	<td class="source"><code>    if (typeof options.maxConcurrentCalls === "number" && options.maxConcurrentCalls &#62; 0) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">542</td>
	<td class="source"><code>      this.maxConcurrentCalls = options.maxConcurrentCalls;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">543</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">544</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">545</td>
	<td class="source"><code>    // If explicitly set to false then autoComplete is false else true (default).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">546</td>
	<td class="source"><code>    this.autoComplete = options.autoComplete === false ? options.autoComplete : true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">547</td>
	<td class="source"><code>    this._onMessage = onMessage;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">548</td>
	<td class="source"><code>    this._onError = onError;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">549</td>
	<td class="source"><code>    const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">550</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">551</td>
	<td class="source"><code>    /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">552</td>
	<td class="source"><code>     * Resets the timer when a new message is received for Session Manager.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">553</td>
	<td class="source"><code>     * It will close the receiver gracefully, if no</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">554</td>
	<td class="source"><code>     * messages were received for the configured newMessageWaitTimeoutInSeconds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">555</td>
	<td class="source"><code>     */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">556</td>
	<td class="source"><code>    const resetTimerOnNewMessageReceived = (): void =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">557</td>
	<td class="source"><code>      if (this._newMessageReceivedTimer) clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">558</td>
	<td class="source"><code>      if (this.newMessageWaitTimeoutInSeconds) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">559</td>
	<td class="source"><code>        this._newMessageReceivedTimer = setTimeout(async () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">560</td>
	<td class="source"><code>          const msg =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">561</td>
	<td class="source"><code>            `MessageSession '${this.sessionId}' with name '${this.name}' did not receive ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">562</td>
	<td class="source"><code>            `any messages in the last ${</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">563</td>
	<td class="source"><code>              this.newMessageWaitTimeoutInSeconds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">564</td>
	<td class="source"><code>            } seconds. Hence closing it.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">565</td>
	<td class="source"><code>          log.error("[%s] %s", this._context.namespace.connectionId, msg);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">566</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">567</td>
	<td class="source"><code>          if (this.callee === SessionCallee.sessionManager) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">568</td>
	<td class="source"><code>            // The session manager will not forward this error to user.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">569</td>
	<td class="source"><code>            // Instead, this is taken as a indicator to create a new session client for the next session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">570</td>
	<td class="source"><code>            const error = translate({</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">571</td>
	<td class="source"><code>              condition: "com.microsoft:message-wait-timeout",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">572</td>
	<td class="source"><code>              description: msg</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">573</td>
	<td class="source"><code>            });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">574</td>
	<td class="source"><code>            this._notifyError(translate(error));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">575</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">576</td>
	<td class="source"><code>          await this.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">577</td>
	<td class="source"><code>        }, this.newMessageWaitTimeoutInSeconds * 1000);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">578</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">579</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">580</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">581</td>
	<td class="source"><code>    if (this._receiver && this._receiver.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">582</td>
	<td class="source"><code>      const onSessionMessage = async (context: EventContext): Promise&#60;void&#62; =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">583</td>
	<td class="source"><code>        // If the receiver got closed in PeekLock mode, avoid processing the message as we</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">584</td>
	<td class="source"><code>        // cannot settle the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">585</td>
	<td class="source"><code>        if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">586</td>
	<td class="source"><code>          this.receiveMode === ReceiveMode.peekLock &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">587</td>
	<td class="source"><code>          (!this._receiver || !this._receiver.isOpen())</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">588</td>
	<td class="source"><code>        ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">589</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">590</td>
	<td class="source"><code>            "[%s] Not calling the user's message handler for the current message " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">591</td>
	<td class="source"><code>              "as the receiver '%s' is closed",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">592</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">593</td>
	<td class="source"><code>            this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">594</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">595</td>
	<td class="source"><code>          return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">596</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">597</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">598</td>
	<td class="source"><code>        resetTimerOnNewMessageReceived();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">599</td>
	<td class="source"><code>        const bMessage: ServiceBusMessage = new ServiceBusMessage(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">600</td>
	<td class="source"><code>          this._context,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">601</td>
	<td class="source"><code>          context.message!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">602</td>
	<td class="source"><code>          context.delivery!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">603</td>
	<td class="source"><code>          true</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">604</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">605</td>
	<td class="source"><code>        try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">606</td>
	<td class="source"><code>          await this._onMessage(bMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">607</td>
	<td class="source"><code>        } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">608</td>
	<td class="source"><code>          // This ensures we call users' error handler when users' message handler throws.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">609</td>
	<td class="source"><code>          if (!isAmqpError(err)) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">610</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">611</td>
	<td class="source"><code>              "[%s] An error occurred while running user's message handler for the message " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">612</td>
	<td class="source"><code>                "with id '%s' on the receiver '%s': %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">613</td>
	<td class="source"><code>              connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">614</td>
	<td class="source"><code>              bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">615</td>
	<td class="source"><code>              this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">616</td>
	<td class="source"><code>              err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">617</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">618</td>
	<td class="source"><code>            this._onError!(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">619</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">620</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">621</td>
	<td class="source"><code>          const error = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">622</td>
	<td class="source"><code>          // Nothing much to do if user's message handler throws. Let us try abandoning the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">623</td>
	<td class="source"><code>          if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">624</td>
	<td class="source"><code>            !bMessage.delivery.remote_settled &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">625</td>
	<td class="source"><code>            this.receiveMode === ReceiveMode.peekLock &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">626</td>
	<td class="source"><code>            this.isOpen() // only try to abandon the messages if the connection is still open</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">627</td>
	<td class="source"><code>          ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">628</td>
	<td class="source"><code>            try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">629</td>
	<td class="source"><code>              log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">630</td>
	<td class="source"><code>                "[%s] Abandoning the message with id '%s' on the receiver '%s' since " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">631</td>
	<td class="source"><code>                  "an error occured: %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">632</td>
	<td class="source"><code>                connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">633</td>
	<td class="source"><code>                bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">634</td>
	<td class="source"><code>                this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">635</td>
	<td class="source"><code>                error</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">636</td>
	<td class="source"><code>              );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">637</td>
	<td class="source"><code>              await bMessage.abandon();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">638</td>
	<td class="source"><code>            } catch (abandonError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">639</td>
	<td class="source"><code>              const translatedError = translate(abandonError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">640</td>
	<td class="source"><code>              log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">641</td>
	<td class="source"><code>                "[%s] An error occurred while abandoning the message with id '%s' on the " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">642</td>
	<td class="source"><code>                  "receiver '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">643</td>
	<td class="source"><code>                connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">644</td>
	<td class="source"><code>                bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">645</td>
	<td class="source"><code>                this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">646</td>
	<td class="source"><code>                translatedError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">647</td>
	<td class="source"><code>              );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">648</td>
	<td class="source"><code>              this._notifyError(translatedError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">649</td>
	<td class="source"><code>            }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">650</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">651</td>
	<td class="source"><code>          return;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">652</td>
	<td class="source"><code>        } finally {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">653</td>
	<td class="source"><code>          if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">654</td>
	<td class="source"><code>            this._receiver!.addCredit(1);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">655</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">656</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">657</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">658</td>
	<td class="source"><code>        // If we've made it this far, then user's message handler completed fine. Let us try</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">659</td>
	<td class="source"><code>        // completing the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">660</td>
	<td class="source"><code>        if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">661</td>
	<td class="source"><code>          this.autoComplete &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">662</td>
	<td class="source"><code>          this.receiveMode === ReceiveMode.peekLock &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">663</td>
	<td class="source"><code>          !bMessage.delivery.remote_settled</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">664</td>
	<td class="source"><code>        ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">665</td>
	<td class="source"><code>          try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">666</td>
	<td class="source"><code>            log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">667</td>
	<td class="source"><code>              "[%s] Auto completing the message with id '%s' on " + "the receiver '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">668</td>
	<td class="source"><code>              connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">669</td>
	<td class="source"><code>              bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">670</td>
	<td class="source"><code>              this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">671</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">672</td>
	<td class="source"><code>            await bMessage.complete();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">673</td>
	<td class="source"><code>          } catch (completeError) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">674</td>
	<td class="source"><code>            const translatedError = translate(completeError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">675</td>
	<td class="source"><code>            log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">676</td>
	<td class="source"><code>              "[%s] An error occurred while completing the message with id '%s' on the " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">677</td>
	<td class="source"><code>                "receiver '%s': %O.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">678</td>
	<td class="source"><code>              connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">679</td>
	<td class="source"><code>              bMessage.messageId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">680</td>
	<td class="source"><code>              this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">681</td>
	<td class="source"><code>              translatedError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">682</td>
	<td class="source"><code>            );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">683</td>
	<td class="source"><code>            this._notifyError(translatedError);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">684</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">685</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">686</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">687</td>
	<td class="source"><code>      // setting the "message" event listener.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">688</td>
	<td class="source"><code>      this._receiver.on(ReceiverEvents.message, onSessionMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">689</td>
	<td class="source"><code>      // adding credit</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">690</td>
	<td class="source"><code>      this._receiver!.addCredit(this.maxConcurrentCalls);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">691</td>
	<td class="source"><code>    } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">692</td>
	<td class="source"><code>      this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">693</td>
	<td class="source"><code>      const msg =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">694</td>
	<td class="source"><code>        `MessageSession with sessionId '${this.sessionId}' and name '${this.name}' ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">695</td>
	<td class="source"><code>        `has either not been created or is not open.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">696</td>
	<td class="source"><code>      log.error("[%s] %s", this._context.namespace.connectionId, msg);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">697</td>
	<td class="source"><code>      this._notifyError(new Error(msg));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">698</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">699</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">700</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">701</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">702</td>
	<td class="source"><code>   * Returns a batch of messages based on given count and timeout over an AMQP receiver link</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">703</td>
	<td class="source"><code>   * from a Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">704</td>
	<td class="source"><code>   *</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">705</td>
	<td class="source"><code>   * @param maxMessageCount      The maximum number of messages to receive from Queue/Subscription.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">706</td>
	<td class="source"><code>   * @param idleTimeoutInSeconds The maximum wait time in seconds for which the Receiver</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">707</td>
	<td class="source"><code>   * should wait to receive the first message. If no message is received by this time,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">708</td>
	<td class="source"><code>   * the returned promise gets resolved to an empty array.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">709</td>
	<td class="source"><code>   * - **Default**: `60` seconds.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">710</td>
	<td class="source"><code>   * @returns Promise&#60;ServiceBusMessage[]&#62; A promise that resolves with an array of Message objects.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">711</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">712</td>
	<td class="source"><code>  async receiveMessages(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">713</td>
	<td class="source"><code>    maxMessageCount: number,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">714</td>
	<td class="source"><code>    idleTimeoutInSeconds?: number</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">715</td>
	<td class="source"><code>  ): Promise&#60;ServiceBusMessage[]&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">716</td>
	<td class="source"><code>    if (idleTimeoutInSeconds == null) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">717</td>
	<td class="source"><code>      idleTimeoutInSeconds = Constants.defaultOperationTimeoutInSeconds;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">718</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">719</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">720</td>
	<td class="source"><code>    const brokeredMessages: ServiceBusMessage[] = [];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">721</td>
	<td class="source"><code>    this.isReceivingMessages = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">722</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">723</td>
	<td class="source"><code>    return new Promise&#60;ServiceBusMessage[]&#62;((resolve, reject) =&#62; {</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 724, Column 11: "'onReceiveMessage' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">724</td>
	<td class="source"><code>      let onReceiveMessage: OnAmqpEventAsPromise;</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 725, Column 11: "'onReceiveDrain' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">725</td>
	<td class="source"><code>      let onReceiveDrain: OnAmqpEvent;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">726</td>
	<td class="source"><code>      let firstMessageWaitTimer: any;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">727</td>
	<td class="source"><code>      let actionAfterWaitTimeout: Func&#60;void, void&#62;;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">728</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">729</td>
	<td class="source"><code>      const setnewMessageWaitTimeoutInSeconds = (value?: number): void =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">730</td>
	<td class="source"><code>        this.newMessageWaitTimeoutInSeconds = value;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">731</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">732</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">733</td>
	<td class="source"><code>      setnewMessageWaitTimeoutInSeconds(1);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">734</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">735</td>
	<td class="source"><code>      this._onError = (error: MessagingError | Error) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">736</td>
	<td class="source"><code>        this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">737</td>
	<td class="source"><code>        // Resetting the newMessageWaitTimeoutInSeconds to undefined since we are done receiving</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">738</td>
	<td class="source"><code>        // a batch of messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">739</td>
	<td class="source"><code>        setnewMessageWaitTimeoutInSeconds();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">740</td>
	<td class="source"><code>        if (firstMessageWaitTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">741</td>
	<td class="source"><code>          clearTimeout(firstMessageWaitTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">742</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">743</td>
	<td class="source"><code>        // Removing listeners, so that the next receiveMessages() call can set them again.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">744</td>
	<td class="source"><code>        if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">745</td>
	<td class="source"><code>          this._receiver.removeListener(ReceiverEvents.message, onReceiveMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">746</td>
	<td class="source"><code>          this._receiver.removeListener(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">747</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">748</td>
	<td class="source"><code>        reject(error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">749</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">750</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">751</td>
	<td class="source"><code>      // Final action to be performed after maxMessageCount is reached or the maxWaitTime is over.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">752</td>
	<td class="source"><code>      const finalAction = (): void =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">753</td>
	<td class="source"><code>        if (this._newMessageReceivedTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">754</td>
	<td class="source"><code>          clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">755</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">756</td>
	<td class="source"><code>        if (firstMessageWaitTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">757</td>
	<td class="source"><code>          clearTimeout(firstMessageWaitTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">758</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">759</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">760</td>
	<td class="source"><code>        // Unsetting the newMessageWaitTimeoutInSeconds to undefined since we are done receiving</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">761</td>
	<td class="source"><code>        // a batch of messages.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">762</td>
	<td class="source"><code>        setnewMessageWaitTimeoutInSeconds();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">763</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">764</td>
	<td class="source"><code>        // Removing listeners, so that the next receiveMessages() call can set them again.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">765</td>
	<td class="source"><code>        if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">766</td>
	<td class="source"><code>          this._receiver.removeListener(ReceiverEvents.message, onReceiveMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">767</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">768</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">769</td>
	<td class="source"><code>        if (this._receiver && this._receiver.credit &#62; 0) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">770</td>
	<td class="source"><code>          log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">771</td>
	<td class="source"><code>            "[%s] Receiver '%s': Draining leftover credits(%d).",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">772</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">773</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">774</td>
	<td class="source"><code>            this._receiver.credit</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">775</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">776</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">777</td>
	<td class="source"><code>          // Setting drain must be accompanied by a flow call (aliased to addCredit in this case).</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">778</td>
	<td class="source"><code>          this._receiver.drain = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">779</td>
	<td class="source"><code>          this._receiver.addCredit(1);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">780</td>
	<td class="source"><code>        } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">781</td>
	<td class="source"><code>          if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">782</td>
	<td class="source"><code>            this._receiver.removeListener(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">783</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">784</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">785</td>
	<td class="source"><code>          this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">786</td>
	<td class="source"><code>          log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">787</td>
	<td class="source"><code>            "[%s] Receiver '%s': Resolving receiveMessages() with %d messages.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">788</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">789</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">790</td>
	<td class="source"><code>            brokeredMessages.length</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">791</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">792</td>
	<td class="source"><code>          resolve(brokeredMessages);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">793</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">794</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">795</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">796</td>
	<td class="source"><code>      /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">797</td>
	<td class="source"><code>       * Resets the timer when a new message is received. If no messages were received for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">798</td>
	<td class="source"><code>       * `newMessageWaitTimeoutInSeconds`, the messages received till now are returned. The</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">799</td>
	<td class="source"><code>       * receiver link stays open for the next receive call, but doesnt receive messages until</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">800</td>
	<td class="source"><code>       */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">801</td>
	<td class="source"><code>      const resetTimerOnNewMessageReceived = (): void =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">802</td>
	<td class="source"><code>        if (this._newMessageReceivedTimer) clearTimeout(this._newMessageReceivedTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">803</td>
	<td class="source"><code>        if (this.newMessageWaitTimeoutInSeconds) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">804</td>
	<td class="source"><code>          this._newMessageReceivedTimer = setTimeout(async () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">805</td>
	<td class="source"><code>            const msg =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">806</td>
	<td class="source"><code>              `MessageSession '${this.sessionId}' with name '${this.name}' did not receive ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">807</td>
	<td class="source"><code>              `any messages in the last ${</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">808</td>
	<td class="source"><code>                this.newMessageWaitTimeoutInSeconds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">809</td>
	<td class="source"><code>              } seconds. Hence closing it.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">810</td>
	<td class="source"><code>            log.error("[%s] %s", this._context.namespace.connectionId, msg);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">811</td>
	<td class="source"><code>            finalAction();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">812</td>
	<td class="source"><code>            if (this.callee === SessionCallee.sessionManager) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">813</td>
	<td class="source"><code>              await this.close();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">814</td>
	<td class="source"><code>            }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">815</td>
	<td class="source"><code>          }, this.newMessageWaitTimeoutInSeconds * 1000);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">816</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">817</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">818</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">819</td>
	<td class="source"><code>      // Action to be performed after the max wait time is over.</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 820, Column 7: "'actionAfterWaitTimeout' is never reassigned. Use 'const' instead."
		<a href="http://eslint.org/docs/rules/prefer-const" target="_blank">prefer-const</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">820</td>
	<td class="source"><code>      actionAfterWaitTimeout = (): void =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">821</td>
	<td class="source"><code>        log.batching(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">822</td>
	<td class="source"><code>          "[%s] Batching Receiver '%s'  max wait time in seconds %d over.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">823</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">824</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">825</td>
	<td class="source"><code>          idleTimeoutInSeconds</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">826</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">827</td>
	<td class="source"><code>        return finalAction();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">828</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">829</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">830</td>
	<td class="source"><code>      // Action to be performed on the "receiver_drained" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">831</td>
	<td class="source"><code>      onReceiveDrain = () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">832</td>
	<td class="source"><code>        this._receiver!.removeListener(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">833</td>
	<td class="source"><code>        this._receiver!.drain = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">834</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">835</td>
	<td class="source"><code>        this.isReceivingMessages = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">836</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">837</td>
	<td class="source"><code>        log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">838</td>
	<td class="source"><code>          "[%s] Receiver '%s' drained. Resolving receiveMessages() with %d messages.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">839</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">840</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">841</td>
	<td class="source"><code>          brokeredMessages.length</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">842</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">843</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">844</td>
	<td class="source"><code>        resolve(brokeredMessages);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">845</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">846</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">847</td>
	<td class="source"><code>      // Action to be performed on the "message" event.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">848</td>
	<td class="source"><code>      onReceiveMessage = async (context: EventContext) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">849</td>
	<td class="source"><code>        if (firstMessageWaitTimer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">850</td>
	<td class="source"><code>          clearTimeout(firstMessageWaitTimer);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">851</td>
	<td class="source"><code>          firstMessageWaitTimer = undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">852</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">853</td>
	<td class="source"><code>        resetTimerOnNewMessageReceived();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">854</td>
	<td class="source"><code>        try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">855</td>
	<td class="source"><code>          const data: ServiceBusMessage = new ServiceBusMessage(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">856</td>
	<td class="source"><code>            this._context,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">857</td>
	<td class="source"><code>            context.message!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">858</td>
	<td class="source"><code>            context.delivery!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">859</td>
	<td class="source"><code>            true</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">860</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">861</td>
	<td class="source"><code>          if (brokeredMessages.length &#60; maxMessageCount) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">862</td>
	<td class="source"><code>            brokeredMessages.push(data);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">863</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">864</td>
	<td class="source"><code>        } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">865</td>
	<td class="source"><code>          // Removing listeners, so that the next receiveMessages() call can set them again.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">866</td>
	<td class="source"><code>          if (this._receiver) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">867</td>
	<td class="source"><code>            this._receiver.removeListener(ReceiverEvents.message, onReceiveMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">868</td>
	<td class="source"><code>            this._receiver.removeListener(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">869</td>
	<td class="source"><code>          }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">870</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">871</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">872</td>
	<td class="source"><code>            "[%s] Receiver '%s' received an error while converting AmqpMessage to ServiceBusMessage:\n%O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">873</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">874</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">875</td>
	<td class="source"><code>            err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">876</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">877</td>
	<td class="source"><code>          reject(err instanceof Error ? err : new Error(JSON.stringify(err)));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">878</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">879</td>
	<td class="source"><code>        if (brokeredMessages.length === maxMessageCount) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">880</td>
	<td class="source"><code>          finalAction();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">881</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">882</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">883</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">884</td>
	<td class="source"><code>      const addCreditAndSetTimer = (reuse?: boolean): void =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">885</td>
	<td class="source"><code>        log.batching(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">886</td>
	<td class="source"><code>          "[%s] Receiver '%s', adding credit for receiving %d messages.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">887</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">888</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">889</td>
	<td class="source"><code>          maxMessageCount</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">890</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">891</td>
	<td class="source"><code>        // By adding credit here, we let the service know that at max we can handle `maxMessageCount`</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">892</td>
	<td class="source"><code>        // number of messages concurrently. We will return the user an array of messages that can</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">893</td>
	<td class="source"><code>        // be of size upto maxMessageCount. Then the user needs to accordingly dispose</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">894</td>
	<td class="source"><code>        // (complete,/abandon/defer/deadletter) the messages from the array.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">895</td>
	<td class="source"><code>        this._receiver!.addCredit(maxMessageCount);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">896</td>
	<td class="source"><code>        let msg: string = "[%s] Setting the wait timer for %d seconds for receiver '%s'.";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">897</td>
	<td class="source"><code>        if (reuse) msg += " Receiver link already present, hence reusing it.";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">898</td>
	<td class="source"><code>        log.batching(msg, this._context.namespace.connectionId, idleTimeoutInSeconds, this.name);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">899</td>
	<td class="source"><code>        firstMessageWaitTimer = setTimeout(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">900</td>
	<td class="source"><code>          actionAfterWaitTimeout,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">901</td>
	<td class="source"><code>          (idleTimeoutInSeconds as number) * 1000</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">902</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">903</td>
	<td class="source"><code>      };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">904</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">905</td>
	<td class="source"><code>      if (this.isOpen()) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">906</td>
	<td class="source"><code>        this._receiver!.on(ReceiverEvents.message, onReceiveMessage);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">907</td>
	<td class="source"><code>        this._receiver!.on(ReceiverEvents.receiverDrained, onReceiveDrain);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">908</td>
	<td class="source"><code>        addCreditAndSetTimer(true);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">909</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">910</td>
	<td class="source"><code>        const msg =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">911</td>
	<td class="source"><code>          `MessageSession "${this.name}" with sessionId "${this.sessionId}", ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">912</td>
	<td class="source"><code>          `is already closed. Hence cannot receive messages in a batch.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">913</td>
	<td class="source"><code>        log.error("[%s] %s", this._context.namespace.connectionId, msg);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">914</td>
	<td class="source"><code>        reject(new Error(msg));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">915</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">916</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">917</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">918</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">919</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">920</td>
	<td class="source"><code>   * Settles the message with the specified disposition.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">921</td>
	<td class="source"><code>   * @param message The ServiceBus Message that needs to be settled.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">922</td>
	<td class="source"><code>   * @param operation The disposition type.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">923</td>
	<td class="source"><code>   * @param options Optional parameters that can be provided while disposing the message.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">924</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">925</td>
	<td class="source"><code>  async settleMessage(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">926</td>
	<td class="source"><code>    message: ServiceBusMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">927</td>
	<td class="source"><code>    operation: DispositionType,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">928</td>
	<td class="source"><code>    options?: DispositionOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">929</td>
	<td class="source"><code>  ): Promise&#60;any&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">930</td>
	<td class="source"><code>    return new Promise((resolve, reject) =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">931</td>
	<td class="source"><code>      if (!options) options = {};</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">932</td>
	<td class="source"><code>      if (operation.match(/^(complete|abandon|defer|deadletter)$/) == null) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">933</td>
	<td class="source"><code>        return reject(new Error(`operation: '${operation}' is not a valid operation.`));</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">934</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">935</td>
	<td class="source"><code>      const delivery = message.delivery;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">936</td>
	<td class="source"><code>      const timer = setTimeout(() =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">937</td>
	<td class="source"><code>        this._deliveryDispositionMap.delete(delivery.id);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">938</td>
	<td class="source"><code>        log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">939</td>
	<td class="source"><code>          "[%s] Disposition for delivery id: %d, did not complete in %d milliseconds. " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">940</td>
	<td class="source"><code>            "Hence resolving the promise.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">941</td>
	<td class="source"><code>          this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">942</td>
	<td class="source"><code>          delivery.id,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">943</td>
	<td class="source"><code>          messageDispositionTimeout</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">944</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">945</td>
	<td class="source"><code>        return resolve();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">946</td>
	<td class="source"><code>      }, messageDispositionTimeout);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">947</td>
	<td class="source"><code>      this._deliveryDispositionMap.set(delivery.id, {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">948</td>
	<td class="source"><code>        resolve: resolve,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">949</td>
	<td class="source"><code>        reject: reject,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">950</td>
	<td class="source"><code>        timer: timer</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">951</td>
	<td class="source"><code>      });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">952</td>
	<td class="source"><code>      if (operation === DispositionType.complete) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">953</td>
	<td class="source"><code>        delivery.accept();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">954</td>
	<td class="source"><code>      } else if (operation === DispositionType.abandon) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">955</td>
	<td class="source"><code>        const params: any = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">956</td>
	<td class="source"><code>          undeliverable_here: false</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">957</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">958</td>
	<td class="source"><code>        if (options.propertiesToModify) params.message_annotations = options.propertiesToModify;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">959</td>
	<td class="source"><code>        delivery.modified(params);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">960</td>
	<td class="source"><code>      } else if (operation === DispositionType.defer) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">961</td>
	<td class="source"><code>        const params: any = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">962</td>
	<td class="source"><code>          undeliverable_here: true</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">963</td>
	<td class="source"><code>        };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">964</td>
	<td class="source"><code>        if (options.propertiesToModify) params.message_annotations = options.propertiesToModify;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">965</td>
	<td class="source"><code>        delivery.modified(params);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">966</td>
	<td class="source"><code>      } else if (operation === DispositionType.deadletter) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">967</td>
	<td class="source"><code>        delivery.reject(options.error || {});</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">968</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">969</td>
	<td class="source"><code>    });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">970</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">971</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">972</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">973</td>
	<td class="source"><code>   * Deletes the MessageSession from the internal cache.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">974</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 975, Column 3: "Member _deleteFromCache should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">975</td>
	<td class="source"><code>  private _deleteFromCache(): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">976</td>
	<td class="source"><code>    this._receiver = undefined;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">977</td>
	<td class="source"><code>    delete this._context.messageSessions[this.sessionId!];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">978</td>
	<td class="source"><code>    log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">979</td>
	<td class="source"><code>      "[%s] Deleted the receiver '%s' with sessionId '%s' from the client cache.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">980</td>
	<td class="source"><code>      this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">981</td>
	<td class="source"><code>      this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">982</td>
	<td class="source"><code>      this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">983</td>
	<td class="source"><code>    );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">984</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">985</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">986</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">987</td>
	<td class="source"><code>   * Creates a new AMQP receiver under a new AMQP session.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">988</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 989, Column 3: "Member _init should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">989</td>
	<td class="source"><code>  private async _init(): Promise&#60;void&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">990</td>
	<td class="source"><code>    const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">991</td>
	<td class="source"><code>    try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">992</td>
	<td class="source"><code>      if (!this.isOpen() && !this.isConnecting) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">993</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">994</td>
	<td class="source"><code>          "[%s] The receiver '%s' with address '%s' is not open and is not currently " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">995</td>
	<td class="source"><code>            "establishing itself. Hence let's try to connect.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">996</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">997</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">998</td>
	<td class="source"><code>          this.address</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">999</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1000</td>
	<td class="source"><code>        this.isConnecting = true;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1001</td>
	<td class="source"><code>        await this._negotiateClaim();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1002</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1003</td>
	<td class="source"><code>        const options = this._createMessageSessionOptions();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1004</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1005</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1006</td>
	<td class="source"><code>          "[%s] Trying to create receiver '%s' with options %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1007</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1008</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1009</td>
	<td class="source"><code>          options</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1010</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1011</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1012</td>
	<td class="source"><code>        this._receiver = await this._context.namespace.connection.createReceiver(options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1013</td>
	<td class="source"><code>        this.isConnecting = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1014</td>
	<td class="source"><code>        const receivedSessionId =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1015</td>
	<td class="source"><code>          this._receiver.source &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1016</td>
	<td class="source"><code>          this._receiver.source.filter &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1017</td>
	<td class="source"><code>          this._receiver.source.filter[Constants.sessionFilterName];</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1018</td>
	<td class="source"><code>        let errorMessage: string = "";</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1019</td>
	<td class="source"><code>        // SB allows a sessionId with empty string value :)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1020</td>
	<td class="source"><code>        if (receivedSessionId == null) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1021</td>
	<td class="source"><code>          errorMessage =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1022</td>
	<td class="source"><code>            `Received an incorrect sessionId '${receivedSessionId}' while creating ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1023</td>
	<td class="source"><code>            `the receiver '${this.name}'.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1024</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1025</td>
	<td class="source"><code>        if (this.sessionId != null && receivedSessionId !== this.sessionId) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1026</td>
	<td class="source"><code>          errorMessage =</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1027</td>
	<td class="source"><code>            `Received sessionId '${receivedSessionId}' does not match the provided ` +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1028</td>
	<td class="source"><code>            `sessionId '${this.sessionId}' while creating the receiver '${this.name}'.`;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1029</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1030</td>
	<td class="source"><code>        if (errorMessage) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1031</td>
	<td class="source"><code>          const error = translate({</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1032</td>
	<td class="source"><code>            description: errorMessage,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1033</td>
	<td class="source"><code>            condition: ErrorNameConditionMapper.SessionCannotBeLockedError</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1034</td>
	<td class="source"><code>          });</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1035</td>
	<td class="source"><code>          log.error("[%s] %O", this._context.namespace.connectionId, error);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1036</td>
	<td class="source"><code>          throw error;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1037</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1038</td>
	<td class="source"><code>        if (this.sessionId == null) this.sessionId = receivedSessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1039</td>
	<td class="source"><code>        this.sessionLockedUntilUtc = convertTicksToDate(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1040</td>
	<td class="source"><code>          this._receiver.properties["com.microsoft:locked-until-utc"]</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1041</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1042</td>
	<td class="source"><code>        log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1043</td>
	<td class="source"><code>          "[%s] Session with id '%s' is locked until: '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1044</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1045</td>
	<td class="source"><code>          this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1046</td>
	<td class="source"><code>          this.sessionLockedUntilUtc.toISOString()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1047</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1048</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1049</td>
	<td class="source"><code>          "[%s] Receiver '%s' for sessionId '%s' has established itself.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1050</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1051</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1052</td>
	<td class="source"><code>          this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1053</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1054</td>
	<td class="source"><code>        log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1055</td>
	<td class="source"><code>          "Promise to create the receiver resolved. " + "Created receiver with name: ",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1056</td>
	<td class="source"><code>          this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1057</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1058</td>
	<td class="source"><code>        log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1059</td>
	<td class="source"><code>          "[%s] Receiver '%s' created with receiver options: %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1060</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1061</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1062</td>
	<td class="source"><code>          options</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1063</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1064</td>
	<td class="source"><code>        if (!this._context.messageSessions[this.sessionId!]) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1065</td>
	<td class="source"><code>          this._context.messageSessions[this.sessionId!] = this;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1066</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1067</td>
	<td class="source"><code>        this._totalAutoLockRenewDuration = Date.now() + this.maxAutoRenewDurationInSeconds * 1000;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1068</td>
	<td class="source"><code>        await this._ensureTokenRenewal();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1069</td>
	<td class="source"><code>        await this._ensureSessionLockRenewal();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1070</td>
	<td class="source"><code>      } else {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1071</td>
	<td class="source"><code>        log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1072</td>
	<td class="source"><code>          "[%s] The receiver '%s' for sessionId '%s' is open -&#62; %s and is connecting " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1073</td>
	<td class="source"><code>            "-&#62; %s. Hence not reconnecting.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1074</td>
	<td class="source"><code>          connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1075</td>
	<td class="source"><code>          this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1076</td>
	<td class="source"><code>          this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1077</td>
	<td class="source"><code>          this.isOpen(),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1078</td>
	<td class="source"><code>          this.isConnecting</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1079</td>
	<td class="source"><code>        );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1080</td>
	<td class="source"><code>      }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1081</td>
	<td class="source"><code>    } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1082</td>
	<td class="source"><code>      this.isConnecting = false;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1083</td>
	<td class="source"><code>      const errObj = translate(err);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1084</td>
	<td class="source"><code>      log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1085</td>
	<td class="source"><code>        "[%s] An error occured while creating the receiver '%s': %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1086</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1087</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1088</td>
	<td class="source"><code>        errObj</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1089</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1090</td>
	<td class="source"><code>      throw errObj;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1091</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1092</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1093</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1094</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1095</td>
	<td class="source"><code>   * Creates the options that need to be specified while creating an AMQP receiver link.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1096</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1097, Column 3: "Member _createMessageSessionOptions should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">1097</td>
	<td class="source"><code>  private _createMessageSessionOptions(): ReceiverOptions {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1098</td>
	<td class="source"><code>    const rcvrOptions: ReceiverOptions = {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1099</td>
	<td class="source"><code>      name: this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1100</td>
	<td class="source"><code>      autoaccept: false,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1101</td>
	<td class="source"><code>      // receiveAndDelete -&#62; first(0), peekLock -&#62; second (1)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1102</td>
	<td class="source"><code>      rcv_settle_mode: this.receiveMode === ReceiveMode.receiveAndDelete ? 0 : 1,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1103</td>
	<td class="source"><code>      // receiveAndDelete -&#62; settled (1), peekLock -&#62; unsettled (0)</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1104</td>
	<td class="source"><code>      snd_settle_mode: this.receiveMode === ReceiveMode.receiveAndDelete ? 1 : 0,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1105</td>
	<td class="source"><code>      source: {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1106</td>
	<td class="source"><code>        address: this.address,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1107</td>
	<td class="source"><code>        filter: {}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1108</td>
	<td class="source"><code>      },</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1109</td>
	<td class="source"><code>      credit_window: 0,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1110</td>
	<td class="source"><code>      onClose: (context) =&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1111</td>
	<td class="source"><code>        this._onAmqpClose(context).catch(() =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1112</td>
	<td class="source"><code>          /* */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1113</td>
	<td class="source"><code>        }),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1114</td>
	<td class="source"><code>      onSessionClose: (context) =&#62;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1115</td>
	<td class="source"><code>        this._onSessionClose(context).catch(() =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1116</td>
	<td class="source"><code>          /* */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1117</td>
	<td class="source"><code>        }),</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1118</td>
	<td class="source"><code>      onError: this._onAmqpError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1119</td>
	<td class="source"><code>      onSessionError: this._onSessionError,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1120</td>
	<td class="source"><code>      onSettled: this._onSettled</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1121</td>
	<td class="source"><code>    };</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1122</td>
	<td class="source"><code>    (rcvrOptions.source as any).filter[Constants.sessionFilterName] = this.sessionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1123</td>
	<td class="source"><code>    return rcvrOptions;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1124</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1125</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1126</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1127</td>
	<td class="source"><code>   * Ensures that the session lock is renewed before it expires. The lock will not be renewed for</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1128</td>
	<td class="source"><code>   * more than the configured totalAutoLockRenewDuration.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1129</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="issue">
	<td><strong class="text-error">Error<strong></td>
	<td>
		Row 1130, Column 3: "Member _ensureSessionLockRenewal should be declared before all public instance method definitions."
		<a href="http://eslint.org/docs/rules/@typescript-eslint/member-ordering" target="_blank">@typescript-eslint/member-ordering</a>
	</td>
</tr><tr class="hit bg-error">
	<td class="line">1130</td>
	<td class="source"><code>  private _ensureSessionLockRenewal(): void {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1131</td>
	<td class="source"><code>    if (</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1132</td>
	<td class="source"><code>      this.autoRenewLock &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1133</td>
	<td class="source"><code>      new Date(this._totalAutoLockRenewDuration) &#62; this.sessionLockedUntilUtc! &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1134</td>
	<td class="source"><code>      Date.now() &#60; this._totalAutoLockRenewDuration &&</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1135</td>
	<td class="source"><code>      this.isOpen()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1136</td>
	<td class="source"><code>    ) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1137</td>
	<td class="source"><code>      const connectionId = this._context.namespace.connectionId;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1138</td>
	<td class="source"><code>      const nextRenewalTimeout = calculateRenewAfterDuration(this.sessionLockedUntilUtc!);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1139</td>
	<td class="source"><code>      this._sessionLockRenewalTimer = setTimeout(async () =&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1140</td>
	<td class="source"><code>        try {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1141</td>
	<td class="source"><code>          log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1142</td>
	<td class="source"><code>            "[%s] Attempting to renew the session lock for MessageSession '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1143</td>
	<td class="source"><code>              "with name '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1144</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1145</td>
	<td class="source"><code>            this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1146</td>
	<td class="source"><code>            this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1147</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1148</td>
	<td class="source"><code>          this.sessionLockedUntilUtc = await this._context.managementClient!.renewSessionLock(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1149</td>
	<td class="source"><code>            this.sessionId!,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1150</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1151</td>
	<td class="source"><code>            {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1152</td>
	<td class="source"><code>              delayInSeconds: 0,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1153</td>
	<td class="source"><code>              timeoutInSeconds: 10,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1154</td>
	<td class="source"><code>              times: 4</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1155</td>
	<td class="source"><code>            }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1156</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1157</td>
	<td class="source"><code>          log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1158</td>
	<td class="source"><code>            "[%s] Successfully renewed the session lock for MessageSession '%s' " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1159</td>
	<td class="source"><code>              "with name '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1160</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1161</td>
	<td class="source"><code>            this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1162</td>
	<td class="source"><code>            this.name</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1163</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1164</td>
	<td class="source"><code>          log.receiver(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1165</td>
	<td class="source"><code>            "[%s] Calling _ensureSessionLockRenewal() again for MessageSession '%s'.",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1166</td>
	<td class="source"><code>            connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1167</td>
	<td class="source"><code>            this.sessionId</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1168</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1169</td>
	<td class="source"><code>          this._ensureSessionLockRenewal();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1170</td>
	<td class="source"><code>        } catch (err) {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1171</td>
	<td class="source"><code>          log.error(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1172</td>
	<td class="source"><code>            "[%s] An error occurred while renewing the session lock for MessageSession " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1173</td>
	<td class="source"><code>              "'%s' with name '%s': %O",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1174</td>
	<td class="source"><code>            this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1175</td>
	<td class="source"><code>            this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1176</td>
	<td class="source"><code>            this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1177</td>
	<td class="source"><code>            err</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1178</td>
	<td class="source"><code>          );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1179</td>
	<td class="source"><code>        }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1180</td>
	<td class="source"><code>      }, nextRenewalTimeout);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1181</td>
	<td class="source"><code>      log.messageSession(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1182</td>
	<td class="source"><code>        "[%s] MessageSession '%s' with name '%s', has next session lock renewal " +</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1183</td>
	<td class="source"><code>          "in %d seconds @(%s).",</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1184</td>
	<td class="source"><code>        this._context.namespace.connectionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1185</td>
	<td class="source"><code>        this.sessionId,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1186</td>
	<td class="source"><code>        this.name,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1187</td>
	<td class="source"><code>        nextRenewalTimeout / 1000,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1188</td>
	<td class="source"><code>        new Date(Date.now() + nextRenewalTimeout).toString()</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1189</td>
	<td class="source"><code>      );</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1190</td>
	<td class="source"><code>    }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1191</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1192</td>
	<td class="source"><code></code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1193</td>
	<td class="source"><code>  /**</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1194</td>
	<td class="source"><code>   * Creates a new instance of the MessageSession based on the provided parameters.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1195</td>
	<td class="source"><code>   * @param context The client entity context</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1196</td>
	<td class="source"><code>   * @param options Options that can be provided while creating the MessageSession.</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1197</td>
	<td class="source"><code>   */</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1198</td>
	<td class="source"><code>  static async create(</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1199</td>
	<td class="source"><code>    context: ClientEntityContext,</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1200</td>
	<td class="source"><code>    options?: MessageSessionOptions</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1201</td>
	<td class="source"><code>  ): Promise&#60;MessageSession&#62; {</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1202</td>
	<td class="source"><code>    throwErrorIfConnectionClosed(context.namespace);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1203</td>
	<td class="source"><code>    const messageSession = new MessageSession(context, options);</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1204</td>
	<td class="source"><code>    await messageSession._init();</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1205</td>
	<td class="source"><code>    return messageSession;</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1206</td>
	<td class="source"><code>  }</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1207</td>
	<td class="source"><code>}</code></td>
</tr>

<tr class="hit bg-success">
	<td class="line">1208</td>
	<td class="source"><code></code></td>
</tr>

	</tbody>
</table>

			</div>
		</div>
	</td>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcSessionSessionManagerTs" class="lint-result bg-success" data-group="f-17" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\session\sessionManager.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcSubscriptionClientTs" class="lint-result bg-success" data-group="f-18" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\subscriptionClient.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcTopicClientTs" class="lint-result bg-success" data-group="f-19" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\topicClient.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcUtilConcurrentExpiringMapTs" class="lint-result bg-success" data-group="f-20" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\util\concurrentExpiringMap.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcUtilConstantsTs" class="lint-result bg-success" data-group="f-21" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\util\constants.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcUtilErrorsTs" class="lint-result bg-success" data-group="f-22" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\util\errors.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcUtilSemaphoreTs" class="lint-result bg-success" data-group="f-23" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\util\semaphore.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSrcUtilUtilsTs" class="lint-result bg-success" data-group="f-24" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \src\util\utils.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestBatchReceiverSpecTs" class="lint-result bg-success" data-group="f-25" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\batchReceiver.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestDeferredMessageSpecTs" class="lint-result bg-success" data-group="f-26" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\deferredMessage.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestInvalidParametersSpecTs" class="lint-result bg-success" data-group="f-27" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\invalidParameters.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestPerfAzureSbPackageReceiveTs" class="lint-result bg-success" data-group="f-28" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\perf\azure-sb-package\receive.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestPerfAzureSbPackageSendTs" class="lint-result bg-success" data-group="f-29" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\perf\azure-sb-package\send.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestPerfRheaPromiseReceiveTs" class="lint-result bg-success" data-group="f-30" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\perf\rhea-promise\receive.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestPerfRheaPromiseSendTs" class="lint-result bg-success" data-group="f-31" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\perf\rhea-promise\send.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestPerfServiceBusReceiveTs" class="lint-result bg-success" data-group="f-32" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\perf\service-bus\receive.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestPerfServiceBusSendTs" class="lint-result bg-success" data-group="f-33" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\perf\service-bus\send.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestReceiveAndDeleteModeSpecTs" class="lint-result bg-success" data-group="f-34" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\receiveAndDeleteMode.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestRenewLockSpecTs" class="lint-result bg-success" data-group="f-35" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\renewLock.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestRenewLockSessionsSpecTs" class="lint-result bg-success" data-group="f-36" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\renewLockSessions.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestSamplesSpecTs" class="lint-result bg-success" data-group="f-37" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\samples.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestSendScheduleSpecTs" class="lint-result bg-success" data-group="f-38" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\sendSchedule.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestServiceBusClientSpecTs" class="lint-result bg-success" data-group="f-39" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\serviceBusClient.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestSessionsTestsSpecTs" class="lint-result bg-success" data-group="f-40" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\sessionsTests.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStreamingReceiverSpecTs" class="lint-result bg-success" data-group="f-41" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\streamingReceiver.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStreamingReceiverSessionsSpecTs" class="lint-result bg-success" data-group="f-42" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\streamingReceiverSessions.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressFixedNumberOfClientsMultipleQueuesTs" class="lint-result bg-success" data-group="f-43" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_fixedNumberOfClientsMultipleQueues.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressFixedNumberOfClientsSingleQueueTs" class="lint-result bg-success" data-group="f-44" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_fixedNumberOfClientsSingleQueue.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressMessageAutolockRenewalTs" class="lint-result bg-success" data-group="f-45" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_messageAutolockRenewal.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressMessageLockRenewalBatchingThenStreamingTs" class="lint-result bg-success" data-group="f-46" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_messageLockRenewalBatchingThenStreaming.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressMessageManualLockRenewalTs" class="lint-result bg-success" data-group="f-47" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_messageManualLockRenewal.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressMessageRandomDispositionTs" class="lint-result bg-success" data-group="f-48" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_messageRandomDisposition.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressMessageRandomDispositionOnSessionTs" class="lint-result bg-success" data-group="f-49" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_messageRandomDispositionOnSession.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressSessionAutolockRenewalTs" class="lint-result bg-success" data-group="f-50" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_sessionAutolockRenewal.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressSessionManualLockRenewalTs" class="lint-result bg-success" data-group="f-51" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_sessionManualLockRenewal.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressSessionStateTs" class="lint-result bg-success" data-group="f-52" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_sessionState.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressSingleClientTs" class="lint-result bg-success" data-group="f-53" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_singleClient.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestStressStressSingleMessageCompleteTs" class="lint-result bg-success" data-group="f-54" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\stress\stress_singleMessageComplete.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestTestUtilsTs" class="lint-result bg-success" data-group="f-55" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\testUtils.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusTestTopicFiltersSpecTs" class="lint-result bg-success" data-group="f-56" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \test\topicFilters.spec.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptAdvancedFeaturesDeferralTs" class="lint-result bg-success" data-group="f-57" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\advancedFeatures\deferral.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptAdvancedFeaturesMovingMessagesToDlqTs" class="lint-result bg-success" data-group="f-58" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\advancedFeatures\movingMessagesToDLQ.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptAdvancedFeaturesProcessMessageFromDlqTs" class="lint-result bg-success" data-group="f-59" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\advancedFeatures\processMessageFromDLQ.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptAdvancedFeaturesSessionStateTs" class="lint-result bg-success" data-group="f-60" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\advancedFeatures\sessionState.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptAdvancedFeaturesTopicFiltersTs" class="lint-result bg-success" data-group="f-61" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\advancedFeatures\topicFilters.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptGettingStartedBrowseMessagesTs" class="lint-result bg-success" data-group="f-62" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\gettingStarted\browseMessages.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptGettingStartedInteractiveLoginTs" class="lint-result bg-success" data-group="f-63" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\gettingStarted\interactiveLogin.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptGettingStartedLoginWithAzureAccountTs" class="lint-result bg-success" data-group="f-64" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\gettingStarted\loginWithAzureAccount.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptGettingStartedReceiveMessagesLoopTs" class="lint-result bg-success" data-group="f-65" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\gettingStarted\receiveMessagesLoop.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptGettingStartedReceiveMessagesStreamingTs" class="lint-result bg-success" data-group="f-66" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\gettingStarted\receiveMessagesStreaming.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptGettingStartedScheduledMessagesTs" class="lint-result bg-success" data-group="f-67" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\gettingStarted\scheduledMessages.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptGettingStartedSendMessagesTs" class="lint-result bg-success" data-group="f-68" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\gettingStarted\sendMessages.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptGettingStartedServicePrincipalLoginTs" class="lint-result bg-success" data-group="f-69" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\gettingStarted\servicePrincipalLogin.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptGettingStartedSessionTs" class="lint-result bg-success" data-group="f-70" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\gettingStarted\session.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

<tr id="cCodeAzureSdkForJsSdkServicebusServiceBusSamplesTypescriptGettingStartedUseProxyTs" class="lint-result bg-success" data-group="f-71" data-problem-count="0" tabindex="0">
    <th class="icon-box" colspan="1">
        <span class="caret"></span>
    </th>
    <th>
        \samples\typescript\gettingStarted\useProxy.ts
    </th>
    <th class="result-summary">
      0 problems
    </th>
</tr>

				</tbody>
			</table>
		</div>
	</div>
	<script type="text/javascript">
	var lintResults = document.querySelectorAll('tr.lint-result'),
		filters = document.querySelectorAll('input[name="filters"]'),
		tabs = document.querySelectorAll('.nav-tabs > li > button');

	// helper functions
	function hideElement(element) {
		if (!element.className.includes('hidden')) {
			element.className = element.className + ' hidden';
		}
	}

	function toggleDisplay(element) {
		element.className = element.className.includes('hidden') ? element.className.replace(' hidden', '') : element.className + ' hidden';
	}

	// accordion
	for(var i = 0; i < lintResults.length; i++) {
		var result = lintResults[i];

		result.addEventListener('click', handleResultClick);
		result.addEventListener('keydown', function onKeydown(event) {
			if (event.which === 13) {
				handleResultClick.apply(this);
			}
		});
	}

	function handleResultClick() {
		if (!this.className.includes('bg-success')) {
			toggleAccordion.apply(this);
		}
		// TODO: Comment this back in when I can support it in example page
//		window.location.href = '#' + this.getAttribute('id');
	}

	function toggleAccordion() {
		var resultDetails = document.getElementsByClassName(this.getAttribute('data-group'));

		this.className = this.className.includes('open') ? this.className.replace(' open', '') : this.className + ' open';
		toggleDisplay(resultDetails[0]);
	}

	// filter
	for(var j = 0; j < filters.length; j++) {
		filters[j].addEventListener('change', filterResults);
	}

	function filterResults() {
		var filterValue = document.querySelector('input[name="filters"]:checked').value;


		for(var i = 0; i < lintResults.length; i++) {
			var result = lintResults[i];

			if (result.className.includes(filterValue)) {
				result.className = result.className.includes('hidden') ? result.className.replace(' hidden', '') : result.className;
			} else {
				hideElement(result);
			}

			if (result.className.includes('hidden') && result.className.includes('open')) {
				toggleAccordion.apply(result);
			}
		}
	}

	// tabs
	for(var k = 0; k < tabs.length; k++) {
		tabs[k].addEventListener('click', activateTab);
	}

	function activateTab() {
		var currentTabs = document.querySelectorAll(this.getAttribute('data-parent') + ' .nav-tabs > li'),
			tabPanes = document.querySelectorAll(this.getAttribute('data-parent') + ' .tab-pane'),
			tabContent = document.getElementById(this.getAttribute('data-content'));

		for(var i = 0; i < currentTabs.length; i++) {
			disableTabs(currentTabs[i]);
		}
		for(var j = 0; j < tabPanes.length; j++) {
			hideElement(tabPanes[j]);
		}
		this.parentNode.className = 'active';
		toggleDisplay(tabContent);
	}

	function disableTabs(tab) {
		tab.className = '';
	}
</script>
</body>
</html>

{"version":3,"file":"sasServiceClientCredentials.js","sourceRoot":"","sources":["../../../src/util/sasServiceClientCredentials.ts"],"names":[],"mappings":";;;AAIA,kEAA8D;AAC9D,2CAA0C;AAE1C,gDAA0D;AAE1D;;GAEG;AACH,MAAa,2BAA2B;IAUtC;;;;OAIG;IACH,YAAY,UAA8B;QACxC,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;QAC9B,IAAI,CAAC,cAAc,GAAG,IAAA,kCAAsB,EAAC,UAAU,CAAC,CAAC;IAC3D,CAAC;IAEO,KAAK,CAAC,kBAAkB,CAAC,SAAiB,EAAE,cAAsB;QACxE,MAAM,YAAY,GAAG,GAAG,SAAS,KAAK,cAAc,EAAE,CAAC;QACvD,MAAM,MAAM,GAAG,MAAM,IAAA,uBAAW,EAAC,IAAI,CAAC,WAAW,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC;QACrE,OAAO,MAAM,CAAC;IAChB,CAAC;IAED;;;;;OAKG;IACH,KAAK,CAAC,WAAW,CAAC,OAAwB;QACxC,IAAI,CAAC,OAAO,CAAC,OAAO;YAAE,OAAO,CAAC,OAAO,GAAG,IAAA,sCAAiB,GAAE,CAAC;QAE5D,MAAM,SAAS,GAAG,kBAAkB,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC;QAE9E,MAAM,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;QACxB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC,CAAC;QACvC,MAAM,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC;QACzD,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;QAC3E,OAAO,CAAC,OAAO,CAAC,GAAG,CACjB,eAAe,EACf,6BAA6B,SAAS,OAAO,cAAc,QAAQ,IAAI,CAAC,WAAW,CAAC,IAAI,OAAO,SAAS,EAAE,CAC3G,CAAC;QACF,OAAO,CAAC,eAAe,GAAG,IAAI,CAAC;QAC/B,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,QAAQ,CAAC,QAAgB;QACvB,OAAO,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAChD,CAAC;CACF;AApDD,kEAoDC","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\nimport type { AccessToken, NamedKeyCredential } from \"@azure/core-auth\";\nimport type { PipelineRequest } from \"@azure/core-rest-pipeline\";\nimport { createHttpHeaders } from \"@azure/core-rest-pipeline\";\nimport { generateKey } from \"./crypto.js\";\nimport type { SasTokenProvider } from \"@azure/core-amqp\";\nimport { createSasTokenProvider } from \"@azure/core-amqp\";\n\n/**\n * @internal\n */\nexport class SasServiceClientCredentials {\n  /**\n   * The NamedKeyCredential containing the key name and secret key value.\n   */\n  private _credential: NamedKeyCredential;\n\n  /**\n   * A SasTokenProvider provides a method to retrieve an `AccessToken`.\n   */\n  private _tokenProvider: SasTokenProvider;\n  /**\n   * Creates a new sasServiceClientCredentials object.\n   *\n   * @param credential - The NamedKeyCredential containing the key name and secret key value.\n   */\n  constructor(credential: NamedKeyCredential) {\n    this._credential = credential;\n    this._tokenProvider = createSasTokenProvider(credential);\n  }\n\n  private async _generateSignature(targetUri: string, expirationDate: number): Promise<string> {\n    const stringToSign = `${targetUri}\\n${expirationDate}`;\n    const result = await generateKey(this._credential.key, stringToSign);\n    return result;\n  }\n\n  /**\n   * Signs a request with the Authentication header.\n   *\n   * @param request - The {@link PipelineRequest} to be signed.\n   * @returns The signed request object.\n   */\n  async signRequest(request: PipelineRequest): Promise<PipelineRequest> {\n    if (!request.headers) request.headers = createHttpHeaders();\n\n    const targetUri = encodeURIComponent(request.url.toLowerCase()).toLowerCase();\n\n    const date = new Date();\n    date.setMinutes(date.getMinutes() + 5);\n    const expirationDate = Math.round(date.getTime() / 1000);\n    const signature = await this._generateSignature(targetUri, expirationDate);\n    request.headers.set(\n      \"authorization\",\n      `SharedAccessSignature sig=${signature}&se=${expirationDate}&skn=${this._credential.name}&sr=${targetUri}`,\n    );\n    request.withCredentials = true;\n    return request;\n  }\n\n  getToken(audience: string): Promise<AccessToken> {\n    return this._tokenProvider.getToken(audience);\n  }\n}\n"]}
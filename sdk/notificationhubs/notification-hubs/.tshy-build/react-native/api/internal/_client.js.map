{"version":3,"file":"_client.js","sourceRoot":"","sources":["../../../../src/api/internal/_client.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type {\n  HttpHeaders,\n  HttpMethods,\n  PipelineRequest,\n  PipelineResponse,\n} from \"@azure/core-rest-pipeline\";\nimport { RestError, createPipelineRequest } from \"@azure/core-rest-pipeline\";\nimport type {\n  NotificationHubsMessageResponse,\n  NotificationHubsResponse,\n} from \"../../models/notificationDetails.js\";\nimport type { NotificationHubsClientContext } from \"../index.js\";\nimport type { OperationOptions } from \"@azure-rest/core-client\";\nimport { isDefined } from \"../../utils/utils.js\";\nimport { parseNotificationOutcome } from \"../../serializers/notificationOutcomeSerializer.js\";\nimport { parseXMLError } from \"../../utils/xmlUtils.js\";\n\nexport function createRequest(\n  endpoint: URL,\n  method: HttpMethods,\n  headers: HttpHeaders,\n  options: OperationOptions,\n): PipelineRequest {\n  return createPipelineRequest({\n    ...options.tracingOptions,\n    ...options.requestOptions,\n    url: endpoint.toString(),\n    abortSignal: options.abortSignal,\n    method,\n    headers,\n  });\n}\n\n/**\n * Parses the HTTP response and creates a NotificationHubsResponse with header information from the operation.\n * @param response - The HTTP response used to populate the result.\n * @returns A NotificationHubsResponse with header information from the operation.\n */\nexport function parseNotificationResponse(response: PipelineResponse): NotificationHubsResponse {\n  const correlationId = response.headers.get(\"x-ms-correlation-request-id\");\n  const trackingId = response.headers.get(\"TrackingId\");\n  const location = response.headers.get(\"Location\");\n\n  return {\n    correlationId,\n    trackingId,\n    location,\n  };\n}\n\n/**\n * Parses the HTTP response and creates a NotificationHubsMessageResponse with results from the notification.\n * @param response - The HTTP response used to populate the result.\n * @returns A NotificationHubsMessageResponse with results from the notification.\n */\nexport async function parseNotificationSendResponse(\n  response: PipelineResponse,\n): Promise<NotificationHubsMessageResponse> {\n  const result = parseNotificationResponse(response);\n  let notificationId: string | undefined;\n  if (result.location) {\n    const locationUrl = new URL(result.location);\n    notificationId = locationUrl.pathname.split(\"/\")[3];\n  }\n\n  const requestUrl = new URL(response.request.url);\n  const isTestSend = requestUrl.searchParams.has(\"test\");\n  const isDirectSend = requestUrl.searchParams.has(\"direct\");\n\n  // Only broadcast/tag based sends are supported for test send\n  const responseBody = response.bodyAsText;\n  if (isTestSend && !isDirectSend && isDefined(responseBody)) {\n    const outcome = await parseNotificationOutcome(responseBody);\n    return {\n      ...result,\n      ...outcome,\n      notificationId,\n    };\n  } else {\n    return createDefaultResponse(result, notificationId);\n  }\n}\n\nfunction createDefaultResponse(\n  response: NotificationHubsResponse,\n  notificationId?: string,\n): NotificationHubsMessageResponse {\n  return {\n    ...response,\n    notificationId,\n    successCount: 0,\n    failureCount: 0,\n    results: [],\n    state: \"Enqueued\",\n  };\n}\n\n/**\n * Sends a request through the client context.\n * @param context - The client context to use.\n * @param request - The HTTP request to send.\n * @param successStatusCode - A status code or list of status codes to check for success.\n * @returns The HTTP Response.\n */\nexport async function sendRequest(\n  context: NotificationHubsClientContext,\n  request: PipelineRequest,\n  successStatusCode: number | number[],\n): Promise<PipelineResponse> {\n  const statuses: number[] = Array.isArray(successStatusCode)\n    ? successStatusCode\n    : [successStatusCode];\n\n  const response = await context.sendRequest(request);\n\n  if (!statuses.some((statusCode) => statusCode === response.status)) {\n    const responseBody = response.bodyAsText;\n    let details: string | undefined;\n    if (isDefined(responseBody)) {\n      details = await parseXMLError(responseBody);\n    }\n\n    let errorMessage: string | undefined;\n    if (isDefined(details)) {\n      errorMessage = `operations failed with: ${details}`;\n    } else {\n      errorMessage = `operation failed with status ${response.status}`;\n    }\n\n    throw new RestError(errorMessage, {\n      statusCode: response.status,\n      response,\n    });\n  }\n\n  return response;\n}\n"]}
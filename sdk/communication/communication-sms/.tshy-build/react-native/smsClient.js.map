{"version":3,"file":"smsClient.js","sourceRoot":"","sources":["../../src/smsClient.ts"],"names":[],"mappings":"AAAA,uCAAuC;AACvC,kCAAkC;AAClC,4CAA4C;AAE5C,OAAO,EACL,6BAA6B,EAC7B,eAAe,EACf,oBAAoB,GACrB,MAAM,6BAA6B,CAAC;AAErC,OAAO,EAAE,iBAAiB,EAAE,MAAM,kBAAkB,CAAC;AAGrD,OAAO,EAAE,YAAY,EAAE,MAAM,iCAAiC,CAAC;AAC/D,OAAO,EAAE,uBAAuB,EAAE,MAAM,8BAA8B,CAAC;AACvE,OAAO,EAAE,0BAA0B,EAAE,MAAM,qBAAqB,CAAC;AACjE,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAC;AACrC,OAAO,EAAE,aAAa,EAAE,MAAM,4BAA4B,CAAC;AAC3D,OAAO,EAAE,aAAa,IAAI,iBAAiB,EAAE,MAAM,oBAAoB,CAAC;AA8KxE;;;;GAIG;AACH,MAAM,kBAAkB,GAAG,CAAC,OAAY,EAA+B,EAAE,CACvE,CAAC,CAAC,OAAO,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;AAExE;;;GAGG;AACH,MAAM,OAAO,SAAS;IAgCpB,YACE,qBAA6B,EAC7B,mBAAwE,EACxE,eAAiC,EAAE;QAEnC,MAAM,EAAE,GAAG,EAAE,UAAU,EAAE,GAAG,oBAAoB,CAAC,qBAAqB,EAAE,mBAAmB,CAAC,CAAC;QAC7F,MAAM,OAAO,GAAG,kBAAkB,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,YAAY,CAAC;QAE7F,MAAM,uBAAuB,mCACxB,OAAO,GACP;YACD,cAAc,EAAE;gBACd,MAAM,EAAE,MAAM,CAAC,IAAI;aACpB;SACF,CACF,CAAC;QAEF,MAAM,UAAU,GAAG,6BAA6B,CAAC,UAAU,CAAC,CAAC;QAC7D,IAAI,CAAC,GAAG,GAAG,IAAI,YAAY,CAAC,GAAG,EAAE,uBAAuB,CAAC,CAAC;QAC1D,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;QACxC,IAAI,CAAC,OAAO,GAAG,IAAI,iBAAiB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACjD,CAAC;IAED;;;;;OAKG;IACI,KAAK,CAAC,IAAI,CACf,WAA2B,EAC3B,UAA0B,EAAE,oBAAoB,EAAE,KAAK,EAAE;QAEzD,MAAM,EAAE,gBAAgB,EAAE,WAAW,EAAE,GAAG,uBAAuB,CAAC,OAAO,CAAC,CAAC;QAC3E,OAAO,aAAa,CAAC,QAAQ,CAAC,gBAAgB,EAAE,gBAAgB,EAAE,KAAK,EAAE,cAAc,EAAE,EAAE;YACzF,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CACtC,0BAA0B,CAAC,WAAW,EAAE,WAAW,CAAC,EACpD,cAAc,CACf,CAAC;YACF,OAAO,QAAQ,CAAC,KAAK,CAAC;QACxB,CAAC,CAAC,CAAC;IACL,CAAC;CACF","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n/// <reference lib=\"esnext.asynciterable\" />\n\nimport {\n  createCommunicationAuthPolicy,\n  isKeyCredential,\n  parseClientArguments,\n} from \"@azure/communication-common\";\nimport type { KeyCredential, TokenCredential } from \"@azure/core-auth\";\nimport { isTokenCredential } from \"@azure/core-auth\";\nimport type { CommonClientOptions, OperationOptions } from \"@azure/core-client\";\nimport type { InternalPipelineOptions } from \"@azure/core-rest-pipeline\";\nimport { SmsApiClient } from \"./generated/src/smsApiClient.js\";\nimport { extractOperationOptions } from \"./extractOperationOptions.js\";\nimport { generateSendMessageRequest } from \"./utils/smsUtils.js\";\nimport { logger } from \"./logger.js\";\nimport { tracingClient } from \"./generated/src/tracing.js\";\nimport { OptOutsClient as OptOutsClientImpl } from \"./optOutsClient.js\";\n\n/**\n * Client options used to configure SMS Client API requests.\n */\nexport interface SmsClientOptions extends CommonClientOptions {}\n\n/**\n * Values used to configure Sms message\n */\nexport interface SmsSendRequest {\n  /**\n   * The sender's phone number in E.164 format that is owned by the authenticated account.\n   */\n  from: string;\n  /**\n   * The list of recipient's phone number in E.164 format.\n   */\n  to: string[];\n  /**\n   * The contents of the message that will be sent to the recipient. The allowable content is\n   * defined by RFC 5724.\n   */\n  message: string;\n}\n\n/**\n * Options to configure Sms requests.\n */\nexport interface SmsSendOptions extends OperationOptions {\n  /**\n   * Enable this flag to receive a delivery report for this message on the Azure Resource\n   * EventGrid. Default value: false.\n   */\n  enableDeliveryReport?: boolean;\n  /**\n   * Use this field to provide metadata that will then be sent back in the corresponding Delivery\n   * Report.\n   */\n  tag?: string;\n  /** Time to wait for a delivery report. After this time a delivery report with timeout error code is generated. */\n  deliveryReportTimeoutInSeconds?: number;\n}\n\n/**\n * The result of Sms send request.\n */\nexport interface SmsSendResult {\n  /**\n   * The recipient's phone number in E.164 format.\n   */\n  to: string;\n  /**\n   * The identifier of the outgoing Sms message. Only present if message processed.\n   */\n  messageId?: string;\n  /**\n   * HTTP Status code.\n   */\n  httpStatusCode: number;\n  /**\n   * Indicates if the message is processed successfully or not.\n   */\n  successful: boolean;\n  /**\n   * Optional error message in case of 4xx/5xx/repeatable errors.\n   */\n  errorMessage?: string;\n}\n\n/**\n * A OptOutsClient represents a Client to the Azure Communication Sms service allowing you\n * to call Opt Out Management Api methods.\n */\nexport interface OptOutsClient {\n  /**\n   * Adds phone numbers to the optouts list.\n   *\n   * @param from - The sender's phone number\n   * @param to - The recipient's phone numbers\n   * @param options - Additional request options\n   */\n  add(from: string, to: string[], options?: AddOptions): Promise<OptOutAddResult[]>;\n  /**\n   * Checks if phone numbers are in the optouts list.\n   *\n   * @param from - The sender's phone number\n   * @param to - The recipient's phone numbers\n   * @param options - Additional request options\n   */\n  check(from: string, to: string[], options?: CheckOptions): Promise<OptOutCheckResult[]>;\n  /**\n   * Removes phone numbers from the optouts list.\n   *\n   * @param from - The sender's phone number\n   * @param to - The recipient's phone numbers\n   * @param options - Additional request options\n   */\n  remove(from: string, to: string[], options?: RemoveOptions): Promise<OptOutRemoveResult[]>;\n}\n\n/**\n * Client options used to configure OptOuts Client API Add requests.\n */\nexport interface AddOptions extends OperationOptions {}\n\n/**\n * Client options used to configure OptOuts Client API Check requests.\n */\nexport interface CheckOptions extends OperationOptions {}\n\n/**\n * Client options used to configure OptOuts Client API Remove requests.\n */\nexport interface RemoveOptions extends OperationOptions {}\n\n/**\n * The result of Opt Out Check request.\n */\nexport interface OptOutCheckResult {\n  /**\n   * The recipient's phone number in E.164 format.\n   */\n  to: string;\n  /**\n   * Indicates if the recipient's phone number in opted out from receiving messages or not.\n   */\n  isOptedOut: boolean;\n  /**\n   * HTTP Status code.\n   */\n  httpStatusCode: number;\n  /**\n   * Optional error message in case of 4xx/5xx/repeatable errors.\n   */\n  errorMessage?: string;\n}\n\n/**\n * The result of Opt Out Add request.\n */\nexport interface OptOutAddResult {\n  /**\n   * The recipient's phone number in E.164 format.\n   */\n  to: string;\n  /**\n   * HTTP Status code.\n   */\n  httpStatusCode: number;\n  /**\n   * Optional error message in case of 4xx/5xx/repeatable errors.\n   */\n  errorMessage?: string;\n}\n\n/**\n * The result of Opt Out Remove request.\n */\nexport interface OptOutRemoveResult {\n  /**\n   * The recipient's phone number in E.164 format.\n   */\n  to: string;\n  /**\n   * HTTP Status code.\n   */\n  httpStatusCode: number;\n  /**\n   * Optional error message in case of 4xx/5xx/repeatable errors.\n   */\n  errorMessage?: string;\n}\n\n/**\n * Checks whether the type of a value is SmsClientOptions or not.\n *\n * @param options - The value being checked.\n */\nconst isSmsClientOptions = (options: any): options is SmsClientOptions =>\n  !!options && !isTokenCredential(options) && !isKeyCredential(options);\n\n/**\n * A SmsClient represents a Client to the Azure Communication Sms service allowing you\n * to send SMS messages.\n */\nexport class SmsClient {\n  private readonly api: SmsApiClient;\n  /**\n   * A OptOutsClient represents a Client to the Azure Communication Sms service allowing you\n   * to call Opt Out Management Api methods.\n   */\n  public optOuts: OptOutsClient;\n\n  /**\n   * Initializes a new instance of the SmsClient class.\n   * @param connectionString - Connection string to connect to an Azure Communication Service resource.\n   *                         Example: \"endpoint=https://contoso.eastus.communications.azure.net/;accesskey=secret\";\n   * @param options - Optional. Options to configure the HTTP pipeline.\n   */\n  constructor(connectionString: string, options?: SmsClientOptions);\n\n  /**\n   * Initializes a new instance of the SmsClient class using an Azure KeyCredential.\n   * @param endpoint - The endpoint of the service (ex: https://contoso.eastus.communications.azure.net).\n   * @param credential - An object that is used to authenticate requests to the service. Use the Azure KeyCredential or `@azure/identity` to create a credential.\n   * @param options - Optional. Options to configure the HTTP pipeline.\n   */\n  constructor(endpoint: string, credential: KeyCredential, options?: SmsClientOptions);\n\n  /**\n   * Initializes a new instance of the SmsClient class using a TokenCredential.\n   * @param endpoint - The endpoint of the service (ex: https://contoso.eastus.communications.azure.net).\n   * @param credential - TokenCredential that is used to authenticate requests to the service.\n   * @param options - Optional. Options to configure the HTTP pipeline.\n   */\n  constructor(endpoint: string, credential: TokenCredential, options?: SmsClientOptions);\n\n  constructor(\n    connectionStringOrUrl: string,\n    credentialOrOptions?: KeyCredential | TokenCredential | SmsClientOptions,\n    maybeOptions: SmsClientOptions = {},\n  ) {\n    const { url, credential } = parseClientArguments(connectionStringOrUrl, credentialOrOptions);\n    const options = isSmsClientOptions(credentialOrOptions) ? credentialOrOptions : maybeOptions;\n\n    const internalPipelineOptions: InternalPipelineOptions = {\n      ...options,\n      ...{\n        loggingOptions: {\n          logger: logger.info,\n        },\n      },\n    };\n\n    const authPolicy = createCommunicationAuthPolicy(credential);\n    this.api = new SmsApiClient(url, internalPipelineOptions);\n    this.api.pipeline.addPolicy(authPolicy);\n    this.optOuts = new OptOutsClientImpl(this.api);\n  }\n\n  /**\n   * Sends an SMS from a phone number that is acquired by the authenticated account, to another phone number.\n   *\n   * @param sendRequest - Provides the sender's and recipient's phone numbers, and the contents of the message\n   * @param options - Additional request options\n   */\n  public async send(\n    sendRequest: SmsSendRequest,\n    options: SmsSendOptions = { enableDeliveryReport: false },\n  ): Promise<SmsSendResult[]> {\n    const { operationOptions, restOptions } = extractOperationOptions(options);\n    return tracingClient.withSpan(\"SmsClient-Send\", operationOptions, async (updatedOptions) => {\n      const response = await this.api.sms.send(\n        generateSendMessageRequest(sendRequest, restOptions),\n        updatedOptions,\n      );\n      return response.value;\n    });\n  }\n}\n"]}
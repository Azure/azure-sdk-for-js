/*
 * Copyright (c) Microsoft Corporation.
 * Licensed under the MIT License.
 *
 * Code generated by Microsoft (R) AutoRest Code Generator.
 * Changes may cause incorrect behavior and will be lost if the code is regenerated.
 */

import { PagedAsyncIterableIterator, PageSettings } from "@azure/core-paging";
import { setContinuationToken } from "../pagingHelper";
import { LogicApps } from "../operationsInterfaces";
import * as coreClient from "@azure/core-client";
import * as Mappers from "../models/mappers";
import * as Parameters from "../models/parameters";
import { ContainerAppsAPIClient } from "../containerAppsAPIClient";
import {
  WorkflowEnvelope,
  LogicAppsListWorkflowsNextOptionalParams,
  LogicAppsListWorkflowsOptionalParams,
  LogicAppsListWorkflowsResponse,
  LogicAppsGetOptionalParams,
  LogicAppsGetResponse,
  LogicApp,
  LogicAppsCreateOrUpdateOptionalParams,
  LogicAppsCreateOrUpdateResponse,
  LogicAppsDeleteOptionalParams,
  LogicAppsGetWorkflowOptionalParams,
  LogicAppsGetWorkflowResponse,
  LogicAppsDeployWorkflowArtifactsOptionalParams,
  LogicAppsListWorkflowsConnectionsOptionalParams,
  LogicAppsListWorkflowsConnectionsResponse,
  LogicAppsProxyMethod,
  LogicAppsInvokeOptionalParams,
  LogicAppsInvokeResponse,
  LogicAppsListWorkflowsNextResponse,
} from "../models";

/// <reference lib="esnext.asynciterable" />
/** Class containing LogicApps operations. */
export class LogicAppsImpl implements LogicApps {
  private readonly client: ContainerAppsAPIClient;

  /**
   * Initialize a new instance of the class LogicApps class.
   * @param client Reference to the service client
   */
  constructor(client: ContainerAppsAPIClient) {
    this.client = client;
  }

  /**
   * List the workflows for a logic app.
   * @param resourceGroupName The name of the resource group. The name is case insensitive.
   * @param containerAppName Name of the Container App.
   * @param logicAppName Name of the Logic App, the extension resource.
   * @param options The options parameters.
   */
  public listWorkflows(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    options?: LogicAppsListWorkflowsOptionalParams,
  ): PagedAsyncIterableIterator<WorkflowEnvelope> {
    const iter = this.listWorkflowsPagingAll(
      resourceGroupName,
      containerAppName,
      logicAppName,
      options,
    );
    return {
      next() {
        return iter.next();
      },
      [Symbol.asyncIterator]() {
        return this;
      },
      byPage: (settings?: PageSettings) => {
        if (settings?.maxPageSize) {
          throw new Error("maxPageSize is not supported by this operation.");
        }
        return this.listWorkflowsPagingPage(
          resourceGroupName,
          containerAppName,
          logicAppName,
          options,
          settings,
        );
      },
    };
  }

  private async *listWorkflowsPagingPage(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    options?: LogicAppsListWorkflowsOptionalParams,
    settings?: PageSettings,
  ): AsyncIterableIterator<WorkflowEnvelope[]> {
    let result: LogicAppsListWorkflowsResponse;
    let continuationToken = settings?.continuationToken;
    if (!continuationToken) {
      result = await this._listWorkflows(
        resourceGroupName,
        containerAppName,
        logicAppName,
        options,
      );
      let page = result.value || [];
      continuationToken = result.nextLink;
      setContinuationToken(page, continuationToken);
      yield page;
    }
    while (continuationToken) {
      result = await this._listWorkflowsNext(
        resourceGroupName,
        containerAppName,
        logicAppName,
        continuationToken,
        options,
      );
      continuationToken = result.nextLink;
      let page = result.value || [];
      setContinuationToken(page, continuationToken);
      yield page;
    }
  }

  private async *listWorkflowsPagingAll(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    options?: LogicAppsListWorkflowsOptionalParams,
  ): AsyncIterableIterator<WorkflowEnvelope> {
    for await (const page of this.listWorkflowsPagingPage(
      resourceGroupName,
      containerAppName,
      logicAppName,
      options,
    )) {
      yield* page;
    }
  }

  /**
   * Gets a logic app extension resource.
   * @param resourceGroupName The name of the resource group. The name is case insensitive.
   * @param containerAppName Name of the Container App.
   * @param logicAppName Name of the Logic App, the extension resource.
   * @param options The options parameters.
   */
  get(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    options?: LogicAppsGetOptionalParams,
  ): Promise<LogicAppsGetResponse> {
    return this.client.sendOperationRequest(
      { resourceGroupName, containerAppName, logicAppName, options },
      getOperationSpec,
    );
  }

  /**
   * Create or update a Logic App extension resource
   * @param resourceGroupName The name of the resource group. The name is case insensitive.
   * @param containerAppName Name of the Container App.
   * @param logicAppName Name of the Logic App, the extension resource.
   * @param resource Logic app resource properties.
   * @param options The options parameters.
   */
  createOrUpdate(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    resource: LogicApp,
    options?: LogicAppsCreateOrUpdateOptionalParams,
  ): Promise<LogicAppsCreateOrUpdateResponse> {
    return this.client.sendOperationRequest(
      { resourceGroupName, containerAppName, logicAppName, resource, options },
      createOrUpdateOperationSpec,
    );
  }

  /**
   * Deletes a Logic App extension resource
   * @param resourceGroupName The name of the resource group. The name is case insensitive.
   * @param containerAppName Name of the Container App.
   * @param logicAppName Name of the Logic App, the extension resource.
   * @param options The options parameters.
   */
  delete(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    options?: LogicAppsDeleteOptionalParams,
  ): Promise<void> {
    return this.client.sendOperationRequest(
      { resourceGroupName, containerAppName, logicAppName, options },
      deleteOperationSpec,
    );
  }

  /**
   * List the workflows for a logic app.
   * @param resourceGroupName The name of the resource group. The name is case insensitive.
   * @param containerAppName Name of the Container App.
   * @param logicAppName Name of the Logic App, the extension resource.
   * @param options The options parameters.
   */
  private _listWorkflows(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    options?: LogicAppsListWorkflowsOptionalParams,
  ): Promise<LogicAppsListWorkflowsResponse> {
    return this.client.sendOperationRequest(
      { resourceGroupName, containerAppName, logicAppName, options },
      listWorkflowsOperationSpec,
    );
  }

  /**
   * Get workflow information by its name
   * @param resourceGroupName The name of the resource group. The name is case insensitive.
   * @param containerAppName Name of the Container App.
   * @param logicAppName Name of the Logic App, the extension resource.
   * @param workflowName Workflow name.
   * @param options The options parameters.
   */
  getWorkflow(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    workflowName: string,
    options?: LogicAppsGetWorkflowOptionalParams,
  ): Promise<LogicAppsGetWorkflowResponse> {
    return this.client.sendOperationRequest(
      {
        resourceGroupName,
        containerAppName,
        logicAppName,
        workflowName,
        options,
      },
      getWorkflowOperationSpec,
    );
  }

  /**
   * Creates or updates the artifacts for the logic app
   * @param resourceGroupName The name of the resource group. The name is case insensitive.
   * @param containerAppName Name of the Container App.
   * @param logicAppName Name of the Logic App, the extension resource.
   * @param options The options parameters.
   */
  deployWorkflowArtifacts(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    options?: LogicAppsDeployWorkflowArtifactsOptionalParams,
  ): Promise<void> {
    return this.client.sendOperationRequest(
      { resourceGroupName, containerAppName, logicAppName, options },
      deployWorkflowArtifactsOperationSpec,
    );
  }

  /**
   * Gets logic app's connections.
   * @param resourceGroupName The name of the resource group. The name is case insensitive.
   * @param containerAppName Name of the Container App.
   * @param logicAppName Name of the Logic App, the extension resource.
   * @param options The options parameters.
   */
  listWorkflowsConnections(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    options?: LogicAppsListWorkflowsConnectionsOptionalParams,
  ): Promise<LogicAppsListWorkflowsConnectionsResponse> {
    return this.client.sendOperationRequest(
      { resourceGroupName, containerAppName, logicAppName, options },
      listWorkflowsConnectionsOperationSpec,
    );
  }

  /**
   * Proxies a the API call to the logic app backed by the container app.
   * @param resourceGroupName The name of the resource group. The name is case insensitive.
   * @param containerAppName Name of the Container App.
   * @param logicAppName Name of the LogicApp App, the extension resource.
   * @param xMsLogicAppsProxyPath The proxy path for the API call
   * @param xMsLogicAppsProxyMethod The proxy method for the API call
   * @param options The options parameters.
   */
  invoke(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    xMsLogicAppsProxyPath: string,
    xMsLogicAppsProxyMethod: LogicAppsProxyMethod,
    options?: LogicAppsInvokeOptionalParams,
  ): Promise<LogicAppsInvokeResponse> {
    return this.client.sendOperationRequest(
      {
        resourceGroupName,
        containerAppName,
        logicAppName,
        xMsLogicAppsProxyPath,
        xMsLogicAppsProxyMethod,
        options,
      },
      invokeOperationSpec,
    );
  }

  /**
   * ListWorkflowsNext
   * @param resourceGroupName The name of the resource group. The name is case insensitive.
   * @param containerAppName Name of the Container App.
   * @param logicAppName Name of the Logic App, the extension resource.
   * @param nextLink The nextLink from the previous successful call to the ListWorkflows method.
   * @param options The options parameters.
   */
  private _listWorkflowsNext(
    resourceGroupName: string,
    containerAppName: string,
    logicAppName: string,
    nextLink: string,
    options?: LogicAppsListWorkflowsNextOptionalParams,
  ): Promise<LogicAppsListWorkflowsNextResponse> {
    return this.client.sendOperationRequest(
      { resourceGroupName, containerAppName, logicAppName, nextLink, options },
      listWorkflowsNextOperationSpec,
    );
  }
}
// Operation Specifications
const serializer = coreClient.createSerializer(Mappers, /* isXml */ false);

const getOperationSpec: coreClient.OperationSpec = {
  path: "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.App/containerApps/{containerAppName}/providers/Microsoft.App/logicApps/{logicAppName}",
  httpMethod: "GET",
  responses: {
    200: {
      bodyMapper: Mappers.LogicApp,
    },
    default: {
      bodyMapper: Mappers.DefaultErrorResponse,
    },
  },
  queryParameters: [Parameters.apiVersion],
  urlParameters: [
    Parameters.$host,
    Parameters.subscriptionId,
    Parameters.resourceGroupName,
    Parameters.containerAppName1,
    Parameters.logicAppName,
  ],
  headerParameters: [Parameters.accept],
  serializer,
};
const createOrUpdateOperationSpec: coreClient.OperationSpec = {
  path: "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.App/containerApps/{containerAppName}/providers/Microsoft.App/logicApps/{logicAppName}",
  httpMethod: "PUT",
  responses: {
    200: {
      bodyMapper: Mappers.LogicApp,
    },
    201: {
      bodyMapper: Mappers.LogicApp,
    },
    default: {
      bodyMapper: Mappers.DefaultErrorResponse,
    },
  },
  requestBody: Parameters.resource,
  queryParameters: [Parameters.apiVersion],
  urlParameters: [
    Parameters.$host,
    Parameters.subscriptionId,
    Parameters.resourceGroupName,
    Parameters.containerAppName1,
    Parameters.logicAppName,
  ],
  headerParameters: [Parameters.contentType, Parameters.accept],
  mediaType: "json",
  serializer,
};
const deleteOperationSpec: coreClient.OperationSpec = {
  path: "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.App/containerApps/{containerAppName}/providers/Microsoft.App/logicApps/{logicAppName}",
  httpMethod: "DELETE",
  responses: {
    200: {},
    204: {},
    default: {
      bodyMapper: Mappers.DefaultErrorResponse,
    },
  },
  queryParameters: [Parameters.apiVersion],
  urlParameters: [
    Parameters.$host,
    Parameters.subscriptionId,
    Parameters.resourceGroupName,
    Parameters.containerAppName1,
    Parameters.logicAppName,
  ],
  headerParameters: [Parameters.accept],
  serializer,
};
const listWorkflowsOperationSpec: coreClient.OperationSpec = {
  path: "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.App/containerApps/{containerAppName}/providers/Microsoft.App/logicApps/{logicAppName}/workflows",
  httpMethod: "GET",
  responses: {
    200: {
      bodyMapper: Mappers.WorkflowEnvelopeCollection,
    },
    default: {
      bodyMapper: Mappers.DefaultErrorResponse,
    },
  },
  queryParameters: [Parameters.apiVersion],
  urlParameters: [
    Parameters.$host,
    Parameters.subscriptionId,
    Parameters.resourceGroupName,
    Parameters.containerAppName1,
    Parameters.logicAppName,
  ],
  headerParameters: [Parameters.accept],
  serializer,
};
const getWorkflowOperationSpec: coreClient.OperationSpec = {
  path: "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.App/containerApps/{containerAppName}/providers/Microsoft.App/logicApps/{logicAppName}/workflows/{workflowName}",
  httpMethod: "GET",
  responses: {
    200: {
      bodyMapper: Mappers.WorkflowEnvelope,
    },
    default: {
      bodyMapper: Mappers.DefaultErrorResponse,
    },
  },
  queryParameters: [Parameters.apiVersion],
  urlParameters: [
    Parameters.$host,
    Parameters.subscriptionId,
    Parameters.resourceGroupName,
    Parameters.containerAppName1,
    Parameters.logicAppName,
    Parameters.workflowName,
  ],
  headerParameters: [Parameters.accept],
  serializer,
};
const deployWorkflowArtifactsOperationSpec: coreClient.OperationSpec = {
  path: "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.App/containerApps/{containerAppName}/providers/Microsoft.App/logicApps/{logicAppName}/deployWorkflowArtifacts",
  httpMethod: "POST",
  responses: {
    200: {},
    default: {
      bodyMapper: Mappers.DefaultErrorResponse,
    },
  },
  requestBody: Parameters.workflowArtifacts,
  queryParameters: [Parameters.apiVersion],
  urlParameters: [
    Parameters.$host,
    Parameters.subscriptionId,
    Parameters.resourceGroupName,
    Parameters.containerAppName1,
    Parameters.logicAppName,
  ],
  headerParameters: [Parameters.contentType, Parameters.accept],
  mediaType: "json",
  serializer,
};
const listWorkflowsConnectionsOperationSpec: coreClient.OperationSpec = {
  path: "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.App/containerApps/{containerAppName}/providers/Microsoft.App/logicApps/{logicAppName}/listWorkflowsConnections",
  httpMethod: "POST",
  responses: {
    200: {
      bodyMapper: Mappers.WorkflowEnvelope,
    },
    default: {
      bodyMapper: Mappers.DefaultErrorResponse,
    },
  },
  queryParameters: [Parameters.apiVersion],
  urlParameters: [
    Parameters.$host,
    Parameters.subscriptionId,
    Parameters.resourceGroupName,
    Parameters.containerAppName1,
    Parameters.logicAppName,
  ],
  headerParameters: [Parameters.accept],
  serializer,
};
const invokeOperationSpec: coreClient.OperationSpec = {
  path: "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.App/containerApps/{containerAppName}/providers/Microsoft.App/logicApps/{logicAppName}/invoke",
  httpMethod: "POST",
  responses: {
    200: {
      bodyMapper: {
        type: { name: "Dictionary", value: { type: { name: "any" } } },
      },
    },
    default: {
      bodyMapper: Mappers.DefaultErrorResponse,
    },
  },
  queryParameters: [Parameters.apiVersion],
  urlParameters: [
    Parameters.$host,
    Parameters.subscriptionId,
    Parameters.resourceGroupName,
    Parameters.containerAppName1,
    Parameters.logicAppName,
  ],
  headerParameters: [
    Parameters.accept,
    Parameters.xMsLogicAppsProxyPath,
    Parameters.xMsLogicAppsProxyMethod,
  ],
  serializer,
};
const listWorkflowsNextOperationSpec: coreClient.OperationSpec = {
  path: "{nextLink}",
  httpMethod: "GET",
  responses: {
    200: {
      bodyMapper: Mappers.WorkflowEnvelopeCollection,
    },
    default: {
      bodyMapper: Mappers.DefaultErrorResponse,
    },
  },
  urlParameters: [
    Parameters.$host,
    Parameters.subscriptionId,
    Parameters.resourceGroupName,
    Parameters.nextLink,
    Parameters.containerAppName1,
    Parameters.logicAppName,
  ],
  headerParameters: [Parameters.accept],
  serializer,
};

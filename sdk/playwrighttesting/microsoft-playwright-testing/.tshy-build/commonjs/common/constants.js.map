{"version":3,"file":"constants.js","sourceRoot":"","sources":["../../../src/common/constants.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\nimport type { ApiErrorMessage } from \"./types.js\";\n\nexport const EntraIdAccessTokenConstants = {\n  LIFETIME_LEFT_THRESHOLD_IN_MINUTES_FOR_ROTATION: 15,\n  SCOPE: \"https://management.core.windows.net/.default\",\n  ROTATION_INTERVAL_PERIOD_IN_MINUTES: 4,\n};\n\n/** @public\n *\n * OS types supported on Microsoft Playwright Testing cloud hosted browsers\n */\nexport const ServiceOS = {\n  LINUX: \"linux\",\n  WINDOWS: \"windows\",\n} as const;\n\n/** @public\n *\n * Authentication types supported on Microsoft Playwright Testing\n */\nexport const ServiceAuth = {\n  ENTRA_ID: \"ENTRA_ID\",\n  ACCESS_TOKEN: \"ACCESS_TOKEN\",\n} as const;\n\n/** @public\n *\n * Environment variables used by Microsoft Playwright Testing\n */\nexport const ServiceEnvironmentVariable = {\n  PLAYWRIGHT_SERVICE_ACCESS_TOKEN: \"PLAYWRIGHT_SERVICE_ACCESS_TOKEN\",\n  PLAYWRIGHT_SERVICE_URL: \"PLAYWRIGHT_SERVICE_URL\",\n};\n\nexport const DefaultConnectOptionsConstants = {\n  DEFAULT_TIMEOUT: 30000,\n  DEFAULT_SLOW_MO: 0,\n  DEFAULT_EXPOSE_NETWORK: \"<loopback>\",\n  DEFAULT_SERVICE_OS: ServiceOS.LINUX,\n};\n\nexport const API_VERSION = \"2023-10-01-preview\";\n\n// Do not put an ending slash for the urls,\n// for example use https://www.microsoft.com/en-in and not https://www.microsoft.com/en-in/\n\nexport class Constants {\n  // Config related constants\n  public static readonly TEST_FRAMEWORK_NAME = \"PLAYWRIGHT\";\n  public static readonly TEST_FRAMEWORK_RUNNERNAME = \"PLAYWRIGHT\";\n  public static readonly TEST_TYPE = \"WebTest\";\n  public static readonly TEST_SDK_LANGUAGE = \"JAVASCRIPT\";\n  // Placeholder version\n  public static readonly DEFAULT_DASHBOARD_ENDPOINT = \"https://playwright.microsoft.com\";\n  public static readonly DEFAULT_SERVICE_ENDPOINT =\n    \"https://{region}.reporting.api.playwright-test.io\";\n  public static readonly DEFAULT_REDACTED_MESSAGE = \"***REDACTED***\";\n  public static readonly SAS_URI_SEPARATOR = \"?\";\n  public static readonly DEFAULT_TEST_RUN_NAME = \"MPTReporterTests\";\n  public static readonly TEST_BATCH_SIZE = 50;\n  public static readonly UPLOAD_MODE = \"sdk\";\n  public static readonly GIT_VERSION_COMMAND = \"git --version\";\n  public static readonly GIT_REV_PARSE = \"git rev-parse --is-inside-work-tree\";\n  public static readonly GIT_COMMIT_MESSAGE_COMMAND = 'git log -1 --pretty=format:\"%s\"';\n  public static readonly ERROR_MESSAGES_MAX_LENGTH = 100;\n  public static readonly sevenDaysInMs = 7 * 24 * 60 * 60 * 1000;\n  public static readonly oneDayInMs = 24 * 60 * 60 * 1000;\n  public static readonly API_VERSION = \"2024-09-01-preview\";\n  public static readonly OS = \"Os\";\n  public static readonly NON_RETRYABLE_STATUS_CODES = [400, 403, 404, 405, 409];\n  public static readonly SupportedRegions: string[] = [\n    \"eastus\",\n    \"eastasia\",\n    \"westeurope\",\n    \"westus3\",\n    \"centraluseuap\",\n    \"eastus2euap\",\n  ];\n  // Error messages\n  public static readonly CONFLICT_409_ERROR_MESSAGE =\n    \"Test run with id {runId} already exists. Provide a unique run id.\";\n  public static readonly FORBIDDEN_403_ERROR_MESSAGE = `You do not have the required permissions to upload test results. This could be because\n\n  a. Reporting is not enabled for your workspace {workspaceId}. Enable the Reporting feature under Feature management settings using the Playwright portal: https://playwright.microsoft.com/workspaces/{workspaceId}/settings/general\n  b. You do not have the required roles on the workspace. Only Owner and Contributor roles can run tests. Contact the service administrator.\n  c. The workspace you are trying to run the tests on is in a different Azure tenant than what you are signed into. Check the tenant id from Azure portal (https://aka.ms/mpt/find-tenant-id) and login using the command 'az login --tenant <TENANT_ID>\n  `;\n  // API Endpoints\n  public static readonly testRunsEndpoint: string = \"workspaces/{workspaceId}/test-runs\";\n  public static readonly testRunsShardEndpoint: string =\n    \"workspaces/{workspaceId}/test-runs/{testRunId}:updateShardExecutionStatus\";\n  public static readonly storageUriEndpoint: string =\n    \"workspaces/{workspaceId}/test-runs/{testRunId}:createArtifactsUploadBaseUri\";\n  public static readonly testResultsEndpoint: string =\n    \"workspaces/{workspaceId}/test-results/upload-batch\";\n  public static readonly patchTestRun: string = \"patchTestRun\";\n  public static readonly getTestRun: string = \"getTestRun\";\n  public static readonly patchTestRunShardStart: string = \"patchTestRunShardStart\";\n  public static readonly patchTestRunShardEnd: string = \"patchTestRunShardEnd\";\n  public static readonly postTestResults: string = \"postTestResults\";\n  public static readonly getStorageUri: string = \"getStorageUri\";\n  public static readonly ERROR_MESSAGE: ApiErrorMessage = {\n    patchTestRun: {\n      400: \"The request made to the server is invalid. Please check the request parameters and try again.\",\n      401: \"The authentication token provided is invalid. Please check the token and try again.\",\n      500: \"An unexpected error occurred on our server. Our team is working to resolve the issue. Please try again later, or contact support if the problem continues.\",\n      429: \"You have exceeded the rate limit for the API. Please wait and try again later.\",\n      504: \"The request to the service timed out. Please try again later.\",\n      503: \"The service is currently unavailable. Please check the service status and try again.\",\n    },\n    getTestRun: {\n      400: \"The request made to the server is invalid. Please check the request parameters and try again.\",\n      401: \"The authentication token provided is invalid. Please check the token and try again.\",\n      403: \"You do not have the required permissions to run tests. Please contact your workspace administrator.\",\n      500: \"An unexpected error occurred on our server. Our team is working to resolve the issue. Please try again later, or contact support if the problem continues.\",\n      429: \"You have exceeded the rate limit for the API. Please wait and try again later.\",\n      504: \"The request to the service timed out. Please try again later.\",\n      503: \"The service is currently unavailable. Please check the service status and try again.\",\n    },\n    patchTestRunShardStart: {\n      400: \"The request made to the server is invalid. Please check the request parameters and try again.\",\n      401: \"The authentication token provided is invalid. Please check the token and try again.\",\n      403: \"You do not have the required permissions to run tests. Please contact your workspace administrator.\",\n      500: \"An unexpected error occurred on our server. Our team is working to resolve the issue. Please try again later, or contact support if the problem continues.\",\n      429: \"You have exceeded the rate limit for the API. Please wait and try again later.\",\n      504: \"The request to the service timed out. Please try again later.\",\n      503: \"The service is currently unavailable. Please check the service status and try again.\",\n    },\n    patchTestRunShardEnd: {\n      400: \"The request made to the server is invalid. Please check the request parameters and try again.\",\n      401: \"The authentication token provided is invalid. Please check the token and try again.\",\n      403: \"You do not have the required permissions to run tests. Please contact your workspace administrator.\",\n      500: \"An unexpected error occurred on our server. Our team is working to resolve the issue. Please try again later, or contact support if the problem continues.\",\n      429: \"You have exceeded the rate limit for the API. Please wait and try again later.\",\n      504: \"The request to the service timed out. Please try again later.\",\n      503: \"The service is currently unavailable. Please check the service status and try again.\",\n    },\n    postTestResults: {\n      400: \"The request made to the server is invalid. Please check the request parameters and try again.\",\n      401: \"The authentication token provided is invalid. Please check the token and try again.\",\n      403: \"You do not have the required permissions to run tests. Please contact your workspace administrator.\",\n      500: \"An unexpected error occurred on our server. Our team is working to resolve the issue. Please try again later, or contact support if the problem continues.\",\n      429: \"You have exceeded the rate limit for the API. Please wait and try again later.\",\n      504: \"The request to the service timed out. Please try again later.\",\n      503: \"The service is currently unavailable. Please check the service status and try again.\",\n    },\n    getStorageUri: {\n      400: \"The request made to the server is invalid. Please check the request parameters and try again.\",\n      401: \"The authentication token provided is invalid. Please check the token and try again.\",\n      403: \"You do not have the required permissions to run tests. Please contact your workspace administrator.\",\n      500: \"An unexpected error occurred on our server. Our team is working to resolve the issue. Please try again later, or contact support if the problem continues.\",\n      429: \"You have exceeded the rate limit for the API. Please wait and try again later.\",\n      504: \"The request to the service timed out. Please try again later.\",\n      503: \"The service is currently unavailable. Please check the service status and try again.\",\n    },\n  };\n}\n\nexport const TestErrorType = {\n  Scalable: \"Scalable\",\n  Reporting: \"Reporting\",\n};\n\nexport const TestResultErrorConstants = [\n  {\n    key: \"401\",\n    message: \"The authentication token provided is invalid. Please check the token and try again.\",\n    pattern: /(?=.*browserType\\.connect)(?=.*401 Unauthorized)/i,\n    type: TestErrorType.Scalable,\n  },\n  {\n    key: \"NoPermissionOnWorkspace_Scalable\",\n    message: `You do not have the required permissions to run tests. This could be because:\n\n    a. You do not have the required roles on the workspace. Only Owner and Contributor roles can run tests. Contact the service administrator.\n    b. The workspace you are trying to run the tests on is in a different Azure tenant than what you are signed into. Check the tenant id from Azure portal (https://aka.ms/mpt/find-tenant-id) and login using the command 'az login --tenant <TENANT_ID>'.\n    `,\n    pattern:\n      /(?=.*browserType\\.connect)(?=.*403 Forbidden)(?=[\\s\\S]*CheckAccess API call with non successful response)/i,\n    type: TestErrorType.Scalable,\n  },\n  {\n    key: \"InvalidWorkspace_Scalable\",\n    message: \"The specified workspace does not exist. Please verify your workspace settings.\",\n    pattern:\n      /(?=.*browserType\\.connect)(?=.*403 Forbidden)(?=[\\s\\S]*InvalidAccountOrSubscriptionState)/i,\n    type: TestErrorType.Scalable,\n  },\n  {\n    key: \"InvalidAccessToken\",\n    message:\n      \"The provided access token does not match the specified workspace URL. Please verify that both values are correct.\",\n    pattern: /(?=.*browserType\\.connect)(?=.*403 Forbidden)(?=[\\s\\S]*InvalidAccessToken)/i,\n    type: TestErrorType.Scalable,\n  },\n  {\n    key: \"AccessTokenOrUserOrWorkspaceNotFound_Scalable\",\n    message:\n      \"The data for the user, workspace or access token was not found. Please check the request or create new token and try again.\",\n    pattern: /(?=.*browserType\\.connect)(?=.*404 Not Found)(?=[\\s\\S]*NotFound)/i,\n    type: TestErrorType.Scalable,\n  },\n  {\n    key: \"AccessKeyBasedAuthNotSupported_Scalable\",\n    message:\n      \"Authentication through service access token is disabled for this workspace. Please use Entra ID to authenticate.\",\n    pattern:\n      /(?=.*browserType\\.connect)(?=.*403 Forbidden)(?=[\\s\\S]*AccessKeyBasedAuthNotSupported)/i,\n    type: TestErrorType.Scalable,\n  },\n  {\n    key: \"503\",\n    message: \"The service is currently unavailable. Please check the service status and try again.\",\n    pattern: /(?=.*browserType\\.connect)(?=.*503 Service Unavailable)/i,\n    type: TestErrorType.Scalable,\n  },\n  {\n    key: \"504\",\n    message: \"The request to the service timed out. Please try again later.\",\n    pattern: /(?=.*browserType\\.connect)(?=.*504 Gateway Timeout)/i,\n    type: TestErrorType.Scalable,\n  },\n  {\n    key: \"QuotaLimitError_Scalable\",\n    message:\n      \"It is possible that the maximum number of concurrent sessions allowed for your workspace has been exceeded. Check the quota at https://aka.ms/mpt/resource-quota.\",\n    pattern: /(?=.*browserType\\.connect): (?=.*Timeout .* exceeded)/i,\n    type: TestErrorType.Scalable,\n  },\n  {\n    key: \"BrowserConnectionError_Scalable\",\n    message: \"The service is currently unavailable. Please try again after some time.\",\n    pattern: /(?=.*browserType\\.connect): (?=.Target page, context or browser has been closed)/i,\n    type: TestErrorType.Scalable,\n  },\n];\n\nexport const InternalEnvironmentVariables = {\n  MPT_PLAYWRIGHT_VERSION: \"_MPT_PLAYWRIGHT_VERSION\",\n  MPT_SETUP_FATAL_ERROR: \"_MPT_SETUP_FATAL_ERROR\",\n  MPT_SERVICE_RUN_NAME: \"_MPT_SERVICE_RUN_NAME\",\n  MPT_SERVICE_RUN_ID: \"_MPT_SERVICE_RUN_ID\",\n  MPT_CLOUD_HOSTED_BROWSER_USED: \"_MPT_CLOUD_HOSTED_BROWSER_USED\",\n  MPT_SERVICE_OS: \"_MPT_SERVICE_OS\",\n  MPT_SERVICE_REPORTING_URL: \"_MPT_SERVICE_REPORTING_URL\",\n  ONE_TIME_OPERATION_FLAG: \"_ONE_TIME_OPERATION_FLAG\",\n};\n\nexport const MINIMUM_SUPPORTED_PLAYWRIGHT_VERSION = \"1.47.0\";\n"]}
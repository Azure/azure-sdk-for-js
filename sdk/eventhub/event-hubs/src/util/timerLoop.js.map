{"version":3,"file":"timerLoop.js","sourceRoot":"","sources":["timerLoop.ts"],"names":[],"mappings":"AAAA,uCAAuC;AACvC,kCAAkC;AAElC,OAAO,EAAE,MAAM,EAAE,MAAM,cAAc,CAAC;AAuBtC;;;GAGG;AACH,MAAM,UAAU,eAAe,CAC7B,WAAmB,EACnB,UAAkC;IAElC,IAAI,KAAoC,CAAC;IACzC,MAAM,IAAI,GAAG;QACX,KAAK,EAAE,GAAG,EAAE;YACV,YAAY,CAAC,KAAK,CAAC,CAAC;YACpB,KAAK,GAAG,UAAU,CAAC,GAAG,EAAE;gBACtB,sDAAsD;gBACtD,UAAU,EAAE;qBACT,KAAK,CAAC,CAAC,GAAG,EAAE,EAAE;oBACb,MAAM,CAAC,OAAO,CAAC,8BAA8B,EAAE,GAAG,CAAC,CAAC;gBACtD,CAAC,CAAC;qBACD,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC;qBACnB,KAAK,CAAC,CAAC,GAAG,EAAE,EAAE;oBACb,MAAM,CAAC,OAAO,CAAC,uCAAuC,EAAE,GAAG,CAAC,CAAC;gBAC/D,CAAC,CAAC,CAAC;YACP,CAAC,EAAE,WAAW,CAAC,CAAC;YAChB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACxB,CAAC;QACD,IAAI,EAAE,GAAG,EAAE;YACT,YAAY,CAAC,KAAK,CAAC,CAAC;YACpB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACzB,CAAC;QACD,SAAS,EAAE,KAAK;KACjB,CAAC;IACF,OAAO,IAAI,CAAC;AACd,CAAC","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { logger } from \"../logger.js\";\n\n/**\n * A timer loop is a loop over multiple instances of a promise every specific\n * time interval. It is different from `setInterval` in that it waits until the\n * promise is settled before it goes to the next iteration.\n * */\nexport interface TimerLoop {\n  /**\n   * Starts the timer loop. If the loop is already running, the loop will be\n   * restarted.\n   */\n  start: () => void;\n  /**\n   * Stops the timer loop. If the loop is not running, it is a no-op.\n   */\n  stop: () => void;\n  /**\n   * Whether the loop is running.\n   */\n  isRunning: boolean;\n}\n\n/**\n * Creates a timer loop with the given timeout and task.\n * @internal\n */\nexport function createTimerLoop(\n  timeoutInMs: number,\n  createTask: () => Promise<unknown>,\n): TimerLoop {\n  let token: ReturnType<typeof setTimeout>;\n  const loop = {\n    start: () => {\n      clearTimeout(token);\n      token = setTimeout(() => {\n        // Fire-and-forget background task with error handling\n        createTask()\n          .catch((err) => {\n            logger.verbose(\"Error in timer loop task: %O\", err);\n          })\n          .finally(loop.start)\n          .catch((err) => {\n            logger.verbose(\"Error in timer loop finally block: %O\", err);\n          });\n      }, timeoutInMs);\n      loop.isRunning = true;\n    },\n    stop: () => {\n      clearTimeout(token);\n      loop.isRunning = false;\n    },\n    isRunning: false,\n  };\n  return loop;\n}\n"]}
# Release History

## 1.0.0 (Unreleased)

## 2021-03-17

- Adds an internal helper method to mask "access_token" in the recorder rather than expecting users to provide it through the custom config `customizationsOnRecordings` from `RecorderEnvironmentSetup`. [#12759](https://github.com/Azure/azure-sdk-for-js/pull/12759)
With this change, users don't have to add callbacks(to mask `access_token`) in the `customizationsOnRecordings` array such as below.
  ```ts
    customizationsOnRecordings: [ recording => recording.replace(/"access_token":"[^"]*"/g, `"access_token":"access_token"`) ]
  ```

## 2020-01-28

- Single quotes can be present in the url path though unusual. When the url path has single quotes, the fixture generated by "nock" is incorrect leading to invalid recordings. [#13474](https://github.com/Azure/azure-sdk-for-js/pull/13474) introduces a workaround to be applied as part of the default customizations done on the generated recordings to fix the issue.
  (Nock Bug üêõ: https://github.com/nock/nock/issues/2136)

## 2020-12-02

- Refactored the code to enable `"browser"` module replacement when used with bundlers. Previously, even browser bundled copies of the recorder would carry dependencies on several Node packages, which would lead to unresolved dependency warnings in Rollup regarding node builtins. With this change, the recorder's browser mappings will avoid this issue.
- Initialized `dotenv` by default in the NockRecorder, since its use is ubiquitous. Clients using the recorder in Node no longer have to import and run `dotenv`, though packages that do import `dotenv` may continue to do so as always.

## 2020-08-27

- [Bug Fix] When the responses have binary content, "nock" library saves the fixture by converting them into hex values. [#10048](https://github.com/Azure/azure-sdk-for-js/pull/10048) fixed the issue if the status code in the response is 200. Now, allowing the rest of the "successful" status codes(200-299).
  [#10892](https://github.com/Azure/azure-sdk-for-js/pull/10892)

## 2020-08-21

- [Bug Fix] When the responses have binary content, "nock" library saves the fixture by converting them into hex values. Fixtures are now overridden before being saved as recordings by decoding the hex values into the buffer as expected if the "Content-Type" is "avro/binary".
  [#10048](https://github.com/Azure/azure-sdk-for-js/pull/10048)

## 2020-07-10

- [Bug Fix] Fixed an issue where the browser-recording file is saved before all the recorded requests are pushed to the array of recordings(request-response pairs). `await recorder.stop()` - stop() call is expected to be await-ed from now on.
  [#10013](https://github.com/Azure/azure-sdk-for-js/pull/10013)

## 2020-04-30

- Since Mocha 7.0.0, Mocha behaves as follows: "When conditionally skipping in the `it` test, related afterEach hooks are now executed"
  ([Source](https://github.com/mochajs/mocha/blob/master/CHANGELOG.md#700--2020-01-05)), now the `recorder.stop()` calls in the `afterEach()` will always be executed. Calling `recorder.skip` should not call `recorder.stop()` anymore.

## 2020-02-06

- If any URLs are meant to be replaced in the recordings with `replaceableVariables`, hostname from the URLs will be independently matched and replaced. [#7204](https://github.com/Azure/azure-sdk-for-js/issues/7204)
  - Example - ENV_VAR `ACCOUNT_URL=https://azureaccount.com/` is supposed to be replaced with `https://endpoint/`, `azureaccount.com` will be independently matched and replaced with `endpoint` too.
- Added the "soft-record" mode, which allows users to only record the tests that have changed. [#7213](https://github.com/Azure/azure-sdk-for-js/issues/7213)
- Added TestContext, TestContextInterface, TestContextTest in exchange of Mocha.Context. They're compatible types, but ours are easier to test.
- Added windowLens, a lens to modify and retrieve properties from the Window object. Useful for future refactorings.

- [BUG FIX] Tests leveraging `coreHttp.requestOptions.timeout` with empty recordings(no nock scopes with request-responses defined in the recording) fail during the playback mode when executed along with other tests. Fixed the issue by resetting nock's global state. More info - [#7264](https://github.com/Azure/azure-sdk-for-js/issues/7264)

## 2020-01-30

- [BUG FIX] Fixed a bug where the replacements aren't properly filtered in the JSON recordings. [#7175](https://github.com/Azure/azure-sdk-for-js/issues/7175)

## 2020-01-29

- [BREAKING] `replaceInRecordings` attribute of `RecorderEnvironmentSetup` interface has been renamed to `customizationsOnRecordings`.

## 2020-01-28

- [BUG FIX] Fixed a bug where the replacements provided aren't being replaced in the query-param parts of recordings, which is an expectation for playback. This caused a few test failures during playback for new recordings. More info [#7108](https://github.com/Azure/azure-sdk-for-js/issues/7108)

- [BREAKING] `setReplaceableVariables`, `setReplacements`, `skipQueryParams` methods of the recorder are no longer exposed.

  - Equivalent `RecorderEnvironmentSetup` type is being exported instead. An object of this type is expected to be passed in the `record()` call.
  - `record(this)` changes to `record(this, recorderEnvSetup)`, where `recorderEnvSetup` is of type `RecorderEnvironmentSetup`.
  - [PR #7083](https://github.com/Azure/azure-sdk-for-js/pull/7083)

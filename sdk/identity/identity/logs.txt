[node-tests] Tgis file os aclled
[node-tests]
[node-tests]
[node-tests]   ManagedIdentityCredential
[node-tests] azure:core-client:warning The baseUri option for SDK Clients has been deprecated, please use endpoint instead.
[node-tests] azure:core-client:warning The baseUri option for SDK Clients has been deprecated, please use endpoint instead.
[node-tests] Failed to replace the request. This might be expected if you're running multiple sendCredentialRequests() calls. Cannot replace non-existent property request
[node-tests] Failed to replace the request. This might be expected if you're running multiple sendCredentialRequests() calls. Cannot replace non-existent property request
[node-tests] getToken is called
[node-tests] attempted till after span is set
[node-tests] before acquireToken
[node-tests] authorityOptions=
[node-tests] azure:identity:info ManagedIdentityCredential => SetAppTokenProvider invoked with parameters- {"correlationId":"noCorrelationId","tenantId":"common","scopes":["scopes","openid","profile","offline_access"]}
[node-tests] azure:identity:info ManagedIdentityCredential - Azure Arc MSI => ManagedIdentityCredential - Azure Arc MSI: The environment variables needed are: IMDS_ENDPOINT and IDENTITY_ENDPOINT
[node-tests] azure:identity:info ManagedIdentityCredential - Fabric MSI => ManagedIdentityCredential - Fabric MSI: Unavailable. The environment variables needed are: IDENTITY_ENDPOINT, IDENTITY_HEADER and IDENTITY_SERVER_THUMBPRINT
[node-tests] azure:identity:info ManagedIdentityCredential - AppServiceMSI 2019 => ManagedIdentityCredential - AppServiceMSI 2019: Unavailable. The environment variables needed are: IDENTITY_ENDPOINT and IDENTITY_HEADER.
[node-tests] azure:identity:info ManagedIdentityCredential - AppServiceMSI 2017 => ManagedIdentityCredential - AppServiceMSI 2017: Unavailable. The environment variables needed are: MSI_ENDPOINT and MSI_SECRET.
[node-tests] azure:identity:info ManagedIdentityCredential - CloudShellMSI => ManagedIdentityCredential - CloudShellMSI: Unavailable. The environment variable MSI_ENDPOINT is needed.
[node-tests] azure:identity:info ManagedIdentityCredential - Token Exchange => ManagedIdentityCredential - Token Exchange: Unavailable. The environment variables needed are: AZURE_CLIENT_ID (or the client ID sent through the parameters), AZURE_TENANT_ID and AZURE_FEDERATED_TOKEN_FILE
[node-tests] azure:identity:info ManagedIdentityCredential - IMDS => ManagedIdentityCredential - IMDS: Pinging the Azure IMDS endpoint
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Attempting to send request f72ba24b-6e08-458e-a616-0da651768042
[node-tests] azure:core-rest-pipeline:info Request: {
[node-tests]   "url": "http://169.254.169.254/metadata/identity/oauth2/token",
[node-tests]   "headers": {
[node-tests]     "accept": "application/json",
[node-tests]     "accept-encoding": "gzip,deflate",
[node-tests]     "user-agent": "azsdk-js-identity/3.0.0-beta.1 core-rest-pipeline/1.9.3 Node/v16.14.2 OS/(x64-Windows_NT-10.0.22621)",
[node-tests]     "x-ms-client-request-id": "f72ba24b-6e08-458e-a616-0da651768042"
[node-tests]   },
[node-tests]   "method": "GET",
[node-tests]   "timeout": 300,
[node-tests]   "disableKeepAlive": false,
[node-tests]   "withCredentials": false,
[node-tests]   "tracingOptions": {
[node-tests]     "tracingContext": {
[node-tests]       "_contextMap": {}
[node-tests]     }
[node-tests]   },
[node-tests]   "requestId": "f72ba24b-6e08-458e-a616-0da651768042",
[node-tests]   "allowInsecureConnection": true,
[node-tests]   "enableBrowserStreams": false
[node-tests] }
[node-tests] {
[node-tests]   protocolMode: 'AAD',
[node-tests]   knownAuthorities: [],
[node-tests]   cloudDiscoveryMetadata: '',
[node-tests]   authorityMetadata: '{"tenant_discovery_endpoint":"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration","api-version":"1.1","metadata":[{"preferred_network":"login.microsoftonline.com","preferred_cache":"login.windows.net","aliases":["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]}]}',
[node-tests]   azureRegionConfiguration: { azureRegion: undefined, environmentRegion: undefined },
[node-tests]   skipAuthorityMetadataCache: false
[node-tests] }
[node-tests] Authority {
[node-tests]   _canonicalAuthority: UrlString { _urlString: 'https://undefined/common/' },
[node-tests]   _canonicalAuthorityUrlComponents: null,
[node-tests]   networkInterface: HttpClient {},
[node-tests]   cacheManager: NodeStorage {
[node-tests]     clientId: 'errclient',
[node-tests]     cryptoImpl: CryptoProvider {
[node-tests]       pkceGenerator: [PkceGenerator],
[node-tests]       guidGenerator: GuidGenerator {},
[node-tests]       hashUtils: HashUtils {}
[node-tests]     },
[node-tests]     cache: {
[node-tests]       'authority-metadata-errclient-undefined': [AuthorityMetadataEntity]
[node-tests]     },
[node-tests]     changeEmitters: [ [Function: bound handleChangeEvent] ],
[node-tests]     logger: Logger {
[node-tests]       level: 2,
[node-tests]       localCallback: [Function: loggerCallback],
[node-tests]       piiLoggingEnabled: false,
[node-tests]       correlationId: '',
[node-tests]       packageName: '@azure/msal-node',
[node-tests]       packageVersion: '1.12.0'
[node-tests]     }
[node-tests]   },
[node-tests]   authorityOptions: {
[node-tests]     protocolMode: 'AAD',
[node-tests]     knownAuthorities: [],
[node-tests]     cloudDiscoveryMetadata: '',
[node-tests]     authorityMetadata: '{"tenant_discovery_endpoint":"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration","api-version":"1.1","metadata":[{"preferred_network":"login.microsoftonline.com","preferred_cache":"login.windows.net","aliases":["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]}]}',
[node-tests]     azureRegionConfiguration: { azureRegion: undefined, environmentRegion: undefined },
[node-tests]     skipAuthorityMetadataCache: false
[node-tests]   },
[node-tests]   regionDiscovery: RegionDiscovery { networkInterface: HttpClient {} },
[node-tests]   regionDiscoveryMetadata: {
[node-tests]     region_used: undefined,
[node-tests]     region_source: undefined,
[node-tests]     region_outcome: undefined
[node-tests]   },
[node-tests]   proxyUrl: '',
[node-tests]   metadata: AuthorityMetadataEntity {
[node-tests]     expiresAt: 86400,
[node-tests]     canonical_authority: 'https://undefined/common/',
[node-tests]     aliases: undefined,
[node-tests]     preferred_cache: undefined,
[node-tests]     preferred_network: undefined,
[node-tests]     aliasesFromNetwork: false,
[node-tests]     authorization_endpoint: undefined,
[node-tests]     token_endpoint: undefined,
[node-tests]     end_session_endpoint: undefined,
[node-tests]     issuer: undefined,
[node-tests]     endpointsFromNetwork: false,
[node-tests]     jwks_uri: undefined
[node-tests]   }
[node-tests] }
[node-tests] this function is called
[node-tests] azure:core-rest-pipeline:info Response status code: 200
[node-tests] azure:core-rest-pipeline:info Headers: {}
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Received a response from request f72ba24b-6e08-458e-a616-0da651768042
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Maximum retries reached. Returning the last received response, or throwing the last received error.
[node-tests] azure:identity:info ManagedIdentityCredential - IMDS => ManagedIdentityCredential - IMDS: The Azure IMDS endpoint is available
[node-tests] azure:identity:info ManagedIdentityCredential - IMDS => ManagedIdentityCredential - IMDS: Using the default Azure IMDS endpoint http://169.254.169.254.
[node-tests] azure:identity:info IdentityClient: sending token request to [http://169.254.169.254/metadata/identity/oauth2/token?resource=scopes&api-version=2018-02-01&client_id=errclient]
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Attempting to send request 3508a2ac-746b-4dd1-b180-fd065b44fd5f
[node-tests] azure:core-rest-pipeline:info Request: {
[node-tests]   "url": "http://169.254.169.254/metadata/identity/oauth2/token?resource=REDACTED&api-version=2018-02-01&client_id=REDACTED",
[node-tests]   "headers": {
[node-tests]     "accept": "application/json",
[node-tests]     "metadata": "REDACTED",
[node-tests]     "accept-encoding": "gzip,deflate",
[node-tests]     "user-agent": "azsdk-js-identity/3.0.0-beta.1 core-rest-pipeline/1.9.3 Node/v16.14.2 OS/(x64-Windows_NT-10.0.22621)",
[node-tests]     "x-ms-client-request-id": "3508a2ac-746b-4dd1-b180-fd065b44fd5f"
[node-tests]   },
[node-tests]   "method": "GET",
[node-tests]   "timeout": 0,
[node-tests]   "disableKeepAlive": false,
[node-tests]   "withCredentials": false,
[node-tests]   "requestId": "3508a2ac-746b-4dd1-b180-fd065b44fd5f",
[node-tests]   "allowInsecureConnection": true,
[node-tests]   "enableBrowserStreams": false
[node-tests] }
[node-tests] azure:core-rest-pipeline:info Response status code: 404
[node-tests] azure:core-rest-pipeline:info Headers: {}
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Received a response from request 3508a2ac-746b-4dd1-b180-fd065b44fd5f
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Processing 2 retry strategies.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Processing retry strategy throttlingRetryStrategy.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Skipped.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Processing retry strategy exponentialRetryStrategy.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Skipped.
[node-tests] azure:core-rest-pipeline retryPolicy:info None of the retry strategies could work with the received response. Returning it.
[node-tests] azure:identity:warning IdentityClient: authentication error. HTTP status: 404, undefined
[node-tests] azure:identity:info IdentityClient: sending token request to [http://169.254.169.254/metadata/identity/oauth2/token?resource=scopes&api-version=2018-02-01&client_id=errclient]
[node-tests] this.metadata=
[node-tests] AuthorityMetadataEntity {
[node-tests]   expiresAt: 86400,
[node-tests]   canonical_authority: 'https://undefined/common/',
[node-tests]   aliases: undefined,
[node-tests]   preferred_cache: undefined,
[node-tests]   preferred_network: undefined,
[node-tests]   aliasesFromNetwork: false,
[node-tests]   authorization_endpoint: undefined,
[node-tests]   token_endpoint: undefined,
[node-tests]   end_session_endpoint: undefined,
[node-tests]   issuer: undefined,
[node-tests]   endpointsFromNetwork: false,
[node-tests]   jwks_uri: undefined
[node-tests] }
[node-tests] preferred cache
[node-tests] undefined
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Attempting to send request bc68eb5e-6033-476e-981b-99a8e9fdff2b
[node-tests] azure:core-rest-pipeline:info Request: {
[node-tests]   "url": "http://169.254.169.254/metadata/identity/oauth2/token?resource=REDACTED&api-version=2018-02-01&client_id=REDACTED",
[node-tests]   "headers": {
[node-tests]     "accept": "application/json",
[node-tests]     "metadata": "REDACTED",
[node-tests]     "accept-encoding": "gzip,deflate",
[node-tests]     "user-agent": "azsdk-js-identity/3.0.0-beta.1 core-rest-pipeline/1.9.3 Node/v16.14.2 OS/(x64-Windows_NT-10.0.22621)",
[node-tests]     "x-ms-client-request-id": "bc68eb5e-6033-476e-981b-99a8e9fdff2b"
[node-tests]   },
[node-tests]   "method": "GET",
[node-tests]   "timeout": 0,
[node-tests]   "disableKeepAlive": false,
[node-tests]   "withCredentials": false,
[node-tests]   "requestId": "bc68eb5e-6033-476e-981b-99a8e9fdff2b",
[node-tests]   "allowInsecureConnection": true,
[node-tests]   "enableBrowserStreams": false
[node-tests] }
[node-tests] azure:core-rest-pipeline:info Response status code: 404
[node-tests] azure:core-rest-pipeline:info Headers: {}
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Received a response from request bc68eb5e-6033-476e-981b-99a8e9fdff2b
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Processing 2 retry strategies.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Processing retry strategy throttlingRetryStrategy.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Skipped.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Processing retry strategy exponentialRetryStrategy.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Skipped.
[node-tests] azure:core-rest-pipeline retryPolicy:info None of the retry strategies could work with the received response. Returning it.
[node-tests] azure:identity:warning IdentityClient: authentication error. HTTP status: 404, undefined
[node-tests] azure:identity:info IdentityClient: sending token request to [http://169.254.169.254/metadata/identity/oauth2/token?resource=scopes&api-version=2018-02-01&client_id=errclient]
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Attempting to send request c34babc3-2170-4cc3-8cef-c48d85cf9d2f
[node-tests] azure:core-rest-pipeline:info Request: {
[node-tests]   "url": "http://169.254.169.254/metadata/identity/oauth2/token?resource=REDACTED&api-version=2018-02-01&client_id=REDACTED",
[node-tests]   "headers": {
[node-tests]     "accept": "application/json",
[node-tests]     "metadata": "REDACTED",
[node-tests]     "accept-encoding": "gzip,deflate",
[node-tests]     "user-agent": "azsdk-js-identity/3.0.0-beta.1 core-rest-pipeline/1.9.3 Node/v16.14.2 OS/(x64-Windows_NT-10.0.22621)",
[node-tests]     "x-ms-client-request-id": "c34babc3-2170-4cc3-8cef-c48d85cf9d2f"
[node-tests]   },
[node-tests]   "method": "GET",
[node-tests]   "timeout": 0,
[node-tests]   "disableKeepAlive": false,
[node-tests]   "withCredentials": false,
[node-tests]   "requestId": "c34babc3-2170-4cc3-8cef-c48d85cf9d2f",
[node-tests]   "allowInsecureConnection": true,
[node-tests]   "enableBrowserStreams": false
[node-tests] }
[node-tests] azure:core-rest-pipeline:info Response status code: 200
[node-tests] azure:core-rest-pipeline:info Headers: {}
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Received a response from request c34babc3-2170-4cc3-8cef-c48d85cf9d2f
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Processing 2 retry strategies.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Processing retry strategy throttlingRetryStrategy.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Skipped.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Processing retry strategy exponentialRetryStrategy.
[node-tests] azure:core-rest-pipeline retryPolicy:info Retry 0: Skipped.
[node-tests] azure:core-rest-pipeline retryPolicy:info None of the retry strategies could work with the received response. Returning it.
[node-tests] azure:identity:info IdentityClient: [http://169.254.169.254/metadata/identity/oauth2/token?resource=scopes&api-version=2018-02-01&client_id=errclient] token acquired, expires on 1506484173000
[node-tests] azure:identity:info ManagedIdentityCredential => SetAppTokenProvider has saved the token in cache
[node-tests] azure:identity:info ManagedIdentityCredential => token = token
[node-tests] CredentialUnavailableError: ManagedIdentityCredential: Authentication failed. Message invalid_cache_environment: Invalid environment when attempting to create cache entry
[node-tests]     at ManagedIdentityCredential.getToken (C:\code\sdk-for-js\sdk\identity\identity\src\credentials\managedIdentityCredential\index.ts:226:23)
[node-tests]     at processTicksAndRejections (node:internal/process/task_queues:96:5)
[node-tests]     at async IdentityTestContext.sendCredentialRequests (C:\code\sdk-for-js\sdk\identity\identity\test\httpRequests.ts:198:22)
[node-tests]     at async Context.<anonymous> (C:\code\sdk-for-js\sdk\identity\identity\test\internal\node\managedIdentityCredential.spec.ts:211:35)
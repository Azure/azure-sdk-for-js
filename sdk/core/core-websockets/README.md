# Azure Core WebSockets library for JavaScript

This is an implementation of web sockets which work in the browser and Node.js. This library is primarily intended to be used in code generated by [AutoRest](https://github.com/Azure/Autorest) and [`autorest.typescript`](https://github.com/Azure/autorest.typescript).

## Getting started

### Requirements

### Currently supported environments

- [LTS versions of Node.js](https://github.com/nodejs/release#release-schedule)
- Latest versions of Safari, Chrome, Edge, and Firefox.

See our [support policy](https://github.com/Azure/azure-sdk-for-js/blob/main/SUPPORT.md) for more details.

### Installation


Install the Azure Core WebSockets library with `npm`:

```bash
npm install @azure/core-websockets
```

## Key concepts

## createWebSocketClient

The `createWebSocketClient` function is the primary entry point for establishing a new WebSocket connection in this library. It abstracts the complexity of creating a connection and managing events.

### What It Does

- **URL Validation:**  
  The function first processes the provided WebSocket URL. It validates the URL and enforces secure connection policies, rejecting the Promise if the URL is invalid or an insecure connection is not permitted (unless explicitly allowed).

- **Connection Initialization:**  
  It sets up a connection manager that handles the process of opening the underlying WebSocket connection. This includes managing retries, abort signals, and internal status transitions.

- **Event Handling:**  
  The client supports event registration (using methods like `on` and `off`) and provides a Promise-like interface. This allows consumers to either:

  - Register callbacks for events such as **open**, **message**, **close**, and **error**, or  
  - Await the connection to be established by using the Promise-like behavior.

- **Underlying Implementations:**  
  Depending on the environment and options provided, it returns access to different underlying WebSocket implementations (for example, ws, Node.js native WebSocket, or browser WebSocket via `asWs` and `asWebSocket` methods).

### What It Returns

The function returns an object conforming to the `WebsocketClientWrapper` interface that includes:

- **Event-based Methods:**  
  - `asWs()`: Returns a Promise for a WebSocket client using a specific underlying implementation.
  - `asWebSocket()`: Returns a Promise for the native WebSocket (when available).

- **Promise Methods:**  
  The client object is "thenable" meaning you can call `.then()`, `.catch()`, and `.finally()` on it. This allows you to conveniently wait for the connection to open or handle an error if one occurs.

- **Status and Metadata:**  
  Read-only properties such as `status` and `identifier` provide runtime information about the connection.

## Examples

Examples can be found in the `samples` folder.

## Next steps

You can build and run the tests locally by executing `rushx test`. Explore the `test` folder to see advanced usage and behavior of the public classes.

## Troubleshooting

If you run into issues while using this library, please feel free to [file an issue](https://github.com/Azure/azure-sdk-for-js/issues/new).

## Contributing

If you'd like to contribute to this library, please read the [contributing guide](https://github.com/Azure/azure-sdk-for-js/blob/main/CONTRIBUTING.md) to learn more about how to build and test the code.

![Impressions](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fcore%2Fcore-rest-pipeline%2FREADME.png)
